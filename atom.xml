<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>phpsmarter</title>
  <subtitle>A beginner of React-native</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-03-23T08:57:15.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>phpsmarter</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æµ‹è¯•æ–‡ä»¶</title>
    <link href="http://yoursite.com/2017/03/23/new-article-2/"/>
    <id>http://yoursite.com/2017/03/23/new-article-2/</id>
    <published>2017-03-23T15:31:30.000Z</published>
    <updated>2017-03-23T08:57:15.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="testing" scheme="http://yoursite.com/categories/testing/"/>
    
    
      <category term="Redux" scheme="http://yoursite.com/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-å¦‚ä½•ä½¿ç”¨React,Reduxå’ŒImmutable-jsæ„å»ºTodo-App</title>
    <link href="http://yoursite.com/2017/03/23/%E7%BF%BB%E8%AF%91-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8React,Redux%E5%92%8CImmutable-js%E6%9E%84%E5%BB%BATodo-App/"/>
    <id>http://yoursite.com/2017/03/23/ç¿»è¯‘-å¦‚ä½•ä½¿ç”¨React,Reduxå’ŒImmutable-jsæ„å»ºTodo-App/</id>
    <published>2017-03-23T00:04:10.000Z</published>
    <updated>2017-03-23T08:49:17.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡æ˜¯ç¿»è¯‘ç‰ˆæœ¬,<a href="https://www.sitepoint.com/how-to-build-a-todo-app-using-react-redux-and-immutable-js/" target="_blank" rel="external">åŸæ–‡è¯·è§</a><br><em>By Dan Prince  May 03, 2016</em></p>
</blockquote>
<p>Reactä½¿ç”¨ç»„ä»¶å’Œå•å‘æ•°æ®æµæ–¹å¼æè¿°ç”¨æˆ·ç•Œé¢,ä½†æ˜¯Reactå¯¹stateçš„å¤„ç†éå¸¸çš„ç®€å•.è¿™ä¸€ç‚¹è®©æˆ‘ä»¬çŸ¥é“,Reactä»…ä»…åªå½“äºä¼ ç»Ÿçš„<code>Model-View-Controller</code>æ„æ¶çš„<code>View</code>å±‚.</p>
<p>ä»…ä»…ä½¿ç”¨Reactä¹Ÿå¯ä»¥æ„å»ºå¤§å‹çš„app,ä½†æ˜¯å¾ˆå¿«æˆ‘ä»¬ä¼šå‘ç°,è¦ä¿æŒä»£ç çš„ç®€æ´,æˆ‘ä»¬éœ€è¦åœ¨å…¶ä»–åœ°æ–¹ç®¡ç†state(æŠŠstateçš„ç®¡ç†ç‹¬ç«‹å‡ºæ¥).</p>
<p>æ²¡æœ‰å®˜æ–¹ç®¡ç†åº”ç”¨stateçš„å·¥å…·,ä½†æ˜¯æœ‰å‡ ä¸ªåº“å·¥ä½œçš„çš„ä¸é”™.ä»Šå¤©æˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªåº“å’ŒReactä¸€èµ·æ¥æ„å»ºä¸€ä¸ªç®€å•çš„app.</p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>Reduxæ˜¯ä¸€ä¸ªå°å‹çš„jsåº“,ä½œä¸ºappçš„stateå®¹å™¨.ç³…åˆäº†Flucå’ŒElmçš„æ¦‚å¿µ.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Reduxç®¡ç†ä»»ä½•appçš„state,åªè¦æˆ‘ä»¬ç´§æ‰£ä¸‹é¢çš„æŒ‡å¯¼ï¼š</p>
<ol>
<li>æˆ‘ä»¬çš„stateä¿æŒåœ¨ä¸€ä¸ªå•ä¸€çš„storeä¸­</li>
<li>stateçš„æ”¹å˜åªä¼šæ¥è‡ªäºactions</li>
</ol>
<p>Reduxçš„æ ¸å¿ƒ storeæ˜¯ä¸€ä¸ªå‡½æ•°,å®ƒæ¥æ”¶å½“å‰çš„applicationçš„stateå’Œä¸€ä¸ªaction,åˆå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„application state,è¿™ä¸ªå‡½æ•°å«åšReducer.</p>
<p>æˆ‘ä»¬çš„Reactç»„ä»¶è´Ÿè´£å‘é€actionsåˆ°æˆ‘ä»¬çš„store,åè¿‡æ¥,å¦‚æœç»„ä»¶éœ€è¦æ¸²æŸ“çš„æ—¶å€™,storeä¼šé€šçŸ¥ä»–.</p>
<h2 id="ImmutableJS"><a href="#ImmutableJS" class="headerlink" title="ImmutableJS"></a>ImmutableJS</h2><p>å› ä¸ºReduxä¸å…è®¸æˆ‘ä»¬mutateç¨‹åºçš„state,å¦‚æœå€ŸåŠ©immutableæ•°æ®ç»“æ„æ¨¡å‹åŒ–åº”ç”¨ç¨‹åºçš„stateå°†ä¼šéå¸¸çš„æœ‰ç”¨.<br><code>Immutable.js</code>ä½¿ç”¨çªå˜ç•Œé¢(mutative interfaces)æä¾›ä¸€äº›immutableæ•°æ®ç»“æ„,è¿™äº›ç•Œé¢å®æ–½æ—¶éå¸¸çš„é«˜æ•ˆ,çµæ„Ÿæ¥è‡ªäºClojureå’ŒScala.</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>æˆ‘ä»¬å°†ä¼šä½¿ç”¨React,Reduxå’ŒImmutableJSå»æ„å»ºä¸€ä¸ªç®€å•çš„todo list,å…è®¸æˆ‘ä»¬æ·»åŠ todos,åœ¨å®Œæˆå’Œæœªå®Œæˆä¹‹é—´åˆ‡æ¢.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//html</div><div class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">//css</div><div class="line"> html, body, input, button &#123;</div><div class="line">  font-family: Sawasdee;</div><div class="line">  font-size: 20px;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo__list &#123;</div><div class="line">  margin: 0;</div><div class="line">  padding: 0;</div><div class="line">  list-style-type: none;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo__item &#123;</div><div class="line">  padding: .5em .25em;</div><div class="line">  border-bottom: solid 1px #eee;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo__item:hover &#123;</div><div class="line">  background: #f7f7f7;</div><div class="line">  cursor: pointer;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo__entry &#123;</div><div class="line">  border: solid 1px #ccc;</div><div class="line">  padding: .25em .5em;</div><div class="line">  border-radius: .2em;</div><div class="line">  background: #f3f3f3;</div><div class="line">  width: 100%;</div><div class="line">  box-sizing: border-box;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo__button &#123;</div><div class="line">  border: 0;</div><div class="line">  border-radius: .2em;</div><div class="line">  background: #71B7FF;  </div><div class="line">  color: #fff;</div><div class="line">  padding: .25em .5em;</div><div class="line">  margin: .5em 0;</div><div class="line">  margin-right: .25em;</div><div class="line">  cursor: pointer;</div><div class="line">&#125;</div><div class="line"></div><div class="line">.todo__button:hover &#123;</div><div class="line">  background: #B2D8FF;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//js</span></div><div class="line"><span class="keyword">const</span> &#123; <span class="built_in">Map</span>, List &#125; = Immutable;</div><div class="line"><span class="keyword">const</span> &#123; createStore &#125; = Redux;</div><div class="line"><span class="keyword">const</span> &#123; Provider, connect &#125; = reactRedux;</div><div class="line"></div><div class="line"><span class="keyword">const</span> components = &#123;</div><div class="line">  Todo(&#123; todo &#125;) &#123;</div><div class="line">    <span class="keyword">if</span>(todo.isDone) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">strike</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">strike</span>&gt;</span></span>;  </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  TodoList(&#123; todos, toggleTodo, addTodo &#125;) &#123;</div><div class="line">    <span class="keyword">const</span> onSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> text = e.target.value;</div><div class="line">      <span class="keyword">if</span>(e.which === <span class="number">13</span> &amp;&amp; text.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        addTodo(text);</div><div class="line">        e.target.value = <span class="string">''</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> toggleClick = <span class="function">(<span class="params">id</span>) =&gt;</span> () =&gt; toggleTodo(id);</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> &#123; Todo &#125; = components;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div className='todo'&gt;</div><div class="line">        &lt;input type='text'</div><div class="line">               className='todo__entry'</div><div class="line">               placeholder='Add todo'</div><div class="line">               onKeyDown=&#123;onSubmit&#125; /&gt;</div><div class="line">        &lt;ul className='todo__list'&gt;</div><div class="line">          &#123;todos.map(t =&gt; (</div><div class="line">            &lt;li</div><div class="line">              key=&#123;t.get('id')&#125;</div><div class="line">              className='todo__item'</div><div class="line">              onClick=&#123;toggleClick(t.get('id'))&#125;&gt;</div><div class="line">              &lt;Todo todo=&#123;t.toJS()&#125; /&gt;</div><div class="line">            &lt;/li&gt;</div><div class="line">          ))&#125; </div><div class="line">        &lt;/ul&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const actions = &#123;</div><div class="line">  addTodo(text) &#123;</div><div class="line">    return &#123;</div><div class="line">      type: 'ADD_TODO',</div><div class="line">      payload: &#123;</div><div class="line">        id: Math.random().toString(34).slice(2),</div><div class="line">        isDone: false,</div><div class="line">        text</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line">  toggleTodo(id) &#123;</div><div class="line">    return &#123;</div><div class="line">      type: 'TOGGLE_TODO',</div><div class="line">      payload: id</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const init = List();</div><div class="line"></div><div class="line">const reducer = function(state=init, action) &#123;</div><div class="line">  switch(action.type) &#123;</div><div class="line">    case 'ADD_TODO':</div><div class="line">      return state.push(</div><div class="line">        Map(action.payload)</div><div class="line">      );</div><div class="line">    case 'TOGGLE_TODO':</div><div class="line">      return state.map(t =&gt; &#123;</div><div class="line">        if(t.get('id') == action.payload) &#123;</div><div class="line">          return t.update('isDone', isDone =&gt; !isDone);</div><div class="line">        &#125; else &#123;</div><div class="line">          return t;</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">    default:</div><div class="line">      return state;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const containers = &#123;</div><div class="line">  TodoList: connect(</div><div class="line">    function mapStateToProps(state) &#123;</div><div class="line">      return &#123;</div><div class="line">        todos: state</div><div class="line">      &#125;;</div><div class="line">    &#125;,</div><div class="line">    function mapDispatchToProps(dispatch) &#123;</div><div class="line">      return &#123;</div><div class="line">        toggleTodo: (id) =&gt; dispatch(actions.toggleTodo(id)),</div><div class="line">        addTodo: (text) =&gt; dispatch(actions.addTodo(text))</div><div class="line">      &#125;;</div><div class="line">    &#125;</div><div class="line">  )(components.TodoList)</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const &#123; TodoList &#125; = containers;</div><div class="line">const store = createStore(reducer);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">    &lt;TodoList /&gt;</div><div class="line">  &lt;/Provider&gt;,</div><div class="line">  document.getElementById('app')</div><div class="line">);</div></pre></td></tr></table></figure>
<hr>
<p>ä»£ç åœ¨ <a href="https://github.com/sitepoint-editors/immutable-redux-todo" target="_blank" rel="external">Github</a></p>
<blockquote>
<p>å¯èƒ½æç¤ºbuildå¤±è´¥,<code>npm install babel-core</code>è¯•è¯•</p>
</blockquote>
<h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><p>ä»åˆ›å»ºé¡¹ç›®ğŸ“‚å¼€å§‹,å»ºç«‹ä¸€ä¸ªpackage.jsonæ–‡ä»¶.ç„¶åå®‰è£…éœ€è¦çš„ä¾èµ–åŒ….</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> npm install --save react react-dom redux react-redux immutable</div><div class="line">npm install --save-dev webpack babel-loader babel-preset-es2015 babel-preset-react</div></pre></td></tr></table></figure>
<hr>
<p>ä½¿ç”¨JSXå’ŒES2015,ç”¨Babelç¼–è¯‘ä»£ç ,ä½¿ç”¨Webpackæ¥å®Œæˆè¿™ä¸ªæ¨¡å—ç»‘å®šè¿‡ç¨‹.</p>
<p>åœ¨<code>webpack.config.js</code>æ–‡ä»¶ä¸­åˆ›å»ºWebpacké…ç½®æ–‡ä»¶.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> <span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">entry</span>: <span class="string">'./src/app.js'</span>,</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: __dirname,</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.js'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">module</span>: &#123;</div><div class="line">    <span class="attr">loaders</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">        <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">        <span class="attr">query</span>: &#123; <span class="attr">presets</span>: [ <span class="string">'es2015'</span>, <span class="string">'react'</span> ] &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<hr>
<p>æœ€åæ‰©å±•ä¸€ä¸‹<code>package.json</code>,æ·»åŠ ä¸€ä¸ªnpm scriptä½¿ç”¨source mapsç¼–è¯‘æˆ‘ä»¬çš„ä»£ç .</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> "scripts": &#123;</div><div class="line">  "build": "webpack --debug"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>æ¯æ¬¡ç¼–è¯‘ä»£ç çš„æ—¶å€™,è¿è¡Œ<code>npm run build</code>.</p>
<h2 id="React-amp-Components"><a href="#React-amp-Components" class="headerlink" title="React&amp;Components"></a>React&amp;Components</h2><p>åœ¨å®æ–½é¡¹ç›®ä¹‹å‰,å…ˆåˆ›å»ºä¸€äº›å‚»ç“œæ•°æ®æœ‰å¾ˆå¤§çš„ç”¨å¤„,ä½†æˆ‘ä»¬æ„æ€éœ€è¦æ¸²æŸ“çš„ç»„ä»¶çš„æ—¶å€™,æœ‰ä¸€ç‚¹ç‚¹åˆæ­¥çš„æ„Ÿè§‰.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">const</span> dummyTodos = [</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">isDone</span>: <span class="literal">true</span>,  <span class="attr">text</span>: <span class="string">'make components'</span> &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'design actions'</span> &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'implement reducer'</span> &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'connect components'</span> &#125;</div><div class="line">];</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªReactç»„ä»¶<code>&lt;Todo/&gt;</code>å’Œ<code>&lt;TodoList&gt;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// src/components.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Todo</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> &#123; todo &#125; = props;</div><div class="line">  <span class="keyword">if</span>(todo.isDone) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">strike</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">strike</span>&gt;</span></span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoList</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> &#123; todos &#125; = props;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div className='todo'&gt;</div><div class="line">      &lt;input type='text' placeholder='Add todo' /&gt;</div><div class="line">      &lt;ul className='todo__list'&gt;</div><div class="line">        &#123;todos.map(t =&gt; (</div><div class="line">          &lt;li key=&#123;t.id&#125; className='todo__item'&gt;</div><div class="line">            &lt;Todo todo=&#123;t&#125; /&gt;</div><div class="line">          &lt;/li&gt;</div><div class="line">        ))&#125;</div><div class="line">      &lt;/ul&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>åˆ°äº†è¿™ä¸€æ­¥,å¯ä»¥åˆ›å»º<code>index.html</code>æ–‡ä»¶æ¥æµ‹è¯•è¿™äº›ç»„ä»·,æ·»åŠ ä¸‹é¢çš„æ ‡è®°</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Immutable Todo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<hr>
<p>è¿˜æœ‰ä¸€ä¸ªé¡¹ç›®çš„å…¥å£æ–‡ä»¶<code>src/app.js</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/app.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123; TodoList &#125; <span class="keyword">from</span> <span class="string">'./components'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> dummyTodos = [</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">isDone</span>: <span class="literal">true</span>,  <span class="attr">text</span>: <span class="string">'make components'</span> &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'design actions'</span> &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'implement reducer'</span> &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'connect components'</span> &#125;</div><div class="line">];</div><div class="line"></div><div class="line">render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">todos</span>=<span class="string">&#123;dummyTodos&#125;</span> /&gt;</span>,</span></div><div class="line">  document.getElementById('app')</div><div class="line">);</div></pre></td></tr></table></figure>
<hr>
<p>ä½¿ç”¨<code>npm run build</code>ç¼–è¯‘æ–‡ä»¶,ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€index.htmlæ–‡ä»¶,ç¡®ä¿è¿è¡Œ.</p>
<h2 id="Redux-amp-ImmutableJS"><a href="#Redux-amp-ImmutableJS" class="headerlink" title="Redux&amp;ImmutableJS"></a>Redux&amp;ImmutableJS</h2><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†å¾ˆå¥½çš„UI,å¯ä»¥å¼€å§‹è€ƒè™‘ç»„ä»¶æœ€åçš„state.å¼€å§‹åˆ›å»ºçš„å‚»ç“œæ•°æ®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€ç«¯,æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“è½¬åŒ–ä¸ºImmutableJSé›†åˆ.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> &#123; List, <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> dummyTodos = List([</div><div class="line">  <span class="built_in">Map</span>(&#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">isDone</span>: <span class="literal">true</span>,  <span class="attr">text</span>: <span class="string">'make components'</span> &#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'design actions'</span> &#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'implement reducer'</span> &#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">isDone</span>: <span class="literal">false</span>, <span class="attr">text</span>: <span class="string">'connect components'</span> &#125;)</div><div class="line">]);</div></pre></td></tr></table></figure>
<hr>
<p>ImmutableJS mapå’ŒJavascriptçš„å¯¹è±¡å·¥ä½œæ–¹å¼ä¸åŒ,æ‰€ä»¥æˆ‘ä»¬è¦å¯¹ç»„ä»¶åšä¸€ç‚¹è½»å¾®çš„æ”¹å˜.propertyæ¥å…¥çš„åœ°æ–¹(ä¾‹å¦‚ï¼štodo.id)éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ¥ä»£æ›¿(ä¾‹å¦‚:<code>todo.get(â€˜idâ€™)</code>).</p>
<h2 id="è®¾è®¡Actions"><a href="#è®¾è®¡Actions" class="headerlink" title="è®¾è®¡Actions"></a>è®¾è®¡Actions</h2><p>ç°åœ¨æˆ‘ä»¬è·å¾—äº†æ•°æ®çš„ç‰¹å¾,å¯ä»¥è€ƒè™‘ä¸€ä¸‹actionsçš„æ›´æ–°.è¿™ä¸ªå®ä¾‹ä¸­,æˆ‘ä»¬ä»…ä»…éœ€è¦ä¸¤ä¸ªacions,ä¸€ä¸ªæ˜¯æ·»åŠ æ–°çš„todo,å¦ä¸€ä¸ªè½¬æ¢todoçš„çŠ¶æ€.</p>
<p>è®©æˆ‘ä»¬å®šä¹‰å‡ ä¸ªå‡½æ•°åˆ›å»ºè¿™äº›actions</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// src/actions.js</span></div><div class="line"></div><div class="line"><span class="comment">// succinct hack for generating passable unique ids</span></div><div class="line"><span class="keyword">const</span> uid = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Math</span>.random().toString(<span class="number">34</span>).slice(<span class="number">2</span>);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addTodo</span>(<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'ADD_TODO'</span>,</div><div class="line">    <span class="attr">payload</span>: &#123;</div><div class="line">      <span class="attr">id</span>: uid(),</div><div class="line">      <span class="attr">isDone</span>: <span class="literal">false</span>,</div><div class="line">      <span class="attr">text</span>: text</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'TOGGLE_TODO'</span>,</div><div class="line">    <span class="attr">payload</span>: id</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>æ¯ä¸€ä¸ªactionä»…ä»…æ˜¯ä¸€ä¸ªæœ‰typeå’Œpayloadçš„å±æ€§å¯¹è±¡.åœ¨æˆ‘ä»¬è§¦å‘actionå,typeå±æ€§å¸®åŠ©æˆ‘ä»¬ç”¨payloadæ¥ä½œä»€ä¹ˆ.</p>
<h2 id="è®¾è®¡ä¸€ä¸ªReducer"><a href="#è®¾è®¡ä¸€ä¸ªReducer" class="headerlink" title="è®¾è®¡ä¸€ä¸ªReducer"></a>è®¾è®¡ä¸€ä¸ªReducer</h2><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†stateçš„ç‰¹æ€§å’Œæ›´æ–°stateçš„action,æˆ‘ä»¬å¯ä»¥åˆ›å»ºreduceräº†.ä»…ä»…æé†’ä¸€ä¸‹,reduceræ˜¯ä¸€ä¸ªæ¥æ”¶stateå’Œactionçš„å‡½æ•°,ç„¶åç”¨æ¥è®¡ç®—æ›´æ–°state.</p>
<p>è¿™é‡Œæ˜¯æˆ‘ä»¬reducerçš„åˆå§‹ç»“æ„.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// src/reducer.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; List, <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> init = List([]);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">todos=init, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span>(action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> todos;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>æ“ä½œ<code>ADD_TODO</code>actionéå¸¸ç®€å•,å¯æ˜¯ä½¿ç”¨<code>.push()</code>æ–¹æ³•,è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨,æ·»åŠ todoåˆ°æœ«å°¾.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line"> <span class="keyword">return</span> todos.push(<span class="built_in">Map</span>(action.payload));</div></pre></td></tr></table></figure>
<hr>
<p>è®°ä½è¦pushåˆ°åˆ—è¡¨ä¹‹å‰,è¦æŠŠtodoå¯¹è±¡è½¬å˜ä¸ºimmutable map.</p>
<p>æˆ‘ä»¬éœ€è¦å¤„ç†çš„ç¨å¾®å¤æ‚çš„actionæ˜¯<code>TOOGLE_TODO</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line"> <span class="keyword">return</span> todos.map(<span class="function"><span class="params">t</span> =&gt;</span> &#123;</div><div class="line">   <span class="keyword">if</span>(t.get(<span class="string">'id'</span>) === action.payload) &#123;</div><div class="line">     <span class="keyword">return</span> t.update(<span class="string">'isDone'</span>, isDone =&gt; !isDone);</div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">     <span class="keyword">return</span> t;</div><div class="line">   &#125;</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘ä»¬ä½¿ç”¨<code>.map()</code>éå†åˆ—è¡¨,æ‰¾åˆ°ä¸aciton<code>id</code>åŒ¹é…çš„todoé¡¹ç›®.ä¹‹åæˆ‘ä»¬è°ƒç”¨<code>.update()</code>æ–¹æ³•,æ¥æ”¶ä¸€ä¸ªé”®å’Œå‡½æ•°,ç„¶åè¿”å›ä¸€ä¸ªmapçš„æ–°æ‹·è´åˆ°updataå‡½æ•°,æ–°æ‹·è´ä¸­æ–°å€¼æ›¿æ¢äº†åˆå§‹å€¼.</p>
<p>å­—é¢é‡ç‰ˆæœ¬<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">const</span> todo = <span class="built_in">Map</span>(&#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">text</span>: <span class="string">'foo'</span>, <span class="attr">isDone</span>: <span class="literal">false</span> &#125;);</div><div class="line">todo.update(<span class="string">'isDone'</span>, isDone =&gt; !isDone);</div><div class="line"><span class="comment">// =&gt; &#123; id: 0, text: 'foo', isDone: true &#125;</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½è¿ç³»åˆ°ä¸€èµ·"><a href="#æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½è¿ç³»åˆ°ä¸€èµ·" class="headerlink" title="æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½è¿ç³»åˆ°ä¸€èµ·"></a>æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½è¿ç³»åˆ°ä¸€èµ·</h2><p>actionså’Œreducerå‡†å¤‡å¥½äº†,å¯ä»¥åˆ›å»ºä¸€ä¸ªstore,è¿æ¥åˆ°æˆ‘ä»¬çš„Reactç»„ä»¶ä¸­.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// src/app.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> &#123; TodoList &#125; <span class="keyword">from</span> <span class="string">'./components'</span>;</div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> store = createStore(reducer);</div><div class="line"></div><div class="line">render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">todos</span>=<span class="string">&#123;store.getState()&#125;</span> /&gt;</span>,</span></div><div class="line">  document.getElementById('app')</div><div class="line">);</div></pre></td></tr></table></figure>
<hr>
<p>ä¸ºäº†ä¿æŒç»„ä»¶å’Œstoreçš„ç‹¬ç«‹,æˆ‘ä»¬ä½¿ç”¨<code>react-redux</code>å¸®åŠ©ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹.å®ƒå…è®¸æˆ‘ä»¬åˆ›å»ºç‹¬ç«‹äºstoreçš„å®¹å™¨,åŒ…è£…æ‰€æœ‰çš„ç»„ä»¶,æˆ‘ä»¬ä¸éœ€è¦æ”¹å˜å…ˆå‰çš„è®¾è®¡.</p>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¹å™¨åŒ…è£…<code>&lt;TodoList/&gt;</code>ç»„ä»¶,çœ‹çœ‹ä¸‹é¢çš„å†…å®¹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// src/containers.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> components <span class="keyword">from</span> <span class="string">'./components'</span>;</div><div class="line"><span class="keyword">import</span> &#123; addTodo, toggleTodo &#125; <span class="keyword">from</span> <span class="string">'./actions'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> TodoList = connect(</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">)(components.TodoList);</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘ä»¬ä½¿ç”¨<code>connect</code>å‡½æ•°åˆ›å»ºå®¹å™¨.å½“æˆ‘ä»¬è°ƒç”¨<code>connect()</code>å‡½æ•°,ä¼ é€’ä¸¤ä¸ªå‡½æ•°,<code>mapStateToProps()</code>å’Œ<code>mapDispatchToProps()</code>.</p>
<p><code>mapStateToProps()</code>å‡½æ•°æ¥æ”¶å½“å‰storeçš„stateä½œä¸ºå‚æ•°,æœŸå¾…è¿”å›ä¸€ä¸ªæˆ‘ä»¬åŒ…è£…ç»„ä»¶éœ€è¦çš„å¯¹è±¡æ˜ å°„.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">todos</span>: state &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ä¸‹é¢ä»£ç æ˜¯ä¸€ä¸ªåŒ…è£…ç»„ä»¶æ ¹æ®æ˜ å°„mapå¯è§†åŒ–çš„ç»“æœ.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;TodoList todos=&#123;state&#125; /&gt;</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘ä»¬ä¹Ÿéœ€è¦æä¾›<code>mapDispatchProps</code>å‡½æ•°,ä¼ é€’storeçš„<code>dispatch</code>æ–¹æ³•,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨action creatrosæ¥dispatch actions.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">addTodo</span>: <span class="function"><span class="params">text</span> =&gt;</span> dispatch(addTodo(text)),</div><div class="line">    <span class="attr">toggleTodo</span>: <span class="function"><span class="params">id</span> =&gt;</span> dispatch(toggleTodo(id))</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>å†ä¸€æ¬¡å®ä¾‹åŒ–ç»„ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;TodoList todos=&#123;state&#125;</div><div class="line">         addTodo=&#123;text =&gt; dispatch(addTodo(text))&#125;</div><div class="line">         toggleTodo=&#123;id =&gt; dispatch(toggleTodo(id))&#125; /&gt;</div></pre></td></tr></table></figure>
<hr>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠaction creatorsæ˜ å°„åˆ°ç»„ä»¶,å¯ä»¥ä»äº‹ä»¶ç›‘å¬ä¸­è°ƒç”¨.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoList</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> &#123; todos, toggleTodo, addTodo &#125; = props;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> onSubmit = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> input = event.target;</div><div class="line">    <span class="keyword">const</span> text = input.value;</div><div class="line">    <span class="keyword">const</span> isEnterKey = (event.which == <span class="number">13</span>);</div><div class="line">    <span class="keyword">const</span> isLongEnough = text.length &gt; <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(isEnterKey &amp;&amp; isLongEnough) &#123;</div><div class="line">      input.value = <span class="string">''</span>;</div><div class="line">      addTodo(text);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> toggleClick = <span class="function"><span class="params">id</span> =&gt;</span> event =&gt; toggleTodo(id);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div className='todo'&gt;</div><div class="line">      &lt;input type='text'</div><div class="line">             className='todo__entry'</div><div class="line">             placeholder='Add todo'</div><div class="line">             onKeyDown=&#123;onSubmit&#125; /&gt;</div><div class="line">      &lt;ul className='todo__list'&gt;</div><div class="line">        &#123;todos.map(t =&gt; (</div><div class="line">          &lt;li key=&#123;t.get('id')&#125;</div><div class="line">              className='todo__item'</div><div class="line">              onClick=&#123;toggleClick(t.get('id'))&#125;&gt;</div><div class="line">            &lt;Todo todo=&#123;t.toJS()&#125; /&gt;</div><div class="line">          &lt;/li&gt;</div><div class="line">        ))&#125;</div><div class="line">      &lt;/ul&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>containerå®¹å™¨è‡ªåŠ¨è®¢é˜…storeçš„å˜åŒ–,åªè¦çš„æ˜ å°„çš„propså˜åŒ–çš„æ—¶å€™,å®¹å™¨åŒ…è£…çš„ç»„ä»¶å°±ä¼šé‡æ–°æ¸²æŸ“.</p>
<p>æœ€å,éœ€è¦ä½¿å®¹å™¨ç»„ä»¶ç‹¬ç«‹äºstore,ä½¿ç”¨<code>&lt;Provider/&gt;</code>ç»„ä»¶.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// src/app.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</div><div class="line"><span class="keyword">import</span> &#123; TodoList &#125; <span class="keyword">from</span> <span class="string">'./containers'</span>;</div><div class="line"><span class="comment">//                          ^^^^^^^^^^</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> store = createStore(reducer);</div><div class="line"></div><div class="line">render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">TodoList</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</div><div class="line">);</div></pre></td></tr></table></figure>
<hr>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ä¸å¯å¦è®¤,å¯¹äºåˆå­¦è€…æ¥è¯´,Reactå’ŒReduxçš„ç”Ÿæ€ç³»ç»Ÿæ˜¯ç›¸å½“å¤æ‚å’Œä»¤äººè¿·æƒ‘çš„.<br>ä½†æ˜¯å¥½æ¶ˆæ¯æ˜¯è¿™äº›æ¦‚å¿µæ˜¯å¯ä»¥å¯ä»¥è½¬ç§»çš„.æˆ‘ä»¬ä»…ä»…ç²—ç•¥çš„æ¥è§¦äº†Reduxçš„åŸºç¡€æ„æ¶,ä½†æ˜¯å·²ç»è¶³å¤Ÿæˆ‘ä»¬å­¦ä¹ <code>Elm æ„æ¶</code>,æˆ–è€…é€‰å–ClojureScriptåº“ä¾‹å¦‚ï¼š<code>Om</code>,<code>Re-frame</code>.ç±»ä¼¼çš„,æˆ‘ä»¬ä»…ä»…çœ‹åˆ°immutableæ•°æ®ç»“æ„çš„åªè¨€ç‰‡è¯­,ä½†æ˜¯å·²ç»è¶³å¤Ÿæˆ‘ä»¬å­¦ä¹ <code>Clojure</code>æˆ–è€…<code>Haskell</code>.</p>
<p>ä¸ç®¡ä½ æ˜¯åˆšå¼€å§‹æ¢ç´¢æœ‰å…³stateçš„webç¼–ç¨‹å¼€å‘è€…,è¿˜æ˜¯ä½¿ç”¨javascriptå¾ˆé•¿æ—¶é—´çš„å¼€å‘è€…,åŸºäºactionæ„æ¶çš„åŠæˆå’Œimmutableæ•°æ®ç»“æ„å˜å¾—è‡³è§‚é‡è¦çš„æŠ€èƒ½.æ‰€ä»¥ç°åœ¨æ˜¯å­¦ä¹ è¿™äº›å†…å®¹çš„æ—¶é—´äº†.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯ç¿»è¯‘ç‰ˆæœ¬,&lt;a href=&quot;https://www.sitepoint.com/how-to-build-a-todo-app-using-react-redux-and-immutable-js/&quot; target=&quot;_blank&quot; rel=
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-è®©æˆ‘ä»¬æŠŠReact-Containerç»„åˆèµ·æ¥</title>
    <link href="http://yoursite.com/2017/03/21/%E7%BF%BB%E8%AF%91-%E8%AE%A9%E6%88%91%E4%BB%AC%E6%8A%8AReact-Container%E7%BB%84%E5%90%88%E8%B5%B7%E6%9D%A5/"/>
    <id>http://yoursite.com/2017/03/21/ç¿»è¯‘-è®©æˆ‘ä»¬æŠŠReact-Containerç»„åˆèµ·æ¥/</id>
    <published>2017-03-21T00:04:10.000Z</published>
    <updated>2017-03-23T08:48:14.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><em>Arunoda Susiripala</em>  <a href="https://voice.kadira.io/let-s-compose-some-react-containers-3b91b6d9b7c8#.92sjwgug1" target="_blank" rel="external">è¯·å‚çœ‹åŸæ–‡</a></p>
</blockquote>
<p>è¿‘æ¥(Jan,2016),è‡ªç»™è‡ªè¶³çš„container(Reduxçš„å®¹å™¨)æ–¹æ³•åœ¨Reactçš„ç¤¾åŒºä¸­éå¸¸çš„æµè¡Œ.ä»–ä»¬åœ¨Realy,Reduxç”šè‡³æ˜¯åœ¨Meteorä¸­å¹¿æ³›ä½¿ç”¨.è¿™ç¯‡æ–‡ç« é‡Œæˆ‘ä»¬æ·±å…¥containerå†…éƒ¨,äº†è§£ä¸€ä¸‹æ€ä¹ˆç®€ä¾¿çš„ç»„åˆcontainers.</p>
<h2 id="ä»€ä¹ˆæ˜¯Container"><a href="#ä»€ä¹ˆæ˜¯Container" class="headerlink" title="ä»€ä¹ˆæ˜¯Container?"></a>ä»€ä¹ˆæ˜¯Container?</h2><p>åœ¨Reactä¸­,æˆ‘ä»¬æœ‰propså’Œstatesæ¥ç®¡ç†ç»„ä»¶çš„æ•°æ®éœ€æ±‚.æœ€è¿‘æœ‰ä¸€ä¸ªè¶‹åŠ¿,åœ¨ç»„ä»¶ä¸­ä»…ä»…åªé€šè¿‡propsæ¥æ¥æ”¶æ•°æ®å’Œaction.æˆ‘ä»¬ä»…ä»…åœ¨ç»„ä»¶å†…éƒ¨ä¿ç•™state.</p>
<p>æˆ‘ä»¬æœ‰æ—¶å€™å«è¿™äº›ç»„ä»¶ä¸ºâ€œå•çº¯å±•ç¤ºç»„ä»¶â€.<br>æˆ‘ä¹Ÿä¸å¤ªç¡®å®šè°å‘æ˜çš„è¿™ä¸ªæœ¯è¯­.ä½†æ˜¯æˆ‘æ‰å¯èƒ½æ˜¯<a href="https://medium.com/@dan_abramov" target="_blank" rel="external">Dan Abramov</a>.<br>æŸ¥çœ‹ä¸€ä¸‹ä»–çš„æ–‡ç« â€œSmart and Dumb Componentsâ€.</p>
<p>ä½†æ˜¯æˆ‘è®¤ä¸ºå«åš<strong><code>UIç»„ä»¶</code></strong>æ›´å¥½ä¸€ç‚¹(æˆ–è€…ä»…ä»…å«åšç»„ä»¶).<br>æ¥ç€åˆå¦ä¸€å¥—ç»„ä»¶å®é™…ç®¡ç†æœ¬åœ°æ•°æ®å’Œè·å–è¿œç¨‹æ•°æ®.è¿™äº›ç»„ä»¶è¢«ç§°ä¸º<strong><code>containerç»„ä»¶</code></strong>.Relayå’ŒReduxçš„Reactç»‘å®šæ˜¯ä»–ä»¬æ›´æµè¡Œäº†.</p>
<p>ä¸‹é¢æ˜¯æ€ä¹ˆä½¿ç”¨Reat Devtoolsæ¥æŸ¥çœ‹ç»„ä»¶çš„è§†å›¾.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-f461d4894bfc06de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="1*QhMLf9dhu-cbAxN9Gc9dtg-2.png"></p>
<p>Container(BlogPost)æ¥æ”¶postId Props.ç„¶åä»–å°†ä¼šè·å–æ•°æ®ä¼ é€’åˆ°å®é™…UIç»„ä»¶ä¸­.</p>
<h2 id="Containerçš„å¸¸è§„ä»»åŠ¡"><a href="#Containerçš„å¸¸è§„ä»»åŠ¡" class="headerlink" title="Containerçš„å¸¸è§„ä»»åŠ¡"></a>Containerçš„å¸¸è§„ä»»åŠ¡</h2><p>containerçš„ä¸»è¦ä»»åŠ¡æ˜¯è·å–æ•°æ®,è¿™é‡Œé¢æœ‰ä¸€äº›äº‹æƒ…è¦åš,è®©æˆ‘ä»¬çœ‹çœ‹:</p>
<ul>
<li>è¯·æ±‚æ•°æ®(è°ƒç”¨è®¢é˜…æˆ–è€…ä»…ä»…è·å–æ•°æ®)</li>
<li>å½“æ•°æ®åŠ è½½çš„æ—¶å€™å±•ç¤ºåŠ è½½å›¾ç‰‡</li>
<li>ä¸€æ—¦æ•°æ®è¿”å›,æŠŠå®ƒä¼ é€’åˆ°UIç»„ä»¶ä¸­</li>
<li>å¦‚æœæœ‰é”™è¯¯,å±•ç¤ºç»™ç”¨æˆ·</li>
<li>å½“propsæ”¹å˜äº†,éœ€è¦é‡æ–°è·å–æˆ–è€…é‡æ–°è®¢é˜…</li>
<li>å½“containerå¸è½½çš„æ—¶å€™,éœ€è¦æ¸…é™¤èµ„æº.</li>
</ul>
<p>è¿™é‡Œcontaineræœ‰å¾ˆå¤šçš„ä»»åŠ¡è¦å®Œæˆ.å¦‚æœä½ æƒ³è‡ªå·±åšè¿™äº›ä»»åŠ¡,ä½ å°±ä¸å¾—ä¸åšä¸€äº›é‡å¤çš„å·¥ä½œ,å‘ç”Ÿé”™è¯¯çš„æ¥æºå°±ç”±æ­¤è¯ç”Ÿäº†.</p>
<h2 id="React-Komposerçš„ä»‹ç»"><a href="#React-Komposerçš„ä»‹ç»" class="headerlink" title="React Komposerçš„ä»‹ç»"></a>React Komposerçš„ä»‹ç»</h2><p>React Komposerè¯•å›¾å¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“çš„åˆå¹¶containers.æœ‰äº†å®ƒ,ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•æ•°æ®èµ„æº,ä¸ç®¡ä½ çš„æ•°æ®æ˜¯æ¥è‡ªäºPromise,Observableç”šè‡³æ˜¯Meteorâ€˜s Tracker.</p>
<h3 id="è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</h3><p>åƒä¸‹é¢è¿™æ ·åˆ›å»ºä¸€ä¸ª<em>æ•°å­—æ—¶é’Ÿ</em>:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-10d84673aea28707.gif?imageMogr2/auto-orient/strip" alt="Digital clock"></p>
<p>è¿™æ˜¯ä¸€ä¸ªå¥½çš„å®ä¾‹,å› ä¸ºæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸ªcontainerçš„å‡ ä¹æ‰€æœ‰çš„åŠŸèƒ½.å¼€å§‹</p>
<p>é¦–å…ˆå®‰è£…react-komposer:</p>
<p><code>npm i â€” save react-komposer</code></p>
<p>ç„¶åè¾“å…¥composeå‡½æ•°ï¼š<br><code>import {compose} from â€˜react-komposerâ€™;</code></p>
<p>ç°åœ¨éœ€è¦ä¸€ä¸ªUIç»„ä»¶å»æ¸²æŸ“æ—¶é—´:</p>
<p><code>const Time = ({time}) =&gt; (&lt;div&gt;{time}&lt;/div&gt;);</code></p>
<p>è¿™æ˜¯æˆ‘ä»¬çš„ç»„åˆå‡½æ•°:</p>
<p>è·å–æ—¶é—´çš„æ—¶å€™éœ€è¦è°ƒç”¨<code>onData</code>å›è°ƒå‡½æ•°(è¿™é‡Œæ²¡æœ‰å®é™…åšä»€ä¹ˆ.)</p>
<p>éœ€è¦è°ƒç”¨<code>onData</code>å‡½æ•°å¤šå°‘æ¬¡å¯ä»¥,åªè¦ç¨‹åºéœ€è¦.å¦‚æœæœ‰é”™è¯¯,å¯ä»¥æŠŠé”™è¯¯ä¿¡æ¯ä½œä¸º<code>onData</code>çš„ç¬¬ä¸€ä¸ªå€¼.</p>
<p>æœ€å,æˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ªæ¸…é™¤èµ„æºçš„é¢å‡½æ•°.åœ¨è¿™ä¸ªå®ä¾‹ä¸­ç”¨ä»–æ¥æ¸…é™¤setIntervaçš„å¥æŸ„.</p>
<p>å¥½äº†,ç°åœ¨æ¥åˆå¹¶ä¸€ä¸‹composer:<br><code>const Clock = compose(composerFunction)(Time);</code></p>
<p>ç„¶åæ¸²æŸ“åˆ°DOMä¸­:<br><code>ReactDOM.render(&lt;Clock /&gt;, document.body);</code></p>
<p>ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªè‡ªæˆ‘ç®¡ç†(state)çš„æ—¶é’Ÿ.<a href="https://jsfiddle.net/arunoda/jxse2yw8/" target="_blank" rel="external">çœ‹çœ‹å®é™…æ¼”ç¤º</a>.</p>
<p>è¿™é‡Œæœ‰ä¸ª<a href="https://jsfiddle.net/arunoda/7qy1mxc7/" target="_blank" rel="external">æ›´å¤æ‚çš„ç‰ˆæœ¬</a>,ä½¿ç”¨props,å¤„ç†é”™è¯¯ä¿¡æ¯.</p>
<p>ä½ ä¹Ÿå¯ä»¥æ”¹å˜é»˜è®¤åŠ è½½å’Œé”™è¯¯ç»„ä»¶.æŸ¥çœ‹ä¸€ä¸‹<a href="https://github.com/kadirahq/react-komposer#api" target="_blank" rel="external">react-komposer æ–‡æ¡£</a>.</p>
<p>è·å¾—å¥½å¤„:æ›´å®¹æ˜“æµ‹è¯•</p>
<p>ä½œä¸ºè¿™ä¸ªç»„ä»¶çš„é™„åŠ æ•ˆæœ,æˆ‘ä»¬ç°åœ¨å¯ä»¥å¾ˆå®¹æ˜“æµ‹è¯•UIä»£ç .</p>
<ul>
<li>å› ä¸ºUIç»„ä»¶ä»…ä»…é€šè¿‡propsæ¥æ”¶æ•°æ®(å’Œaction),æ˜¯çš„æµ‹è¯•å¾ˆå®¹æ˜“.</li>
<li>ä¹Ÿå¯ä»¥æµ‹è¯•ç»„åˆå‡½æ•°çš„æ•°æ®è·å–é€»è¾‘.</li>
</ul>
<h2 id="å¯¹äºå¤šç§æ•°æ®æºçš„æ”¯æŒ"><a href="#å¯¹äºå¤šç§æ•°æ®æºçš„æ”¯æŒ" class="headerlink" title="å¯¹äºå¤šç§æ•°æ®æºçš„æ”¯æŒ"></a>å¯¹äºå¤šç§æ•°æ®æºçš„æ”¯æŒ</h2><p>æˆ‘å·²ç»æåˆ°è¿‡,å¯ä»¥ä½¿ç”¨è¿™ä¸ªç»„ä»¶å’Œä»»ä½•æ•°æ®æºä¸€èµ·å·¥ä½œ,å› ä¸ºç»„åˆçš„APIæ˜¯é€šç”¨çš„.æˆ‘ä»¬æœ‰å¤„ç†æµè¡Œæ•°æ®æºçš„ç‰¹å®šAPIS.<br> è¿™é‡Œæ˜¯:</p>
<ul>
<li><em>composeWithPromise</em>ç”¨äºPromise-baseed æ•°æ®æº</li>
<li><em>composeWithObservable</em>ç”¨äºRx.js Observalbe-basedæ•°æ®æº</li>
<li><em>composeWithTracker</em>å‡ºäº‹ç‰¹æ®Šçš„ä¸€äº›æ•°æ®æº.</li>
</ul>
<p>æœ‰äº†è¿™äº›API,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨react-komposerå»åˆå¹¶ä»»ä½•æ•°æ®æºçš„container.</p>
<p>çœ‹çœ‹<a href="https://github.com/kadirahq/react-komposer#using-with-xxx" target="_blank" rel="external">repo</a>,æœ‰æ›´å¤šçš„ä¾‹å­.</p>
<p>åœ¨ä½ çš„appä¸­ä½¿ç”¨ä¸€ä¸‹react-komposer,ä½ ä¼šå–œæ¬¢ä¸Šä»–çš„.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Arunoda Susiripala&lt;/em&gt;  &lt;a href=&quot;https://voice.kadira.io/let-s-compose-some-react-containers-3b91b6d9b7c8#.92sjwgug1&quot; t
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨React,Redux,redux-sageæ„å»ºå›¾ç‰‡åº“(ç¿»è¯‘)</title>
    <link href="http://yoursite.com/2017/03/15/%E4%BD%BF%E7%94%A8React,Redux,redux-sage%E6%9E%84%E5%BB%BA%E5%9B%BE%E7%89%87%E5%BA%93(%E7%BF%BB%E8%AF%91)/"/>
    <id>http://yoursite.com/2017/03/15/ä½¿ç”¨React,Redux,redux-sageæ„å»ºå›¾ç‰‡åº“(ç¿»è¯‘)/</id>
    <published>2017-03-15T00:04:10.000Z</published>
    <updated>2017-03-23T08:56:16.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>çœ‹åˆ°è¿™ç¯‡æ–‡ç« <a href="http://joelhooks.com/blog/2016/03/20/build-an-image-gallery-using-redux-saga/" target="_blank" rel="external">build an image gallery using redux saga</a>ï¼Œè§‰å¾—å†™çš„ä¸é”™ï¼Œé•¿çŸ­ä¹Ÿé€‚ä¸­.  æ–‡åæœ‰<a href="https://github.com/phpsmarter/egghead-react-redux-image-gallery/tree/comment" target="_blank" rel="external">æ³¨é‡Šç‰ˆçš„githubä»£ç åº“,è¯·ä½¿ç”¨commentåˆ†æ</a>. Flickr APIå¯èƒ½éœ€è¦æœ‰fQçš„åŸºæœ¬èƒ½åŠ›.å¯ä»¥ä½¿ç”¨googleçš„ç¿»è¯‘ä½œä¸ºå‚è€ƒï¼Œè¿™ç¯‡æ–‡ç« googleç¿»è¯‘ç‰ˆçš„ä¸­æ–‡æ°´å¹³è®©æˆ‘åƒäº†ä¸€æƒŠ.<br>ç¿»è¯‘å·²ç»å®Œæˆ.</p>
</blockquote>
<hr>
<p>###ä½¿ç”¨React,Reduxå’Œreudx-sagaæ„å»ºä¸€ä¸ªå›¾åƒæµè§ˆç¨‹åº(ç¿»è¯‘)<br>Joel Hooks ,2016å¹´3æœˆ</p>
<p>#####æ„å»ºä¸€ä¸ªå›¾ç‰‡é•¿å»Š</p>
<p>å›¾åƒé•¿å»Šæ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œä»Flicker API åŠ è½½å›¾ç‰‡URLs,å…è®¸ç”¨æˆ·æŸ¥çœ‹å›¾ç‰‡è¯¦æƒ…ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-b0d03ac095f09c55.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/240" alt="Screen Shot 2016-03-20 at 3.42.17 PM-2.png"></p>
<p>åç»­æˆ‘ä»¬ä¼šä½¿ç”¨React,Reduxå’Œredux-saga.Reactä½œä¸ºæ ¸å¿ƒæ¡†æ¶ï¼Œä¼˜åŠ¿æ˜¯è™šæ‹Ÿdom(virtual-dom)çš„å®ç°ã€‚Reduxåœ¨ç¨‹åºå†…è´Ÿè´£stateçš„ç®¡ç†ã€‚æœ€åï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨redux-sagaæ¥æ‰§è¡Œjavascriptçš„å¼‚æ­¥æ“ä½œæ­¥éª¤ã€‚</p>
<p>æˆ‘ä»¬ä¼šä½¿ç”¨ES6(ç®­å¤´å‡½æ•°ï¼Œæ¨¡å—ï¼Œå’Œæ¨¡æ¿å­—ç¬¦ä¸²)ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦åšä¸€äº›é¡¹ç›®çš„é…ç½®å·¥ä½œã€‚</p>
<p>#####é¡¹ç›®é…ç½®å’Œè‡ªåŠ¨åŒ–</p>
<hr>
<p>å¦‚æœè¦å¼€å§‹ä¸€ä¸ªReacté¡¹ç›®ï¼Œé¡»æœ‰æœ‰ä¸€ç³»åˆ—çš„é…ç½®é€‰é¡¹ã€‚å¯¹äºä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œæˆ‘æƒ³æŠŠé…ç½®é€‰é¡¹å°½å¯èƒ½ç¼©å‡ã€‚è€ƒè™‘åˆ°æµè§ˆå™¨çš„ç‰ˆæœ¬é—®é¢˜ï¼Œä½¿ç”¨BabelæŠŠES6ç¼–è¯‘ä¸ºES5ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨npm init åˆ›å»ºä¸€ä¸ª<code>package.json</code>æ–‡ä»¶</p>
<p>package.json<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">  &#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"egghead-react-redux-image-gallery"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</div><div class="line">  <span class="string">"description"</span>: <span class="string">"Redux Saga beginner tutorial"</span>,</div><div class="line">  <span class="string">"main"</span>: <span class="string">"src/main.js"</span>,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"babel-node ./src/saga.spec.js | tap-spec"</span>,</div><div class="line">    <span class="string">"start"</span>: <span class="string">"budo ./src/main.js:build.js --dir ./src --verbose  --live -- -t babelify"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"repository"</span>: &#123;</div><div class="line">    <span class="string">"type"</span>: <span class="string">"git"</span>,</div><div class="line">    <span class="string">"url"</span>: <span class="string">"git+https://github.com/joelhooks/egghead-react-redux-image-gallery.git"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"author"</span>: <span class="string">"Joel Hooks &lt;joelhooks@gmail.com&gt;"</span>,</div><div class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</div><div class="line">  <span class="string">"dependencies"</span>: &#123;</div><div class="line">    <span class="string">"babel-polyfill"</span>: <span class="string">"6.3.14"</span>,</div><div class="line">    <span class="string">"react"</span>: <span class="string">"^0.14.3"</span>,</div><div class="line">    <span class="string">"react-dom"</span>: <span class="string">"^0.14.3"</span>,</div><div class="line">    <span class="string">"react-redux"</span>: <span class="string">"^4.4.1"</span>,</div><div class="line">    <span class="string">"redux"</span>: <span class="string">"^3.3.1"</span>,</div><div class="line">    <span class="string">"redux-saga"</span>: <span class="string">"^0.8.0"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"devDependencies"</span>: &#123;</div><div class="line">    <span class="string">"babel-cli"</span>: <span class="string">"^6.1.18"</span>,</div><div class="line">    <span class="string">"babel-core"</span>: <span class="string">"6.4.0"</span>,</div><div class="line">    <span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.1.18"</span>,</div><div class="line">    <span class="string">"babel-preset-react"</span>: <span class="string">"^6.1.18"</span>,</div><div class="line">    <span class="string">"babel-preset-stage-2"</span>: <span class="string">"^6.1.18"</span>,</div><div class="line">    <span class="string">"babelify"</span>: <span class="string">"^7.2.0"</span>,</div><div class="line">    <span class="string">"browserify"</span>: <span class="string">"^13.0.0"</span>,</div><div class="line">    <span class="string">"budo"</span>: <span class="string">"^8.0.4"</span>,</div><div class="line">    <span class="string">"tap-spec"</span>: <span class="string">"^4.1.1"</span>,</div><div class="line">    <span class="string">"tape"</span>: <span class="string">"^4.2.2"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p> æœ‰äº†<code>package.json</code>, å¯ä»¥åœ¨é¡¹ç›®æ–‡ä»¶å¤¹å‘½ä»¤è¡Œè¿è¡Œ <code>npm install</code> å®‰è£…ç¨‹åºéœ€è¦çš„ä¾èµ–é¡¹ã€‚</p>
<p> .babelrc<br> <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"react"</span>, <span class="string">"stage-2"</span>]</div><div class="line">   &#125; </div><div class="line">``` </div><div class="line">___</div><div class="line">è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰babel,æˆ‘ä»¬å°†ä¼šä½¿ç”¨ES2015(ES6),Reactä»¥åŠES2106çš„stage<span class="number">-2</span>çš„ä¸€äº›ç‰¹å¾ã€‚</div><div class="line"></div><div class="line">`package.json`æœ‰ä¸¤ä¸ªæ ‡å‡†çš„scriptè„šæœ¬é…ç½®ï¼š`start`å’Œ`test`.ç°åœ¨æˆ‘ä»¬æƒ³é€šè¿‡startè„šæœ¬åŠ è½½ç¨‹åºï¼Œstartä¼šä½¿ç”¨`src`ç›®å½•çš„ä¸€äº›æ–‡ä»¶ï¼Œæ‰€ä»¥è¥¿è¯å…ˆåˆ›å»º`src`æ–‡ä»¶å¤¹.åœ¨`src`æ–‡ä»¶å¤¹æ·»åŠ ä¸‹é¢çš„ä¸€äº›æ–‡ï¼š</div><div class="line">index.html</div></pre></td></tr></table></figure></p>
<p>   &lt;!doctype html&gt;</p>
<p><html></html></p>
<p><head><br>  <meta charset="utf-8"><br>  <meta name="viewport" content="width=device-width, initial-scale=1.0"><br>  <title>egghead: React Redux Image Gallery</title><br>  <link rel="stylesheet" href="styles.css"><br></head></p>
<p><body></body></p>
<div class="title"><br>  <img src="http://cloud.egghead.io/2G021h3t2K10/download/egghead-logo-head-only.svg" alt=""><br>  <h3>Egghead Image Gallery</h3><br></div>

<div id="root"></div>

<p><script type="text/javascript" src="build.js"></script><br><br><br> <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"></div><div class="line"><span class="selector-tag">main</span><span class="selector-class">.js</span></div></pre></td></tr></table></figure></p>
<pre><code>import &quot;babel-polyfill&quot;
</code></pre><p>import React from â€˜reactâ€™<br>import ReactDOM from â€˜react-domâ€™</p>
<p>ReactDOM.render(<br>  </p><h1>Hello React!</h1>,<br>  document.getElementById(â€˜rootâ€™)<br>);<br>  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"> <span class="selector-tag">style</span><span class="selector-class">.css</span></div></pre></td></tr></table></figure><p></p>
<pre><code>body {
font-family: Helvetica, Arial, Sans-Serif, sans-serif;
background: white;
</code></pre><p>}</p>
<p>.title {<br>    display: flex;<br>    padding: 2px;<br>}</p>
<p>.egghead {<br>    width: 30px;<br>    padding: 5px;<br>}</p>
<p>.image-gallery {<br>    width: 300px;<br>    display: flex;<br>    flex-direction: column;<br>    border: 1px solid darkgray;<br>}</p>
<p>.gallery-image {<br>    height: 250px;<br>    display: flex;<br>    align-items: center;<br>    justify-content: center;<br>}</p>
<p>.gallery-image img {<br>    width: 100%;<br>    max-height: 250px;<br>}</p>
<p>.image-scroller {<br>    display: flex;<br>    justify-content: space-around;<br>    overflow: auto;<br>    overflow-y: hidden;<br>}</p>
<p>.image-scroller img {<br>    width: 50px;<br>    height: 50px;<br>    padding: 1px;<br>    border: 1px solid black;<br>}</p>
  <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">  ___</div><div class="line"></div><div class="line">`index.html`æ–‡ä»¶åŠ è½½`style.css`æ–‡ä»¶æä¾›ä¸€äº›åŸºæœ¬çš„å¸ƒå±€æ ·å¼ï¼ŒåŒæ—¶ä¹ŸåŠ è½½`build.js`æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå‡ºæ¥çš„æ–‡ä»¶.`main.js`æ˜¯ä¸€ä¸ªæœ€åŸºç¡€çš„Reactç¨‹åºï¼Œä»–åœ¨`index.html`çš„`#root`å…ƒç´ ä¸­æ¸²æŸ“ä¸€ä¸ª`h1`å…ƒç´ ã€‚åˆ›å»ºè¿™äº›æ–‡ä»¶ä»¥åï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å‘½ä»¤è¡Œè¿è¡Œ`npm start`ã€‚åœ¨æµè§ˆå™¨æ‰“å¼€`http:<span class="comment">//10.11.12.1:9966`.å°±å¯ä»¥çœ‹åˆ°`index.html`ä¸­æ¸²æŸ“çš„é¡µé¢</span></div><div class="line"></div><div class="line">![è¿è¡ŒåŠ è½½å›¾](http:<span class="comment">//upload-images.jianshu.io/upload_images/2044710-b24265cbe5f89d88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/240)</span></div><div class="line"></div><div class="line"></div><div class="line">ç°åœ¨æˆ‘ä»¬æ¥æ„å»ºåŸºç¡€çš„`Gallery` React ç»„ä»¶</div><div class="line"></div><div class="line">#####åœ¨Galleryä¸­æ˜¾ç¤ºä¸€äº›å›¾ç‰‡</div><div class="line">___</div><div class="line"></div><div class="line"> é¦–å…ˆæˆ‘ä»¬éœ€è¦å°½å¯èƒ½å¿«çš„è·å¾—ä¸€ä¸ªå¯ä»¥æ˜¾ç¤ºçš„å›¾ç‰‡ç´ æ.åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶`Gallery.js`</div><div class="line"> Gallery.js</div></pre></td></tr></table></figure>
<pre><code>import React, {Component} from &apos;react&apos;
</code></pre><p>const flickrImages = [<br>  â€œ<a href="https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg</a>â€œ,<br>  â€œ<a href="https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg</a>â€œ,<br>  â€œ<a href="https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg</a>â€œ,<br>  â€œ<a href="https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg</a>â€œ,<br>  â€œ<a href="https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg</a>â€œ<br>];</p>
<p>export default class Gallery extends Component {<br>  constructor(props) {<br>    super(props);<br>    this.state = {<br>      images: flickrImages,<br>      selectedImage: flickrImages[0]<br>    }<br>  }<br>  render() {<br>    const {images, selectedImage} = this.state;<br>    return (<br>      <div classname="image-gallery"><br>        <div classname="gallery-image"><br>          <div><br>            <img src="{selectedImage}"><br>          </div><br>        </div><br>        <div classname="image-scroller"><br>          {images.map((image, index) =&gt; (<br>            <div key="{index}"><br>              <img src="{image}/"><br>            </div><br>          ))}<br>        </div><br>      </div><br>    )<br>  }<br>}<br>  <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">___</div><div class="line">æˆ‘ä»¬ç›´æ¥åœ¨ç»„ä»¶ä¸­ç¡¬ç¼–ç äº†ä¸€ä¸ªæä¾›æ•°æ®çš„æ•°ç»„ï¼Œè®©é¡¹ç›®å°½å¿«çš„å·¥ä½œèµ·æ¥.`Galleryç»„ä»¶`ç»§æ‰¿`Componentç»„ä»¶`,åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºä¸€äº›ç»„ä»¶çš„å‡ºäº‹çŠ¶æ€.æœ€åæˆ‘ä»¬åˆ©ç”¨ä¸€äº›æ ·å¼æ ‡è®°æ¸²æŸ“ä¸€ä¸‹æ–‡ä»¶ã€‚`image-scroller`å…ƒç´ éå†(`map`æ–¹æ³•)å›¾ç‰‡æ•°ç»„,ç”Ÿæˆæ‘˜è¦å°å›¾ç‰‡ã€‚</div></pre></td></tr></table></figure></p>
<pre><code>import &quot;babel-polyfill&quot;
</code></pre><p>import React from â€˜reactâ€™<br>import ReactDOM from â€˜react-domâ€™</p>
<ul>
<li>import Gallery from â€˜./Galleryâ€™</li>
</ul>
<p>ReactDOM.render(</p>
<ul>
<li><h1>Hello React!</h1>,</li>
</ul>
<ul>
<li><p><gallery>,<br>document.getElementById(â€˜rootâ€™)<br>);</gallery></p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¡¬ç¼–ç çš„å›¾ç‰‡URLs(é€šè¿‡fickrImages)æ•°ç»„,ç¬¬ä¸€å¼ å›¾ç‰‡ä½œä¸º`selectedImage`.è¿™äº›å±æ€§åœ¨`Gallery`ç»„ä»¶çš„æ„é€ å‡½æ•°ç¼ºçœé…ç½®ä¸­ï¼Œé€šè¿‡åˆå§‹çŠ¶æ€(initial)æ¥è®¾å®š.</div><div class="line"></div><div class="line"></div><div class="line">æ¥ä¸‹æ¥åœ¨ç»„ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå’Œç»„ä»¶è¿›è¡Œäº¤äº’æ“ä½œçš„æ–¹æ³•ï¼Œæ–¹æ³•å…·ä½“å†…å®¹æ˜¯æ“åš`setSate`.</div><div class="line">Gallery.js</div></pre></td></tr></table></figure>
<p>  export default class Gallery extends Component {<br>constructor(props) {<br> super(props);<br> this.state = {<br>   images: flickrImages,<br>   selectedImage: flickrImages[0]<br> }<br>}</p>
</li>
<li>handleThumbClick(selectedImage) {</li>
<li>this.setState({</li>
<li>selectedImage</li>
<li>})</li>
<li>}<br>render() {<br> const {images, selectedImage} = this.state;<br> return (<br>   <div classname="image-gallery"><pre><code>&lt;div className=&quot;gallery-image&quot;&gt;
  &lt;div&gt;
    &lt;img src={selectedImage} /&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div className=&quot;image-scroller&quot;&gt;
  {images.map((image, index) =&gt; (
</code></pre></div></li>
</ul>
<ul>
<li><div key="{index}"></div></li>
</ul>
<ul>
<li><p><div key="{index}" onclick="{this.handleThumbClick.bind(this,image)}"><br> <img src="{image}/"><br></div><br>))}<br><br><br>)<br>}<br>}</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">åœ¨`Galleryç»„ä»¶`æ·»åŠ `handleThumbClick`æ–¹æ³•,ä»»ä½•å…ƒç´ éƒ½å¯ç”¨é€šè¿‡`onClick`å±æ€§è°ƒç”¨è¿™ä¸ªæ–¹æ³•.`image`ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ï¼Œå…ƒç´ è‡ªèº«ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’.bindæ–¹æ³•ä¼ é€’javascriptå‡½æ•°è°ƒç”¨ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯éå¸¸ä¾¿æ·ã€‚</div><div class="line"></div><div class="line">çœ‹èµ·æ¥ä¸é”™!ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€äº›äº¤äº’æ“ä½œçš„æ–¹æ³•ï¼Œæœ‰ç‚¹â€œAPPâ€çš„æ„æ€äº†ã€‚æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»è®©appè¿è¡Œèµ·æ¥äº†ï¼Œæ¥ä¸‹æ¥è¦è€ƒè™‘æ€ä¹ˆåŠ è½½è¿œç¨‹æ•°æ®ã€‚æœ€å®¹æ˜“åŠ è½½è¿œç¨‹æ•°æ®çš„åœ°æ–¹æ˜¯ä¸€ä¸ª`Reactç»„ä»¶`ç”Ÿå‘½å‘¨æœŸæ–¹æ³•,æˆ‘ä»¬ä½¿ç”¨`componentDidMount`æ–¹æ³•,é€šè¿‡ä»–ä»`Flikr API`è¯·æ±‚å¹¶åŠ è½½ä¸€äº›å›¾ç‰‡.</div><div class="line"></div><div class="line">Gallery.js</div></pre></td></tr></table></figure>
<p>export default class Gallery extends Component {<br>constructor(props) {<br>super(props);<br>this.state = {<br>images: flickrImages,<br>selectedImage: flickrImages[0]<br>}<br>}</p>
</li>
<li>componentDidMount() {</li>
<li>const API_KEY = â€˜a46a979f39c49975dbdd23b378e6d3d5â€™;</li>
<li>const API_ENDPOINT = <code>https://api.flickr.com/services/rest/?method=flickr.interestingness.+getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5</code>;+<br>+</li>
<li>fetch(API_ENDPOINT).then((response) =&gt; {</li>
<li>return response.json().then((json) =&gt; {</li>
<li>const images = json.photos.photo.map(({farm, server, id, secret}) =&gt; { </li>
<li>return <code>https://farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg</code></li>
<li>});<br>+</li>
<li>this.setState({images, selectedImage: images[0]});</li>
<li>})</li>
<li>})</li>
<li><p>}<br>[â€¦]</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æˆ‘ä»¬åœ¨`Gallery`ç±»ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•,é€šè¿‡Reactçš„`componentDidMount`ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è§¦å‘Flickrå›¾ç‰‡æ•°æ®çš„è·å–ã€‚</div><div class="line"></div><div class="line">åœ¨`React`ç»„ä»¶è¿è¡Œçš„ä¸åŒæ—¶é—´ç‚¹ï¼Œç»„ä»¶ä¼šè°ƒç”¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå½“ç»„ä»¶è¢«æ¸²æŸ“åˆ°`DOM`ä¸­çš„æ—¶é—´ç‚¹,`componentDidMount`å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯:`Gallery`ç»„ä»¶åªæœ‰ä¸€æ¬¡æ¸²æŸ“åˆ°`DOM`çš„æœºä¼šï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°å¯ä»¥æä¾›ä¸€äº›åˆå§‹åŒ–å›¾ç‰‡.è€ƒè™‘åˆ°åœ¨APPçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­,æœ‰æ›´å¤šçš„åŠ¨æ€ç»„ä»¶çš„åŠ è½½å’Œå¸è½½,è¿™å¯èƒ½ä¼šé€ æˆä¸€äº›å¤šä½™çš„è°ƒç”¨å’Œæ— æ³•è€ƒè™‘åˆ°çš„ç»“æœã€‚</div><div class="line"></div><div class="line">æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨æ¥å£(browser API)çš„`fetch`æ–¹æ³•æ‰§è¡Œè¯·æ±‚.Fetchè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡è§£æ`response`å¯¹è±¡.è°ƒç”¨`response.json()`æ–¹æ³•,è¿”å›å¦ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å®é™…éœ€è¦çš„`json`æ ¼å¼çš„æ•°æ®.éå†è¿™ä¸ªå¯¹è±¡ä»¥åå°±å¯ä»¥è·å–å›¾ç‰‡çš„urlåœ°å€.</div><div class="line"></div><div class="line">&gt;å¦ç™½è®²ï¼Œè¿™ä¸ªåº”ç”¨ç›®å‰è¿˜å¾ˆç®€å•.æˆ‘ä»¬è¿˜éœ€è¦åœ¨è¿™é‡ŒèŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼Œè¿˜æœ‰ä¸€äº›åŸºç¡€çš„éœ€æ±‚éœ€è¦å®Œæˆ.æˆ–è®¸æˆ‘ä»¬åº”è¯¥åœ¨promiseå¤„ç†æµç¨‹ä¸­æ·»åŠ é”™è¯¯å¤„ç†æ–¹æ³•,å¦‚æœå›¾ç‰‡æ•°æ®è·å–æˆåŠŸä¹Ÿéœ€è¦ä¸€äº›å¤„ç†é€»è¾‘.åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œä½ éœ€è¦å‘æŒ¥ä¸€äº›æƒ³è±¡åŠ›è€ƒè™‘ä¸€ä¸‹æ›´å¤šçš„é€»è¾‘.åœ¨ç”Ÿäº§å®è·µä¸­ç®€å•çš„éœ€æ±‚æ˜¯å¾ˆå°‘è§çš„.å¾ˆå¿«,åº”ç”¨ä¸­å°±ä¼šæ·»åŠ æ›´å¤šçš„éœ€æ±‚ã€‚è®¤è¯,æ»šåŠ¨æ©±çª—,åŠ è½½ä¸åŒå›¾ç‰‡åº“çš„èƒ½åŠ›å’Œå›¾ç‰‡çš„è®¾ç½®ç­‰ç­‰.ä»…ä»…è¿™äº›è¿˜è¿œè¿œä¸å¤Ÿ.</div><div class="line"></div><div class="line">æˆ‘ä»¬å·²ç»ä½¿ç”¨`React`æ„å»ºäº†ä¸€ä¸ªåŠ è½½å›¾ç‰‡åº“çš„ç¨‹åºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°éšç€ç¨‹åºåŠŸèƒ½çš„æ·»åŠ ï¼Œåˆ°åº•éœ€è¦å“ªäº›åŸºç¡€çš„æ¨¡å¼.é¦–å…ˆè€ƒè™‘åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¦æŠŠåº”ç”¨çš„çŠ¶æ€(state)æ§åˆ¶ä»`Gallery`ç»„ä»¶ä¸­åˆ†ç¦»å‡ºæ¥.</div><div class="line"></div><div class="line">æˆ‘ä»¬é€šè¿‡å¼•å…¥`Redux`æ¥å®Œæˆåº”ç”¨çš„çŠ¶æ€ç®¡ç†å·¥ä½œã€‚</div><div class="line"></div><div class="line">#####ä½¿ç”¨`Redux`æ¥ç®¡ç†çŠ¶æ€</div><div class="line">___</div><div class="line">åœ¨ä½ çš„åº”ç”¨ä¸­åªè¦ä½¿ç”¨äº†`setState`æ–¹æ³•éƒ½ä¼šè®©ä¸€ä¸ªç»„ä»¶ä»æ— çŠ¶æ€å˜ä¸ºæœ‰çŠ¶æ€çš„ç»„ä»¶.ç³Ÿç³•çš„æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šå¯¼è‡´åº”ç”¨ä¸­å‡ºç°ä¸€äº›ä»¤äººå›°æƒ‘çš„ä»£ç ,è¿™äº›ä»£ç ä¼šåœ¨åº”ç”¨ä¸­åˆ°å¤„è”“å»¶ã€‚</div><div class="line"></div><div class="line">`Flux`æ„æ¶æ¥å‡è½»è¿™ä¸ªé—®é¢˜.`Flux`æŠŠé€»è¾‘(logic)å’ŒçŠ¶æ€(state)è¿ç§»åˆ°`Store`ä¸­.åº”ç”¨ä¸­çš„åŠ¨ä½œ(`Actions`)è¢«`Dispatch`çš„æ—¶å€™,`Stores`</div><div class="line">ä¼šåšç›¸åº”çš„æ›´æ–°.`Stores`çš„æ›´æ–°ä¼šè§¦å‘`View`æ ¹æ®æ–°çŠ¶æ€çš„æ¸²æŸ“.</div><div class="line"></div><div class="line">é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦èˆå¼ƒ`Flux`?ä»–ç«Ÿç„¶è¿˜æ˜¯â€œå®˜æ–¹â€æ„å»ºçš„.</div><div class="line">å¥½å§ï¼`Redux`æ˜¯åŸºäº`Flux`æ„æ¶çš„,ä½†æ˜¯ä»–æœ‰ä¸€äº›ç‹¬ç‰¹çš„ä¼˜åŠ¿.ä¸‹é¢æ˜¯Dan Abramov(Reduxåˆ›å»ºè€…)çš„ä¸€äº›è¯ï¼š</div><div class="line">&gt;Reduxå’ŒFluxæ²¡æœ‰ä»€ä¹ˆä¸åŒ.æ€»ä½“æ¥è®²ä»–ä»¬æ˜¯ç›¸åŒçš„æ„æ¶,ä½†æ˜¯Reduxé€šè¿‡åŠŸèƒ½ç»„åˆæŠŠFluxä½¿ç”¨å›è°ƒæ³¨å†Œçš„å¤æ‚ç‚¹ç»™å±è”½æ‰äº†.</div><div class="line">ä¸¤ä¸ªæ„æ¶ä»æ›´æœ¬ä¸Šè®²æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä½†æ˜¯æˆ‘å‘ç°Reduxä½¿ä¸€äº›åœ¨Fluxæ¯”è¾ƒéš¾å®ç°çš„é€»è¾‘æ›´å®¹æ˜“å®ç°.</div><div class="line"></div><div class="line"></div><div class="line">[Reduxæ–‡æ¡£](http:<span class="comment">//cn.redux.js.org/index.html)éå¸¸æ£’.</span></div><div class="line">å¦‚æœä½ è¿˜æ²¡æœ‰è¯»è¿‡ä»£ç çš„å¡é€šæ•™ç¨‹æˆ–è€…Dançš„ç³»åˆ—æ–‡ç« .èµ¶å¿«å»çœ‹çœ‹å§ï¼</div><div class="line"></div><div class="line">#####å¯åŠ¨Redux</div><div class="line"></div><div class="line">ç¬¬ä¸€ä»¶éœ€è¦åšçš„äº‹äº‹åˆå§‹åŒ–`Redux`,è®©ä»–åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­è¿è¡Œèµ·æ¥.ç°åœ¨ä¸éœ€è¦åšå®‰è£…å·¥ä½œï¼Œåˆšå¼€å§‹è¿è¡Œ`npm install`çš„æ—¶å€™å·²ç»å®‰è£…å¥½äº†ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›å¯¼å…¥å’Œé…ç½®å·¥ä½œ.</div><div class="line">**reducerå‡½æ•°æ˜¯Reduxçš„å¤§è„‘.** æ¯å½“åº”ç”¨åˆ†å‘(æˆ–æ´¾é£,dispatch)ä¸€ä¸ªæ“ä½œ(action)çš„æ—¶å€™,`reducer`å‡½æ•°ä¼šæ¥å—æ“ä½œ(action)å¹¶ä¸”ä¾æ®è¿™ä¸ªåŠ¨ä½œ(action)åˆ›å»º`reducer`è‡ªå·±çš„`state`.å› ä¸º`reducers`æ˜¯çº¯å‡½æ•°ï¼Œä»–ä»¬å¯ä»¥ç»„åˆåˆ°ä¸€èµ·ï¼Œåˆ›å»ºåº”ç”¨çš„`ä¸€ä¸ªå®Œæ•´state`.è®©æˆ‘ä»¬åœ¨`src`ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„reducer:</div><div class="line">reducer.js</div></pre></td></tr></table></figure>
<p>export default function images(state, action) {<br>   console.log(state, action)<br>   return state;<br>}</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> ___</div><div class="line"> ä¸€ä¸ªreducerå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°(arguments).</div><div class="line">   <span class="number">1</span>. [x] `<span class="keyword">state</span>`-è¿™ä¸ªæ•°æ®ä»£è¡¨åº”ç”¨çš„çŠ¶æ€(<span class="keyword">state</span>).reducerå‡½æ•°ä½¿ç”¨è¿™ä¸ªçŠ¶æ€æ¥æ„å»ºä¸€ä¸ªreducerè‡ªå·±å¯ä»¥ç®¡ç†çš„çŠ¶æ€.å¦‚æœçŠ¶æ€æ²¡æœ‰å‘ç”Ÿæ”¹å˜,reducerä¼šè¿”å›è¾“å…¥çš„çŠ¶æ€.</div><div class="line">   <span class="number">2</span>. [x]  `action`-è¿™æ˜¯è§¦å‘reducerçš„äº‹ä»¶.Actionsé€šè¿‡storeæ´¾å‘(dispatch),ç”±reducerå¤„ç†.actionéœ€è¦ä¸€ä¸ª`type`å±æ€§æ¥å‘Šè¯‰reduceræ€ä¹ˆå¤„ç†<span class="keyword">state</span>.</div><div class="line"></div><div class="line">ç›®å‰,`images` reuduceråœ¨ç»ˆç«¯ä¸­æ‰“å°å‡ºæ—¥å¿—è®°å½•ï¼Œè¡¨æ˜å·¥ä½œæµç¨‹æ˜¯æ­£å¸¸çš„ï¼Œå¯ä»¥åšæ¥ä¸‹æ¥çš„å·¥ä½œäº†.ä¸ºäº†ä½¿ç”¨reducerï¼Œéœ€è¦åœ¨`main.js`ä¸­åšä¸€äº›é…ç½®å·¥ä½œ:</div><div class="line">main.js</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import â€œbabel-polyfillâ€;</p>
<p>import React from â€˜reactâ€™;<br>import ReactDOM from â€˜react-domâ€™;</p>
<p>import Gallery from â€˜./Galleryâ€™;</p>
<ul>
<li>import { createStore } from â€˜reduxâ€™</li>
<li><p>import reducer from â€˜./reducerâ€™</p>
</li>
<li><p>const store = createStore(reducer);</p>
</li>
<li><p>import {Provider} from â€˜react-reduxâ€™;</p>
</li>
</ul>
<p>ReactDOM.render(</p>
<ul>
<li><provider store="{store}"> <gallery></gallery></provider></li>
<li><p>,<br>document.getElementById(â€˜rootâ€™)<br>);<br>}</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"> ___</div><div class="line"> </div><div class="line"> æˆ‘ä»¬ä»`Redux`åº“ä¸­å¯¼å…¥`createStore`ç»„ä»¶.`creatStore`ç”¨æ¥åˆ›å»ºReduxçš„store.å¤§å¤šæ•°æƒ…å†µä¸‹,æˆ‘ä»¬ä¸ä¼šå’Œstoreç›´æ¥äº¤äº’,storeåœ¨Reduxä¸­åšå¹•åç®¡ç†å·¥ä½œ.</div><div class="line"></div><div class="line"> ä¹Ÿéœ€è¦å¯¼å…¥åˆšæ‰åˆ›å»ºçš„reducerå‡½æ•°,ä»¥ä¾¿äºä»–å¯ä»¥è¢«å‘é€åˆ°store.</div><div class="line"> æˆ‘ä»¬å°†é€šè¿‡`createStore(reducer)`æ“ä½œï¼Œåˆ©ç”¨reduceræ¥é…ç½®åº”ç”¨çš„store.è¿™ä¸ªç¤ºä¾‹ä»…ä»…åªæœ‰ä¸€ä¸ªreducer,ä½†æ˜¯`createStore`å¯ä»¥æ¥æ”¶å¤šä¸ªreducerä½œä¸ºå‚æ•°.ç¨åæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™ä¸€ç‚¹.</div><div class="line"> </div><div class="line"> æœ€åæˆ‘ä»¬å¯¼å…¥é«˜åº¦é›†æˆåŒ–çš„ç»„ä»¶`Provider`,è¿™ä¸ªç»„ä»¶ç”¨æ¥åŒ…è£…`Gallery`,ä»¥ä¾¿äºæˆ‘ä»¬åœ¨åº”ç”¨ä¸­ä½¿ç”¨Redux.æˆ‘ä»¬éœ€è¦æŠŠåˆšåˆšåˆ›å»ºçš„storeä¼ é€’ç»™`Provider`.ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨`Provider`,å®é™…ä¸ŠReduxå¯ä»¥ä¸éœ€è¦React.ä½†æ˜¯æˆ‘ä»¬å°†ä¼šä½¿ç”¨`Provider`,å› ä¸ºä»–éå¸¸ä¾¿äºä½¿ç”¨.</div><div class="line"> </div><div class="line"> </div><div class="line"></div><div class="line">![æ‰“å°æ—¥å¿—](http:<span class="comment">//upload-images.jianshu.io/upload_images/2044710-6667a047b669d287.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/320)</span></div><div class="line"></div><div class="line"> è¿™å¼ å›¾å¯èƒ½æœ‰ç‚¹å¤æ€ªï¼Œä½†æ˜¯å±•ç¤ºäº†Reduxçš„ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹.æ‰€æœ‰çš„reducersæ¥æ”¶åœ¨åº”ç”¨ä¸­çš„å…¨éƒ¨actions(åŠ¨ä½œæˆ–æ“ä½œ).åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Reduxè‡ªå·±æ´¾å‘çš„ä¸€ä¸ª`action`.</div><div class="line"> #####è¿æ¥Galleryç»„ä»¶</div><div class="line"> </div><div class="line"> å€ŸåŠ©Redux,æˆ‘ä»¬å°†ä½¿ç”¨â€connectedâ€å’Œâ€œun-connectedâ€ç»„ä»¶.ä¸€ä¸ª`connected`ç»„ä»¶è¢«è¿çº¿åˆ°store.`connected`ç»„ä»¶ä½¿æ§åˆ¶åŠ¨ä½œäº‹ä»¶(controls action event)å’Œstoreåä½œèµ·æ¥.é€šå¸¸,ä¸€ä¸ª`connected`ç»„ä»¶æœ‰å­ç»„ä»¶,å­ç»„ä»¶å…·æœ‰å•çº¯çš„æ¥æ”¶è¾“å…¥å’Œæ¸²æŸ“åŠŸèƒ½ï¼Œå½“æ•°æ®æ›´æ–°æ—¶æ‰§è¡Œè°ƒç”¨.è¿™ä¸ªå­ç»„ä»¶å°±æ˜¯unconnectedç»„ä»¶.</div><div class="line"> &gt;æç¤º:å½“Rectå’ŒReduxé…åˆæ˜¯å·¥ä½œçš„éå¸¸å¥½,ä½†æ˜¯Reduxä¸æ˜¯éè¦å’ŒReactåœ¨ä¸€èµ·æ‰èƒ½å·¥ä½œ.æ²¡æœ‰React,Reduxå…¶å®å¯ä»¥å’Œå…¶ä»–æ¡†æ¶é…åˆä½¿ç”¨.</div><div class="line"> </div><div class="line"> </div><div class="line">åœ¨åº”ç”¨ä¸­éœ€è¦å…³è”`Reactç»„ä»¶`å’Œ`Redux Store` çš„æ—¶å€™ï¼Œ`react-redux`æä¾›äº†ä¾¿æ·çš„åŒ…è£…å™¨.æˆ‘ä»¬æŠŠreact-reduxæ·»åŠ è¿›`Gallery`ä¸­</div><div class="line">,ä»è€Œä½¿`Gallery`æˆä¸ºé¦–è¦çš„å…³è”ç»„ä»¶.</div><div class="line"></div><div class="line">Gallery.js</div></pre></td></tr></table></figure>
<p>import React, {Component} from â€˜reactâ€™<br>+import {connect} from â€˜react-reduxâ€™;</p>
</li>
</ul>
<p>-export default class Gallery extends Component {<br>+export class Gallery extends Component {<br>  constructor(props) {<br>    super(props);</p>
<ul>
<li><p>console.log(props);<br>this.state = {<br> images: []<br>}<br>}<br>componentDidMount() {<br>const API_KEY = â€˜a46a979f39c49975dbdd23b378e6d3d5â€™;<br>const API_ENDPOINT = <code>https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5</code>;</p>
<p>fetch(API_ENDPOINT).then((response) =&gt; {<br> return response.json().then((json) =&gt; {<br>   const images = json.photos.photo.map(({farm, server, id, secret}) =&gt; {</p>
<pre><code>return `https://farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg`
</code></pre><p>   });</p>
<p>   this.setState({images, selectedImage: images[0]});<br> })<br>})<br>}<br>handleThumbClick(selectedImage) {<br>this.setState({<br> selectedImage<br>})<br>}<br>render() {<br>const {images, selectedImage} = this.state;<br>return (<br> <div classname="image-gallery"><br>   <div classname="gallery-image"></div></div></p>
<pre><code>&lt;div&gt;
  &lt;img src={selectedImage} /&gt;
&lt;/div&gt;
</code></pre><p>   <br>   <div classname="image-scroller"></div></p>
<pre><code>{images.map((image, index) =&gt; (
  &lt;div key={index} onClick={this.handleThumbClick.bind(this,image)}&gt;
    &lt;img src={image}/&gt;
  &lt;/div&gt;
))}
</code></pre><p>   <br> <br>)<br>}<br>}</p>
</li>
</ul>
<p>+export default connect()(Gallery)<br> <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">ä»`react-redux`å¯¼å…¥`connect`å‡½æ•°,å¯ä»¥åœ¨å¯¼å‡ºç»„ä»¶çš„æ—¶å€™æŠŠä»–å˜ä¸ºé“¾æ¥ç»„ä»¶(connected component).è¯·æ³¨æ„,`connect()(Gallery)`ä»£ç æŠŠ`Gallery`ç»„ä»¶æ”¾åœ¨ç¬¬äºŒä¸ªå½¢å‚ä¸­,è¿™æ˜¯å› ä¸º`connect()`è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªReactç»„ä»¶ä½œä¸ºå‚æ•°(argument).è°ƒç”¨`connect()`å‡½æ•°æ—¶éœ€è¦é…ç½®é¡¹.åé¢æˆ‘ä»¬å°†ä¼šä¼ é€’é…ç½®æˆ‘ä»¬åº”ç”¨çš„actionså’Œstateå‚æ•°.</div><div class="line">æˆ‘ä»¬ä¹ŸæŠŠ`connect`ä½œä¸ºé»˜è®¤é…ç½®åˆ°å¤„æ¨¡å—.è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ç°åœ¨å½“æˆ‘ä»¬`<span class="keyword">import</span> Gallery`çš„æ—¶å€™,å°±ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„Reactç»„ä»¶äº†,è€Œæ˜¯ä¸€ä¸ªå’ŒReduxå…³è”çš„ç»„ä»¶äº†.</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">![](http:<span class="comment">//upload-images.jianshu.io/upload_images/2044710-72a9136f9b481bf6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/620)</span></div><div class="line"></div><div class="line">å¦‚æœä½ è§‚å¯Ÿæˆ‘ä»¬æ·»åŠ è¿›æ„é€ å™¨çš„`console.log`çš„è¾“å‡º,å°±å¯ä»¥çœ‹åˆ°`Gallery`ç»„ä»¶çš„å±æ€§ç°åœ¨åŒ…æ‹¬äº†ä¸€ä¸ª`dispatch`å‡½æ•°.è¿™ä¸ªåœ°æ–¹æ˜¯`connect`ä¸ºæˆ‘ä»¬çš„åº”ç”¨ä¿®æ”¹çš„,è¿™ä¸ªæ”¹åŠ¨èµ‹äºˆäº†ç»„ä»¶æŠŠè‡ªå·±çš„åŠ¨ä½œå¯¹è±¡(action objects)`æ´¾å‘`åˆ°`reducers`çš„èƒ½åŠ›.</div></pre></td></tr></table></figure></p>
<pre><code>export class Gallery extends Component {
</code></pre><p>  constructor(props) {<br>    super(props);</p>
<ul>
<li>this.props.dispatch({type: â€˜TESTâ€™});<br>this.state = {<br> images: []<br>}<br>}<br>[â€¦]<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶çš„æ„é€ å™¨ä¸­è°ƒç”¨æ´¾å‘åŠŸèƒ½.ä½ å¯ä»¥åœ¨å¼€å‘è€…çš„ç»ˆç«¯ä¸­çœ‹åˆ°æ¥è‡ªreducerçš„æ—¥å¿—å£°æ˜.çœ‹åˆ°å£°æ˜è¡¨ç¤ºæˆ‘ä»¬å·²ç»æ´¾å‘äº†ç¬¬ä¸€ä¸ªaction!.Actionsæ˜¯ä¸€ä¸ªå•ä¸€çš„javascriptå¯¹è±¡,å¿…éœ€æœ‰`type`å±æ€§.Actionså¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡å’Œç§ç±»çš„å…¶ä»–å±æ€§.ä½†æ˜¯`type`å¯ä»¥è®©reducersç†è§£è¿™äº›åŠ¨ä½œåˆ°åº•æ˜¯åšä»€ä¹ˆç”¨çš„(æ„è¯‘ï¼Œæ„æ€æ˜¯åªæœ‰æ‹¥æœ‰typeå±æ€§ï¼Œreducersæ‰çŸ¥é“å¯¹<span class="keyword">state</span>åšä»€ä¹ˆæ ·çš„ä¿®æ”¹).</div></pre></td></tr></table></figure>
</li>
</ul>
<p>export default function images(state, action) {</p>
<ul>
<li>console.log(state, action)</li>
</ul>
<ul>
<li>switch(action.type) {</li>
<li>case â€˜TESTâ€™:</li>
<li>console.log(â€˜THIS IS ONLY A TESTâ€™)</li>
<li><p>}<br>return state;<br>}</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> ___</div><div class="line"></div><div class="line">æ€»çš„reducersä½¿ç”¨`switchä»£ç å—`è¿‡æ»¤æœ‰å…³çš„æ¶ˆæ¯,`Switch`è¯­å¥ä½¿ç”¨actionsçš„typeå±æ€§,å½“ä¸€ä¸ª`action`å’Œ`<span class="keyword">case</span>`åˆ†æ”¯å»åˆä»¥å,ç›¸åº”çš„å•ä¸ªreducerå°±ä¼šæ‰§è¡Œä»–çš„å…·ä½“å·¥ä½œ.</div><div class="line"></div><div class="line">æˆ‘ä»¬çš„åº”ç”¨ç°åœ¨å…³è”åˆ°æ¥æ”¶çš„åŠ¨ä½œ.ç°åœ¨æˆ‘ä»¬éœ€è¦æŠŠ`Redux`-`Store`æä¾›çš„`state`å…³è”åˆ°åº”ç”¨ä¸­.</div><div class="line"></div><div class="line">####é»˜è®¤çš„åº”ç”¨çŠ¶æ€(state)</div><div class="line">reducer.js</div></pre></td></tr></table></figure>
<p>const defaultState = {<br>images: []<br>}</p>
</li>
</ul>
<p>export default function images(state = defaultState, action) {<br>  switch(action.type) {<br>    case â€˜TESTâ€™:</p>
<ul>
<li>console.log(â€˜THIS IS ONLY A TESTâ€™)</li>
</ul>
<ul>
<li>console.log(state, action)</li>
<li>return state;</li>
<li>default:</li>
<li>return state;<br>}</li>
</ul>
<ul>
<li><p>return state;<br>}</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`<span class="keyword">default</span>State`å¯¹è±¡,è¿™ä¸ªå¯¹è±¡è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ä½œä¸ºimagesçš„å±æ€§.æˆ‘ä»¬æŠŠ`images`å‡½æ•°çš„å‚æ•°`<span class="keyword">state</span>`è®¾ç½®ä¸ºé»˜è®¤.å¦‚æœåœ¨teståˆ†æ”¯ä¸­è¾“å‡ºæ—¥å¿—,å°†ä¼šçœ‹åˆ°<span class="keyword">state</span>ä¸æ˜¯undefined(ç©ºæ•°ç»„ä¸æ˜¯undefined)!reduceréœ€è¦è¿”å›åº”ç”¨çš„å½“å‰<span class="keyword">state</span>.è¿™ç‚¹å¾ˆé‡è¦!ç°åœ¨æˆ‘ä»¬æ²¡æœ‰åšä»»ä½•æ”¹å˜,æ‰€ä»¥ä»…ä»…è¿”å›<span class="keyword">state</span>.æ³¨æ„æˆ‘ä»¬åœ¨`case`ä¸­æ·»åŠ äº†<span class="keyword">default</span>åˆ†æ”¯,reducerå¿…é¡»è¦è¿”å›ä¸€ä¸ª<span class="keyword">state</span>.</div><div class="line"> </div><div class="line">åœ¨`Gallery`ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ<span class="keyword">state</span>åšä¸€å®šçš„æ˜ å°„(map)ä»¥åå†è¿æ¥åˆ°åº”ç”¨.</div></pre></td></tr></table></figure>
<p>import React, {Component} from â€˜reactâ€™<br>import {connect} from â€˜react-reduxâ€™;</p>
</li>
</ul>
<p>export class Gallery extends Component {<br>  constructor(props) {<br>    super(props);<br>    this.props.dispatch({type: â€˜TESTâ€™});</p>
<ul>
<li>console.log(props);</li>
</ul>
<ul>
<li>this.state = {</li>
<li>images: []</li>
<li>}<br>}</li>
<li>componentDidMount() {</li>
<li>const API_KEY = â€˜a46a979f39c49975dbdd23b378e6d3d5â€™;</li>
<li>const API_ENDPOINT = <code>https://api.flickr.com/services/rest/?method=flickr.interestingness.-getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5</code>;-<br>-</li>
<li>fetch(API_ENDPOINT).then((response) =&gt; {</li>
<li>return response.json().then((json) =&gt; {</li>
<li>const images = json.photos.photo.map(({farm, server, id, secret}) =&gt; { </li>
<li>return <code>https://farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg</code></li>
<li>});<br>-</li>
<li>this.setState({images, selectedImage: images[0]});</li>
<li>})</li>
<li>})</li>
<li>}</li>
<li>handleThumbClick(selectedImage) {</li>
<li>this.setState({</li>
<li>selectedImage</li>
<li>})</li>
<li>}<br>render() {</li>
<li>const {images, selectedImage} = this.state;</li>
</ul>
<ul>
<li>const {images, selectedImage} = this.props;<br>return (<br> <div classname="image-gallery"><br>   <div classname="gallery-image"><pre><code>&lt;div&gt;
  &lt;img src={selectedImage} /&gt;
&lt;/div&gt;
</code></pre>   </div><br>   <div classname="image-scroller"><pre><code>{images.map((image, index) =&gt; (
</code></pre></div></div></li>
</ul>
<ul>
<li><div key="{index}" onclick="{this.handleThumbClick.bind(this,image)}"></div></li>
</ul>
<ul>
<li><div key="{index}"><br> <img src="{image}/"><br></div><br>))}<br><br><br>)<br>}<br>}</li>
</ul>
<p>+function mapStateToProps(state) {</p>
<ul>
<li>return {</li>
<li>images: state.images</li>
<li>selectedImage: state.selectedImage</li>
<li>}<br>+}</li>
</ul>
<p>-export default connect()(Gallery)<br>+export default connect(mapStateToProps)(Gallery)</p>
 <figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"></div><div class="line"> æˆ‘ä»¬å°†ç§»é™¤è¿æ¥ç»„ä»¶ä¸­çš„æ‰€æœ‰å›¾ç‰‡åŠ è½½å’Œäº¤äº’é€»è¾‘ä»£ç ,å¦‚æœä½ æ³¨æ„çœ‹`Gallery`ç»„ä»¶çš„åº•éƒ¨ä»£ç ,ä½ ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`mapStateToProps`å‡½æ•°,æ¥æ”¶ä¸€ä¸ª`<span class="keyword">state</span>`ä½œä¸ºå‚æ•°,è¿”å›ä¸€ä¸ªå¯¹è±¡,æŠŠ`<span class="keyword">state</span>.images`æ˜ å°„ä¸º`images`å±æ€§.`mapStateToProps`åšä¸ºå‚æ•°ä¼ é€’ç»™`connect`.</div><div class="line"> æ­£å¦‚åå­—æš—ç¤ºçš„ä¸€æ ·,`mapStateToProps`å‡½æ•°æ¥æ”¶å½“å‰åº”ç”¨çš„<span class="keyword">state</span>,ç„¶åæŠŠ<span class="keyword">state</span>è½¬å˜ä¸ºç»„ä»¶çš„å±æ€§(propertys).å¦‚æœåœ¨æ„é€ å™¨ä¸­è¾“å‡ºprops,å°†ä¼šçœ‹åˆ°imagesæ•°ç»„æ˜¯`reducer`è¿”å›çš„é»˜è®¤<span class="keyword">state</span>.</div></pre></td></tr></table></figure>
<p>   const defaultState = {</p>
<ul>
<li>images: []</li>
</ul>
<ul>
<li>images: [</li>
<li>â€œ<a href="https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg</a>â€œ,</li>
<li>â€œ<a href="https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg</a>â€œ,</li>
<li>â€œ<a href="https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg</a>â€œ,</li>
<li>â€œ<a href="https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg</a>â€œ,</li>
<li>â€œ<a href="https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg</a>â€œ</li>
<li>],</li>
<li>selectedImage: â€œ<a href="https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg</a>â€œ<br>}</li>
</ul>
<p>export default function images(state = defaultState, action) {<br>  switch(action.type) {<br>    case â€˜TESTâ€™:<br>      console.log(state, action)<br>      return state;<br>    default:<br>      return state;<br>  }<br>}<br>  <figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"></div><div class="line">å¦‚æœåœ¨`<span class="keyword">default</span>State`ä¸­æ›´æ–°imagesæ•°ç»„,ä½ å°†å¯ä»¥çœ‹åˆ°ä¸€äº›å›¾ç‰‡é‡æ–°å‡ºç°åœ¨galleryä¸­!ç°åœ¨å½“ç”¨æˆ·ç‚¹å‡»ç¼©ç•¥å›¾çš„æ—¶å€™,æˆ‘ä»¬å¯ä»¥åé¦ˆé€‰æ‹©åŠ¨ä½œ,è¿”å›å¯¹åº”çš„å¤§å›¾.</div><div class="line"></div><div class="line"><span class="comment">####æ›´æ–°state</span></div><div class="line">æ€ä¹ˆæ“ä½œæ‰èƒ½æ ¹æ®æ–°é€‰æ‹©çš„å›¾ç‰‡æ›´æ–°<span class="keyword">state</span>?</div><div class="line">éœ€è¦é…ç½®reducerç›‘å¬`IMAGE_SELECTED`åŠ¨ä½œ,å€ŸåŠ©actionæºå¸¦çš„ä¿¡æ¯(payload,æœ‰çš„æ–‡ç« ç¿»è¯‘ä¸ºè½½è·,è½½è·æ€ä¹ˆç†è§£ï¼Ÿæ‰‹æœºè½½è·å°±æ˜¯å£°éŸ³ï¼ŒçŸ­ä¿¡å’Œæµé‡æ•°æ®ã€‚å¦‚æœæ˜¯å¡è½¦å°±æ˜¯æ‹‰çš„è´§ç‰©,å¦‚æœæ˜¯å®¢è½¦å°±ä¹˜è½½çš„ä¹˜å®¢,actionçš„è½½è·å°±æ˜¯è¦è®©reduceræ˜ç™½ä½ è¦å¹²ä»€ä¹ˆï¼Œéœ€è¦ä»€ä¹ˆ)æ¥æ›´æ–°<span class="keyword">state</span>.</div></pre></td></tr></table></figure></p>
<p>  const defaultState = {<br>  images: [<br>    â€œ<a href="https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg</a>â€œ,<br>    â€œ<a href="https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg</a>â€œ,<br>    â€œ<a href="https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg</a>â€œ,<br>    â€œ<a href="https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg</a>â€œ,<br>    â€œ<a href="https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg</a>â€œ<br>  ],<br>  selectedImage: â€œ<a href="https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg" target="_blank" rel="external">https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg</a>â€œ<br>}</p>
<p>export default function images(state = defaultState, action) {<br>  switch(action.type) {</p>
<ul>
<li>case â€˜TESTâ€™:<br>case â€˜IMAGE_SELECTEDâ€™:</li>
<li>return state;</li>
</ul>
<ul>
<li><p>return {â€¦state, selectedImage: action.image};<br>default:<br>return state;<br>}<br>}</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">ç°åœ¨reducerå·²ç»å‡†å¤‡æ¥æ”¶`IMAGE_SELECTED` actionäº†.åœ¨`IMAGE_SELECTED`åˆ†æ”¯é€‰é¡¹å†…,æˆ‘ä»¬åœ¨å±•å¼€(spreading,ES6çš„å¯¹è±¡æ“ä½œæ–¹æ³•),å¹¶é‡å†™`selectedImage`å±æ€§å,è¿”å›ä¸€ä¸ªæ–°stateå¯¹è±¡.äº†è§£æ›´å¤šçš„`...state`å¯¹è±¡æ“ä½œå¯ä»¥çœ‹`ruanyifeng`çš„ä¹¦.</div></pre></td></tr></table></figure>
<p>import React, {Component} from â€˜reactâ€™<br>import {connect} from â€˜react-reduxâ€™;</p>
</li>
</ul>
<p>export class Gallery extends Component {</p>
<ul>
<li>constructor(props) {</li>
<li>super(props);</li>
<li>this.props.dispatch({type: â€˜TESTâ€™});</li>
<li>console.log(props);</li>
<li>}<br>render() {</li>
<li>const {images, selectedImage} = this.props;</li>
</ul>
<ul>
<li><p>const {images, selectedImage, dispatch} = this.props;</p>
<p>return (<br> <div classname="image-gallery"><br>   <div classname="gallery-image"></div></div></p>
<pre><code>&lt;div&gt;
  &lt;img src={selectedImage} /&gt;
&lt;/div&gt;
</code></pre><p>   <br>   <div classname="image-scroller"></div></p>
<pre><code>{images.map((image, index) =&gt; (
</code></pre></li>
</ul>
<ul>
<li><div key="{index}"></div></li>
</ul>
<ul>
<li><div key="{index}" onclick="{()" ==""> dispatch({type:â€™IMAGE_SELECTEDâ€™, image})}&gt;<br> <img src="{image}/"><br></div><br>))}<br><br><br>)<br>}<br>}</li>
</ul>
<p>function mapStateToProps(state) {<br>  return {<br>    images: state.images,<br>    selectedImage: state.selectedImage<br>  }<br>}</p>
<p>export default connect(mapStateToProps)(Gallery)<br>  <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> ___</div><div class="line"> åœ¨`Gallery`ç»„ä»¶ä¸­,æˆ‘ä»¬å°†ä¼šåœ¨ç»„ä»¶çš„å±æ€§ä¸­å®šä¹‰`dispatch`åœ¨`onClick`å‡½æ•°ä½“ä¸­è°ƒç”¨ä»–,ç°åœ¨æˆ‘ä»¬ä»ä¾¿åˆ©è§’åº¦è€ƒè™‘æŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·,ä½†æ˜¯ä¸¤è€…åŠŸèƒ½æ˜¯ä¸€æ ·çš„.ä¸€æ—¦æˆ‘ä»¬ç‚¹å‡»äº†ç¼©ç•¥å›¾,ä»–å°†ä¼šé€šè¿‡reduceræ›´æ–°å¤§å›¾.</div><div class="line">ä½¿ç”¨dispatchå¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ›å»ºé€šç”¨actions,ä½†æ˜¯å¾ˆå¿«æˆ‘ä»¬ä¼šéœ€è¦é‡ç”¨å‘½åå¥½çš„actions.ä¸ºäº†è¿™æ ·åš,å¯ä»¥ä½¿ç”¨â€action creatorsâ€.</div><div class="line"></div><div class="line">####Action Creators</div><div class="line">Action creatorså‡½æ•°è¿”å›é…ç½®å¥½çš„actionå¯¹è±¡.æˆ‘ä»¬åœ¨`action.js`ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªaction creator.</div><div class="line"></div><div class="line">action.js</div></pre></td></tr></table></figure></p>
<p> export const IMAGE_SELECTED = â€˜IMAGE_SELECTEDâ€™;</p>
<p>export function selectImage(image) {<br>  return {<br>    type: IMAGE_SELECTED,<br>    image<br>  }<br>}<br> <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">è¿™ä¸ªæ–¹æ³•ç»è¿‡<span class="keyword">export</span>ä»¥å,å¯ä»¥ç›´æ¥åœ¨ä»»ä½•éœ€è¦åˆ›å»º`selectImage` actionåœ°æ–¹å¯¼å…¥!`selectImage`æ˜¯çº¯å‡½æ•°ï¼Œåªèƒ½è¿”å›æ•°æ®.ä»–æ¥æ”¶ä¸€ä¸ªimageä½œä¸ºå‚æ•°,æŠŠimageæ·»åŠ åˆ°actionå¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›.</div><div class="line"></div><div class="line">&gt;æ³¨æ„:æˆ‘ä»¬æ­£åœ¨è¿”å›ä¸€ä¸ªå•çº¯çš„javascript object,ä½†æ˜¯`image`çš„å±æ€§å¯èƒ½å¾ˆå¤æ€ªï¼Œå¦‚æœä½ ä»¥å‰æ²¡æœ‰ç¢°åˆ°è¿™æ ·çš„æ ·å¼.ä»ES6çš„è§’åº¦å‡ºå‘,å¦‚æœä½ ç»™ä¸€ä¸ªå¯¹è±¡ä¼ é€’ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„å±æ€§,éšå«çš„æ„æ€æ˜¯æŠŠ`image:<span class="string">'ä»»ä½•imageåŒ…å«çš„å€¼'</span>`æ·»åŠ åˆ°æœ€ç»ˆè¿”å›çš„å¯¹è±¡.è¶…çº§å¥½ç”¨!</div></pre></td></tr></table></figure></p>
<p> import  * as GalleryActions from â€˜./actions.jsâ€™;<br>[â€¦]<br>onClick={() =&gt; dispatch(GalleryActions.selectImage(image))}<br> <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">this isnâ€™t much than just using `dispatchti` though.</div><div class="line"></div><div class="line">å¹¸è¿çš„æ˜¯,è¿™ä¸ªæ¨¡å¼å¾ˆæ™®é,Reduxåœ¨`bindActionCreators`å‡½æ•°é‡Œæä¾›äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½.</div></pre></td></tr></table></figure></p>
<p> import React, {Component} from â€˜reactâ€™<br>import {connect} from â€˜react-reduxâ€™;</p>
<ul>
<li><p>import {bindActionCreators} from â€˜reduxâ€™;</p>
</li>
<li><p>import  * as GalleryActions from â€˜./actions.jsâ€™;</p>
</li>
</ul>
<p>export class Gallery extends Component {<br>  constructor(props) {<br>    super(props);<br>    this.props.dispatch({type: â€˜TESTâ€™});<br>    console.log(props);<br>  }<br>  handleThumbClick(selectedImage) {<br>    this.setState({<br>      selectedImage<br>    })<br>  }<br>  render() {</p>
<ul>
<li>const {images, selectedImage, dispatch} = this.props;</li>
</ul>
<ul>
<li>const {images, selectedImage, selectImage} = this.props;<br>return (<br> <div classname="image-gallery"><br>   <div classname="gallery-image"><pre><code>&lt;div&gt;
  &lt;img src={selectedImage} /&gt;
&lt;/div&gt;
</code></pre>   </div><br>   <div classname="image-scroller"><pre><code>{images.map((image, index) =&gt; (
</code></pre></div></div></li>
</ul>
<ul>
<li><div key="{index}" onclick="{()" ==""> dispatch({type:â€™IMAGE_SELECTEDâ€™, image})}&gt;</div></li>
</ul>
<ul>
<li><div key="{index}" onclick="{()" ==""> selectImage(image)}&gt;<br> <img src="{image}/"><br></div><br>))}<br><br><br>)<br>}<br>}</li>
</ul>
<p>function mapStateToProps(state) {<br>  return {<br>    images: state.images,<br>    selectedImage: state.selectedImage<br>  }<br>}</p>
<p>+function mapActionCreatorsToProps(dispatch) {</p>
<ul>
<li>return bindActionCreators(GalleryActions, dispatch);<br>+}</li>
</ul>
<p>-export default connect(mapStateToProps)(Gallery)<br>+export default connect(mapStateToProps, mapActionCreatorsToProps)(Gallery)<br> <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"> ___</div><div class="line"> æˆ‘ä»¬å·²ç»æ·»åŠ äº†`mapActionCreatorsToProps`å‡½æ•°,ä»–æ¥æ”¶`dispatch`å‡½æ•°ä½œä¸ºå‚æ•°.è¿”å›`bindActionCreators`çš„è°ƒç”¨ç»“æœ,`GalleryActions`ä½œä¸º`bindActionCreators`çš„å‚æ•°.ç°åœ¨å¦‚æœä½ è¾“å‡ºå±æ€§æ—¥å¿—,å°±çœ‹ä¸åˆ°`dispatch`ä½œä¸ºå‚æ•°,`selectImage`ç›´æ¥å¯ä»¥ä½¿ç”¨äº†.(è¿™é‡Œç›¸å½“äºå¯¹dispatchå’Œactionè¿›è¡Œäº†åŒ…è£…).</div><div class="line"> </div><div class="line"> ç°åœ¨å›é¡¾ä¸€ä¸‹,æˆ‘ä»¬åšäº†å‡ ä»¶äº‹:</div><div class="line"> - åˆ›å»ºäº†ä¸€ä¸ªreduceråŒ…å«åº”ç”¨çš„é»˜è®¤åˆå§‹çŠ¶æ€(initial state),å¹¶ä¸”ç›‘å¬actionsçš„æ‰§è¡Œ.</div><div class="line"> - åˆ›å»ºäº†ä¸€ä¸ªstore,æŠŠreducerå…·ä½“åŒ–,æä¾›ä¸€ä¸ªåˆ†å‘å™¨(dispatcher)å¯ä»¥åˆ†å‘action.</div><div class="line"> - æŠŠæˆ‘ä»¬çš„Galleryç»„ä»¶å…³è”åˆ°storeçš„state.</div><div class="line"> - æŠŠstoreçš„stateæ˜ å°„ä¸ºå±æ€§(property)ï¼Œä¼ é€’ç»™Gallery.</div><div class="line"> - æ˜ å°„ä¸€ä¸ªåŠ¨ä½œåˆ›å»ºå™¨,Galleryå¯ä»¥ç®€å•çš„è°ƒç”¨`selectImage(image)`,åˆ†å‘åŠ¨ä½œ,åº”ç”¨çŠ¶æ€å°†ä¼šæ›´æ–°.</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½ä½¿ç”¨è¿™äº›æ¨¡å¼ä»è¿œç¨‹èµ„æºåŠ è½½æ•°æ®å‘¢ï¼Ÿ</div><div class="line"></div><div class="line">è¿™ä¸ªè¿‡ç¨‹å°†ä¼šéå¸¸æœ‰è¶£!</div><div class="line"></div><div class="line">####å¼‚æ­¥æ´»åŠ¨ï¼Ÿ</div><div class="line"></div><div class="line">---</div><div class="line">ä½ å¯èƒ½åœ¨å‚åŠ å‡½æ•°å¼ç¼–ç¨‹çš„æ—¶å€™å¬è¯´è¿‡â€å‰¯ä½œç”¨â€(side effects)è¿™ä¸ªåè¯,side effectsæ˜¯å‘ç”Ÿåœ¨åº”ç”¨çš„èŒƒå›´ä¹‹å¤–çš„ä¸œè¥¿.åœ¨æˆ‘ä»¬èˆ’é€‚çš„è‚¥çš‚æ³¡é‡Œ,side effectæ ¹æœ¬ä¸æ˜¯é—®é¢˜,ä½†æ˜¯å½“æˆ‘ä»¬è¦åˆ°è¾¾ä¸€ä¸ªè¿œç¨‹èµ„æº,è‚¥çš‚æ³¡å°±è¢«ç©¿é€äº†.æœ‰äº›äº‹æƒ…æˆ‘ä»¬å°±æ§åˆ¶ä¸äº†äº†,æˆ‘ä»¬å¿…é¡»æ¥å—è¿™ä¸ªäº‹å®.(æ ¹æ®è¿™æ®µè¯ï¼Œside effect ç¿»è¯‘ä¸ºæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ï¼Œå‡ºä¹æ„æ–™çš„ä¸å—æ§åˆ¶çš„äº‹æƒ…æ›´å¥½)</div><div class="line"></div><div class="line">åœ¨Reduxé‡Œ,reduceræ²¡æœ‰Side effects.è¿™æ„å‘³ç€reducersä¸å¤„ç†æˆ‘ä»¬åº”ç”¨ä¸­çš„å¼‚æ­¥æ´»åŠ¨.æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨reducersåŠ è½½è¿œç¨‹æ•°æ®,å› ä¸ºreducersæ˜¯çº¯å‡½æ•°,æ²¡æœ‰side effects.</div><div class="line"></div><div class="line">Reduxå¾ˆæ£’,å¦‚æœä½ çš„åº”ç”¨é‡Œæ²¡æœ‰ä»»ä½•å¼‚æ­¥æ´»åŠ¨ï¼Œä½ å¯ä»¥åœä¸‹æ¥,ä¸ç”¨å†å¾€ä¸‹çœ‹äº†.</div><div class="line">å¦‚æœä½ åˆ›å»ºçš„åº”ç”¨æ¯”è¾ƒå¤§,å¯èƒ½ä½ ä¼šä»æœåŠ¡ç«¯åŠ è½½æ•°æ®,è¿™æ—¶,å½“ç„¶è¦ä½¿ç”¨å¼‚æ­¥æ–¹å¼.</div><div class="line"></div><div class="line">&gt;**æ³¨æ„**ï¼š Reduxå…¶ä¸­ä¸€ä¸ªæœ€é…·çš„åœ°æ–¹æ˜¯ä»–éå¸¸å°å·§.ä»–è¯•å›¾è§£å†³æœ‰é™èŒƒå›´å†…çš„é—®é¢˜.å¤§å¤šæ•°çš„åº”ç”¨éœ€è¦è§£å†³å¾ˆå¤šé—®é¢˜!ä¸‡å¹¸,Reducæä¾›ä¸­é—´ä»¶æ¦‚å¿µ,ä¸­é—´ä»¶å­˜åœ¨äºaction-&gt;reducer-&gt;storeçš„ä¸‰è§’å…³ç³»ä¸­,é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼,å¯ä»¥å¯¼å…¥è¯¸å¦‚è¿œç¨‹æ•°æ®å¼‚æ­¥åŠ è½½ç±»ä¼¼çš„åŠŸèƒ½.</div><div class="line"></div><div class="line"></div><div class="line">å…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨`thunks`å¯¹è±¡,åœ¨Reduxä¸­æœ‰ redux-thunk ä¸­é—´ä»¶.Thunkséå¸¸å‰å®³ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´actionsçš„åºåˆ—å¾ˆå¤æ‚,æµ‹è¯•èµ·æ¥ä¹Ÿæ˜¯å¾ˆå¤§çš„æŒ‘æˆ˜.</div><div class="line"></div><div class="line">è€ƒè™‘åˆ°æˆ‘ä»¬çš„ å›¾ç‰‡æµè§ˆç¨‹åº.å½“åº”ç”¨åŠ è½½æ˜¯,éœ€è¦åš:</div><div class="line">- ä»æœåŠ¡å™¨è¯·æ±‚å›¾ç‰‡æ•°ç»„</div><div class="line">- å½“å›¾ç‰‡åŠ è½½å®Œæ¯•,æ˜¾ç¤ºæç¤ºæ¶ˆæ¯</div><div class="line">- å½“è¿œç¨‹æ•°æ®è¿”å›ä»¥å,é€‰æ‹©åˆå§‹å›¾ç‰‡æ˜¾ç¤º</div><div class="line">- å¤„ç†å¯èƒ½å‡ºç°çš„é”™è¯¯</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">è¿™äº›äº‹ä»¶éƒ½è¦åœ¨ç”¨æˆ·ç‚¹å‡»åº”ç”¨é‡Œçš„ä»»ä½•å…ƒç´ ä¹‹å‰å®Œæˆ!</div><div class="line">æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</div><div class="line">redux-sagaå°±æ˜¯ä¸ºæ­¤è€Œè¯ç”Ÿ,ä¸ºæˆ‘ä»¬çš„åº”ç”¨æä¾›ç»ä½³çš„æœåŠ¡.</div><div class="line"></div><div class="line">redux-sage</div><div class="line">___</div><div class="line">redux-sageå¯ä»¥åœ¨Reduxåº”ç”¨ä¸­æ“ä½œå¼‚æ­¥actions.ä»–æä¾›ä¸­é—´ä»¶å’Œè¶æ‰‹çš„æ–¹æ³•ä½¿æ„å»ºå¤æ‚çš„å¼‚æ­¥æ“ä½œæµç¨‹è½»è€Œæ˜“ä¸¾.</div><div class="line"></div><div class="line">ä¸€ä¸ªsagaæ˜¯ä¸€ä¸ªGenerator(ç”Ÿæˆå™¨),Generatorå‡½æ•°æ˜¯ES2015æ–°æ·»åŠ çš„ç‰¹æ€§.å¯èƒ½æ˜¯ä½ ç¬¬ä¸€æ¬¡é‡åˆ°Generatorå‡½æ•°,è¿™æ ·ä½ ä¼šè§‰å¾—æœ‰ç‚¹å¤æ€ª,å¯ä»¥å‚è€ƒ(ruanyifengæ–‡ç« ).ä¸è¦è‹¦æ¼ï¼Œå¦‚æœä½ å¯¹æ­¤ä»ç„¶å¾ˆæŠ“è€³æŒ è…®.ä½¿ç”¨redux-sageä½ ä¸éœ€è¦javascriptå¼‚æ­¥ç¼–ç¨‹çš„åšå£«å­¦ä½.</div><div class="line"></div><div class="line">å› ä¸ºä½¿ç”¨äº†generatorsçš„ç¼˜æ•…,æˆ‘ä»¬èƒ½åˆ›å»ºä¸€ä¸ªé¡ºåºæ‰§è¡Œçš„å‘½ä»¤åºåˆ—ï¼Œç”¨æ¥æè¿°å¤æ‚çš„å¼‚æ­¥æ“ä½œæµç¨‹(workflows).æ•´ä¸ªå›¾ç‰‡çš„åŠ è½½æµç¨‹åºåˆ—å¦‚ä¸‹ï¼š</div></pre></td></tr></table></figure></p>
<p>   export function* loadImages() {<br>  try {<br>    const images = yield call(fetchImages);<br>    yield put({type: â€˜IMAGES_LOADEDâ€™, images})<br>    yield put({type: â€˜IMAGE_SELECTEDâ€™, image: images[0]})<br>  } catch(error) {<br>    yield put({type: â€˜IMAGE_LOAD_FAILUREâ€™, error})<br>  }<br>}</p>
<p>export function* watchForLoadImages() {<br>  while(true) {<br>    yield take(â€˜LOAD_IMAGESâ€™);<br>    yield call(loadImages);<br>  }<br>}<br>   <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">   ___</div><div class="line">   </div><div class="line">####ç¬¬ä¸€ä¸ªsaga</div><div class="line"></div><div class="line">æˆ‘ä»¬å°†å¼€å§‹ä¸€ä¸ªç®€å•çš„sagaå®ä¾‹,ç„¶åé…ç½®ä»–è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨.åœ¨`src`åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</div><div class="line">`saga.js`</div></pre></td></tr></table></figure></p>
<p>   export function* sayHello() {<br>  console.log(â€˜helloâ€™);<br>}<br>  <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æˆ‘ä»¬çš„sagaæ˜¯ä¸€ä¸ªç®€å•çš„generatorå‡½æ•°.å‡½æ•°åé¢çš„`*`ä½œä¸ºæ ‡å¿—,ä»–ä¹Ÿè¢«å«åšâ€super starâ€.</div><div class="line"></div><div class="line">ç°åœ¨åœ¨`main.js`æ–‡ä»¶ä¸­å¯¼å…¥æ–°å‡½æ•°,å¹¶ä¸”æ‰§è¡Œä»–.</div></pre></td></tr></table></figure></p>
<p>  import â€œbabel-polyfillâ€;</p>
<p>import React from â€˜reactâ€™;<br>import ReactDOM from â€˜react-domâ€™;</p>
<p>import Gallery from â€˜./Galleryâ€™;</p>
<p>import { createStore } from â€˜reduxâ€™<br>import {Provider} from â€˜react-reduxâ€™;<br>import reducer from â€˜./reducerâ€™</p>
<p>+import {sayHello} from â€˜./sagasâ€™;<br>+sayHello();</p>
<p>const store = createStore(reducer);</p>
<p>ReactDOM.render(<br>  <provider store="{store}"><br>    <gallery><br>  </gallery></provider>,<br>  document.getElementById(â€˜rootâ€™)<br>);<br>  <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"></div><div class="line">ä¸ç®¡ä½ ç›¯ä½ç»ˆç«¯å¤šé•¿æ—¶é—´,â€œhelloâ€æ°¸è¿œä¸ä¼šå‡ºç°.</div><div class="line">è¿™æ˜¯å› ä¸º`sayHello`æ˜¯ä¸€ä¸ªgeneratorï¼Generator ä¸ä¼šç«‹å³æ‰§è¡Œ.å¦‚æœä½ æŠŠä»£ç è¯¥ä¸º`sayHello().next();`ä½ çš„â€œhelloâ€å°±å‡ºç°äº†.ä¸ç”¨æ‹…å¿ƒ,æˆ‘ä»¬ä¸ä¼šæ€»æ˜¯è°ƒç”¨`next`.æ­£å¦‚Redux,redux-sagaç”¨æ¥æ¶ˆé™¤åº”ç”¨å¼€å‘ä¸­çš„ç—›è‹¦.</div><div class="line"></div><div class="line">é…ç½® redux-sage</div><div class="line">___</div></pre></td></tr></table></figure></p>
<p>   import â€œbabel-polyfillâ€;</p>
<p>import React from â€˜reactâ€™;<br>import ReactDOM from â€˜react-domâ€™;</p>
<p>import Gallery from â€˜./Galleryâ€™;</p>
<p>-import { createStore } from â€˜reduxâ€™<br>+import { createStore, applyMiddleware } from â€˜reduxâ€™<br>+import createSagaMiddleware from â€˜redux-sagaâ€™<br>import {Provider} from â€˜react-reduxâ€™;<br>import reducer from â€˜./reducerâ€™</p>
<p>import {sayHello} from â€˜./sagasâ€™;<br>-sayHello()</p>
<p>-const store = createStore(reducer);<br>+const store = createStore(</p>
<ul>
<li>reducer,</li>
<li>applyMiddleware(createSagaMiddleware(sayHello))<br>+);</li>
</ul>
<p>ReactDOM.render(<br>  <provider store="{store}"><br>    <gallery><br>  </gallery></provider>,<br>  document.getElementById(â€˜rootâ€™)<br>);<br>  <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  ___</div><div class="line">  æˆ‘ä»¬å·²ä»Reduxå¯¼å…¥äº†`applyMiddleware`å‡½æ•°.ä»redux-sagaå¯¼å…¥`createSagaMiddleware`å‡½æ•°.å½“æˆ‘ä»¬åˆ›å»ºstoreçš„æ—¶å€™,æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸­é—´ä»¶æä¾›Reduxéœ€è¦çš„åŠŸèƒ½.åœ¨è¿™ä¸ªå®ä¾‹ä¸­,æˆ‘ä»¬ä¼šè°ƒç”¨`applyMiddleware`å‡½æ•°,è¿™ä¸ªå‡½æ•°è¿”å›`createSagaMiddleware(sayHello)`çš„ç»“æœ.åœ¨å¹•å,redux-sagaåŠ è½½`sayHello`å‡½æ•°,ä»ªå¼æ€§çš„è°ƒç”¨`next`å‡½æ•°.</div><div class="line">  </div><div class="line">  åº”è¯¥å¯ä»¥åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°æç¤ºæ¶ˆæ¯äº†.</div><div class="line">  ç°åœ¨è®©æˆ‘ä»¬æ„å»ºåŠ è½½å›¾ç‰‡çš„saga</div><div class="line">  </div><div class="line">####é€šè¿‡SagaåŠ è½½å›¾ç‰‡æ•°æ®</div><div class="line">___</div><div class="line">æˆ‘ä»¬å°†åˆ é™¤å‡ºsayHello saga,ä½¿ç”¨`loadImages` saga</div></pre></td></tr></table></figure></p>
<p>  -export function* sayHello() {</p>
<ul>
<li>console.log(â€˜helloâ€™);<br>-}</li>
</ul>
<p>+export function* loadImages() {</p>
<ul>
<li>console.log(â€˜load some images pleaseâ€™)<br>+}<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">ä¸è¦å¿˜äº†æ›´æ–°`main.js`</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import â€œbabel-polyfillâ€;</p>
<p>import React from â€˜reactâ€™;<br>import ReactDOM from â€˜react-domâ€™;</p>
<p>import Gallery from â€˜./Galleryâ€™;</p>
<p>import { createStore, applyMiddleware } from â€˜reduxâ€™<br>import {Provider} from â€˜react-reduxâ€™;<br>import createSagaMiddleware from â€˜redux-sagaâ€™<br>import reducer from â€˜./reducerâ€™</p>
<p>-import {sayHello} from â€˜./sagasâ€™;<br>+import {loadImages} from â€˜./sagasâ€™;</p>
<p>const store = createStore(<br>  reducer,</p>
<ul>
<li>applyMiddleware(createSagaMiddleware(sayHello))</li>
</ul>
<ul>
<li>applyMiddleware(createSagaMiddleware(loadImages))<br>);</li>
</ul>
<p>ReactDOM.render(<br>  <provider store="{store}"><br>    <gallery><br>  </gallery></provider>,<br>  document.getElementById(â€˜rootâ€™)<br>);<br>  <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">ç°åœ¨sagaå·²ç»åŠ è½½,åœ¨`saga.js`ä¸­æ·»åŠ `fetchImages`æ–¹æ³•</div></pre></td></tr></table></figure></p>
<pre><code>const API_KEY = &apos;a46a979f39c49975dbdd23b378e6d3d5&apos;;
</code></pre><p>const API_ENDPOINT = <code>https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5</code>;</p>
<p>const fetchImages = () =&gt; {<br>  return fetch(API<em>ENDPOINT).then(function (response) {<br>    return response.json().then(function (json) {<br>      return json.photos.photo.map(<br>        ({farm, server, id, secret}) =&gt; `<a href="https://farm${farm}.staticflickr.com/${server}/${id}" target="_blank" rel="external">https://farm${farm}.staticflickr.com/${server}/${id}</a></em>${secret}.jpg`<br>      );<br>    })<br>  })<br>};</p>
<p>export function* loadImages() {<br>  const images = yield fetchImages();<br>  console.log(images)<br>}<br>   <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"></div><div class="line"></div><div class="line"> `fetchImages`æ–¹æ³•è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡.æˆ‘ä»¬å°†è°ƒç”¨`fetchImages`,ä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¦ä½¿ç”¨`yield`å…³é”®å­—.é€šè¿‡é»‘æš—è‰ºæœ¯å’Œå·«æœ¯,generatorsç†è§£Promiseå¯¹è±¡,æ­£å¦‚ç»ˆç«¯è¾“å‡ºçš„æ—¥å¿—æ˜¾ç¤º,æˆ‘ä»¬å·²ç»æ”¶è·äº†ä¸€ä¸ªå›¾ç‰‡URLsçš„æ•°ç»„.çœ‹çœ‹`loadImages`çš„ä»£ç ,ä»–çœ‹èµ·æ¥åƒæ˜¯å…¸å‹çš„åŒæ­¥æ“ä½œä»£ç .`yield`å…³é”®å­—æ˜¯ç§˜åˆ¶è°ƒå‘³é…±,è®©æˆ‘ä»¬çš„ä»£ç ç”¨åŒæ­¥æ ¼å¼æ‰§è¡Œå¼‚æ­¥æ“ä½œæ´»åŠ¨.</div><div class="line"> ___</div><div class="line"> </div><div class="line"> ####å°è£…æˆ‘ä»¬çš„å¼‚æ­¥APIè¯·æ±‚.</div><div class="line"> </div><div class="line"> é¦–å…ˆæ¥å®šä¹‰ä¸€ä¸‹éœ€è¦ä½¿ç”¨çš„api.ä»–æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹,å®é™…ä¸Šä»–å’Œæ—©å…ˆåŠ è½½Flickr imagesçš„ä»£ç æ˜¯ç›¸åŒçš„.æˆ‘ä»¬åˆ›å»º`flickr.js`æ–‡ä»¶</div></pre></td></tr></table></figure></p>
<p>   const API_KEY = â€˜a46a979f39c49975dbdd23b378e6d3d5â€™;<br>const API_ENDPOINT = <code>https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5</code>;</p>
<p>export const fetchImages = () =&gt; {<br>  return fetch(API<em>ENDPOINT).then(function (response) {<br>    return response.json().then(function (json) {<br>      return json.photos.photo.map(<br>        ({farm, server, id, secret}) =&gt; `<a href="https://farm${farm}.staticflickr.com/${server}/${id}" target="_blank" rel="external">https://farm${farm}.staticflickr.com/${server}/${id}</a></em>${secret}.jpg`<br>      );<br>    })<br>  })<br>};<br> <figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> ___</div><div class="line"> </div><div class="line"></div><div class="line">ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´,ä¸éœ€è¦è¿™ä¹ˆåš,ä½†æ˜¯è¿™ä¼šå¸¦æ¥ä¸€å®šçš„å¥½å¤„.æˆ‘ä»¬å¤„åœ¨åº”ç”¨çš„è¾¹ç¼˜(boundaries <span class="keyword">of</span> our application,æ„æ€æ˜¯è¯´åœ¨è¿™é‡Œçš„ä»£ç å¯èƒ½æ˜¯å¾ˆå¤šå’Œè¿œç¨‹æœåŠ¡å™¨äº¤äº’çš„ä»£ç ï¼Œå¯èƒ½é€»è¾‘ä¼šå¾ˆå¤æ‚),äº‹æƒ…éƒ½æœ‰ç‚¹ä¹±.é€šè¿‡å°è£…å’Œè¿œç¨‹APIäº¤äº’çš„é€»è¾‘,æˆ‘ä»¬çš„ä»£ç å°†ä¼šå¾ˆæ•´æ´,å¾ˆå®¹æ˜“æ›´æ–°.å¦‚æœéœ€è¦æŠ¹æ‰å›¾ç‰‡æœåŠ¡ä¹Ÿä¼šå‡ºå¥‡çš„ç®€å•.</div><div class="line"></div><div class="line">æˆ‘ä»¬çš„`saga.js`çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</div></pre></td></tr></table></figure></p>
<p>  import {fetchImages} from â€˜./flickrâ€™;</p>
<p>export function* loadImages() {<br>  const images = yield fetchImages();<br>  console.log(images)<br>}<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æˆ‘ä»¬ä»ç„¶éœ€è¦åœ¨sagaå¤–è·å–æ•°æ®,å¹¶ä¸”è¿›å…¥åº”ç”¨çš„state(ä½¿ç”¨å¼‚æ­¥è·å–çš„è¿œç¨‹æ•°æ®æ›´æ–°state).ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜,æˆ‘ä»¬å°†ä½¿ç”¨â€effectsâ€.</div><div class="line"></div><div class="line">####ä»sagaæ¥æ›´æ–°åº”ç”¨</div><div class="line"></div><div class="line">æˆ‘ä»¬å¯ä»¥é€šè¿‡`dispatch`æˆ–è€…storeä½œä¸ºå‚æ•°æ¥è°ƒç”¨saga,ä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ—¶é—´ä¸€é•¿å°±ä¼šç»™äººé€ æˆäº›è®¸çš„å›°æ‰°.æˆ‘ä»¬é€‰æ‹©é‡‡ç”¨redux-sagaæä¾›çš„`put`æ–¹æ³•.</div><div class="line">é¦–å…ˆæˆ‘ä»¬æ›´æ–°`reducer.js`æ“ä½œä¸€ä¸ªæ–°çš„actionç±»å‹`IMAGES_LOADED`.</div></pre></td></tr></table></figure></p>
<p>const defaultState = {</p>
<ul>
<li>images: []<br>}</li>
</ul>
<p>export default function images(state = defaultState, action) {<br>  switch(action.type) {<br>    case â€˜IMAGE_SELECTEDâ€™:<br>      return {â€¦state, selectedImage: action.image};</p>
<ul>
<li>case â€˜IMAGES_LOADEDâ€™:</li>
<li><p>return {â€¦state, images: action.images};<br>default:<br>return state;<br>}<br>}     </p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">___</div><div class="line">æˆ‘ä»¬æ·»åŠ äº†æ–°çš„åˆ†æ”¯,å¹¶ä»`<span class="keyword">default</span>State`ä¸­åˆ é™¤äº†ç¡¬ç¼–ç çš„URLsæ•°æ®.`IMAGES_LOADED`åˆ†æ”¯ç°åœ¨è¿”å›ä¸€ä¸ªæ›´æ–°çš„<span class="keyword">state</span>,åŒ…å«actionçš„imageæ•°æ®.</div><div class="line">ä¸‹ä¸€æ­¥æˆ‘ä»¬æ›´æ–°saga:</div></pre></td></tr></table></figure>
<p>import {fetchImages} from â€˜./flickrâ€™;<br>+import {put} from â€˜redux-saga/effectsâ€™;</p>
</li>
</ul>
<p>export function* loadImages() {<br>  const images = yield fetchImages();</p>
<ul>
<li>yield put({type: â€˜IMAGES_LOADEDâ€™, images})<br>}<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line"></div><div class="line">å¯¼å…¥`put`ä»¥å,æˆ‘ä»¬åœ¨`loadImages`æ·»åŠ å¦å¤–ä¸€è¡Œ.ä»–`yield` `put`å‡½æ•°è°ƒç”¨çš„è¿”å›ç»“æœ.åœ¨å¹•å,redux-saga åˆ†å‘è¿™äº›åŠ¨ä½œ,reduceræ¥æ”¶åˆ°äº†æ¶ˆæ¯!</div><div class="line">	   æ€æ ·æ‰èƒ½ä½¿ç”¨ç‰¹å®šç±»å‹çš„actionæ¥è§¦å‘ä¸€ä¸ªsaga?</div><div class="line">	   </div><div class="line">####ä½¿ç”¨actionsæ¥è§¦å‘sagaå·¥ä½œæµ</div><div class="line">___</div><div class="line">Sagaså˜å¾—è¶Šæ¥è¶Šæœ‰ç”¨,å› ä¸ºæˆ‘ä»¬æœ‰èƒ½åŠ›ä½¿ç”¨redux actionsæ¥è§¦å‘å·¥ä½œæµ.å½“æˆ‘ä»¬è¿™æ ·åš,sagaä¼šåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­è¡¨ç°å‡ºæ›´å¤§çš„èƒ½åŠ›.é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„saga.`watchForLoadImages`.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import {fetchImages} from â€˜./flickrâ€™;<br>-import {put} from â€˜redux-saga/effectsâ€™;<br>+import {put, take} from â€˜redux-saga/effectsâ€™;</p>
<p>export function* loadImages() {<br>  const images = yield fetchImages();<br>  yield put({type: â€˜IMAGES_LOADEDâ€™, images})<br>}</p>
<p>+export function* watchForLoadImages() {</p>
<ul>
<li>while(true) {</li>
<li>yield take(â€˜LOAD_IMAGESâ€™);</li>
<li>yield loadImages();</li>
<li>}<br>+}   <figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">  ___</div><div class="line">æ–°çš„sagaä½¿ç”¨çš„æ˜¯<span class="keyword">while</span>æ¥ä¿æŒä¸€ç›´æ¿€æ´»å’Œç­‰å¾…è°ƒç”¨çŠ¶æ€.åœ¨å¾ªç¯çš„å†…éƒ¨,æˆ‘ä»¬ç”Ÿæˆ(<span class="keyword">yield</span>)ä¸€ä¸ªredux<span class="params">-sage</span>è°ƒç”¨æ–¹æ³•:<span class="string">`take`</span>.<span class="keyword">Take</span>æ–¹æ³•ç›‘å¬ä»»ä½•ç±»å‹çš„actions,ä»–ä¹Ÿä¼šä½¿sagaæ¥å—ä¸‹ä¸€ä¸ª<span class="keyword">yield</span>.åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•<span class="string">`loadImages`</span>,åˆå§‹åŒ–å›¾ç‰‡åŠ è½½.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import â€œbabel-polyfillâ€;</p>
<p>import React from â€˜reactâ€™;<br>import ReactDOM from â€˜react-domâ€™;</p>
<p>import Gallery from â€˜./Galleryâ€™;</p>
<p>import { createStore, applyMiddleware } from â€˜reduxâ€™<br>import {Provider} from â€˜react-reduxâ€™;<br>import createSagaMiddleware from â€˜redux-sagaâ€™<br>import reducer from â€˜./reducerâ€™</p>
<p>-import {loadImages} from â€˜./sagasâ€™;<br>+import {loadImages} from â€˜./watchForLoadImagesâ€™;</p>
<p>const store = createStore(<br>  reducer,</p>
<ul>
<li>applyMiddleware(createSagaMiddleware(loadImages))</li>
</ul>
<ul>
<li>applyMiddleware(createSagaMiddleware(watchForLoadImages))<br>);</li>
</ul>
<p>ReactDOM.render(<br>  <provider store="{store}"><br>    <gallery><br>  </gallery></provider>,<br>  document.getElementById(â€˜rootâ€™)<br>);<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æ›´æ–°äº†`main.js`ä»¥å,åº”ç”¨ä¸å†åŠ è½½å›¾ç‰‡,æˆ‘ä»¬éœ€è¦åœ¨action creatorsä¸­æ·»åŠ `loadImages`çš„`action`.</div></pre></td></tr></table></figure></p>
<p>export const IMAGE_SELECTED = â€˜IMAGE_SELECTEDâ€™;<br>+const LOAD_IMAGES = â€˜LOAD_IMAGESâ€™;</p>
<p>export function selectImage(image) {<br>  return {<br>    type: IMAGE_SELECTED,<br>    image<br>  }<br>}</p>
<p>+export function loadImages() {</p>
<ul>
<li>return {</li>
<li>type: LOAD_IMAGES</li>
<li>}<br>+}<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">å› ä¸ºæˆ‘ä»¬å·²ç»ç»‘å®šäº†action creators(Actionåˆ›å»ºå™¨),æˆ‘ä»¬åªéœ€è¦åœ¨`Gallery`ç»„ä»¶ä¸­è°ƒç”¨è¿™ä¸ªactionå°±å¯ä»¥äº†.</div><div class="line"></div><div class="line">####block(é˜»å¡)å’Œno-blocking(éé˜»å¡)æ•ˆåº”</div><div class="line">ç°åœ¨æˆ‘ä»¬çš„å¼•ç”¨å·¥ä½œçš„è¶³å¤Ÿå¥½äº†,ä½†æ˜¯å¯èƒ½è¿˜æœ‰æ›´å¤šçš„é—®é¢˜éœ€è¦è€ƒè™‘.`watchForLoadImages` sagaåŒ…å« block effects.é‚£ä¹ˆè¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™æ„å‘³ç€åœ¨å·¥ä½œæµä¸­æˆ‘ä»¬åªèƒ½æ‰§è¡Œä¸€æ¬¡`LOAD_IMAGES`!åœ¨è¯¸å¦‚æˆ‘ä»¬ç°åœ¨æ„å»ºçš„å°å‹åº”ç”¨ä¸€æ ·,è¿™ä¸€ç‚¹ä¸å¤ªæ˜æ˜¾,å®é™…ä¸Šæˆ‘ä»¬ä¹Ÿä»…ä»…åŠ è½½äº†ä¸€æ¬¡å›¾ç‰‡é›†.</div><div class="line">å®é™…ä¸Šï¼Œæ™®éçš„åšæ³•æ˜¯ä½¿ç”¨`fork` effect ä»£æ›¿  `yield` æ¥åŠ è½½å›¾ç‰‡</div><div class="line">.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>export function* watchForLoadImages() {<br>  while(true) {<br>    yield take(â€˜LOAD_IMAGESâ€™);</p>
<ul>
<li>yield loadImages();</li>
</ul>
<ul>
<li>yield fork(loadImages); //be sure to import it!<br>}<br>}<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">___</div><div class="line">ä½¿ç”¨`fork`åŠ©æ‰‹(helper)å‡½æ•°,`watchForLoadImages`å°±å˜æˆäº†éé˜»å¡sagaäº†,å†ä¹Ÿä¸ç”¨è€ƒè™‘ä»–æ˜¯ä¸æ˜¯ä»¥å‰æ‰ç”¨è¿‡.redux-sagas æä¾›ä¸¤ä¸ªhelpers,`takeEvery`å’Œ`takeLastest`ï¼ˆtakeEveryç›‘å¬å¤šæ¬¡actionï¼Œä¸è€ƒè™‘æ˜¯ä¸æ˜¯åŒä¸€ç§action type,takeLateståªå¤„ç†åŒä¸€ç§action typeçš„æœ€åä¸€æ¬¡è°ƒç”¨ï¼‰.</div><div class="line">####é€‰æ‹©é»˜è®¤çš„å›¾ç‰‡</div><div class="line">SagasæŒ‰ç…§é˜Ÿåˆ—æ¥æ‰§è¡Œacitons,æ‰€ä»¥æ·»åŠ æ›´å¤šçš„sagaä¹Ÿå¾ˆå®¹æ˜“.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import {fetchImages} from â€˜./flickrâ€™;<br>import {put, take, fork} from â€˜redux-saga/effectsâ€™;</p>
<p>export function* loadImages() {<br>  const images = yield fetchImages();<br>  yield put({type: â€˜IMAGES_LOADEDâ€™, images})</p>
<ul>
<li>yield put({type: â€˜IMAGE_SELECTEDâ€™, image: images[0]})<br>}</li>
</ul>
<p>export function* watchForLoadImages() {<br>  while(true) {<br>    yield take(â€˜LOAD_IMAGESâ€™);<br>    yield fork(loadImages);<br>  }<br>}<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">åœ¨ `loadImages`å·¥ä½œæµä¸Š,æˆ‘ä»¬å¯ä»¥yield putå‡½æ•°è°ƒç”¨,action typeæ˜¯`IMAGE_SELECTED`.å‘é€æˆ‘ä»¬é€‰æ‹©çš„å›¾ç‰‡(åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‘é€çš„ä»…ä»…æ˜¯å›¾ç‰‡çš„urlçš„å­—ç¬¦ä¸²).</div><div class="line">####é”™è¯¯å¤„ç†</div><div class="line">å¦‚æœåœ¨sagaå¾ªç¯å†…éƒ¨å‡ºç°é”™è¯¯,æˆ‘ä»¬è¦è€ƒè™‘æé†’åº”ç”¨åšå‡ºåˆç†çš„å›åº”.æ‰€æœ‰æµç¨‹åŒ…è£…åˆ°try/catchè¯­å¥å—é‡Œå°±å¯ä»¥å®ç°,æ•è·é”™è¯¯ä»¥å`put`ä¸€ä¸ªæç¤ºä¿¡æ¯ä½œä¸º`IMAGE_LOAD_FAILURE` actionçš„å†…å®¹.</div></pre></td></tr></table></figure></p>
<p>import {fetchImages} from â€˜./flickrâ€™;<br>import {put, take, fork} from â€˜redux-saga/effectsâ€™;</p>
<p>export function* loadImages() {</p>
<ul>
<li>try {<br> const images = yield fetchImages();<br> yield put({type: â€˜IMAGES_LOADEDâ€™, images})<br> yield put({type: â€˜IMAGE_SELECTEDâ€™, image: images[0]})</li>
<li>} catch(error) {</li>
<li>yield put({type: â€˜IMAGE_LOAD_FAILUREâ€™, error})</li>
<li>}<br>}</li>
</ul>
<p>export function* watchForLoadImages() {<br>  while(true) {<br>    yield take(â€˜LOAD_IMAGESâ€™);<br>    yield fork(loadImages);<br>  }<br>}<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="emphasis">___</span></div><div class="line"><span class="section">####Sagasçš„æµ‹è¯•</span></div><div class="line"><span class="emphasis">___</span></div><div class="line">åœ¨åº”ç”¨ä¸­ä½¿ç”¨Redux,æµ‹è¯•å˜å¾—ç›¸å½“çš„èˆ’æœ. çœ‹çœ‹æˆ‘ä»¬çš„[<span class="string">é¹…è›‹å¤´ç³»åˆ—è¯¾ç¨‹</span>](<span class="link">https://egghead.io/series/react-testing-cookbook</span>),å¯ä»¥äº†è§£åˆ°å¾ˆå¤šReactçš„æµ‹è¯•æŠ€æœ¯.</div><div class="line">ä½¿ç”¨Redux-sagaåœ¨æ£’çš„ä¸€ä¸ªæ–¹é¢å°±æ˜¯å¼‚æ­¥ä»£ç æµ‹è¯•å¾ˆå®¹æ˜“.æµ‹è¯•javascriptå¼‚æ­¥ä»£ç çœŸæ˜¯ä¸€ä»¶è‹¦å·®äº‹.æœ‰äº†saga,æˆ‘ä»¬ä¸éœ€è¦è·³å‡ºå¼•ç”¨çš„æ ¸å¿ƒä»£ç .SagaæŠŠjavascriptçš„ç—›ç‚¹éƒ½æŠ¹æ‰äº†.æ˜¯ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬è¦å†™æ›´å¤šçš„æµ‹è¯•?å¯¹çš„.</div><div class="line"></div><div class="line">æˆ‘ä»¬ä¼šä½¿ç”¨<span class="code">`tape`</span>ç»„ä»¶,é¦–å…ˆåšä¸€äº›é…ç½®å·¥ä½œ.</div></pre></td></tr></table></figure></p>
<p>import test from â€˜tapeâ€™;<br>import {put, take} from â€˜redux-saga/effectsâ€™<br>import {watchForLoadImages, loadImages} from â€˜./sagasâ€™;<br>import {fetchImages} from â€˜./flickrâ€™;</p>
<p>test(â€˜watchForLoadImagesâ€™, assert =&gt; {<br>  const generator = watchForLoadImages();</p>
<p>  assert.end();<br>});<br><figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æ·»åŠ æ‰€æœ‰éœ€è¦çš„ç»„ä»¶,ç°åœ¨æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæµ‹è¯•.è¿™ä¸ªæµ‹è¯•æ¥æ”¶ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå‡½æ•°ä½œä¸ºå½¢å‚.åœ¨æµ‹è¯•çš„å‡½æ•°ä½“å†…éƒ¨ä»£ç å—,æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªsagaç”Ÿæˆå™¨ä»£ç å®ä¾‹.åœ¨è¿™ä¸ªå®ä¾‹é‡Œé¢æˆ‘ä»¬å°…æ˜¯æµ‹è¯•sagaçš„æ¯ä¸€ä¸ªåŠ¨ä½œ.</div></pre></td></tr></table></figure></p>
<p>import test from â€˜tapeâ€™;<br>import {put, take} from â€˜redux-saga/effectsâ€™<br>import {watchForLoadImages, loadImages} from â€˜./sagasâ€™;<br>import {fetchImages} from â€˜./flickrâ€™;</p>
<p>test(â€˜watchForLoadImagesâ€™, assert =&gt; {<br>  const generator = watchForLoadImages();</p>
<ul>
<li>assert.deepEqual(</li>
<li>generator.next().value,</li>
<li>false,</li>
<li>â€˜watchForLoadImages should be waiting for LOAD_IMAGES actionâ€™</li>
<li><p>);</p>
<p>assert.end();<br>});</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">`assert.deepEqual`æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå€¼,æ£€æŸ¥ä¸€ä¸‹ä»–ä»¬æ˜¯ä¸æ˜¯æ·±åº¦ç›¸åŒ(jså¯¹è±¡çš„æ¦‚å¿µ).ç¬¬ä¸€è¡Œä»£ç æ˜¯`generator.next().value`çš„è°ƒç”¨,è¿™ä¸ªè°ƒç”¨ä½¿ç”Ÿæˆå™¨ä»æš‚åœä¸­æ¢å¤,å¾—åˆ°å€¼.ä¸‹ä¸€ä¸ªå€¼å•å•æ˜¯ä¸€ä¸ª`false`.æˆ‘æƒ³çœ‹åˆ°ä»–å¤±è´¥,æœ€åä¸€ä¸ªå‚æ•°æè¿°äº†æµ‹è¯•æœŸå¾…çš„è¡Œä¸º.</div><div class="line">åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å‘½ä»¤è¡Œè¿è¡Œ`npm test`çœ‹çœ‹ç»“æœ:</div></pre></td></tr></table></figure>
<p>import test from â€˜tapeâ€™;<br>import {put, take} from â€˜redux-saga/effectsâ€™<br>import {watchForLoadImages, loadImages} from â€˜./sagasâ€™;<br>import {fetchImages} from â€˜./flickrâ€™;</p>
</li>
</ul>
<p>test(â€˜watchForLoadImagesâ€™, assert =&gt; {<br>  const generator = watchForLoadImages();</p>
<ul>
<li>assert.deepEqual(</li>
<li>generator.next().value,</li>
<li>false,</li>
<li>â€˜watchForLoadImages should be waiting for LOAD_IMAGES actionâ€™</li>
<li><p>);</p>
<p>assert.end();<br>});</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æµ‹è¯•ç»“æœå’Œé¢„æœŸçš„ä¸€æ ·å¤±è´¥,ç»“æœæœ‰ç‚¹æ„æ€.å®é™…çš„ç»“è®ºæ˜¯`&#123;TAKE:<span class="string">'LOAD_IMAGES'</span>&#125;`,è¿™æ˜¯æˆ‘ä»¬è°ƒç”¨`take(<span class="string">'LOAD_IMAGES'</span>)`å—åˆ°çš„ç»“æœ.å®é™…ä¸Š,æˆ‘ä»¬çš„sagaâ€™å¯ä»¥yieldä¸€ä¸ªå¯¹è±¡æ¥ä»£æ›¿è°ƒç”¨`take`.ä½†æ˜¯`take`æ·»åŠ äº†ä¸€äº›ä»£ç ,è®©æˆ‘ä»¬å°‘æ•²äº›ä»£ç .</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import test from â€˜tapeâ€™;<br>import {put, take} from â€˜redux-saga/effectsâ€™<br>import {watchForLoadImages, loadImages} from â€˜./sagasâ€™;<br>import {fetchImages} from â€˜./flickrâ€™;</p>
<p>test(â€˜watchForLoadImagesâ€™, assert =&gt; {<br>  const generator = watchForLoadImages();</p>
<p>  assert.deepEqual(<br>    generator.next().value,</p>
<ul>
<li>false</li>
</ul>
<ul>
<li><p>take(â€˜LOAD_IMAGESâ€™),<br>â€˜watchForLoadImages should be waiting for LOAD_IMAGES actionâ€™<br>);</p>
<p>assert.end();<br>});</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æˆ‘ä»¬ç®€å•çš„è°ƒç”¨`take`å‡½æ•°,å°±å¯ä»¥å¾—åˆ°æœŸå¾…çš„ç»“æœäº†.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>import test from â€˜tapeâ€™;<br>import {put, take} from â€˜redux-saga/effectsâ€™<br>import {watchForLoadImages, loadImages} from â€˜./sagasâ€™;<br>import {fetchImages} from â€˜./flickrâ€™;</p>
<p>test(â€˜watchForLoadImagesâ€™, assert =&gt; {<br>  const generator = watchForLoadImages();</p>
<p>  assert.deepEqual(<br>    generator.next().value,<br>    take(â€˜LOAD_IMAGESâ€™),<br>    â€˜watchForLoadImages should be waiting for LOAD_IMAGES actionâ€™<br>  );</p>
<ul>
<li>assert.deepEqual(</li>
<li>gen.next().value,</li>
<li>false,</li>
<li>â€˜watchForLoadImages should call loadImages after LOAD_IMAGES action is receivedâ€™</li>
<li><p>);</p>
<p>assert.end();<br>});</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">ä¸‹ä¸€ä¸ªæµ‹è¯•ä½¿æˆ‘ä»¬ç¡®ä¿¡`loadImages`sagaåœ¨æµç¨‹çš„ä¸‹ä¸€ä¸ªé˜¶æ®µä¼šè¢«è‡ªåŠ¨è°ƒç”¨.</div><div class="line">æˆ‘ä»¬éœ€è¦ä¸€ä¸ª falseæ¥æ£€æŸ¥ç»“æœ.</div><div class="line">æ›´æ–°ä¸€ä¸‹sagaä»£ç ,yieldä¸€ä¸ª`loadImages` saga:</div></pre></td></tr></table></figure>
</li>
</ul>
<p>export function* watchForLoadImages() {<br>  while(true) {<br>    yield take(â€˜LOAD_IMAGESâ€™);</p>
<ul>
<li>yield loadImages();</li>
</ul>
<ul>
<li>yield fork(loadImages); //be sure to import it!<br>}<br>}<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">___</span></div><div class="line">ç°åœ¨è¿è¡Œæµ‹è¯•,å°†ä¼šçœ‹åˆ°ä¸‹é¢ç»“æœï¼š</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="âœ–-watchForLoadImages-should-call-loadImages-after-LOAD-IMAGES-action-is-received"><a href="#âœ–-watchForLoadImages-should-call-loadImages-after-LOAD-IMAGES-action-is-received" class="headerlink" title="âœ– watchForLoadImages should call loadImages after LOAD_IMAGES action is received"></a>âœ– watchForLoadImages should call loadImages after LOAD_IMAGES action is received</h2><p>  operator: deepEqual<br>  expected: |-<br>    false<br>  actual: |-<br>    { _invoke: [Function: invoke] }<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">å“¼ï¼`&#123; _invoke: [Function: invoke] &#125;`ç»å¯¹ä¸æ˜¯æˆ‘ä»¬yield takeæƒ³è¦çš„ç»“æœ.</div><div class="line">æœ‰é—®é¢˜.å¹¸è¿çš„æ˜¯redux-sagaå¯ä»¥ä½¿ç”¨è¯¸å¦‚`fork`ä¸€æ ·çš„`effects`æ¥è§£å†³è¿™ä¸ªé—®é¢˜.`fork`,`take`å’Œå…¶ä»–çš„effectæ–¹æ³•è¿”å®¹æ˜“æ»¡è¶³æµ‹è¯•è¦æ±‚çš„ç®€å•å¯¹è±¡.è¿™äº›effectsè¿”å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ªæŒ‡å¯¼redux-sagaè¿›è¡Œä»»åŠ¡æ‰§è¡Œçš„é›†åˆ.è¿™ä¸€ç‚¹å¯¹äºæµ‹è¯•æ¥è¯´éå¸¸çš„ä¼˜é›…,å› ä¸ºæˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒç±»ä¼¼è¿œç¨‹æœåŠ¡è¯·æ±‚çš„å‰¯ä½œç”¨.æœ‰äº†redux-saga,æˆ‘ä»¬æŠŠæ³¨æ„ç‚¹æ”¾åˆ°è¯·æ±‚æ‰§è¡Œçš„å‘½ä»¤ä¸Š.</div><div class="line">ä¸‹é¢è®©æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹saga,å†ä¸€æ¬¡ä½¿ç”¨`fork`.</div></pre></td></tr></table></figure></p>
<p>export function* watchForLoadImages() {<br>  while(true) {<br>    yield take(â€˜LOAD_IMAGESâ€™);</p>
<ul>
<li>yield loadImages();</li>
</ul>
<ul>
<li><p>yield fork(loadImages);</p>
<p>}<br>}</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">___</div><div class="line">è¿™é‡Œä½¿ç”¨`yield fork(loadImages)`ç›´æ¥ä»£æ›¿`loadImages`.éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ‰§è¡Œ`loadImages`,è€Œæ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™`fork`.</div><div class="line">å†æ¬¡è¿è¡Œ`npm test`.</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="âœ–-watchForLoadImages-should-call-loadImages-after-LOAD-IMAGES-action-is-received-1"><a href="#âœ–-watchForLoadImages-should-call-loadImages-after-LOAD-IMAGES-action-is-received-1" class="headerlink" title="âœ– watchForLoadImages should call loadImages after LOAD_IMAGES action is received"></a>âœ– watchForLoadImages should call loadImages after LOAD_IMAGES action is received</h2><p>  operator: deepEqual<br>  expected: |-<br>    false<br>  actual: |-<br>    { FORK: { args: [], context: null, fn: [Function: loadImages] } }<br><figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">ç»“æœå¾—åˆ°äº†ä¸€ä¸ªå•çº¯å¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨.å‡½æ•°åœ¨æµè§ˆå™¨ç«¯ä¹ŸåŒæ—¶åŠ è½½äº†,ä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥è½»æ¾çš„åœ¨saga å·¥ä½œæµé‡Œæµ‹è¯•è¿™ä¸ªæ­¥éª¤.</div></pre></td></tr></table></figure></p>
<p>import test from â€˜tapeâ€™;<br>import {put, take} from â€˜redux-saga/effectsâ€™<br>import {watchForLoadImages, loadImages} from â€˜./sagasâ€™;<br>import {fetchImages} from â€˜./flickrâ€™;</p>
<p>test(â€˜watchForLoadImagesâ€™, assert =&gt; {<br>  const generator = watchForLoadImages();</p>
<p>  assert.deepEqual(<br>    generator.next().value,<br>    take(â€˜LOAD_IMAGESâ€™),<br>    â€˜watchForLoadImages should be waiting for LOAD_IMAGES actionâ€™<br>  );</p>
<p>  assert.deepEqual(<br>    generator.next().value,</p>
<ul>
<li>false,</li>
</ul>
<ul>
<li><p>yield fork(loadImages),<br>â€˜watchForLoadImages should call loadImages after LOAD_IMAGES action is receivedâ€™<br>);</p>
<p>assert.end();<br>});</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">___</div><div class="line">æµ‹è¯•`loadImages`sagaæ˜¯ä¸€æ ·çš„,åªéœ€è¦æŠŠ`yield fetchImages`æ›´æ–°ä¸º`yield fork(fetchImages)`.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>test(â€˜loadImagesâ€™, assert =&gt; {<br>  const gen = loadImages();</p>
<p>  assert.deepEqual(<br>    gen.next().value,<br>    call(fetchImages),<br>    â€˜loadImages should call the fetchImages apiâ€™<br>  );</p>
<p>  const images = [0];</p>
<p>  assert.deepEqual(<br>    gen.next(images).value,<br>    put({type: â€˜IMAGES_LOADEDâ€™, images}),<br>    â€˜loadImages should dispatch an IMAGES_LOADED action with the imagesâ€™<br>  );</p>
<p>  assert.deepEqual(<br>    gen.next(images).value,<br>    put({type: â€˜IMAGE_SELECTEDâ€™, image: images[0]}),<br>    â€˜loadImages should dispatch an IMAGE_SELECTED action with the first imageâ€™<br>  );</p>
<p>  const error = â€˜errorâ€™;</p>
<p>  assert.deepEqual(<br>    gen.throw(error).value,<br>    put({type: â€˜IMAGE_LOAD_FAILUREâ€™, error}),<br>    â€˜loadImages should dispatch an IMAGE_LOAD_FAILURE if an error is thrownâ€™<br>  );</p>
<p>  assert.end();<br>});<br>```</p>
<hr>
<p>ç‰¹åˆ«æ³¨æ„æœ€åä¸€ä¸ª<code>assert</code>.è¿™ä¸ªæ–­è¨€æµ‹è¯•ä½¿ç”¨å¼‚å¸¸æ•è·ä»£æ›¿ç”Ÿæˆå™¨å‡½æ•°çš„nextæ–¹æ³•.å¦ä¸€ä¸ªéå¸¸é…·çš„åœ°æ–¹æ˜¯ï¼šå¯ä»¥ä¼ å€¼.æ³¨æ„çœ‹ä»£ç ,æˆ‘ä»¬åˆ›å»ºäº†<code>images</code>å¸¸é‡,å¹¶ä¸”ä¼ é€’åˆ°nextå‡½æ•°.sagaå¯ä»¥åœ¨æ¥ä¸‹æ¥çš„ä»»åŠ¡åºåˆ—ä¸­ä½¿ç”¨ä¼ é€’çš„å€¼.<br> å¤ªæ£’äº†,è¿™ç§æ–¹æ³•æ˜¯æµ‹è¯•å¼‚æ­¥ç¼–ç¨‹çš„ç¨‹åºå‘˜æ¢¦å¯ä»¥æ±‚çš„æŠ€æœ¯.</p>
<p> #####æ¥ä¸‹æ¥åšä»€ä¹ˆï¼Ÿ</p>
<hr>
<p> ä½ å¯ä»¥<a href="https://github.com/joelhooks/egghead-react-redux-image-gallery" target="_blank" rel="external">forkä¸€ä¸‹è¿™ä¸ªä¾‹å­çš„ä»£ç </a>.</p>
<p> å¦‚æœä½ æƒ³æ‰©å……è¿™ä¸ªåº”ç”¨,å¯ä»¥åšä¸€ä¸‹å‡ ä¸ªæ–¹é¢çš„å·¥ä½œ.</p>
<ul>
<li>åšä¸€ä¸ªå¹»ç¯æ˜¾ç¤ºä¸‹ä¸€å¼ è¦æ˜¾ç¤ºçš„å›¾ç‰‡</li>
<li>å…è®¸ä½¿ç”¨è€…æœç´¢Flickrå›¾ç‰‡</li>
<li>æ·»åŠ å…¶ä»–æä¾›å›¾ç‰‡çš„API</li>
<li>å…è®¸ç”¨æˆ·é€‰æ‹©å–œæ¬¢çš„APIè¿›è¡Œæœç´¢.</li>
</ul>
<p>æˆ‘ä»¬ä»…ä»…å’Œç”Ÿæˆå™¨ç¢°äº†ä¸€ä¸‹é¢,ä½†æ˜¯å³ä¾¿å¦‚æ­¤,å¸Œæœ›åœ¨è”åˆä½¿ç”¨redux-saga library,Reduxå’ŒReactçš„æ—¶å€™ç»™ä½ ä¸€äº›å¸®åŠ©.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;çœ‹åˆ°è¿™ç¯‡æ–‡ç« &lt;a href=&quot;http://joelhooks.com/blog/2016/03/20/build-an-image-gallery-using-redux-saga/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-ä½¿ç”¨Reactæ„å»ºä½ çš„App</title>
    <link href="http://yoursite.com/2017/03/12/%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8React%E6%9E%84%E5%BB%BA%E4%BD%A0%E7%9A%84App/"/>
    <id>http://yoursite.com/2017/03/12/ç¿»è¯‘-ä½¿ç”¨Reactæ„å»ºä½ çš„App/</id>
    <published>2017-03-12T00:04:10.000Z</published>
    <updated>2017-03-23T08:50:04.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>è¿™ç¯‡æ–‡ç« æ—¶é—´æœ‰ç‚¹ä¹…è¿œ,ç¿»è¯‘è¯•è¯•çœ‹.ä½†æ˜¯æœ¬ç¯‡æ–‡ç« å¯¹äºReactçš„æ¸²æŸ“å·¥ä½œåŸç†è®²çš„æ¯”è¾ƒå¥½,ä½¿ç”¨ä¸€ä¸ªæ¸¸æˆå¼•æ“çš„æ¸²æŸ“æ–¹å¼æ¥ç±»æ¯”è§£é‡ŠReactçš„æ•°æ®æµç¨‹,å€¼å¾—å­¦ä¹ . <a href="http://konkle.us/architecting-your-app-react-part-1/" target="_blank" rel="external">åŸæ–‡åœ¨è¿™é‡Œ</a></p>
</blockquote>
<p>å»å¹´äº”æœˆ(2013å¹´5æœˆ),Facebookå‘å¸ƒäº†æ„å»ºå‰ç«¯ç»„ä»¶åº“çš„å¼€æºè½¯ä»¶-React.Reactå¯¹äºæµè§ˆå™¨å’Œappçš„ç»“æ„æ¥è¯´æœ‰ç‚¹å¼‚ç±».ä½†æ˜¯ç»è¿‡è¿™æ®µæ—¶é—´,å¼€å‘è€…é€æ¸çœ‹åˆ°äº†ä¸€äº›ä¼˜åŠ¿,Reactä¹Ÿå› æ­¤è·å–äº†å¾ˆå¤šçš„äººæ°”.Reactæœ€ä¸ºç›¸åŠ©çš„é¢ç‰¹å¾æ˜¯å¼•å…¥äº†virtual-DOMæ–¹æ³•,virtual-DOMä½¿å®é™…çš„æµè§ˆå™¨çš„DOMå˜åŒ–å‡åˆ°æœ€ä½,DOMçš„æ¸²æŸ“æ€§èƒ½å¤§å¹…æé«˜.</p>
<p>Reactå¹¶ä¸æ˜¯å®Œæ•´çš„MVCæ¡†æ¶,Reactå®é™…æ˜¯MVCçš„åŠ å¼ºç‰ˆ(è¿™ç‚¹,çœŸæ˜¯é›ªä¸­é€ç‚­,ä¸€ç›´éƒ½å¯¹è¿™ä¸ªæ¡†æ¶åˆ°åº•æ˜¯ä¸æ˜¯MVCè€Œå¿ƒå­˜ç–‘è™‘).å¾ˆå¤šå¼€å‘è€…é€‰æ‹©Reactä½œä¸ºMVCæ¡†æ¶çš„å»¶ä¼¸,ä¾‹å¦‚Backbone.Reactæœ¬èº«å¹¶æ²¡æœ‰è·¯ç”±å’Œæ•°æ®åŒæ­¥çš„å†…å®¹,æ‰€ä»¥ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„ä½¿ç”¨å–œæ¬¢çš„å·¥å…·æ¥å®Œæˆç±»ä¼¼çš„åŠŸèƒ½.Reactä¹Ÿå¯ä»¥åœ¨å…¶ä»–çš„åº”ç”¨ä¸­ç®¡ç†ä¸€éƒ¨åˆ†ç‰¹å®šçš„ç»„ä»¶.ä½†æ˜¯å¦‚æœåœ¨åº”ç”¨çš„ç•Œé¢ä¸Šå…¨é¢ä½¿ç”¨React,å‘æŒ¥çš„åŠŸèƒ½ä¼šæ›´å¤§.</p>
<p>#####å°½å¯èƒ½çš„é¿å…DOM<br>Reactä½œä¸ºjavascriptçš„ä¸€ä¸ªç±»,æä¾›virtual-DOMå®æ–½æ–¹æ¡ˆ.è¿™æ„å‘³ç€ä½ å¯ä»¥é¢‘ç¹çš„æ›´æ–°ä½ çš„åº”ç”¨ç¨‹åºçš„å…ƒç´ æ ‘,ä½†æ˜¯å®é™…ä¸Šæ²¡æœ‰å‘ç”Ÿæµè§ˆå™¨çš„DOMæ“ä½œ.ç”±äºä½¿ç”¨äº†ç°ä»£çš„å¼•æ“,Javascriptçš„é€Ÿåº¦ç›¸å½“å¿«.å®é™…ç”±äºå¼•æ“çš„é€Ÿåº¦å¾ˆå¿«,å½“æ¯ä¸€æ¬¡æ•°æ®æ›´æ–°çš„æ—¶å€™,æ¸²æŸ“åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯å¯ä»¥çš„,å‡å°‘äº†å®æ—¶å…ƒç´ æ“ä½œå’ŒåŒå‘æ•°æ®ç»‘å®šçš„éœ€æ±‚.Reactå‘¨æœŸæ€§çš„æ¯”è¾ƒvirtual-DOMå’Œæµè§ˆå™¨DOM,ä»…ä»…åšå‡ºæœ€æœ‰å¿…è¦çš„DOMåŒæ­¥.</p>
<p>#####å•å‘æ•°æ®æµ<br>å½“HTMLå…ƒç´ çš„æ¸²æŸ“èŠ±é”€å¤§å¹…åº¦é™ä½ä»¥å,ä½ ç°åœ¨éœ€è¦èŠ±è´¹æ›´å¤šçš„çš„æ–¹æ³•æ¥ç®¡ç†ä½ çš„ç•Œé¢.æ”¾å¼ƒé”™ç»¼å¤æ‚çš„å°±åœ°æ›´æ–°å…ƒç´ æ“ä½œå’Œæ•°æ®å˜åŒ–ä¸­çš„çš„å¤šä¸ªstateçš„åŒæ­¥,ä½ å¯ä»¥æŠŠçŠ¶æ€æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹,åŸºäºé›†ä¸­çš„stateæ¥æè¿°ä½ çš„ç•Œé¢.åªè¦çŠ¶æ€ä»¥æ”¹å˜,Reactçš„ç»„ä»¶å°±å¯ä»¥è¿›è¡Œæ›´æ–°æ“ä½œ.<br>å½“ä½ çš„æ•´ä¸ªåº”ç”¨éƒ½åŸºäºè¿™ä¸ªæ€æƒ³æ¥è®¾è®¡,ä½ å¯ä»¥æŠŠimmutable æ•°æ®ä»é¡¶å±‚ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶,ç„¶åæ‰§è¡Œè‡ªé¡¶å‘ä¸‹çš„åº”ç”¨æ›´æ–°.Reactä»æ ¹æœ¬ä¸Šæ”¹å˜äº†ä½ å¯¹åº”ç”¨çš„æ€è·¯,è€Œä¸”ç»å¸¸ä¼šç®€åŒ–åº”ç”¨çš„è®¾è®¡.</p>
<p>#####æµè§ˆå™¨ä½œä¸ºæ¸²æŸ“å¼•æ“<br>è¿™ä¸€ç‚¹æ˜¯å¯¹MVCæ¡†æ¶éå¸¸æ¿€è¿›çš„æ”¹å˜,å®ƒå¼ºè°ƒä½¿ç”¨åŒå‘æ•°æ®ç»‘å®š,å°½å¯èƒ½å¤šè‡ªåŠ¨å°±åœ°é‡æ–°æ¸²æŸ“.å½“æˆ‘åˆšå¼€å§‹äº†è§£Reactçš„æ—¶å€™,æˆ‘è¿˜ä¸æ˜¯å¤ªç¡®å®š.è½¬æŠ˜ç‚¹æ˜¯æˆ‘çœ‹äº†ä¸€ä¸ªPete Huntçš„è§†é¢‘:æ¯”è¾ƒReactå’ŒDoom3æ¸²æŸ“å¼•æ“.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-a1553d287e86aebb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="doom3çš„æ¸²æŸ“ç¤ºæ„å›¾"><br>åœ¨å›¾è¡¨ä¸­,æ¸¸æˆçš„sateç»è¿‡åº•å±‚çš„å›¾å½¢ä»£ç å¯¼å…¥å‰ç«¯é€»è¾‘å’ŒæŠ½è±¡å±‚.è¿™ä¸ªæ“ä½œä¼šåˆ›å»ºä¸€ä¸ªâ€œåœºæ™¯ä¸­é—´è¡¨ç¤ºå±‚â€(scene intermediate representation),è¿™ä¸ªè¡¨ç¤ºå±‚è¡¨ç°å‡ºç”¨æˆ·åº”è¯¥çœ‹åˆ°çš„å†…å®¹.è¿™ä¸ªè¡¨ç¤ºå±‚ä¼šä¼ é€’ç»™â€backendâ€(åç«¯),åç«¯æ¥æ”¶è¡¨ç¤ºå±‚å†…å®¹,éšä¹‹è½¬æ¢ä¸ºOpenGLæ“ä½œ,OpenGLä½¿ç”¨å›¾å½¢å¡(ç”µè„‘æ˜¾å¡)æ¸²æŸ“å‡ºå†…å®¹.Reactçš„å·¥ä½œåŸç†å’ŒDoom3çš„æ¸²æŸ“æ–¹å¼æ˜¯ä¸€æ ·çš„.(doom3æ˜¯æ—©æœŸä¸€æ¬¾æ¯”è¾ƒè‘—åçš„ç¬¬ä¸€äººç§°å°„å‡»æ¸¸æˆ,è¿™é‡Œä½¿ç”¨doom3çš„å›¾å½¢æ¸²æŸ“æ–¹å¼æ¥è¯´æ˜Reactçš„å·¥ä½œæ–¹å¼).</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-73a98731bc9d6411.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="Reactç»„ä»¶æ¸²æŸ“"></p>
<p>å½“ç¨‹åºçš„stateç”±äºæµè§ˆå™¨æˆ–è€…å®æ—¶äº‹ä»¶å‘ç”Ÿå˜åŒ–,Reactç¨‹åºæ¥æ”¶è¿™äº›å˜åŒ–,å¹¶ä¸”ä¼ é€’ç»™ç»„ä»¶ä»¬,æ¥ç€ä½¿ç”¨virtual-DOMæ–¹å¼ç”Ÿæˆä¸­é—´è¡¨ç¤ºå±‚.æµè§ˆå™¨çš„DOMå¹¶ä¸ä¼šå‘ç”Ÿç«‹å³çš„å˜åŒ–.ç„¶è€ŒReactä¼šå‘¨æœŸæ€§çš„æ¥æ”¶virtual DOM,è®¡ç®—å‡ºå¿…è¦çš„DOMæ“ä½œ.è¿™ä¸€ç‚¹å’Œæ¸¸æˆå¼•æ“æ¥å—åœºæ™¯ä¸­é—´è¡¨ç¤ºå±‚,å†³å®šæ˜¯å¦ä½¿ç”¨OpenGLæ¸²æŸ“åœºæ™¯ç±»ä¼¼.Reactæ˜¯æ¥æ”¶DOM,æŠŠå®ƒæ¸²æŸ“åˆ°ç”¨æˆ·å±å¹•ä¸Š.(å¯è§ä¸¤è€…æ¸²æŸ“çš„æ€è·¯æ˜¯ä¸€æ ·çš„,Reactä½¿ç”¨äº†æµè§ˆå™¨æ¥åšè¿™ä¸ªå·¥ä½œ).</p>
<p>æµè§ˆå™¨å’Œæ¸¸æˆå¼•æ“ä¸€æ ·,æœ€æ…¢çš„éƒ¨åˆ†å®é™…æ˜¯ä¸­é—´è¡¨ç¤ºå±‚åˆ°å±å¹•çš„æ¸²æŸ“éƒ¨åˆ†.ä½ å¯ä»¥å¯¹virtual-DOMåšå‡ºè®¸å¤šç»†å°çš„æ”¹å˜,Reactä¼˜åŒ–äº†è¿™ä¸ªéƒ¨åˆ†,æ‰€ä»¥ä¸ä¼šå› æ­¤è€Œç‰ºç‰²æ¸²æŸ“çš„æ€§èƒ½.</p>
<p>#####æ›´å¤šçš„èµ„æº<br>åœ¨ç¬¬äºŒéƒ¨åˆ†,æˆ‘å°†ä¼šæ¼”ç¤ºæ€ä¹ˆæŠŠReactçš„è®¾è®¡å“²å­¦ä»˜è¯¸å®è·µ.æˆ‘ä¼šåˆ†äº«æ€ä¹ˆæ›´å…·ä¸åŒçš„åŠŸèƒ½è´£ä»»,æ¸²æŸ“ä¸€ä¸ªç”±å°ç»„ä»¶ç»„æˆçš„é¡¶çº§ç»„ä»¶çš„ç•Œé¢.æˆ‘ä¹Ÿä¼šæ¼”ç¤ºæ€ä¹ˆåœ¨Reactåº”ç”¨ä¸­æ•´åˆè·¯ç”±åŠŸèƒ½å’Œæ•°æ®åŒæ­¥åŠŸèƒ½.</p>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„Reactå†…å®¹,æƒ³çŸ¥é“å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„,çœ‹çœ‹ä¸‹é¢çš„èµ„æºåˆ—è¡¨.</p>
<ul>
<li><a href="http://facebook.github.io/react/" target="_blank" rel="external">Reactä¸»é¡µ</a></li>
<li><a href="http://facebook.github.io/react/docs/videos.html" target="_blank" rel="external">è§†é¢‘</a></li>
<li><a href="http://facebook.github.io/react/docs/examples.html" target="_blank" rel="external">å®ä¾‹</a></li>
<li><a href="https://groups.google.com/forum/#!forum/reactjs" target="_blank" rel="external">React Google Group</a></li>
<li>#reactjs on Freenode-å®˜æ–¹ IRCé¢‘é“,æ¯”è¾ƒæ´»è·ƒ</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ—¶é—´æœ‰ç‚¹ä¹…è¿œ,ç¿»è¯‘è¯•è¯•çœ‹.ä½†æ˜¯æœ¬ç¯‡æ–‡ç« å¯¹äºReactçš„æ¸²æŸ“å·¥ä½œåŸç†è®²çš„æ¯”è¾ƒå¥½,ä½¿ç”¨ä¸€ä¸ªæ¸¸æˆå¼•æ“çš„æ¸²æŸ“æ–¹å¼æ¥ç±»æ¯”è§£é‡ŠReactçš„æ•°æ®æµç¨‹,å€¼å¾—å­¦ä¹ . &lt;a href=&quot;http://konkle.us/architecting-your-ap
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-Reduxçš„ä¸­é—´ä»¶-Reselect</title>
    <link href="http://yoursite.com/2017/03/09/%E7%BF%BB%E8%AF%91-Redux%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6-Reselect/"/>
    <id>http://yoursite.com/2017/03/09/ç¿»è¯‘-Reduxçš„ä¸­é—´ä»¶-Reselect/</id>
    <published>2017-03-09T00:04:10.000Z</published>
    <updated>2017-03-23T08:54:59.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡æ˜¯ç¿»è¯‘Reduxçš„ä¸€ä¸ªä¸­é—´ä»¶æ–‡æ¡£.Reduxæ˜¯Reactçš„ä¸€ä¸ªæ•°æ®å±‚,Reactç»„ä»¶çš„stateæœ‰å…³é€»è¾‘å¤„ç†éƒ½è¢«å•ç‹¬æ”¾åˆ°Reduxä¸­æ¥è¿›è¡Œ,åœ¨stateçš„æ“ä½œæµç¨‹ä¸­è¡ç”Ÿäº†å¾ˆå¤šä¸­é—´ä»¶,Reselectè¿™ä¸ªä¸­é—´ä»¶è¦è§£å†³çš„é—®é¢˜æ˜¯:`åœ¨ç»„ä»¶äº¤äº’æ“ä½œçš„æ—¶å€™,stateå‘ç”Ÿå˜åŒ–çš„æ—¶å€™å¦‚ä½•å‡å°‘æ¸²æŸ“çš„å‹åŠ›.åœ¨Reselectä¸­é—´ä¸­ä½¿ç”¨äº†ç¼“å­˜æœºåˆ¶,è¿™ä¸ªæœºåˆ¶å¯ä»¥åœ¨javascriptçš„æ¨¡å¼è®¾è®¡ä¸­åˆšçœ‹åˆ°ä»‹ç»,è¿™é‡Œå°±ä¸è¯¦ç»†è¯´äº†.</strong>ä»…ä¾›å‚è€ƒ,ä»¥åŸæ–‡ä¸ºå‡†.</p>
<hr>
<p>ä¸€æ—¦reduxä»reactçš„æ•°æ®å±‚æ¥ç†è§£ï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼¼ä¹æ‰¾åˆ°äº†ç†è®ºä¾æ®ï¼Œæ‰€è°“åæ­£è¨€é¡ºã€‚åœ¨webæ¡†æ¶ä¸­éƒ½ä¼šç”¨æ•°æ®åº“åšæ•°æ®æŒä¹…å±‚ï¼Œåœ¨æŸ¥è¡¨çš„æ—¶å€™ä¼šä¸ºäº†æ•ˆç‡åšç¼“å­˜ï¼Œreselectæ˜¯åŒæ ·çš„ç›®çš„ã€‚Reactçš„ç»„ä»¶æœ‰è‡ªå·±çš„ç‰¹æ®Šæ€§ï¼Œé‡åˆ°ç‰¹æ®Šçš„ç‰¹æ€§çš„æ—¶å€™éœ€è¦æœ‰ç‰¹æ®Šçš„å¤„ç†<br>æ–¹æ³•.</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯è¯‘æ–‡å†…å®¹,<a href="https://github.com/reactjs/reselect" target="_blank" rel="external">åŸæ–‡è¯·å‚è§</a></p>
<hr>
<blockquote>
<p>â€œselectorâ€æ˜¯ä¸€ä¸ªç®€å•çš„Reduxåº“,çµæ„Ÿæ¥æºäº<code>NuclearJS</code>.</p>
<ul>
<li>Selectorå¯ä»¥è®¡ç®—è¡ç”Ÿçš„æ•°æ®,å¯ä»¥è®©Reduxåšåˆ°å­˜å‚¨å°½å¯èƒ½å°‘çš„stateã€‚</li>
<li>Selectoræ¯”è¾ƒé«˜æ•ˆ,åªæœ‰åœ¨æŸä¸ªå‚æ•°å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰å‘ç”Ÿè®¡ç®—è¿‡ç¨‹.</li>
<li>Selectoræ˜¯å¯ä»¥ç»„åˆçš„,ä»–ä»¬å¯ä»¥ä½œä¸ºè¾“å…¥,ä¼ é€’åˆ°å…¶ä»–çš„selector.</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è¿™ä¸ªä¾‹å­ä¸å¿…å¤ªåœ¨æ„,åé¢ä¼šæœ‰è¯¦ç»†çš„ä»‹ç»</span></div><div class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> shopItemsSelector = <span class="function"><span class="params">state</span> =&gt;</span> state.shop.items</div><div class="line"><span class="keyword">const</span> taxPercentSelector = <span class="function"><span class="params">state</span> =&gt;</span> state.shop.taxPercent</div><div class="line"></div><div class="line"><span class="keyword">const</span> subtotalSelector = createSelector(</div><div class="line">  shopItemsSelector,</div><div class="line">  items =&gt; items.reduce(<span class="function">(<span class="params">acc, item</span>) =&gt;</span> acc + item.value, <span class="number">0</span>)</div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">const</span> taxSelector = createSelector(</div><div class="line">  subtotalSelector,</div><div class="line">  taxPercentSelector,</div><div class="line">  (subtotal, taxPercent) =&gt; subtotal * (taxPercent / <span class="number">100</span>)</div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> totalSelector = createSelector(</div><div class="line">  subtotalSelector,</div><div class="line">  taxSelector,</div><div class="line">  (subtotal, tax) =&gt; (&#123; <span class="attr">total</span>: subtotal + tax &#125;)</div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">let</span> exampleState = &#123;</div><div class="line">  <span class="attr">shop</span>: &#123;</div><div class="line">    <span class="attr">taxPercent</span>: <span class="number">8</span>,</div><div class="line">    <span class="attr">items</span>: [</div><div class="line">      &#123; <span class="attr">name</span>: <span class="string">'apple'</span>, <span class="attr">value</span>: <span class="number">1.20</span> &#125;,</div><div class="line">      &#123; <span class="attr">name</span>: <span class="string">'orange'</span>, <span class="attr">value</span>: <span class="number">0.95</span> &#125;,</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(subtotalSelector(exampleState)) <span class="comment">// 2.15</span></div><div class="line"><span class="built_in">console</span>.log(taxSelector(exampleState))      <span class="comment">// 0.172</span></div><div class="line"><span class="built_in">console</span>.log(totalSelector(exampleState))    <span class="comment">// &#123; total: 2.322 &#125;</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li><a href="#å®‰è£…">Installation</a></li>
<li><a href="#å®ä¾‹">å®ä¾‹</a><ul>
<li><a href="#motivation-for-memoized-selectors">Motivation for Memoized Selectors</a></li>
<li><a href="#creating-a-memoized-selector">Creating a Memoized Selector</a></li>
<li><a href="#composing-selectors">Composing Selectors</a></li>
<li><a href="#connecting-a-selector-to-the-redux-store">Connecting a Selector to the Redux Store</a></li>
<li><a href="#accessing-react-props-in-selectors">Accessing React Props in Selectors</a></li>
<li><a href="#sharing-selectors-with-props-across-multiple-components">Sharing Selectors with Props Across Multiple Components</a></li>
</ul>
</li>
<li><a href="#api">API</a><ul>
<li><a href="#createselectorinputselectors--inputselectors-resultfunc"><code>createSelector</code></a></li>
<li><a href="#defaultmemoizefunc-equalitycheck--defaultequalitycheck"><code>defaultMemoize</code></a></li>
<li><a href="#createselectorcreatormemoize-memoizeoptions"><code>createSelectorCreator</code></a></li>
<li><a href="#createstructuredselectorinputselectors-selectorcreator--createselector"><code>createStructuredSelector</code></a></li>
</ul>
</li>
<li><p><a href="#faq">FAQ</a></p>
<ul>
<li><a href="#q-why-isnt-my-selector-recomputing-when-the-input-state-changes">Why isnâ€™t my selector recomputing when the input state changes?</a></li>
<li><a href="#q-why-is-my-selector-recomputing-when-the-input-state-stays-the-same">Why is my selector recomputing when the input state stays the same?</a></li>
<li><a href="#q-can-i-use-reselect-without-redux">Can I use Reselect without Redux?</a></li>
<li><a href="#q-the-default-memoization-function-is-no-good-can-i-use-a-different-one">The default memoization function is no good, can I use a different one?</a></li>
<li><a href="#q-how-do-i-test-a-selector">How do I test a selector?</a></li>
<li><a href="#q-how-do-i-create-a-selector-that-takes-an-argument">How do I create a selector that takes an argument? </a></li>
<li><a href="#q-how-do-i-use-reselect-with-immutablejs">How do I use Reselect with Immutable.js?</a></li>
<li><a href="#q-can-i-share-a-selector-across-multiple-components">Can I share a selector across multiple components?</a></li>
<li><a href="#q-are-there-typescript-typings">Are there TypeScript typings?</a></li>
<li><a href="#q-how-can-i-make-a-curried-selector">How can I make a curried selector?</a></li>
</ul>
</li>
<li><p><a href="#related-projects">Related Projects</a></p>
</li>
<li><a href="#license">License</a><br>##å®‰è£…<br><code>npm install reselect</code></li>
</ul>
<p>##å®ä¾‹</p>
<p>###ç¼“å­˜Selcectosçš„åŠ¨æœº</p>
<blockquote>
<p>å®ä¾‹æ˜¯åŸºäº <a href="http://redux.js.org/docs/basics/UsageWithReact.html" target="_blank" rel="external">Redux Todos List example</a>.</p>
</blockquote>
<h4 id="containers-VisibleTodoList-js"><a href="#containers-VisibleTodoList-js" class="headerlink" title="containers/VisibleTodoList.js"></a><code>containers/VisibleTodoList.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; toggleTodo &#125; <span class="keyword">from</span> <span class="string">'../actions'</span></div><div class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../components/TodoList'</span></div><div class="line"></div><div class="line"><span class="comment">//ä¸‹é¢è¿™æ®µä»£ç æ˜¯æ ¹æ®è¿‡æ»¤å™¨çš„stateæ¥æ”¹å˜æ—¥ç¨‹stateçš„å‡½æ•°</span></div><div class="line"><span class="keyword">const</span> getVisibleTodos = <span class="function">(<span class="params">todos, filter</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">switch</span> (filter) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SHOW_ALL'</span>:</div><div class="line">      <span class="keyword">return</span> todos</div><div class="line">    <span class="keyword">case</span> <span class="string">'SHOW_COMPLETED'</span>:</div><div class="line">      <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">t</span> =&gt;</span> t.completed)</div><div class="line">    <span class="keyword">case</span> <span class="string">'SHOW_ACTIVE'</span>:</div><div class="line">      <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">t</span> =&gt;</span> !t.completed)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="comment">//todosæ˜¯æ ¹æ®è¿‡æ»¤å‡½æ•°è¿”å›çš„stateï¼Œä¼ å…¥ä¸¤ä¸ªå®å‚</span></div><div class="line">    todos: getVisibleTodos(state.todos, state.visibilityFilter)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//mapDispatchToPropsæ¥ä¼ é€’dispatchçš„æ–¹æ³•</span></div><div class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onTodoClick</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</div><div class="line">      dispatch(toggleTodo(id))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//ä½¿ç”¨Reduxçš„connectå‡½æ•°æ³¨å…¥state,åˆ°TodoListç»„ä»¶</span></div><div class="line"><span class="keyword">const</span> VisibleTodoList = connect(</div><div class="line">  mapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(TodoList)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> VisibleTodoList</div></pre></td></tr></table></figure>
<hr>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­,<code>mapStateToProps</code>è°ƒç”¨<code>getVisibleTodos</code>å»è®¡ç®—<code>todos</code>.è¿™ä¸ªå‡½æ•°è®¾è®¡çš„æ˜¯ç›¸å½“å¥½çš„,ä½†æ˜¯æœ‰ä¸ªç¼ºç‚¹ï¼š<code>todos</code>åœ¨æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°çš„æ—¶å€™éƒ½ä¼šé‡æ–°è®¡ç®—.å¦‚æœstateæ ‘çš„ç»“æ„æ¯”è¾ƒå¤§,æˆ–è€…è®¡ç®—æ¯”è¾ƒæ˜‚è´µ,æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°çš„æ—¶å€™éƒ½è¿›è¡Œè®¡ç®—çš„è¯,å°†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜.<code>Reselect</code>èƒ½å¤Ÿå¸®åŠ©reduxæ¥é¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—è¿‡ç¨‹.</p>
<p>###åˆ›å»ºä¸€ä¸ªç¼“å­˜Selector<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®°å¿†ç¼“å­˜selectorä»£æ›¿<code>getVisibleTodos</code>,å¦‚æœ<code>state.todos</code>å’Œ<code>state.visibilityFilter</code>å‘ç”Ÿå˜åŒ–,ä»–ä¼šé‡æ–°è®¡ç®—<code>state</code>,ä½†æ˜¯å‘ç”Ÿåœ¨å…¶ä»–éƒ¨åˆ†çš„stateå˜åŒ–,å°±ä¸ä¼šé‡æ–°è®¡ç®—.</p>
<p>Reslectæä¾›ä¸€ä¸ªå‡½æ•°<code>createSelector</code>æ¥åˆ›å»ºä¸€ä¸ªè®°å¿†selectors.<code>createSelector</code>æ¥å—ä¸€ä¸ª<code>input-selectors</code>å’Œä¸€ä¸ªå˜æ¢å‡½æ•°ä½œä¸ºå‚æ•°.å¦‚æœReduxçš„stateå‘ç”Ÿæ”¹å˜é€ æˆ<code>input-selector</code>çš„å€¼å‘ç”Ÿæ”¹å˜,selectorä¼šè°ƒç”¨å˜æ¢å‡½æ•°,ä¾æ®<code>input-selector</code>åšå‚æ•°,è¿”å›ä¸€ä¸ªç»“æœ.å¦‚æœ<code>input-selector</code>è¿”å›çš„ç»“æœå’Œå‰é¢çš„ä¸€æ ·,é‚£ä¹ˆå°±ä¼šç›´æ¥è¿”å›æœ‰å…³state,ä¼šçœç•¥å˜æ¢å‡½æ•°çš„è°ƒç”¨.</p>
<p>ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè®°å¿†selector<code>getVisibleTodos</code>æ›¿ä»£éè®°å¿†çš„ç‰ˆæœ¬</p>
<h4 id="selectors-index-js"><a href="#selectors-index-js" class="headerlink" title="selectors/index.js"></a><code>selectors/index.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> getVisibilityFilter = <span class="function">(<span class="params">state</span>) =&gt;</span> state.visibilityFilter</div><div class="line"><span class="keyword">const</span> getTodos = <span class="function">(<span class="params">state</span>) =&gt;</span> state.todos</div><div class="line"><span class="comment">//ä¸‹é¢çš„å‡½æ•°æ˜¯ç»è¿‡åŒ…è£…çš„</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getVisibleTodos = createSelector(</div><div class="line">  [ getVisibilityFilter, getTodos ],</div><div class="line">  (visibilityFilter, todos) =&gt; &#123;</div><div class="line">    <span class="keyword">switch</span> (visibilityFilter) &#123;</div><div class="line">      <span class="keyword">case</span> <span class="string">'SHOW_ALL'</span>:</div><div class="line">        <span class="keyword">return</span> todos</div><div class="line">      <span class="keyword">case</span> <span class="string">'SHOW_COMPLETED'</span>:</div><div class="line">        <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">t</span> =&gt;</span> t.completed)</div><div class="line">      <span class="keyword">case</span> <span class="string">'SHOW_ACTIVE'</span>:</div><div class="line">        <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">t</span> =&gt;</span> !t.completed)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>ä¸Šé¢çš„çš„å®ä¾‹ä¸­,<code>getVisibilityfilter</code>å’Œ<code>getTodos</code>æ˜¯input-selectors.è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯æ™®é€šçš„éè®°å¿†selectorå‡½æ•°,å› ä¸ºä»–ä»¬æ²¡æœ‰å˜æ¢ä»–ä»¬selectçš„æ•°æ®.<code>getVisibleTodos</code>å¦ä¸€æ–¹é¢æ˜¯ä¸€ä¸ªè®°å¿†selector.ä»–æ¥æ”¶<code>getVisibilityfilter</code>å’Œ<code>getTodos</code>ä½œä¸ºinput-selectors,å¹¶ä¸”ä½œä¸ºä¸€ä¸ªå˜æ¢å‡½æ•°è®¡ç®—ç­›é€‰çš„todo list.</p>
<p>###èšåˆselectors</p>
<p>ä¸€ä¸ªè®°å¿†æ€§selectoræœ¬èº«ä¹Ÿå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªè®°å¿†æ€§selectorçš„input-selector.è¿™é‡Œ<code>getVisibleTodos</code>å¯ä»¥ä½œä¸ºinput-selectorä½œä¸ºå…³é”®å­—ç­›é€‰çš„input-selector:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> getKeyword = <span class="function">(<span class="params">state</span>) =&gt;</span> state.keyword</div><div class="line"></div><div class="line"><span class="keyword">const</span> getVisibleTodosFilteredByKeyword = createSelector(</div><div class="line">  [ getVisibleTodos, getKeyword ],</div><div class="line">  (visibleTodos, keyword) =&gt; visibleTodos.filter(</div><div class="line">    <span class="function"><span class="params">todo</span> =&gt;</span> todo.text.indexOf(keyword) &gt; <span class="number">-1</span></div><div class="line">  )</div><div class="line">)</div></pre></td></tr></table></figure></p>
<hr>
<p>###è¿æ¥ä¸€ä¸ªSelectoråˆ°Redux Store<br>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ <a href="https://github.com/reactjs/react-redux" target="_blank" rel="external">React Redux</a>, ä½ å¯ä»¥ç›´æ¥ä¼ é€’selectoråˆ° <code>mapStateToProps()</code>:</p>
<h4 id="containers-VisibleTodoList-js-1"><a href="#containers-VisibleTodoList-js-1" class="headerlink" title="containers/VisibleTodoList.js"></a><code>containers/VisibleTodoList.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; toggleTodo &#125; <span class="keyword">from</span> <span class="string">'../actions'</span></div><div class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../components/TodoList'</span></div><div class="line"><span class="keyword">import</span> &#123; getVisibleTodos &#125; <span class="keyword">from</span> <span class="string">'../selectors'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">todos</span>: getVisibleTodos(state)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onTodoClick</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</div><div class="line">      dispatch(toggleTodo(id))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> VisibleTodoList = connect(</div><div class="line">  mapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(TodoList)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> VisibleTodoList</div></pre></td></tr></table></figure>
<hr>
<p>###åœ¨React Propsä¸­æ¥å…¥Selectors</p>
<blockquote>
<p>è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬å‡è®¾ç¨‹åºå°†ä¼šæœ‰ä¸€ä¸ªæ‰©å±•,æˆ‘ä»¬å…è®¸selectoræ”¯æŒå¤štodo List.è¯·æ³¨æ„å¦‚æœè¦å®Œå…¨å®æ–½è¿™ä¸ªæ‰©å±•,reducers,components,actionsç­‰ç­‰éƒ½éœ€è¦ä½œå‡ºæ”¹å˜.è¿™äº›å†…å®¹å’Œä¸»é¢˜ä¸æ˜¯å¤ªç›¸å…³,æ‰€ä»¥è¿™é‡Œå°±çœç•¥æ‰äº†.</p>
</blockquote>
<p>ç›®å‰ä¸ºæ­¢,æˆ‘ä»¬ä»…ä»…çœ‹åˆ°selectorsæ¥æ”¶storeçš„stateä½œä¸ºä¸€ä¸ªå‚æ•°,å…¶å®ä¸€ä¸ªselectorå¶å¯ä»¥æ¥å—props.</p>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ª<code>App</code>ç»„ä»¶,æ¸²æŸ“å‡ºä¸‰ä¸ª<code>VisibleTodoList</code>ç»„ä»¶,æ¯ä¸€ä¸ªç»„ä»¶æœ‰<code>ListId</code>å±æ€§.</p>
<h4 id="components-App-js"><a href="#components-App-js" class="headerlink" title="components/App.js"></a><code>components/App.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">'./Footer'</span></div><div class="line"><span class="keyword">import</span> AddTodo <span class="keyword">from</span> <span class="string">'../containers/AddTodo'</span></div><div class="line"><span class="keyword">import</span> VisibleTodoList <span class="keyword">from</span> <span class="string">'../containers/VisibleTodoList'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">  &lt;div&gt;</div><div class="line">    &lt;VisibleTodoList listId="1" /&gt;</div><div class="line">    &lt;VisibleTodoList listId="2" /&gt;</div><div class="line">    &lt;VisibleTodoList listId="3" /&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>æ¯ä¸€ä¸ª<code>VisibleTodoList</code>containeråº”è¯¥æ ¹æ®å„è‡ªçš„<code>listId</code>å±æ€§è·å–stateçš„ä¸åŒéƒ¨åˆ†.æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹<code>getVisibilityFilter</code>å’Œ<code>getTodos</code>,ä¾¿äºæ¥å—ä¸€ä¸ªå±æ€§å‚æ•°</p>
<h4 id="selectors-todoSelectors-js"><a href="#selectors-todoSelectors-js" class="headerlink" title="selectors/todoSelectors.js"></a><code>selectors/todoSelectors.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> getVisibilityFilter = <span class="function">(<span class="params">state, props</span>) =&gt;</span></div><div class="line">  state.todoLists[props.listId].visibilityFilter</div><div class="line"></div><div class="line"><span class="keyword">const</span> getTodos = <span class="function">(<span class="params">state, props</span>) =&gt;</span></div><div class="line">  state.todoLists[props.listId].todos <span class="comment">//è¿™é‡Œæ˜¯ä¸ºäºŒç»´æ•°ç»„äº†</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> getVisibleTodos = createSelector(</div><div class="line">  [ getVisibilityFilter, getTodos ],</div><div class="line">  (visibilityFilter, todos) =&gt; &#123;</div><div class="line">    <span class="keyword">switch</span> (visibilityFilter) &#123;</div><div class="line">      <span class="keyword">case</span> <span class="string">'SHOW_COMPLETED'</span>:</div><div class="line">        <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed)</div><div class="line">      <span class="keyword">case</span> <span class="string">'SHOW_ACTIVE'</span>:</div><div class="line">        <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed)</div><div class="line">      <span class="keyword">default</span>:</div><div class="line">        <span class="keyword">return</span> todos</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> getVisibleTodos</div></pre></td></tr></table></figure>
<hr>
<p><code>props</code>å¯ä»¥ä»<code>mapStateToProps</code>ä¼ é€’åˆ°<code>getVisibleTodos</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">todos</span>: getVisibleTodos(state, props)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ç°åœ¨<code>getVisibleTodos</code>å¯ä»¥è·å–<code>props</code>,æ¯ä¸€éƒ¨åˆ†ä¼¼ä¹éƒ½å·¥ä½œçš„ä¸é”™.</p>
<p><em>**ä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜</em><br>å½“<code>getVisibleTodos</code>selectorå’Œ<code>VisibleTodoList</code>containerçš„å¤šä¸ªå®ä¾‹ä¸€èµ·å·¥ä½œçš„æ—¶å€™,è®°å¿†åŠŸèƒ½å°±ä¸èƒ½æ­£å¸¸çš„è¿è¡Œ:</p>
<h4 id="containers-VisibleTodoList-js-2"><a href="#containers-VisibleTodoList-js-2" class="headerlink" title="containers/VisibleTodoList.js"></a><code>containers/VisibleTodoList.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; toggleTodo &#125; <span class="keyword">from</span> <span class="string">'../actions'</span></div><div class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../components/TodoList'</span></div><div class="line"><span class="keyword">import</span> &#123; getVisibleTodos &#125; <span class="keyword">from</span> <span class="string">'../selectors'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="comment">// WARNING: THE FOLLOWING SELECTOR DOES NOT CORRECTLY MEMOIZE</span></div><div class="line">    <span class="comment">//âš ï¸ä¸‹é¢çš„selectorä¸èƒ½æ­£ç¡®çš„è®°å¿†</span></div><div class="line">    todos: getVisibleTodos(state, props)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onTodoClick</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</div><div class="line">      dispatch(toggleTodo(id))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> VisibleTodoList = connect(</div><div class="line">  mapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(TodoList)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> VisibleTodoList</div></pre></td></tr></table></figure>
<hr>
<p>ä½¿ç”¨<code>createSelector</code>åˆ›å»ºçš„selectoræ—¶å€™,å¦‚æœä»–çš„å‚æ•°é›†åˆå’Œä¸Šä¸€æ¬¡çš„å‚æ•°æœºä¼šæ˜¯ä¸€æ ·çš„,ä»…ä»…è¿”å›ç¼“å­˜çš„å€¼.å¦‚æœæˆ‘ä»¬äº¤æ›¿æ¸²æŸ“<code>&lt;VisibleTodoList listId=&quot;1&quot; /&gt;</code> å’Œ<code>&lt;VisibleTodoList listId=&quot;2&quot; /&gt;</code>æ—¶,å…±äº«çš„selectorå°†ä¼šäº¤æ›¿æ¥å—<code>{listIdï¼š1}</code>å’Œ<code>{listId:2}</code>ä½œä¸ºä»–çš„propsçš„å‚æ•°.è¿™å°†ä¼šå¯¼è‡´æ¯ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™çš„å‚æ•°éƒ½ä¸åŒ,å› æ­¤selectoræ¯æ¬¡éƒ½ä¼šé‡æ–°æ¥è®¡ç®—è€Œä¸æ˜¯è¿”å›ç¼“å­˜çš„å€¼.ä¸‹ä¸€éƒ¨åˆ†æˆ‘ä»¬å°†ä¼šä»‹ç»æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜.</p>
<p>###è·¨è¶Šå¤šä¸ªç»„ä»¶ä½¿ç”¨selectorså…±æ€§props</p>
<blockquote>
<p>è¿™ä¸€éƒ¨åˆ†çš„å®ä¾‹éœ€è¦React Redux v4.3.0æˆ–è€…æ›´é«˜ç‰ˆæœ¬çš„æ”¯æŒ.</p>
</blockquote>
<p>åœ¨å¤šä¸ª<code>VisibleTodoList</code>ç»„ä»¶ä¸­å…±äº«selector,åŒæ—¶è¿˜è¦<strong>ä¿æŒ</strong>è®°å¿†æ€§,æ¯ä¸€ä¸ªç»„ä»¶çš„å®ä¾‹éœ€è¦ä»–ä»¬è‡ªå·±çš„selectorå¤‡ä»½.</p>
<p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°<code>makeGetVisibleTodos</code>,è¿™ä¸ªå‡½æ•°æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™è¿”å›ä¸€ä¸ªæ–°çš„<code>getVisibleTodos</code>çš„æ‹·è´:</p>
<h4 id="selectors-todoSelectors-js-1"><a href="#selectors-todoSelectors-js-1" class="headerlink" title="selectors/todoSelectors.js"></a><code>selectors/todoSelectors.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> getVisibilityFilter = <span class="function">(<span class="params">state, props</span>) =&gt;</span></div><div class="line">  state.todoLists[props.listId].visibilityFilter</div><div class="line"></div><div class="line"><span class="keyword">const</span> getTodos = <span class="function">(<span class="params">state, props</span>) =&gt;</span></div><div class="line">  state.todoLists[props.listId].todos</div><div class="line"></div><div class="line"><span class="keyword">const</span> makeGetVisibleTodos = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> createSelector(</div><div class="line">    [ getVisibilityFilter, getTodos ],</div><div class="line">    (visibilityFilter, todos) =&gt; &#123;</div><div class="line">      <span class="keyword">switch</span> (visibilityFilter) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SHOW_COMPLETED'</span>:</div><div class="line">          <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed)</div><div class="line">        <span class="keyword">case</span> <span class="string">'SHOW_ACTIVE'</span>:</div><div class="line">          <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed)</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">          <span class="keyword">return</span> todos</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> makeGetVisibleTodos</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘ä»¬ä¹Ÿéœ€è¦è®¾ç½®ç»™æ¯ä¸€ä¸ªç»„ä»¶çš„å®ä¾‹ä»–ä»¬å„è‡ªè·å–ç§æœ‰çš„selectoræ–¹æ³•.<code>mapStateToProps</code>çš„<code>connect</code>å‡½æ•°å¯ä»¥å¸®åŠ©å®Œæˆè¿™ä¸ªåŠŸèƒ½.</p>
<p><em>**å¦‚æœ<code>mapStateToProps</code>æä¾›ç»™<code>connect</code>ä¸è¿”å›ä¸€ä¸ªå¯¹è±¡è€Œæ˜¯ä¸€ä¸ªå‡½æ•°,ä»–å°±å¯ä»¥è¢«ç”¨æ¥ä¸ºæ¯ä¸ªç»„ä»¶containeråˆ›å»ºä¸€ä¸ªç§æœ‰çš„<code>mapStateProps</code>å‡½æ•°.</em></p>
<p>åœ¨ä¸‹é¢çš„å®ä¾‹ä¸­,<code>mapStateProps</code>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>getVisibleTodos</code>selector,ä»–è¿”å›ä¸€ä¸ª<code>mapStateToProps</code>å‡½æ•°,è¿™ä¸ªå‡½æ•°èƒ½å¤Ÿæ¥å…¥æ–°çš„selector.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> makeMapStateToProps = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> getVisibleTodos = makeGetVisibleTodos()</div><div class="line">  <span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">todos</span>: getVisibleTodos(state, props)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> mapStateToProps</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>å¦‚æœæˆ‘ä»¬æŠŠ<code>makeMapStateToprops</code>ä¼ é€’åˆ°<code>connect</code>,æ¯ä¸€ä¸ª<code>visibleTodoList</code>containerå°†ä¼šè·å¾—å„è‡ªçš„å«æœ‰ç§æœ‰<code>getVisibleTodos</code>selectorçš„<code>mapStateToProps</code>çš„å‡½æ•°.è¿™æ ·ä¸€æ¥è®°å¿†å°±æ­£å¸¸äº†,ä¸ç®¡<code>VisibleTodoList</code>containersçš„æ¸²æŸ“é¡ºåºæ€ä¹ˆæ ·.</p>
<h4 id="containers-VisibleTodoList-js-3"><a href="#containers-VisibleTodoList-js-3" class="headerlink" title="containers/VisibleTodoList.js"></a><code>containers/VisibleTodoList.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; toggleTodo &#125; <span class="keyword">from</span> <span class="string">'../actions'</span></div><div class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../components/TodoList'</span></div><div class="line"><span class="keyword">import</span> &#123; makeGetVisibleTodos &#125; <span class="keyword">from</span> <span class="string">'../selectors'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> makeMapStateToProps = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> getVisibleTodos = makeGetVisibleTodos()</div><div class="line">  <span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">todos</span>: getVisibleTodos(state, props)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> mapStateToProps</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onTodoClick</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</div><div class="line">      dispatch(toggleTodo(id))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> VisibleTodoList = connect(</div><div class="line">  makeMapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(TodoList)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> VisibleTodoList</div></pre></td></tr></table></figure>
<hr>
<p>##API</p>
<p>###createSelector(â€¦inputSelectors|[inputSelectors],resultFunc)</p>
<p>æ¥å—ä¸€ä¸ªæˆ–è€…å¤šä¸ªselectors,æˆ–è€…ä¸€ä¸ªselectorsæ•°ç»„,è®¡ç®—ä»–ä»¬çš„å€¼å¹¶ä¸”ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>resultFunc</code>.</p>
<p><code>createSelector</code>é€šè¿‡åˆ¤æ–­input-selectorä¹‹å‰è°ƒç”¨å’Œä¹‹åè°ƒç”¨çš„è¿”å›å€¼çš„å…¨ç­‰äº(===,è¿™ä¸ªåœ°æ–¹è‹±æ–‡æ–‡çŒ®å«reference equality,å¼•ç”¨ç­‰äº,è¿™ä¸ªå•è¯æ˜¯æœ¬è´¨,ä¸­æ–‡æ²¡æœ‰ç¿»è¯‘å‡ºæ¥).ç»è¿‡<code>createSelector</code>åˆ›å»ºçš„selectoråº”è¯¥æ˜¯immutable(ä¸å˜çš„).</p>
<p>ç»è¿‡<code>createSelector</code>åˆ›å»ºçš„Selectorsæœ‰ä¸€ä¸ªç¼“å­˜,å¤§å°æ˜¯1.è¿™æ„å‘³ç€å½“ä¸€ä¸ªinput-selectorå˜åŒ–çš„æ—¶å€™,ä»–ä»¬æ€»æ˜¯ä¼šé‡æ–°è®¡ç®—state,å› ä¸ºSelectorä»…ä»…å­˜å‚¨æ¯ä¸€ä¸ªinput-selectorå‰ä¸€ä¸ªå€¼.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mySelector = createSelector(</div><div class="line">  <span class="function"><span class="params">state</span> =&gt;</span> state.values.value1,</div><div class="line">  state =&gt; state.values.value2,</div><div class="line">  (value1, value2) =&gt; value1 + value2</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// You can also pass an array of selectors</span></div><div class="line"><span class="comment">//å¯ä»¥å‡ºä¼ é€’ä¸€ä¸ªselectoræ•°ç»„</span></div><div class="line"><span class="keyword">const</span> totalSelector = createSelector(</div><div class="line">  [</div><div class="line">    <span class="function"><span class="params">state</span> =&gt;</span> state.values.value1,</div><div class="line">    state =&gt; state.values.value2</div><div class="line">  ],</div><div class="line">  (value1, value2) =&gt; value1 + value2</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>åœ¨selectorå†…éƒ¨è·å–ä¸€ä¸ªç»„ä»¶çš„propséå¸¸æœ‰ç”¨.å½“ä¸€ä¸ªselectoré€šè¿‡<code>connect</code>å‡½æ•°è¿æ¥åˆ°ä¸€ä¸ªç»„ä»¶ä¸Š,ç»„ä»¶çš„å±æ€§ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™selector:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> abSelector = <span class="function">(<span class="params">state, props</span>) =&gt;</span> state.a * props.b</div><div class="line"></div><div class="line"><span class="comment">// props only (ignoring state argument)</span></div><div class="line"><span class="keyword">const</span> cSelector =  <span class="function">(<span class="params">_, props</span>) =&gt;</span> props.c</div><div class="line"></div><div class="line"><span class="comment">// state only (props argument omitted as not required)</span></div><div class="line"><span class="keyword">const</span> dSelector = <span class="function"><span class="params">state</span> =&gt;</span> state.d</div><div class="line"></div><div class="line"><span class="keyword">const</span> totalSelector = createSelector(</div><div class="line">  abSelector,</div><div class="line">  cSelector,</div><div class="line">  dSelector,</div><div class="line">  (ab, c, d) =&gt; (&#123;</div><div class="line">    <span class="attr">total</span>: ab + c + d</div><div class="line">  &#125;)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<hr>
<p>###defaultMemoize(func, equalityCheck = defaultEqualityCheck)</p>
<p><code>defaultMemoize</code>èƒ½è®°ä½é€šè¿‡funcä¼ é€’çš„å‚æ•°.è¿™æ˜¯<code>createSelector</code>ä½¿ç”¨çš„è®°å¿†å‡½æ•°.</p>
<p><code>defaultMemoize</code> é€šè¿‡è°ƒç”¨<code>equalityCheck</code>å‡½æ•°æ¥å†³å®šä¸€ä¸ªå‚æ•°æ˜¯å¦å·²ç»å‘ç”Ÿæ”¹å˜.å› ä¸º<code>defaultMemoize</code>è®¾è®¡å‡ºæ¥å°±æ˜¯å’Œimmutableæ•°æ®ä¸€èµ·ä½¿ç”¨,é»˜è®¤çš„<code>equalityCheck</code>ä½¿ç”¨å¼•ç”¨å…¨ç­‰äºæ¥åˆ¤æ–­å˜åŒ–:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultEqualityCheck</span>(<span class="params">currentVal, previousVal</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> currentVal === previousVal</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p><code>defaultMemoize</code>å’Œ<code>createSelectorCreator</code>å»<a href="#é…ç½®-equalitycheck-for-defaultmemoize">é…ç½®<code>equalityCheck</code>å‡½æ•°</a>.</p>
<p>###createSelectorCreator(memoize,â€¦memoizeOptions)</p>
<p><code>createSelectorCreator</code>ç”¨æ¥é…ç½®å®šåˆ¶ç‰ˆæœ¬çš„<code>createSelector</code>.</p>
<p><code>memoize</code>å‚æ•°æ˜¯ä¸€ä¸ªæœ‰è®°å¿†åŠŸèƒ½çš„å‡½æ•°,æ¥ä»£æ›¿<code>defaultMemoize</code>.<br><code>â€¦memoizeOption</code>å±•å¼€çš„å‚æ•°æ˜¯0æˆ–è€…æ›´å¤šçš„é…ç½®é€‰é¡¹,è¿™äº›å‚æ•°ä¼ é€’ç»™<code>memoizeFunc</code>.selectors<code>resultFunc</code>ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™<code>memoize</code>,<code>memoizeOptions</code>ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> customSelectorCreator = createSelectorCreator(</div><div class="line">  customMemoize, <span class="comment">// function to be used to memoize resultFunc,è®°å¿†resultFunc</span></div><div class="line">  option1, <span class="comment">// option1 will be passed as second argument to customMemoize ç¬¬äºŒä¸ªæƒ¨å‘¼</span></div><div class="line">  option2, <span class="comment">// option2 will be passed as third argument to customMemoize ç¬¬ä¸‰ä¸ªå‚æ•°</span></div><div class="line">  option3 <span class="comment">// option3 will be passed as fourth argument to customMemoize   ç¬¬å››ä¸ªå‚æ•°</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">const</span> customSelector = customSelectorCreator(</div><div class="line">  input1,</div><div class="line">  input2,</div><div class="line">  resultFunc <span class="comment">// resultFunc will be passed as first argument to customMemoize  ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™customMomize</span></div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>åœ¨<code>customSelecotr</code>å†…éƒ¨æ»´å•Šç”¨memoizeçš„å‡½æ•°çš„ä»£ç å¦‚ä¸‹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">customMemoize(resultFunc, option1, option2, option3)</div></pre></td></tr></table></figure></p>
<hr>
<p>ä¸‹é¢æ˜¯å‡ ä¸ªå¯èƒ½ä¼šç”¨åˆ°çš„<code>createSelectorCreator</code>çš„å®ä¾‹:</p>
<p>####ä¸º<code>defaultMemoize</code>é…ç½®<code>equalityCheck</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelectorCreator, defaultMemoize &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"><span class="keyword">import</span> isEqual <span class="keyword">from</span> <span class="string">'lodash.isEqual'</span></div><div class="line"></div><div class="line"><span class="comment">// create a "selector creator" that uses lodash.isEqual instead of ===</span></div><div class="line"><span class="keyword">const</span> createDeepEqualSelector = createSelectorCreator(</div><div class="line">  defaultMemoize,</div><div class="line">  isEqual</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// use the new "selector creator" to create a selector</span></div><div class="line"><span class="keyword">const</span> mySelector = createDeepEqualSelector(</div><div class="line">  <span class="function"><span class="params">state</span> =&gt;</span> state.values.filter(<span class="function"><span class="params">val</span> =&gt;</span> val &lt; <span class="number">5</span>),</div><div class="line">  values =&gt; values.reduce(<span class="function">(<span class="params">acc, val</span>) =&gt;</span> acc + val, <span class="number">0</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>####ä½¿ç”¨loadshçš„memoizeå‡½æ•°æ¥ç¼“å­˜æœªç»‘å®šçš„ç¼“å­˜.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelectorCreator &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"><span class="keyword">import</span> memoize <span class="keyword">from</span> <span class="string">'lodash.memoize'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> called = <span class="number">0</span></div><div class="line"><span class="keyword">const</span> hashFn = <span class="function">(<span class="params">...args</span>) =&gt;</span> args.reduce(</div><div class="line">  <span class="function">(<span class="params">acc, val</span>) =&gt;</span> acc + <span class="string">'-'</span> + <span class="built_in">JSON</span>.stringify(val),</div><div class="line">  <span class="string">''</span></div><div class="line">)</div><div class="line"><span class="keyword">const</span> customSelectorCreator = createSelectorCreator(memoize, hashFn)</div><div class="line"><span class="keyword">const</span> selector = customSelectorCreator(</div><div class="line">  <span class="function"><span class="params">state</span> =&gt;</span> state.a,</div><div class="line">  state =&gt; state.b,</div><div class="line">  (a, b) =&gt; &#123;</div><div class="line">    called++</div><div class="line">    <span class="keyword">return</span> a + b</div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<h3 id="createStructuredSelector-inputSelectors-selectorCreator-createSelector"><a href="#createStructuredSelector-inputSelectors-selectorCreator-createSelector" class="headerlink" title="createStructuredSelector({inputSelectors}, selectorCreator = createSelector)"></a>createStructuredSelector({inputSelectors}, selectorCreator = createSelector)</h3><p>å¦‚æœåœ¨æ™®é€šçš„æ¨¡å¼ä¸‹ä½¿ç”¨<code>createStructuredSelector</code>å‡½æ•°å¯ä»¥æå‡ä¾¿åˆ©æ€§.ä¼ é€’åˆ°<code>connect</code>çš„selectorè£…é¥°è€…(è¿™æ˜¯jsè®¾è®¡æ¨¡å¼çš„æ¦‚å¿µ,å¯ä»¥å‚è€ƒç›¸å…³çš„ä¹¦ç±)æ¥å—ä»–çš„input-selectors,å¹¶ä¸”åœ¨ä¸€ä¸ªå¯¹è±¡å†…æ˜ å°„åˆ°ä¸€ä¸ªé”®ä¸Š.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mySelectorA = <span class="function"><span class="params">state</span> =&gt;</span> state.a</div><div class="line"><span class="keyword">const</span> mySelectorB = <span class="function"><span class="params">state</span> =&gt;</span> state.b</div><div class="line"></div><div class="line"><span class="comment">// The result function in the following selector</span></div><div class="line"><span class="comment">// is simply building an object from the input selectors ç”±selectorsæ„å»ºçš„ä¸€ä¸ªå¯¹è±¡</span></div><div class="line"><span class="keyword">const</span> structuredSelector = createSelector(</div><div class="line">   mySelectorA,</div><div class="line">   mySelectorB,</div><div class="line">   mySelectorC,</div><div class="line">   (a, b, c) =&gt; (&#123;</div><div class="line">     a,</div><div class="line">     b,</div><div class="line">     c</div><div class="line">   &#125;)</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p><code>createStructuredSelector</code>æ¥å—ä¸€ä¸ªå¯¹è±¡,è¿™ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯input-selectors,å‡½æ•°è¿”å›ä¸€ä¸ªç»“æ„æ€§çš„selector.è¿™ä¸ªç»“æ„æ€§çš„selectorè¿”å›ä¸€ä¸ªå¯¹è±¡,å¯¹è±¡çš„é”®å’Œ<code>inputSelectors</code>çš„å‚æ•°æ˜¯ç›¸åŒçš„,ä½†æ˜¯ä½¿ç”¨selectorsä»£æ›¿äº†å…¶ä¸­çš„å€¼.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mySelectorA = <span class="function"><span class="params">state</span> =&gt;</span> state.a</div><div class="line"><span class="keyword">const</span> mySelectorB = <span class="function"><span class="params">state</span> =&gt;</span> state.b</div><div class="line"></div><div class="line"><span class="keyword">const</span> structuredSelector = createStructuredSelector(&#123;</div><div class="line">  <span class="attr">x</span>: mySelectorA,</div><div class="line">  <span class="attr">y</span>: mySelectorB</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> result = structuredSelector(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;) <span class="comment">// will produce &#123; x: 1, y: 2 &#125;</span></div></pre></td></tr></table></figure>
<hr>
<p>ç»“æ„æ€§çš„selectorså¯ä»¥æ˜¯åµŒå¥—å¼çš„:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> nestedSelector = createStructuredSelector(&#123;</div><div class="line">  <span class="attr">subA</span>: createStructuredSelector(&#123;</div><div class="line">    selectorA,</div><div class="line">    selectorB</div><div class="line">  &#125;),</div><div class="line">  <span class="attr">subB</span>: createStructuredSelector(&#123;</div><div class="line">    selectorC,</div><div class="line">    selectorD</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<hr>
<p>##FAQ</p>
<h3 id="Q-ä¸ºä»€ä¹ˆå½“è¾“å…¥çš„stateå‘ç”Ÿæ”¹å˜çš„æ—¶å€™-selectorä¸é‡æ–°è®¡ç®—ï¼Ÿ"><a href="#Q-ä¸ºä»€ä¹ˆå½“è¾“å…¥çš„stateå‘ç”Ÿæ”¹å˜çš„æ—¶å€™-selectorä¸é‡æ–°è®¡ç®—ï¼Ÿ" class="headerlink" title="Q:ä¸ºä»€ä¹ˆå½“è¾“å…¥çš„stateå‘ç”Ÿæ”¹å˜çš„æ—¶å€™,selectorä¸é‡æ–°è®¡ç®—ï¼Ÿ"></a>Q:ä¸ºä»€ä¹ˆå½“è¾“å…¥çš„stateå‘ç”Ÿæ”¹å˜çš„æ—¶å€™,selectorä¸é‡æ–°è®¡ç®—ï¼Ÿ</h3><p>A:æ£€æŸ¥ä¸€ä¸‹ä½ çš„è®°å¿†éŸ©å¼æ˜¯ä¸æ˜¯å’Œä½ çš„stateæ›´æ–°å‡½æ•°ç›¸å…¼å®¹(ä¾‹å¦‚:å¦‚æœä½ æ­£åœ¨ä½¿ç”¨Redux).ä¾‹å¦‚:ä½¿ç”¨<code>createSelector</code>åˆ›å»ºçš„selectoræ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡,åŸæ¥æœŸå¾…çš„æ˜¯æ›´æ–°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡.<code>createSelector</code>ä½¿ç”¨(===)æ£€æµ‹è¾“å…¥æ˜¯å¦æ”¹å˜,å› æ­¤å¦‚æœæ”¹å˜ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡æ²¡æœ‰è§¦å‘selectoré‡æ–°è®¡ç®—çš„åŸå› æ˜¯æ”¹å˜ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™æ²¡æœ‰è§¦å‘ç›¸å…³çš„æ£€æµ‹.æç¤ºï¼šå¦‚æœä½ æ­£åœ¨ä½¿ç”¨Redux,æ”¹å˜ä¸€ä¸ªstateå¯¹è±¡çš„<a href="http://redux.js.org/docs/Troubleshooting.html" target="_blank" rel="external">é”™è¯¯å¯èƒ½æœ‰</a>.</p>
<p>ä¸‹é¢çš„å®ä¾‹å®šä¹‰äº†ä¸€ä¸ªselectorå¯ä»¥å†³å®šæ•°ç»„çš„ç¬¬ä¸€ä¸ªtodoé¡¹ç›®æ˜¯ä¸æ˜¯å·²ç»è¢«å®Œæˆ:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> isFirstTodoCompleteSelector = createSelector(</div><div class="line">  <span class="function"><span class="params">state</span> =&gt;</span> state.todos[<span class="number">0</span>],</div><div class="line">  todo =&gt; todo &amp;&amp; todo.completed</div><div class="line">)</div></pre></td></tr></table></figure></p>
<hr>
<p>ä¸‹é¢çš„stateæ›´æ–°å‡½æ•°å’Œ<code>isFirstTodoCompleteSelector</code><strong>å°†ä¸ä¼š</strong>æ­£å¸¸å·¥ä½œå·¥ä½œ:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todos</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">  <span class="keyword">case</span> COMPLETE_ALL:</div><div class="line">    <span class="keyword">const</span> areAllMarked = state.every(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed)</div><div class="line">    <span class="comment">// BAD: mutating an existing object</span></div><div class="line">    <span class="keyword">return</span> state.map(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</div><div class="line">      todo.completed = !areAllMarked</div><div class="line">      <span class="keyword">return</span> todo</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ä¸‹é¢çš„stateæ›´æ–°å‡½æ•°å’Œ<code>isFirstTodoComplete</code>ä¸€èµ·<strong>å¯ä»¥</strong>æ­£å¸¸å·¥ä½œ.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todos</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">  <span class="keyword">case</span> COMPLETE_ALL:</div><div class="line">    <span class="keyword">const</span> areAllMarked = state.every(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed)</div><div class="line">    <span class="comment">// GOOD: returning a new object each time with Object.assign</span></div><div class="line">    <span class="keyword">return</span> state.map(<span class="function"><span class="params">todo</span> =&gt;</span> <span class="built_in">Object</span>.assign(&#123;&#125;, todo, &#123;</div><div class="line">      <span class="attr">completed</span>: !areAllMarked</div><div class="line">    &#125;))</div><div class="line"></div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨Redux,ä½†æ˜¯æœ‰ä½¿ç”¨mutableæ•°æ®çš„éœ€æ±‚,ä½ å¯ä»¥ä½¿ç”¨<code>createSelectorCreator</code>ä»£æ›¿é»˜è®¤çš„è®°å¿†å‡½æ•°,å¹¶ä¸”ä½¿ç”¨ä¸åŒçš„ç­‰å€¼æ£€æµ‹å‡½æ•°.è¯·å‚çœ‹<a href="#use-memoize-function-from-lodash-for-an-unbounded-cache">è¿™é‡Œ</a> å’Œ <a href="#customize-equalitycheck-for-defaultmemoize">è¿™é‡Œ</a>ä½œä¸ºå‚è€ƒ.</p>
<p>###Q:ä¸ºä»€ä¹ˆinput stateæ²¡æœ‰æ”¹å˜çš„æ—¶å€™,selectorè¿˜æ˜¯ä¼šé‡æ–°è®¡ç®—?</p>
<p>A: æ£€æŸ¥ä¸€ä¸‹ä½ çš„è®°å¿†å‡½æ•°å’Œä½ ä½ çš„stateæ›´æ–°å‡½æ•°æ˜¯ä¸æ˜¯å…¼å®¹(å¦‚æœæ˜¯ä½¿ç”¨Reduxçš„æ—¶å€™,çœ‹çœ‹reducer).ä¾‹å¦‚:ä½¿ç”¨æ¯ä¸€æ¬¡æ›´æ–°çš„æ—¶å€™,ä¸ç®¡å€¼æ˜¯ä¸æ˜¯å‘ç”Ÿæ”¹å˜,<code>createSelector</code>åˆ›å»ºçš„selectoræ€»æ˜¯ä¼šæ”¶åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡.<code>createSelector</code>å‡½æ•°ä½¿ç”¨(<code>===</code>)æ£€æµ‹inputçš„å˜åŒ–,ç”±æ­¤å¯çŸ¥å¦‚æœæ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡,è¡¨ç¤ºselectoræ€»æ˜¯åœ¨æ¯æ¬¡æ›´æ–°çš„æ—¶å€™é‡æ–°è®¡ç®—.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; REMOVE_OLD &#125; <span class="keyword">from</span> <span class="string">'../constants/ActionTypes'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> initialState = [</div><div class="line">  &#123;</div><div class="line">    <span class="attr">text</span>: <span class="string">'Use Redux'</span>,</div><div class="line">    <span class="attr">completed</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">id</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">timestamp</span>: <span class="built_in">Date</span>.now()</div><div class="line">  &#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todos</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">  <span class="keyword">case</span> REMOVE_OLD:</div><div class="line">    <span class="keyword">return</span> state.filter(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">return</span> todo.timestamp + <span class="number">30</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> &gt; <span class="built_in">Date</span>.now()</div><div class="line">    &#125;)</div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ä¸‹é¢çš„selectoråœ¨æ¯ä¸€æ¬¡REMOVE_OLDè°ƒç”¨çš„æ—¶å€™,éƒ½ä¼šé‡æ–°è®¡ç®—,å› ä¸ºArray.filteræ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡.ä½†æ˜¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,REMOVE_OLD actionéƒ½ä¸ä¼šæ”¹å˜todoåˆ—è¡¨,æ‰€ä»¥é‡æ–°è®¡ç®—æ˜¯ä¸å¿…è¦çš„.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> todosSelector = <span class="function"><span class="params">state</span> =&gt;</span> state.todos</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> visibleTodosSelector = createSelector(</div><div class="line">  todosSelector,</div><div class="line">  (todos) =&gt; &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>ä½ å¯ä»¥é€šè¿‡stateæ›´æ–°å‡½æ•°è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡æ¥å‡å°‘ä¸å¿…è¦çš„é‡è®¡ç®—æ“ä½œ,è¿™ä¸ªå¯¹è±¡æ‰§è¡Œæ·±åº¦ç­‰å€¼æ£€æµ‹,åªæœ‰æ·±åº¦ä¸ç›¸åŒçš„æ—¶å€™æ‰è¿”å›æ–°å¯¹è±¡.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; REMOVE_OLD &#125; <span class="keyword">from</span> <span class="string">'../constants/ActionTypes'</span></div><div class="line"><span class="keyword">import</span> isEqual <span class="keyword">from</span> <span class="string">'lodash.isEqual'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> initialState = [</div><div class="line">  &#123;</div><div class="line">    <span class="attr">text</span>: <span class="string">'Use Redux'</span>,</div><div class="line">    <span class="attr">completed</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">id</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">timestamp</span>: <span class="built_in">Date</span>.now()</div><div class="line">  &#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todos</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">  <span class="keyword">case</span> REMOVE_OLD:</div><div class="line">    <span class="keyword">const</span> updatedState =  state.filter(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">return</span> todo.timestamp + <span class="number">30</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> &gt; <span class="built_in">Date</span>.now()</div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">return</span> isEqual(updatedState, state) ? state : updatedState</div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>æ›¿ä»£çš„æ–¹æ³•æ˜¯,åœ¨selectorä¸­ä½¿ç”¨æ·±åº¦æ£€æµ‹æ–¹æ³•æ›¿ä»£é»˜è®¤çš„<code>equalityCheck</code>å‡½æ•°:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelectorCreator, defaultMemoize &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"><span class="keyword">import</span> isEqual <span class="keyword">from</span> <span class="string">'lodash.isEqual'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> todosSelector = <span class="function"><span class="params">state</span> =&gt;</span> state.todos</div><div class="line"></div><div class="line"><span class="comment">// create a "selector creator" that uses lodash.isEqual instead of ===</span></div><div class="line"><span class="keyword">const</span> createDeepEqualSelector = createSelectorCreator(</div><div class="line">  defaultMemoize,</div><div class="line">  isEqual</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// use the new "selector creator" to create a selector</span></div><div class="line"><span class="keyword">const</span> mySelector = createDeepEqualSelector(</div><div class="line">  todosSelector,</div><div class="line">  (todos) =&gt; &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>æ£€æŸ¥<code>equalityCheck</code>å‡½æ•°çš„æ›´æ›¿æˆ–è€…åœ¨stateæ›´æ–°å‡½æ•°ä¸­åšæ·±åº¦æ£€æµ‹å¹¶ä¸æ€»æ˜¯æ¯”é‡è®¡ç®—çš„èŠ±é”€å°.å¦‚æœæ¯æ¬¡é‡è®¡ç®—çš„èŠ±é”€æ€»æ˜¯æ¯”è¾ƒå°,å¯èƒ½çš„åŸå› æ˜¯Reselectæ²¡æœ‰é€šè¿‡<code>connect</code>å‡½æ•°ä¼ é€’<code>mapStateProps</code>å•çº¯å¯¹è±¡çš„åŸå› .</p>
<h3 id="Q-æ²¡æœ‰Reduxçš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨Reselectå—ï¼Ÿ"><a href="#Q-æ²¡æœ‰Reduxçš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨Reselectå—ï¼Ÿ" class="headerlink" title="Q:æ²¡æœ‰Reduxçš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨Reselectå—ï¼Ÿ"></a>Q:æ²¡æœ‰Reduxçš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨Reselectå—ï¼Ÿ</h3><p>A:å¯ä»¥.Reselectæ²¡æœ‰å…¶ä»–ä»»ä½•çš„ä¾èµ–åŒ…,å› æ­¤å°½ç®¡ä»–è®¾è®¡çš„å’ŒReduxæ¯”è¾ƒæ­é…,ä½†æ˜¯ç‹¬ç«‹ä½¿ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„.ç›®å‰çš„ç‰ˆæœ¬åœ¨ä¼ ç»Ÿçš„Flux APPä¸‹ä½¿ç”¨æ˜¯æ¯”è¾ƒæˆåŠŸçš„.</p>
<blockquote>
<p>å¦‚æœä½ ä½¿ç”¨<code>createSelector</code>åˆ›å»ºçš„selectors,éœ€è¦ç¡®ä¿ä»–çš„å‚æ•°æ˜¯immutableçš„.</p>
<p>çœ‹<a href="#createselectorinputselectors--inputselectors-resultfunc">è¿™é‡Œ</a></p>
</blockquote>
<h3 id="Q-æ€ä¹ˆæ‰èƒ½åˆ›å»ºä¸€ä¸ªæ¥æ”¶å‚æ•°çš„selector"><a href="#Q-æ€ä¹ˆæ‰èƒ½åˆ›å»ºä¸€ä¸ªæ¥æ”¶å‚æ•°çš„selector" class="headerlink" title="Q:æ€ä¹ˆæ‰èƒ½åˆ›å»ºä¸€ä¸ªæ¥æ”¶å‚æ•°çš„selector."></a>Q:æ€ä¹ˆæ‰èƒ½åˆ›å»ºä¸€ä¸ªæ¥æ”¶å‚æ•°çš„selector.</h3><p>A:Reselectæ²¡æœ‰æ”¯æŒåˆ›å»ºæ¥æ”¶å‚æ•°çš„selectors,ä½†æ˜¯è¿™é‡Œæœ‰ä¸€äº›å®ç°ç±»ä¼¼å‡½æ•°åŠŸèƒ½çš„å»ºè®®.</p>
<p>å¦‚æœå‚æ•°ä¸æ˜¯åŠ¨æ€çš„,ä½ å¯ä»¥ä½¿ç”¨å·¥å‚å‡½æ•°:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> expensiveItemSelectorFactory = <span class="function"><span class="params">minValue</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> createSelector(</div><div class="line">    shopItemsSelector,</div><div class="line">    items =&gt; items.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.value &gt; minValue)</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> subtotalSelector = createSelector(</div><div class="line">  expensiveItemSelectorFactory(<span class="number">200</span>),</div><div class="line">  items =&gt; items.reduce(<span class="function">(<span class="params">acc, item</span>) =&gt;</span> acc + item.value, <span class="number">0</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<hr>
<p>æ€»çš„è¾¾æˆå…±è¯†<a href="https://github.com/reactjs/reselect/issues/38" target="_blank" rel="external">çœ‹è¿™é‡Œ</a>å’Œ<a href="https://github.com/optimizely/nuclear-js/issues/14" target="_blank" rel="external">è¶…è¶Š neclear-js</a>æ˜¯:å¦‚æœä¸€ä¸ªselectoréœ€è¦åŠ¨æ€çš„å‚æ•°,é‚£ä¹ˆå‚æ•°åº”è¯¥æ˜¯storeä¸­çš„state.å¦‚æœä½ å†³å®šå¥½äº†åœ¨åº”ç”¨ä¸­ä½¿ç”¨åŠ¨æ€å‚æ•°,åƒä¸‹é¢è¿™æ ·è¿”å›ä¸€ä¸ªè®°å¿†å‡½æ•°æ˜¯æ¯”è¾ƒåˆé€‚çš„:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'reselect'</span></div><div class="line"><span class="keyword">import</span> memoize <span class="keyword">from</span> <span class="string">'lodash.memoize'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> expensiveSelector = createSelector(</div><div class="line">  <span class="function"><span class="params">state</span> =&gt;</span> state.items,</div><div class="line">  items =&gt; memoize(</div><div class="line">    <span class="function"><span class="params">minValue</span> =&gt;</span> items.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.value &gt; minValue)</div><div class="line">  )</div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">const</span> expensiveFilter = expensiveSelector(state)</div><div class="line"></div><div class="line"><span class="keyword">const</span> slightlyExpensive = expensiveFilter(<span class="number">100</span>)</div><div class="line"><span class="keyword">const</span> veryExpensive = expensiveFilter(<span class="number">1000000</span>)</div></pre></td></tr></table></figure>
<hr>
<h3 id="Qï¼šé»˜è®¤çš„è®°å¿†å‡½æ•°ä¸å¤ªå¥½-æˆ‘èƒ½ç”¨ä¸ªå…¶ä»–çš„å—ï¼Ÿ"><a href="#Qï¼šé»˜è®¤çš„è®°å¿†å‡½æ•°ä¸å¤ªå¥½-æˆ‘èƒ½ç”¨ä¸ªå…¶ä»–çš„å—ï¼Ÿ" class="headerlink" title="Qï¼šé»˜è®¤çš„è®°å¿†å‡½æ•°ä¸å¤ªå¥½,æˆ‘èƒ½ç”¨ä¸ªå…¶ä»–çš„å—ï¼Ÿ"></a>Qï¼šé»˜è®¤çš„è®°å¿†å‡½æ•°ä¸å¤ªå¥½,æˆ‘èƒ½ç”¨ä¸ªå…¶ä»–çš„å—ï¼Ÿ</h3><p>A: æˆ‘è®¤ä¸ºè¿™ä¸ªè®°å¿†éŸ©å¼å·¥ä½œçš„è¿˜å¯ä»¥,ä½†æ˜¯å¦‚æœä½ éœ€è¦ä¸€ä¸ªå…¶ä»–çš„éŸ©å¼ä¹Ÿæ˜¯å¯ä»¥çš„.<br>å¯ä»¥çœ‹çœ‹è¿™ä¸ª<a href="#customize-equalitycheck-for-defaultmemoize">ä¾‹å­</a></p>
<h3 id="Q-æ€ä¹ˆæ‰èƒ½æµ‹è¯•ä¸€ä¸ªselector"><a href="#Q-æ€ä¹ˆæ‰èƒ½æµ‹è¯•ä¸€ä¸ªselector" class="headerlink" title="Q:æ€ä¹ˆæ‰èƒ½æµ‹è¯•ä¸€ä¸ªselector?"></a>Q:æ€ä¹ˆæ‰èƒ½æµ‹è¯•ä¸€ä¸ªselector?</h3><p>A:å¯¹äºä¸€ä¸ªç»™å®šçš„input,ä¸€ä¸ªselectoræ€»æ˜¯äº§å‡ºç›¸åŒçš„ç»“æœ.åŸºäºè¿™ä¸ªåŸå› ,åšå•å…ƒæµ‹è¯•æ˜¯éå¸¸ç®€å•çš„.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> selector = createSelector(</div><div class="line">  <span class="function"><span class="params">state</span> =&gt;</span> state.a,</div><div class="line">  state =&gt; state.b,</div><div class="line">  (a, b) =&gt; (&#123;</div><div class="line">    <span class="attr">c</span>: a * <span class="number">2</span>,</div><div class="line">    <span class="attr">d</span>: b * <span class="number">3</span></div><div class="line">  &#125;)</div><div class="line">)</div><div class="line"></div><div class="line">test(<span class="string">"selector unit test"</span>, () =&gt; &#123;</div><div class="line">  assert.deepEqual(selector(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;), &#123; <span class="attr">c</span>: <span class="number">2</span>, <span class="attr">d</span>: <span class="number">6</span> &#125;)</div><div class="line">  assert.deepEqual(selector(&#123; <span class="attr">a</span>: <span class="number">2</span>, <span class="attr">b</span>: <span class="number">3</span> &#125;), &#123; <span class="attr">c</span>: <span class="number">4</span>, <span class="attr">d</span>: <span class="number">9</span> &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<hr>
<p>åœ¨stateæ›´æ–°å‡½æ•°è°ƒç”¨çš„æ—¶å€™åŒæ—¶æ£€æµ‹selectorçš„è®°å¿†å‡½æ•°çš„åŠŸèƒ½ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„(ä¾‹å¦‚ ä½¿ç”¨Reduxçš„æ—¶å€™æ£€æŸ¥reducer).æ¯ä¸€ä¸ªselectoréƒ½æœ‰ä¸€ä¸ª<code>recomputations</code>æ–¹æ³•è¿”å›é‡æ–°è®¡ç®—çš„æ¬¡æ•°:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">suite(<span class="string">'selector'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> state = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> (</div><div class="line">    &#123;</div><div class="line">      <span class="attr">a</span>: action(state.a),</div><div class="line">      <span class="attr">b</span>: action(state.b)</div><div class="line">    &#125;</div><div class="line">  )</div><div class="line"></div><div class="line">  <span class="keyword">const</span> selector = createSelector(</div><div class="line">    <span class="function"><span class="params">state</span> =&gt;</span> state.a,</div><div class="line">    state =&gt; state.b,</div><div class="line">    (a, b) =&gt; (&#123;</div><div class="line">      <span class="attr">c</span>: a * <span class="number">2</span>,</div><div class="line">      <span class="attr">d</span>: b * <span class="number">3</span></div><div class="line">    &#125;)</div><div class="line">  )</div><div class="line"></div><div class="line">  <span class="keyword">const</span> plusOne = <span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span></div><div class="line">  <span class="keyword">const</span> id = <span class="function"><span class="params">x</span> =&gt;</span> x</div><div class="line"></div><div class="line">  test(<span class="string">"selector unit test"</span>, () =&gt; &#123;</div><div class="line">    state = reducer(state, plusOne)</div><div class="line">    assert.deepEqual(selector(state), &#123; <span class="attr">c</span>: <span class="number">4</span>, <span class="attr">d</span>: <span class="number">9</span> &#125;)</div><div class="line">    state = reducer(state, id)</div><div class="line">    assert.deepEqual(selector(state), &#123; <span class="attr">c</span>: <span class="number">4</span>, <span class="attr">d</span>: <span class="number">9</span> &#125;)</div><div class="line">    assert.equal(selector.recomputations(), <span class="number">1</span>)</div><div class="line">    state = reducer(state, plusOne)</div><div class="line">    assert.deepEqual(selector(state), &#123; <span class="attr">c</span>: <span class="number">6</span>, <span class="attr">d</span>: <span class="number">12</span> &#125;)</div><div class="line">    assert.equal(selector.recomputations(), <span class="number">2</span>)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<hr>
<p>å¦å¤–,selectorsä¿ç•™äº†æœ€åä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æœçš„å¼•ç”¨,è¿™ä¸ªå¼•ç”¨ä½œä¸º<code>.resultFunc</code>.å¦‚æœä½ å·²ç»èšåˆäº†å…¶ä»–çš„selectors,è¿™ä¸ªå‡½æ•°å¼•ç”¨å¯ä»¥å¸®åŠ©ä½ æµ‹è¯•æ¯ä¸€ä¸ªselector,ä¸éœ€è¦ä»stateä¸­è§£è€¦æµ‹è¯•.</p>
<p>ä¾‹å¦‚å¦‚æœä½ çš„selectorsé›†åˆåƒä¸‹é¢è¿™æ ·:<br><strong>selectors.js</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> firstSelector = createSelector( ... )</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> secondSelector = createSelector( ... )</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> thirdSelector = createSelector( ... )</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> myComposedSelector = createSelector(</div><div class="line">  firstSelector,</div><div class="line">  secondSelector,</div><div class="line">  thirdSelector,</div><div class="line">  (first, second, third) =&gt; first * second &lt; third</div><div class="line">)</div></pre></td></tr></table></figure></p>
<hr>
<p>å•å…ƒæµ‹è¯•å°±åƒä¸‹é¢è¿™æ ·:<br><strong>test/selectors.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// tests for the first three selectors...</span></div><div class="line">test(<span class="string">"firstSelector unit test"</span>, () =&gt; &#123; ... &#125;)</div><div class="line">test(<span class="string">"secondSelector unit test"</span>, () =&gt; &#123; ... &#125;)</div><div class="line">test(<span class="string">"thirdSelector unit test"</span>, () =&gt; &#123; ... &#125;)</div><div class="line"></div><div class="line"><span class="comment">// We have already tested the previous</span></div><div class="line"><span class="comment">// three selector outputs so we can just call `.resultFunc`</span></div><div class="line"><span class="comment">// with the values we want to test directly:</span></div><div class="line">test(<span class="string">"myComposedSelector unit test"</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// here instead of calling selector()</span></div><div class="line">  <span class="comment">// we just call selector.resultFunc()</span></div><div class="line">  assert(selector.resultFunc(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), <span class="literal">true</span>)</div><div class="line">  assert(selector.resultFunc(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>), <span class="literal">false</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<hr>
<p>æœ€å,æ¯ä¸€ä¸ªselectoræœ‰ä¸€ä¸ª<code>resetRecomputations</code>æ–¹æ³•,é‡ç½®recomputationsæ–¹æ³•ä¸º0,è¿™ä¸ªå‚æ•°çš„æ„å›¾æ˜¯åœ¨é¢å¯¹å¤æ‚çš„selectorçš„æ—¶å€™,éœ€è¦å¾ˆå¤šç‹¬ç«‹çš„æµ‹è¯•,ä½ ä¸éœ€è¦ç®¡ç†å¤æ‚çš„æ‰‹å·¥è®¡ç®—,æˆ–è€…ä¸ºæ¯ä¸€ä¸ªæµ‹è¯•åˆ›å»ºâ€å‚»ç“œâ€selector.</p>
<h3 id="Q-Reselectæ€ä¹ˆå’ŒImmutble-jsä¸€èµ·ä½¿ç”¨"><a href="#Q-Reselectæ€ä¹ˆå’ŒImmutble-jsä¸€èµ·ä½¿ç”¨" class="headerlink" title="Q:Reselectæ€ä¹ˆå’ŒImmutble.jsä¸€èµ·ä½¿ç”¨?"></a>Q:Reselectæ€ä¹ˆå’ŒImmutble.jsä¸€èµ·ä½¿ç”¨?</h3><p>A:<code>creatSelector</code>åˆ›å»ºçš„Selectorsåº”è¯¥å¯ä»¥å’ŒImmutable.jsæ•°æ®ç»“æ„ä¸€èµ·å®Œç¾çš„å·¥ä½œ.<br>å¦‚æœä½ çš„selectoræ­£åœ¨é‡è®¡ç®—,å¹¶ä¸”ä½ è®¤ä¸ºstateæ²¡æœ‰å‘ç”Ÿå˜åŒ–,ä¸€å®šè¦ç¡®ä¿çŸ¥é“å“ªä¸€ä¸ªImmutable.jsæ›´æ–°æ–¹æ³•,è¿™ä¸ªæ–¹æ³•åªè¦ä¸€æ›´æ–°<strong>æ€»æ˜¯</strong>è¿”å›æ–°å¯¹è±¡.å“ªä¸€ä¸ªæ–¹æ³•åªæœ‰<strong>é›†åˆå®é™…å‘ç”Ÿå˜åŒ–çš„æ—¶å€™</strong>æ‰è¿”å›æ–°å¯¹è±¡.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Immutable <span class="keyword">from</span> <span class="string">'immutable'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> myMap = Immutable.Map(&#123;</div><div class="line">  <span class="attr">a</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">b</span>: <span class="number">2</span>,</div><div class="line">  <span class="attr">c</span>: <span class="number">3</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"> <span class="comment">// set, merge and others only return a new obj when update changes collection</span></div><div class="line"><span class="keyword">let</span> newMap = myMap.set(<span class="string">'a'</span>, <span class="number">1</span>)</div><div class="line">assert.equal(myMap, newMap)</div><div class="line">newMap = myMap.merge(&#123; <span class="string">'a'</span>, <span class="number">1</span> &#125;)</div><div class="line">assert.equal(myMap, newMap)</div><div class="line"><span class="comment">// map, reduce, filter and others always return a new obj</span></div><div class="line">newMap = myMap.map(<span class="function"><span class="params">a</span> =&gt;</span> a * <span class="number">1</span>)</div><div class="line">assert.notEqual(myMap, newMap)</div></pre></td></tr></table></figure>
<hr>
<p>å¦‚æœä¸€ä¸ªæ“ä½œå¯¼è‡´çš„selectoræ›´æ–°æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡,å¯èƒ½ä¼šå‘ç”Ÿä¸å¿…è¦çš„é‡è®¡ç®—.<a href="#q-why-is-my-selector-recomputing-when-the-input-state-stays-the-same">çœ‹è¿™é‡Œ</a>.è¿™æ˜¯ä¸€ä¸ªå…³äºprosçš„è®¨è®º,ä½¿ç”¨æ·±å…¨ç­‰äºæ¥æ£€æµ‹ä¾‹å¦‚<code>immutable.js</code>æ¥å‡å°‘ä¸å¿…è¦çš„é‡è®¡ç®—è¿‡ç¨‹.</p>
<h3 id="Q-å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«selectorå—ï¼Ÿ"><a href="#Q-å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«selectorå—ï¼Ÿ" class="headerlink" title="Q:å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«selectorå—ï¼Ÿ"></a>Q:å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«selectorå—ï¼Ÿ</h3><p>A: ä½¿ç”¨<code>createSelector</code>åˆ›å»ºçš„Selectorçš„ç¼“å­˜çš„å¤§å°åªæœ‰1.è¿™ä¸ªè®¾å®šä½¿å¾—å¤šä¸ªç»„ä»¶çš„å®ä¾‹ä¹‹é—´çš„å‚æ•°ä¸åŒ,è·¨ç»„ä»¶å…±äº«selectorå˜å¾—ä¸åˆé€‚.è¿™é‡Œä¹Ÿæœ‰å‡ ç§åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜:</p>
<ul>
<li>ä½¿ç”¨å·¥ç¨‹å‡½æ•°æ–¹æ³•,ä¸ºæ¯ä¸€ä¸ªç»„ä»¶å®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°çš„selector.è¿™é‡Œæœ‰ä¸€ä¸ªå†…å»ºçš„å·¥å‚æ–¹æ³•,React Redux v4.3æˆ–è€…æ›´é«˜ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨. <a href="#sharing-selectors-with-props-across-multiple-components">çœ‹è¿™é‡Œ</a></li>
<li>åˆ›å»ºä¸€ä¸ªç¼“å­˜å°ºå¯¸å¤§äº1çš„å®šåˆ¶selector.</li>
</ul>
<h3 id="Q-æœ‰TypeScriptçš„ç±»å‹å—ï¼Ÿ"><a href="#Q-æœ‰TypeScriptçš„ç±»å‹å—ï¼Ÿ" class="headerlink" title="Q:æœ‰TypeScriptçš„ç±»å‹å—ï¼Ÿ"></a>Q:æœ‰TypeScriptçš„ç±»å‹å—ï¼Ÿ</h3><p>A: æ˜¯çš„ï¼ä»–ä»¬åŒ…å«åœ¨<code>package.json</code>é‡Œ.å¯ä»¥å¾ˆå¥½çš„å·¥ä½œ.</p>
<h3 id="Qï¼šæ€ä¹ˆæ„å»ºä¸€ä¸ªæŸ¯é‡ŒåŒ–selector"><a href="#Qï¼šæ€ä¹ˆæ„å»ºä¸€ä¸ªæŸ¯é‡ŒåŒ–selector" class="headerlink" title="Qï¼šæ€ä¹ˆæ„å»ºä¸€ä¸ªæŸ¯é‡ŒåŒ–selector?"></a>Qï¼šæ€ä¹ˆæ„å»ºä¸€ä¸ª<a href="https://github.com/hemanth/functional-programming-jargon#currying" target="_blank" rel="external">æŸ¯é‡ŒåŒ–</a>selector?</h3><p>Aï¼šå°è¯•ä¸€äº›è¿™é‡Œ<a href="https://github.com/reactjs/reselect/issues/159#issuecomment-238724788" target="_blank" rel="external">åŠ©æ‰‹å‡½æ•°</a>,ç”±<a href="https://github.com/MattSPalmer" target="_blank" rel="external">MattSPalmer</a>æä¾›</p>
<h2 id="æœ‰å…³çš„é¡¹ç›®"><a href="#æœ‰å…³çš„é¡¹ç›®" class="headerlink" title="æœ‰å…³çš„é¡¹ç›®"></a>æœ‰å…³çš„é¡¹ç›®</h2><h3 id="reselect-map"><a href="#reselect-map" class="headerlink" title="reselect-map"></a><a href="https://github.com/HeyImAlex/reselect-map" target="_blank" rel="external">reselect-map</a></h3><p>å› ä¸ºReselectä¸å¯èƒ½ä¿è¯ç¼“å­˜ä½ æ‰€æœ‰çš„éœ€æ±‚,åœ¨åš<strong>éå¸¸æ˜‚è´µçš„è®¡ç®—</strong>çš„æ—¶å€™,è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæœ‰ç”¨.æŸ¥çœ‹ä¸€ä¸‹reselect-maps readme</p>
<p><strong>reselect-mapçš„ä¼˜åŒ–æªæ–½ä»…ä»…ä½¿ç”¨åœ¨ä¸€äº›å°çš„æ¡ˆä¾‹ä¸­,å¦‚æœä½ ä¸ç¡®å®šæ˜¯ä¸æ˜¯éœ€è¦ä»–,å°±ä¸è¦ä½¿ç”¨å®ƒ</strong>.</p>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>MIT</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ¬æ–‡æ˜¯ç¿»è¯‘Reduxçš„ä¸€ä¸ªä¸­é—´ä»¶æ–‡æ¡£.Reduxæ˜¯Reactçš„ä¸€ä¸ªæ•°æ®å±‚,Reactç»„ä»¶çš„stateæœ‰å…³é€»è¾‘å¤„ç†éƒ½è¢«å•ç‹¬æ”¾åˆ°Reduxä¸­æ¥è¿›è¡Œ,åœ¨stateçš„æ“ä½œæµç¨‹ä¸­è¡ç”Ÿäº†å¾ˆå¤šä¸­é—´ä»¶,Reselectè¿™ä¸ªä¸­é—´ä»¶è¦è§£å†³çš„é—®é¢˜æ˜¯:`åœ¨
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘--Redux-Saga--æœªæ¥æ˜¯1975å¹´</title>
    <link href="http://yoursite.com/2017/03/08/%E7%BF%BB%E8%AF%91--Redux-Saga--%E6%9C%AA%E6%9D%A5%E6%98%AF1975%E5%B9%B4/"/>
    <id>http://yoursite.com/2017/03/08/ç¿»è¯‘--Redux-Saga--æœªæ¥æ˜¯1975å¹´/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:45:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>24 SEPTEMBER 2016</p>
<blockquote>
<p><a href="https://ohyayanotherblog.ghost.io/redux-saga-clock/" target="_blank" rel="external">åŸæ–‡åœ¨è¿™é‡Œ</a></p>
</blockquote>
<p>(è¿™ä¸ªæ–‡ç« æ˜¯æœ‰å…³Redux-sagaä¸‰éƒ¨æ›²çš„ç¬¬ä¸€éƒ¨åˆ†,<a href="https://ohyayanotherblog.ghost.io/redux-saga-hello-world/" target="_blank" rel="external">ç¬¬äºŒéƒ¨åˆ†</a>,<a href="https://ohyayanotherblog.ghost.io/redux-saga-finishing-the-clock-demo-app/" target="_blank" rel="external">ç¬¬ä¸‰éƒ¨åˆ†</a>.æˆ‘ä»¬ä¼šæ„å»ºä¸€ä¸ªæŠ½è±¡çš„æ—¶é’Ÿ)</p>
<hr>
<p><a href="http://www.jianshu.com/p/6f8678a6ad78" target="_blank" rel="external">ç¬¬ä¸€éƒ¨åˆ†è¯‘æ–‡è¯·è§</a>ï¼Œ<br><a href="http://www.jianshu.com/p/fad0136e77c0" target="_blank" rel="external">ç¬¬äºŒéƒ¨åˆ†è¯‘æ–‡è¯·è§</a>ï¼Œ<br><a href="http://www.jianshu.com/p/88fc4236b505" target="_blank" rel="external">ç¬¬ä¸‰éƒ¨åˆ†è¯‘æ–‡è¯·è§</a>.</p>
<hr>
<p>æˆ‘çš„è§‚ç‚¹æ˜¯:React/Reduxç»„åˆæ˜¯ç›®å‰æœ€å¥½çš„å‰ç«¯æŠ€æœ¯æ ˆ.è¿™ä¸¤ä¸ªåº“æ˜¯ç›¸äº’ä¾å­˜çš„,å› ä¸ºReactå¯ä»¥æ˜¯çº¯å‡½æ•°,åŠŸèƒ½æ˜¯:<code>state=&gt;view</code>,Reactä»…ä»…å…³æ³¨æ€ä¹ˆæ ¹æ®stateæ¥æ¸²æŸ“å†…å®¹,Reduxä¹Ÿæ˜¯çº¯å‡½æ•°,åŠŸèƒ½æ˜¯:<code>action=&gt;state</code>,Reduxä½œä¸ºæ§åˆ¶app stateçš„å•ä¸€èµ„æº(è¯‘è€…è§‚ç‚¹:è¿™ä¸ªåœ°æ–¹çš„state,éœ€è¦æ›´åŠ å¼€é˜”çœ¼ç•Œ,å¹¶ä¸æ˜¯ä»…ä»…æ˜¯UIçš„çŠ¶æ€,ç»„ä»¶éœ€è¦çš„è¿œç¨‹æ•°æ®ä¹Ÿå¯ä»¥æ˜¯stateçš„ä¸€éƒ¨åˆ†,å¦‚æ­¤ä»¥æ¥,Reduxçš„æ„ä¹‰å°±æ›´åŠ å‡¸æ˜¾å‡ºæ¥).å³ä¾¿æ˜¯æ‹¥æœ‰å¦‚æ­¤å…ˆè¿›çš„æŠ€æœ¯,ä½ æœ€ç»ˆä¹Ÿä¼šå‘ç°,appçš„æ§åˆ¶æµä»£ç è¢«ä¸€ä½é—²é€›çš„æµæµªæ±‰æå¾—å¥½åƒæ˜¯ä¸€å›¢çƒ‚æ³¥.åœ¨å®é™…çš„åº”ç”¨ä¸­,æœ€å¤æ‚çš„æ§åˆ¶æµä»£ç é€šå¸¸åŒ…å«å¼‚æ­¥ä»£ç ,å¼‚æ­¥ä»£ç å’Œå…¶ä»–æ—¶åºçš„ä»£ç æ€»æ˜¯ååŒå·¥ä½œ.</p>
<ul>
<li>â€œå½“POSTè¯·æ±‚è¿”å›æ—¶,è½¬åˆ°ä¸‹ä¸€é¡µæˆ–è€…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯.â€</li>
<li>â€œå½“ç§»åŠ¨è®¾å¤‡çš„ç”µåŠ›é™åˆ°5%ä¸€ä¸‹çš„æ—¶å€™,æ˜¾ç¤ºä¸€æ¡âš ï¸ä¿¡æ¯.â€</li>
<li>â€œåç§’é’Ÿä»¥å,éšè—æ¨¡æ€æ¡†.â€</li>
<li>â€œä½†æˆ‘çš„ç›´å±é¢†å¯¼åœ¨é™„è¿‘æ™ƒè¡çš„æ—¶å€™,ä»FBåˆ‡æ¢åˆ°JIRA.â€(è¯‘è€…ï¼šè¿™è‚¯å®šæ˜¯ä¸ªå¹½é»˜)</li>
</ul>
<p>åœ¨ä¸€äº›appä¸­,è¿™äº›â€œæ— å®¶å¯å½’â€çš„ä»£ç å¼€å§‹éªšéªšæ‰°æœ‰ç¤¼è²Œçš„é‚»å±….(è¯‘è€…:åé¢è¿™æ®µæ²¡æœ‰ç¿»è¯‘å‡ºæ¥,æ„æ€æ˜¯å¼‚æ­¥ä»£ç ä¼šæŠŠåŒæ­¥ä»£ç æå¾—ä¸€å›¢ç³Ÿ.)</p>
<p>###ä¸æ— å®¶å¯å½’è€…æˆ˜æ–—<br>javascriptåº“Redux-sagaæ˜¯ä¸ºReduxè®¾è®¡çš„ä¸€ä¸ªä¸­é—´ä»¶,ä¸ºå¼‚æ­¥æ“ä½œæä¾›äº†è§£å†³åŠæ³•:æŠŠæ•°æ®æµä¸­çš„å¼‚æ­¥ä»£ç ä½¿ç”¨ç”Ÿæˆå™¨ä»£ç å—(generator)éš”ç¦»èµ·æ¥,generatorçš„yieldæè¿°ä¸€äº›ä»£ç å—:<code>effects</code>,è¿™äº›<code>effects</code>ç«ç¾æ§åˆ¶æµçš„æŸä¸ªç»™å®šç‚¹å‘ç”Ÿä½œç”¨.</p>
<p>Sagaä½œä¸ºå¼‚æ­¥ä»£ç çš„æ”¶å®¹æ‰€,æ¥çº³appçš„å¼‚æ­¥ä»£ç å—.sagaä¸¥é‡ä¾èµ–ç”Ÿæˆå™¨å‡½æ•°,å› æ­¤æˆ‘ä»¬åœ¨æ­£å¼å­¦ä¹ Redux-sagaä¹‹å‰,éœ€è¦äº†è§£ä¸€ä¸‹ç”Ÿæˆå™¨å‡½æ•°.åœ¨è¿™ä¸ªæ–‡ç« ä¸­,æˆ‘ä»¬ä¼šæ¶‰åŠåˆ°å†…åœ¨çš„åˆç†åŸå› å’Œä½¿ç”¨Redux-sagaçš„å¥½å¤„,æ¥ç€æˆ‘ä¼šæ•™ä½ ä¸€äº›å¿…è¦çš„èƒŒæ™¯çŸ¥è¯†.å¥½äº†,åˆ°åº•ä»€ä¹ˆæ˜¯generator,æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä»–ï¼Ÿ</p>
<p>wikiå…³äºgeneratorsçš„è§£é‡Šä¸‹é¢è¿™ä¸ªå†…å®¹</p>
<blockquote>
<p>ç”Ÿæˆå™¨éå¸¸ç±»ä¼¼äºè¿”å›ä¸€ä¸ªæ•°ç»„çš„å‡½æ•°,åœ¨ç”Ÿæˆå™¨å†…æœ‰å¯ä»¥è¢«è°ƒç”¨çš„å‚æ•°,ç”Ÿæˆå™¨æ˜¯ä¸€ç³»åˆ—çš„å€¼.ç„¶è€Œä¸è¿”å›ä¸€ä¸ªæ•°ç»„çš„å‡½æ•°ä¸€æ¬¡è¿”å›æ•´ä¸ªæ•°ç»„ä¸åŒ,ç”Ÿæˆå™¨å‡½æ•°ä¸€æ¬¡åªè¿”å›ä¸€ä¸ªå€¼.ä¸€å¥è¯,ç”Ÿæˆå™¨å‡½æ•°çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªå‡½æ•°,ä½†æ˜¯è¡Œä¸ºåƒæ˜¯ä¸€ä¸ªéå†å™¨.</p>
</blockquote>
<p>æˆ‘è§‰å¾—ä»ä¸Šé¢è¿™æ®µè¯æ ¹æœ¬å°±æ²¡æœ‰å­¦åˆ°ä»»ä½•ä¸œè¥¿,é‚£ä¹ˆçœ‹çœ‹ä¸‹é¢è¿™æ®µ</p>
<blockquote>
<p>ç”Ÿæˆå™¨æ¦‚å¿µé¦–æ¬¡æå‡ºæ˜¯åœ¨1975å¹´(è¯‘è€…:é¢˜ç›®å°±æ˜¯æ¥æºäºæ­¤),ä½œä¸ºCLUè¯­è¨€çš„å­—ç¬¦ä¸²æ“ä½œç‰¹å¾,ç°åœ¨Python,C#,Rubyä¸­éƒ½å¯ä»¥ä½¿ç”¨,åœ¨javascriptçš„ES6ç‰ˆæœ¬ä¸­ä¹Ÿä¼šåŠ å…¥,åœ¨CLUå’ŒC#ä¸­ç”Ÿæˆå™¨å«åšiterators,åœ¨Rubyä¸­å«åšenumerators.</p>
</blockquote>
<p>æ‰€ä»¥ç”Ÿæˆå™¨å‡½æ•°çš„æ¦‚å¿µæ˜¯æ¯”è¾ƒè€ä¹Ÿæ˜¯å¹¿ä¸ºæ‰€çŸ¥çš„æ¦‚å¿µ,ä½†æ˜¯ç›´åˆ°æœ€è¿‘æ‰åŠ å…¥ECMAScript.ä½†æ˜¯ä¸ºä»€ä¹ˆç°åœ¨åœ¨javascriptä¸­è¦å…³æ³¨å®ƒå‘¢ï¼Ÿ</p>
<p>javascriptçš„è¿è¡Œç¯å¢ƒè®©æˆ‘ä»¬æˆä¸ºäº†éå¸¸ä¸å¹¸çš„ç¨‹åºå‘˜,åœ¨æµè§ˆå™¨å†…éƒ¨ä»…ä»…åªæœ‰ä¸€ä¸ªå•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¨¡å‹.æˆ‘ä»¬æ‰€æœ‰çš„ä»£ç éƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ,å› æ­¤åœ¨javascriptç¨‹åºå‘˜çš„è„‘è¢‹é‡Œä¸€å®šè¦ç‰¢å›ºçš„æ¤å…¥ä¸€ä¸ªæ¦‚å¿µ,æ°¸è¿œæ°¸è¿œä¸è¦é˜»å¡ä»£ç æ‰§è¡Œ,å› ä¸ºé˜»å¡çš„ä»£ç å—å°†ä¼šç»ˆç«¯å…¶ä»–æ‰€æœ‰çš„å…¶ä»–ä»£ç çš„æ‰§è¡Œ.åœ¨éé˜»å¡æƒ…å†µä¸‹,æˆ‘ä»¬æœ‰å„ç§åŠæ³•æ¥å¤„ç†å¼‚æ­¥ä»£ç æ‰§è¡Œ,å…¶å®éƒ½æ˜¯å„ç§å½¢å¼çš„å›è°ƒå‡½æ•°çš„æ³¨å†Œæ–¹æ³•.å›è°ƒå‡½æ•°æ˜¯æ¯ä¸€ä¸ªjavascriptå¼€å‘è€…å¿…é¡»ç†Ÿç»ƒæŒæ¡çš„å†…å®¹,å¦‚æœä½ è¿˜ä¸äº†è§£å›è°ƒå‡½æ•°å’Œpromiseså¯¹è±¡,åœ¨å¼€å§‹ä¸‹é¢å†…å®¹ä¹‹å‰è¦äº†è§£ä¸€ä¸‹.å¦åˆ™çš„è¯ä½ çœ‹åˆ°ç”Ÿæˆå™¨çš„æ—¶å€™ä¼šç–¯æ‰çš„.</p>
<p>æ—¶åˆ»è®°ä½,ä¸è¦æš‚åœä»£ç æ‰§è¡Œ,è®©æˆ‘ä»¬çœ‹çœ‹ES6ç”Ÿæˆå™¨çš„å®ç°.ä½ ä¹Ÿå¯ä»¥è¯»è¯»æ”¶åˆ°é«˜åº¦è¯„ä»·çš„<a href="http://www.2ality.com/2015/03/es6-generators.html" target="_blank" rel="external">2ality Blog</a>,</p>
<blockquote>
<p>ç”Ÿæˆå™¨æ˜¯ECMAScript6çš„æ–°ç‰¹å¾,ç”Ÿæˆå™¨å¯ä»¥æš‚åœå’Œæ¢å¤æ‰§è¡Œ.è¿™ä¸ªç‰¹ç‚¹å¯¹äºéå†å™¨å’Œå¼‚æ­¥ç¼–ç¨‹éƒ½å¤§æœ‰å¸®åŠ©.<br>è¿™éƒ½æ˜¯ä»€ä¹ˆé¬¼è¯.ä»–åªè¯´ç”Ÿæˆå™¨æ˜¯â€œå¯ä»¥æš‚åœå’Œæ¢å¤çš„å‡½æ•°!!â€æˆ‘ä»¬è¢«å…è®¸,é¼“åŠ±åœ¨ç”Ÿæˆå™¨å†…æš‚åœå’Œæ¢å¤ä»£ç æ‰§è¡Œ.è¿™ä¸€ç‚¹å®Œå…¨å’Œä¸è¦é˜»å¡ä»£ç æ‰§è¡Œä¸ä¸€æ ·.ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç¼–ç¨‹æ„æ¶å…è®¸æˆ‘ä»¬ç¼–å†™å¯ä»¥æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„ä»£ç .è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç”Ÿæˆå™¨å‡½æ•°æˆä¸ºä¸€ä¸ªjså¼‚æ­¥ç¼–ç¨‹è¿›åŒ–çš„é‡Œç¨‹ç¢‘.</p>
</blockquote>
<h3 id="ES6ç”Ÿæˆå™¨æ‘˜è¦"><a href="#ES6ç”Ÿæˆå™¨æ‘˜è¦" class="headerlink" title="ES6ç”Ÿæˆå™¨æ‘˜è¦"></a>ES6ç”Ÿæˆå™¨æ‘˜è¦</h3><p>ä½ ä¸éœ€è¦å…·æœ‰åšå£«å­¦ä½æ‰å¯ä»¥ä½¿ç”¨Redux-saga,ä½†æ˜¯åŸºç¡€çŸ¥è¯†è¿˜æ˜¯éœ€è¦çš„.ä¸‹é¢çš„å†…å®¹æ˜¯ES6ç”Ÿæˆå™¨ç»å¯¹çš„ç²¾åéƒ¨åˆ†:</p>
<ul>
<li>ä¸€ä¸ªgeneratorå‡½æ•°ä»¥<code>function *</code>(â€œfunction starâ€)å¼€å§‹,çœ‹èµ·æ¥åƒä¸‹é¢çš„æ ·å­:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">genFunc</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="comment">// code goes here </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>generatorå‡½æ•°è¿”å›ä¸€ä¸ªgenerator</li>
<li>generatorä¸æ˜¯ä¸€ä¸ªå‡½æ•°,è¯¥æ­»çš„.çœ‹èµ·æ¥åƒæ˜¯generatorå‡½æ•°è¿”å›çš„ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡:<code>let genObj=genFunc()</code></li>
<li>åœ¨generatorä¸­å¯ä»¥ä½¿ç”¨<code>yield</code>ç»ˆæ­¢ä¸€ä¸ªgeneratorçš„æ‰§è¡Œ.</li>
<li>ä¸è¦å¿˜äº†é‚£ä¸ªâœ¨ç¬¦å· <code>function* example(){yield &#39;scheibe&#39;}</code></li>
<li><p>ä¸èƒ½ä½¿ç”¨<code>new</code>å…³é”®å­—æ¥è°ƒç”¨ä¸€ä¸ªgeneratorå‡½æ•°.æˆ‘ä»¬å¯ä»¥ä¸€ç›´è°ƒç”¨generatorå‡½æ•°,ä»–æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„generatorå¯¹è±¡,å‡½æ•°ä½“æ‰§è¡Œä¼šä¸­æ–­,ç›´åˆ°æˆ‘ä»¬è°ƒç”¨<code>next</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span>* <span class="title">genFunc</span> (<span class="params"></span>) </span>&#123; <span class="keyword">yield</span> <span class="string">'hi'</span> &#125;  </div><div class="line">  <span class="keyword">let</span> genObj1 = genFunc()</div><div class="line">  <span class="keyword">let</span> genObj2 = genFunc()</div><div class="line">  genObj1.next()</div><div class="line">  &#123;<span class="attr">value</span>: <span class="string">"hi"</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">  genObj1.next()</div><div class="line">&#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;</div><div class="line">  genObj2.next()</div><div class="line">&#123; <span class="attr">value</span>: <span class="string">"hi"</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°,å½“æˆ‘ä»¬è°ƒç”¨<code>next</code>æ–¹æ³•åƒè¿™æ ·<code>genObj.next()</code>,ç›´åˆ°ä¸‹ä¸€ä¸ª<code>yield</code>å…³é”®å­—çš„æ—¶å€™æ‰å¯ä»¥æ‰§è¡Œ,æ¥ç€è¿”å›<code>yield</code>çš„è¡¨è¾¾å¼å½¢å¼,æ ¼å¼ä¸º<code>{value:any,done:boolean}</code>,â€œanyâ€æ˜¯yieldçš„å€¼,â€doneâ€å‘Šè¯‰æˆ‘ä»¬generatorè¿˜æœ‰æ²¡æœ‰å‰©ä¸‹çš„ä»£ç éœ€è¦yield.</p>
</li>
<li>ä¸‹ä¸€æ¬¡è¿”å›çš„æ—¶å€™,generatorä»è¿™ä¸ªç‚¹ç»§ç»­æ‰§è¡Œ.ä½†æ˜¯ä½ æ˜¯ç›‘å¬ä¸åˆ°è¿™ä¸ªè¿‡ç¨‹çš„.</li>
<li>å¦‚æœæ•´ä¸ªgeneratorå®Œæˆ,å¦‚æœå†æ‰§è¡Œ<code>next()</code>è°ƒç”¨,å°†è¿”å›<code>{value:undefined,}</code>.</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°ä¼ å€¼åˆ°generator:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span>* <span class="title">test</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123; </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'FIRST STEP'</span>)</div><div class="line">    <span class="keyword">var</span> x = <span class="keyword">yield</span> <span class="number">1</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'SECOND STEP'</span>)</div><div class="line">    <span class="keyword">yield</span> x * <span class="number">2</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&gt; <span class="keyword">let</span> gen = test()</div><div class="line">&gt; gen.next()</div><div class="line"><span class="comment">// executes until the first yield, sends out its value and waits</span></div><div class="line">FIRST STEP  </div><div class="line">&#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">gen.next(<span class="number">29</span>)  </div><div class="line"><span class="comment">// sends in 29 to the first yield, which is waiting, assigns it to x, then executes until the next yield and sends out its value</span></div><div class="line">SECOND STEP  </div><div class="line">&#123; <span class="attr">value</span>: <span class="number">58</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">gen.next(<span class="number">2</span>)  </div><div class="line"><span class="comment">// paused at the second yield, we execute up until the first yield again, the value passed to next gets thrown away since we didn't assign it to anything</span></div><div class="line">FIRST STEP  </div><div class="line">&#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">gen.next()  </div><div class="line"><span class="comment">// sends in no value to the paused first yield (undefined), and executes until the second yield, sending out the result of its operand expression</span></div><div class="line">SECOND STEP  </div><div class="line">&#123; <span class="attr">value</span>: <span class="literal">NaN</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div></pre></td></tr></table></figure>
<hr>
<ul>
<li>æ‰€ä»¥<code>next</code>å¯ä»¥è¢«åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤:1.å¯ä»¥ä¼ é€’ä¸€ä¸ªå€¼åˆ°ç›®å‰æŒ‚èµ·çš„yield 2.è¿”å›ä¸‹ä¸€ä¸ªyieldçš„æ“ä½œç¬¦ 3.åœ¨yieldä¸­æŒ‚èµ·</li>
</ul>
<p>å¥½äº†,ç¡®å®æœ‰å¾ˆå¤šçš„ä¸œè¥¿è¦æ¶ˆåŒ–,ä½†æ˜¯ç°åœ¨ä½ å·²ç»çŸ¥é“æ€ä¹ˆä¼ é€’ä¸€ä¸ªå€¼åˆ°generator.ä½ æˆ–è®¸ä¼šæƒ³ç€æ…¢æ…¢ç ”ç©¶è¿™äº›ä»£ç ç›´åˆ°ææ¸…æ¥šæ¯ä»¶äº‹.ç¡®ä¿è°ƒç”¨<code>next</code>çš„æ—¶å€™,è®°ä½ä¸‰ä¸ªæ­¥éª¤.æœ€å¥½èƒ½è®°ä½è¿™äº›æ­¥éª¤.è¿™äº›æ­¥éª¤ä¸ä»…ä»…å¯¹äºç†è§£generator,Reduxå’ŒSagaå¾ˆå…³é”®,å¦‚æœæˆ‘ä»¬å†™æµ‹è¯•sagaä»£ç çš„æ—¶å€™,è¿™äº›æ­¥éª¤ä¹Ÿå˜å¾—éå¸¸æœ‰ç”¨.æœ€ç»ˆçš„ä¸¤ä¸ªç»“è®º:</p>
<ul>
<li><strong>åªèƒ½åœ¨generatorå‡½æ•°ä¸­yield,åœ¨å›è°ƒå‡½æ•°ä¸­æ˜¯ä¸è¡Œçš„.ä¾‹å¦‚ä¸‹é¢çš„ä»£ç æ˜¯é”™è¯¯çš„ï¼š</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">genFunc</span> (<span class="params"></span>) </span>&#123; [<span class="number">1</span>, <span class="number">2</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> <span class="keyword">yield</span> x) &#125;</div></pre></td></tr></table></figure>
<hr>
<ul>
<li>å¯ä»¥ä½¿ç”¨yield*æŠŠæ§åˆ¶æƒä¼ é€’åˆ°å¦ä¸€ä¸ªgeneratorï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">yield</span>* bar()</div><div class="line">  <span class="keyword">yield</span> <span class="number">3</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">yield</span> <span class="number">1</span></div><div class="line">  <span class="keyword">yield</span> <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">&gt; <span class="keyword">let</span> gen = foo()</div><div class="line">&gt; gen.next()</div><div class="line">&#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">&gt; gen.next()</div><div class="line">&#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">&gt; gen.next()</div><div class="line">&#123; <span class="attr">value</span>: <span class="number">3</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</div><div class="line">&gt; gen.next()</div><div class="line">&#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘æœŸæœ›ä½ èƒ½é‡æ–°è¯»è¯»ä¸Šé¢çš„åˆ—è¡¨é¡¹çš„å†…å®¹,åœ¨æµè§ˆå™¨çš„consoleä¸­ç»ƒä¹ ä¸€ä¸‹generatorsä»£ç .å¦‚æœä½ å¯¹è¿™äº›ä»£ç ç†Ÿæ‚‰äº†ä»¥å,å°±å¯ä»¥å‡†å¤‡å¼€å§‹Redux Saga appäº†.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;24 SEPTEMBER 2016&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://ohyayanotherblog.ghost.io/redux-saga-clock/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åŸæ–‡åœ¨è¿™é‡Œ&lt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>æœ¬åœ°Node-jsæœåŠ¡å™¨ä½œä¸ºapiæœåŠ¡å™¨çš„è§£å†³åŠæ³•</title>
    <link href="http://yoursite.com/2017/03/08/%E6%9C%AC%E5%9C%B0Node-js%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%9C%E4%B8%BAapi%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>http://yoursite.com/2017/03/08/æœ¬åœ°Node-jsæœåŠ¡å™¨ä½œä¸ºapiæœåŠ¡å™¨çš„è§£å†³åŠæ³•/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:44:39.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åœ¨çœ‹react-nativeæ•™ç¨‹çš„æ—¶å€™ï¼Œé‡åˆ°è¦åœ¨æ‰‹æœºç«¯è°ƒè¯•ï¼Œéœ€è¦apiæœåŠ¡å™¨ï¼Œä½†æ˜¯ç”±äºNode.jsè‡ªå·±å°±ä½œä¸ºæœåŠ¡å™¨ï¼Œæ²¡æœ‰apacheæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨apacheå’Œnginxä¹Ÿå¯ä»¥è§£å†³ï¼Œä½†æ˜¯æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨nodeå·²æœ‰çš„æ¨¡å—è§£å†³è¿™ä¸ªé—®é¢˜.<br>æ¦‚å¿µ:ç”µè„‘çš„åœ°å€æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°ç¯å›åœ°å€ï¼Œå°±æ˜¯127.0.0.1æˆ–localhost,è¿™ä¸ªåœ°å€æœ¬æœºä»¥å¤–æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ°å€æ˜¯è·¯ç”±å™¨æˆ–äº¤æ¢æœºåˆ†é…çš„ipåœ°å€ï¼Œè¿™ä¸ªåœ°å€å…¶ä»–ç”µè„‘å¯ä»¥è®¿é—®ã€‚<br>åœ¨node.jsä¸­è¦æŠŠipåœ°å€è½¬ä¸ºæœ¬åœ°ç¯å›åœ°å€æ‰å¯ä»¥è®¿é—®ã€‚åŸç†å°±æ˜¯è¿™æ ·ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//æœåŠ¡å™¨ç«¯çš„ä»£ç </span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line"><span class="comment">// set up handlebars view engine</span></div><div class="line"><span class="keyword">var</span> handlebars = <span class="built_in">require</span>(<span class="string">'express3-handlebars'</span>)</div><div class="line">	.create(&#123; <span class="attr">defaultLayout</span>:<span class="string">'main'</span> &#125;);</div><div class="line">app.engine(<span class="string">'handlebars'</span>, handlebars.engine);</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'handlebars'</span>);</div><div class="line"></div><div class="line">app.set(<span class="string">'port'</span>, process.env.PORT || <span class="number">3000</span>);</div><div class="line"></div><div class="line">app.use(express.static(__dirname + <span class="string">'/public'</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> fortuneCookies = [</div><div class="line">	<span class="string">"Conquer your fears or they will conquer you."</span>,</div><div class="line">	<span class="string">"Rivers need springs."</span>,</div><div class="line">	<span class="string">"Do not fear what you don't know."</span>,</div><div class="line">	<span class="string">"You will have a pleasant surprise."</span>,</div><div class="line">	<span class="string">"Whenever possible, keep it simple."</span>,</div><div class="line">];</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">	res.render(<span class="string">'home'</span>);</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> randomFortune = </div><div class="line">		fortuneCookies[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * fortuneCookies.length)];</div><div class="line">	res.render(<span class="string">'about'</span>, &#123; <span class="attr">fortune</span>: randomFortune &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 404 catch-all handler (middleware)</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</div><div class="line">	res.status(<span class="number">404</span>);</div><div class="line">	res.render(<span class="string">'404'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 500 error handler (middleware)</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.error(err.stack);</div><div class="line">	res.status(<span class="number">500</span>);</div><div class="line">	res.render(<span class="string">'500'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log( <span class="string">'Express started on http://localhost:'</span> + </div><div class="line">    app.get(<span class="string">'port'</span>) + <span class="string">'; press Ctrl-C to terminate.'</span> );</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<hr>
<p>ä¸Šé¢è¿™æ®µä»£ç åœ¨127.0.0.1:3000ç«¯å£å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨,ä½†æ˜¯åœ¨æ‰‹æœºç«¯æ˜¯ä¸èƒ½è®¿é—®çš„.</p>
<p>æˆ‘ä»¬å†å¯åŠ¨å¦ä¸€ä¸ªnode.jsæœåŠ¡å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//proxy.js</span></div><div class="line">   <span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>), </div><div class="line">         httpProxy = <span class="built_in">require</span>(<span class="string">'http-proxy'</span>);  <span class="comment">//å¼•å…¥è¿™ä¸ªæ¨¡å—</span></div><div class="line">  </div><div class="line"><span class="comment">// æ–°å»ºä¸€ä¸ªä»£ç† Proxy Server å¯¹è±¡  </span></div><div class="line"><span class="keyword">var</span> proxy = httpProxy.createProxyServer(&#123;&#125;);  </div><div class="line">  </div><div class="line"><span class="comment">// æ•è·å¼‚å¸¸  </span></div><div class="line">proxy.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, req, res</span>) </span>&#123;  </div><div class="line">  res.writeHead(<span class="number">500</span>, &#123;  </div><div class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>  </div><div class="line">  &#125;);  </div><div class="line">  res.end(<span class="string">'Something went wrong. And we are reporting a custom error message.'</span>);  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="comment">// å¦å¤–æ–°å»ºä¸€ä¸ª HTTP 80 ç«¯å£çš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯å¸¸è§„ Node åˆ›å»º HTTP æœåŠ¡å™¨çš„æ–¹æ³•ã€‚  </span></div><div class="line"><span class="comment">// åœ¨æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œè°ƒç”¨ proxy.web(req, res config) æ–¹æ³•è¿›è¡Œè¯·æ±‚åˆ†å‘  </span></div><div class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;  </div><div class="line">  <span class="comment">// åœ¨è¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ä½ çš„è·¯ç”±åˆ†å‘  </span></div><div class="line">  <span class="keyword">var</span> host = req.headers.host, ip = req.headers[<span class="string">'x-forwarded-for'</span>] || req.connection.remoteAddress;  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"client ip:"</span> + ip + <span class="string">", host:"</span> + host);  </div><div class="line">    </div><div class="line">  <span class="keyword">switch</span>(host)&#123;  <span class="comment">//æ„æ€æ˜¯ç›‘å¬ä¸‹é¢çš„ipåœ°å€,å¦‚æœåŒ¹é…å°±è½¬åˆ°</span></div><div class="line"><span class="comment">//127.0.0.1:3000åœ°å€</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'192.168.0.101:8080'</span>:    <span class="comment">//ç›‘å¬è¿™ä¸ªåœ°å€</span></div><div class="line">   <span class="comment">//è¿™ä¸ªåœ°å€åœ¨windowä¸Šç”¨ipconfigæŸ¥çœ‹,mac/linuxç”¨ifconfigæŸ¥çœ‹</span></div><div class="line">   </div><div class="line">    <span class="keyword">case</span> <span class="string">'bbs.aaaa.com'</span>:  </div><div class="line">        proxy.web(req, res, &#123; <span class="attr">target</span>: <span class="string">'http://127.0.0.1:3000'</span> &#125;);  <span class="comment">//è½¬åˆ°è¿™ä¸ªåœ°å€</span></div><div class="line">    <span class="keyword">break</span>;  </div><div class="line">    </div><div class="line">    <span class="keyword">default</span>:  </div><div class="line">        res.writeHead(<span class="number">200</span>, &#123;  </div><div class="line">            <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>  </div><div class="line">        &#125;);  </div><div class="line">        res.end(<span class="string">'Welcome to my server!'</span>);  </div><div class="line">  &#125;  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="built_in">console</span>.log(<span class="string">"listening on port 8080"</span>)  </div><div class="line">server.listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure></p>
<p>node proxy.js ä»¥åå¯åŠ¨äº†proxyæœåŠ¡å™¨.å¯ä»¥é€šè¿‡ç”µè„‘çš„ipåœ°å€è®¿é—®127.0.0.1çš„apiè·¯ç”±äº†ã€‚</p>
<p>å¦‚æœæ˜¯ä½¿ç”¨nginxä¹Ÿå¯ä»¥è¾¾åˆ°è¦æ±‚ï¼Œ<br>åœ¨macä¸Šä½¿ç”¨homebrewåŒ…ç®¡ç†ç›¸å½“æ–¹ä¾¿<br> bashä¸‹  å®‰è£… brew install nginx<br>                å¯åŠ¨ brew services start nginx<br>  å¦‚æœå®‰è£…äº†atomç¼–è¾‘å™¨<br>  bashåœ¨ ç›´æ¥  atom /usr/local/etc/nginx/nginx.conf æ‰“å¼€é…ç½®æ–‡ä»¶æœ¬åˆ†ä»¥ååšå‡ºä¿®æ”¹</p>
<p>ä¸‹é¢æ˜¯nginx.confçš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//nginx.conf</span></div><div class="line"></div><div class="line"> #åŸæ¥çš„æ–‡ä»¶å¦å­˜åã€‚ç›´æ¥ä½¿ç”¨ä¸‹é¢å†…å®¹æ›¿æ¢nginx.<span class="keyword">conf</span>çš„å†…å®¹</div><div class="line"></div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    <span class="keyword">include</span>       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    #log_format  main  '<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="string">"$request"</span> '</div><div class="line">    #                  '<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> <span class="string">"$http_referer"</span> '</div><div class="line">    #                  '<span class="string">"$http_user_agent"</span> <span class="string">"$http_x_forwarded_for"</span>';</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    sendfile        <span class="keyword">on</span>;</div><div class="line">    #tcp_nopush     <span class="keyword">on</span>;</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen 8080;  #ç›‘å¬80880ç«¯å£</div><div class="line">        server_name www.penguu.com 192.168.1.100;  #è¿™é‡Œæ˜¯çœŸæœºè¦è®¿é—®çš„åœ°å€ã€‚</div><div class="line">        # <span class="keyword">Mac</span> é€šè¿‡ç»ˆç«¯ ifconfig æŸ¥çœ‹ã€‚æ¯”å¦‚æˆ‘æŸ¥çœ‹çš„å°±æ˜¯192.168.1.100</div><div class="line">        #æ‰‹æœºè®¿é—®çš„æ¥å£å°±æ˜¯ 192.168.1.100:8080</div><div class="line">        #å®é™…åœ¨23è¡Œç›‘å¬çš„ç«¯å£å¯ä»¥æ˜¯80ç«¯å£ï¼Œç”±äºæµè§ˆå™¨é»˜è®¤å°±æ˜¯80ç«¯å£ã€‚ä½†æ˜¯åœ¨<span class="keyword">mac</span>ä¸­æœ‰æƒé™é—®é¢˜ã€‚æ‰€#ä»¥å°±ä½¿ç”¨8080ç«¯å£</div><div class="line">        # address_bookä¸­çš„serviceä¸­çš„åœ°å€ä¹Ÿè¦ä¿®æ”¹è·¯å¾„æ˜¯</div><div class="line">        # <span class="keyword">view</span>/service.js-&gt;host,ä¿®æ”¹ä¸º 192.168.1.100ï¼š8080</div><div class="line"></div><div class="line">        #access_log /<span class="keyword">var</span>/<span class="keyword">log</span>/nginx/<span class="keyword">test</span>.<span class="keyword">log</span>;</div><div class="line">        location / &#123;</div><div class="line">            proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line">            proxy_set_header X-Forwarded-<span class="keyword">For</span> <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">            proxy_set_header Host  <span class="variable">$http_host</span>;</div><div class="line">            proxy_set_header X-Nginx-Proxy true;</div><div class="line">            proxy_set_header Connection <span class="string">""</span>;</div><div class="line">            proxy_pass      http:<span class="comment">//127.0.0.1:3000;  # address_bookçš„ serveråœ°å€ï¼Œå°±æ˜¯æœ¬åœ°node.jsæœåŠ¡å™¨çš„ipåœ°å€</span></div><div class="line">            #node.jsé»˜è®¤å°±æ˜¯127.0.0.1 ï¼Œport:3000æ˜¯åœ¨<span class="keyword">app</span>.jsä¸­è®¾å®šçš„ã€‚å¯ä»¥ä¿®æ”¹ã€‚</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åœ¨çœ‹react-nativeæ•™ç¨‹çš„æ—¶å€™ï¼Œé‡åˆ°è¦åœ¨æ‰‹æœºç«¯è°ƒè¯•ï¼Œéœ€è¦apiæœåŠ¡å™¨ï¼Œä½†æ˜¯ç”±äºNode.jsè‡ªå·±å°±ä½œä¸ºæœåŠ¡å™¨ï¼Œæ²¡æœ‰apacheæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨apacheå’Œnginxä¹Ÿå¯ä»¥è§£å†³ï¼Œä½†æ˜¯æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨nodeå·²æœ‰çš„æ¨¡å—è§£å†³è¿™ä¸ªé—®é¢˜.&lt;
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨React,Redux,redux-sageæ„å»ºå›¾ç‰‡åº“(ç¿»è¯‘)</title>
    <link href="http://yoursite.com/2017/03/08/Getting%20Started%20with%20React,%20Redux%20and%20Immutable:%20a%20Test-Driven%20Tutorial%20(Part%202)%20/"/>
    <id>http://yoursite.com/2017/03/08/Getting Started with React, Redux and Immutable: a Test-Driven Tutorial (Part 2) /</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:36:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¿»è¯‘ç‰ˆæœ¬,<a href="http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-2/" target="_blank" rel="external">åŸæ–‡è¯·è§</a></p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fds4960hm8j30xc0b4weu.jpg" alt="Imageç”±[egghead.ioæä¾›](http://egghead.io/)"></p>
<p>è¿™æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„å†…å®¹.</p>
<p>åœ¨ç¬¬ä¸€éƒ¨åˆ†,æˆ‘ä»¬ç½—åˆ—äº†appçš„UI,å¼€å‘å’Œå•å…ƒæµ‹è¯•çš„åŸºç¡€.</p>
<p>æˆ‘ä»¬çœ‹åˆ°äº†appçš„stateé€šè¿‡Reactçš„<code>props</code>å‘ä¸‹ä¼ é€’åˆ°å•ä¸ªçš„ç»„ä»¶,ç”¨æˆ·çš„actionså£°æ˜ä¸ºå›è°ƒå‡½æ•°,å› æ­¤appçš„é€»è¾‘å’ŒUIåˆ†ç¦»å¼€æ¥äº†.</p>
<h2 id="Reduxçš„å·¥ä½œæµä»‹ç»"><a href="#Reduxçš„å·¥ä½œæµä»‹ç»" class="headerlink" title="Reduxçš„å·¥ä½œæµä»‹ç»"></a>Reduxçš„å·¥ä½œæµä»‹ç»</h2><p>åœ¨è¿™ä¸€ç‚¹ä¸Š,æˆ‘ä»¬çš„UIæ˜¯æ²¡æœ‰äº¤äº’æ“ä½œçš„:å°½ç®¡æˆ‘ä»¬å·²ç»æµ‹è¯•äº†å¦‚æœä¸€ä¸ªitemå¦‚æœè¢«è®¾å®šä¸º<code>completed</code>,å®ƒå°†ç»™æ–‡æœ¬åˆ’çº¿,ä½†æ˜¯è¿™é‡Œè¿˜æ²¡æœ‰æ–¹æ³•é‚€è¯·ç”¨æˆ·æ¥å®Œæˆå®ƒ:</p>
<ol>
<li>state treeé€šè¿‡<code>props</code>å®šä¹‰äº†UIå’Œactionå›è°ƒå‡½æ•°.</li>
<li>ç”¨æˆ·çš„actions,ä¾‹å¦‚ç‚¹å‡»,è¢«å‘é€åˆ°action creator,actionè¢«å®ƒèŒƒå¼åŒ–.</li>
<li>redux actionè¢«ä¼ é€’åˆ°reducerå®ç°å®é™…çš„appé€»è¾‘</li>
<li>reduceræ›´æ–°state tree,dispatch stateåˆ°store.</li>
<li>UIæ ¹æ®storeé‡Œçš„æ–°state treeæ¥æ›´æ–°UI</li>
</ol>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fdua9bq152j30f10870sn.jpg" alt="Redux working flos"></p>
<h2 id="è®¾å®šåˆå§‹åŒ–state"><a href="#è®¾å®šåˆå§‹åŒ–state" class="headerlink" title="è®¾å®šåˆå§‹åŒ–state"></a>è®¾å®šåˆå§‹åŒ–state</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/be48d4d610b3438aeb1dfcd07d317b3c72fbdb3e" target="_blank" rel="external">è¿™éƒ¨åˆ†çš„ä»£ç æäº¤åœ¨è¿™é‡Œ</a></p>
<p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªactionå°†ä¼šå…è®¸æˆ‘ä»¬åœ¨Redux storeé‡Œæ­£ç¡®çš„è®¾ç½®åˆå§‹åŒ–state<br>,æˆ‘ä»¬å°†ä¼šåˆ›å»ºstore.</p>
<p>Reduxä¸­çš„actionæ˜¯ä¸€ä¸ªä¿¡æ¯çš„è½½ä½“(payload).actionç”±ä¸€ä¸ªJSONå¯¹è±¡æœ‰ä¸€ä¸ª<code>type</code>å±æ€§,æè¿°actionåˆ°åº•æ˜¯åšä»€ä¹ˆçš„,è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯appéœ€è¦çš„ä¿¡æ¯.åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­,typeè¢«è®¾å®šä¸º<code>SET_STATE</code>,æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªstateå¯¹è±¡åŒ…å«éœ€è¦çš„state:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attribute">type</span>: <span class="string">'SET_STATE'</span>,</div><div class="line">  <span class="attribute">state</span>: &#123;</div><div class="line">    <span class="attribute">todos</span>: [</div><div class="line">      &#123;<span class="attribute">id</span>: <span class="number">1</span>, <span class="attribute">text</span>: <span class="string">'React'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>, <span class="attribute">editing</span>: false&#125;,</div><div class="line">      &#123;<span class="attribute">id</span>: <span class="number">2</span>, <span class="attribute">text</span>: <span class="string">'Redux'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>, <span class="attribute">editing</span>: false&#125;,</div><div class="line">      &#123;<span class="attribute">id</span>: <span class="number">3</span>, <span class="attribute">text</span>: <span class="string">'Immutable'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>, <span class="attribute">editing</span>: false&#125;,</div><div class="line">    ],</div><div class="line">    <span class="attribute">filter</span>: <span class="string">'all'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªactionä¼šè¢«dispatchåˆ°ä¸€ä¸ªreducer,reducerè§’è‰²çš„æ˜¯è¯†åˆ«å’Œå®æ–½å’Œactionå¯¹åº”çš„é€»è¾‘ä»£ç .</p>
<p>è®©æˆ‘ä»¬ä¸ºreduceræ¥å†™å•å…ƒæµ‹è¯•ä»£ç <br><code>test/reducer_spec.js</code><br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> <span class="title">import</span> &#123;List, <span class="built_in">Map</span>, fromJS&#125; from <span class="string">'immutable'</span>;</div><div class="line"><span class="title">import</span> &#123;expect&#125; from <span class="string">'chai'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> reducer from <span class="string">'../src/reducer'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line"></div><div class="line">  it(<span class="string">'handles SET_STATE'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = <span class="built_in">Map</span>();</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attribute">type</span>: <span class="string">'SET_STATE'</span>,</div><div class="line">      <span class="attribute">state</span>: <span class="built_in">Map</span>(&#123;</div><div class="line">        <span class="attribute">todos</span>: List.of(</div><div class="line">          <span class="built_in">Map</span>(&#123;<span class="attribute">id:</span><span class="string"> 1, text</span>: <span class="string">'React'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">          <span class="built_in">Map</span>(&#123;<span class="attribute">id:</span><span class="string"> 2, text</span>: <span class="string">'Redux'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">          <span class="built_in">Map</span>(&#123;<span class="attribute">id:</span><span class="string"> 3, text</span>: <span class="string">'Immutable'</span>, <span class="attribute">status</span>: <span class="string">'completed'</span>&#125;)</div><div class="line">        )</div><div class="line">      &#125;)</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line"></div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attribute">todos</span>: [</div><div class="line">        &#123;<span class="attribute">id:</span><span class="string"> 1, text</span>: <span class="string">'React'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attribute">id:</span><span class="string"> 2, text</span>: <span class="string">'Redux'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attribute">id:</span><span class="string"> 3, text</span>: <span class="string">'Immutable'</span>, <span class="attribute">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†æ–¹ä¾¿ä¸€ç‚¹,<code>state</code>ä½¿ç”¨å•çº¯JSå¯¹è±¡,è€Œä¸æ˜¯ä½¿ç”¨Immutableæ•°æ®ç»“æ„.è®©æˆ‘ä»¬çš„reduceræ¥å¤„ç†è½¬å˜.æœ€å,reducerå°†ä¼šä¼˜é›…çš„å¤„ç†<code>undefined</code>åˆå§‹åŒ–state:<br><code>test/reducer_spec.js</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles SET_STATE with plain JS payload'</span>, () =&gt; &#123;</div><div class="line">    const initialState = Map();</div><div class="line">    const action = &#123;</div><div class="line"><span class="symbol">      type:</span> <span class="string">'SET_STATE'</span>,</div><div class="line"><span class="symbol">      state:</span> &#123;</div><div class="line"><span class="symbol">        todos:</span> [</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">    const nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line"><span class="symbol">      todos:</span> [</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles SET_STATE without initial state'</span>, () =&gt; &#123;</div><div class="line">    const action = &#123;</div><div class="line"><span class="symbol">      type:</span> <span class="string">'SET_STATE'</span>,</div><div class="line"><span class="symbol">      state:</span> &#123;</div><div class="line"><span class="symbol">        todos:</span> [</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">    const nextState = reducer(undefined, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line"><span class="symbol">      todos:</span> [</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬çš„reducerå°†ä¼šåŒ¹é…æ¥æ”¶çš„actionsçš„<code>type</code>,å¦‚æœtypeæ˜¯<code>SET_STATE</code>,å½“å‰çš„stateå’Œactionè¿è½½çš„stateèåˆåœ¨ä¸€èµ·:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;<span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">state, newState</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.merge(newState);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SET_STATE'</span>:</div><div class="line">      <span class="keyword">return</span> setState(state, action.state);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬ä¸å¾—ä¸æŠŠreducerè¿æ¥åˆ°æˆ‘ä»¬çš„app,æ‰€ä»¥å½“appå¯åŠ¨åˆå§‹åŒ–state.è¿™é‡Œå®é™…æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨Reduxåº“,å®‰è£…ä¸€ä¸‹<br><code>npm install â€”save redux@3.3.1 react-redux@4.4.1</code></p>
<p><code>src/index.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123;List, <span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> &#123;Provider&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</div><div class="line"><span class="keyword">import</span> &#123;TodoAppContainer&#125; <span class="keyword">from</span> <span class="string">'./components/TodoApp'</span>;</div><div class="line"></div><div class="line"><span class="comment">// We instantiate a new Redux store</span></div><div class="line"><span class="keyword">const</span> store = createStore(reducer);</div><div class="line"><span class="comment">// We dispatch the SET_STATE action holding the desired state</span></div><div class="line">store.dispatch(&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'SET_STATE'</span>,</div><div class="line">  <span class="attr">state</span>: &#123;</div><div class="line">    <span class="attr">todos</span>: [</div><div class="line">      &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">    ],</div><div class="line">    <span class="attr">filter</span>: <span class="string">'all'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">require</span>(<span class="string">'../node_modules/todomvc-app-css/index.css'</span>);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="comment">// We wrap our app in a Provider component to pass the store down to the components</span></div><div class="line">  &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">TodoAppContainer</span> /&gt;</span></span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ çœ‹çœ‹ä¸Šé¢çš„ä»£ç æ®µ,ä½ å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬çš„<code>TodoApp</code>ç»„ä»¶å®é™…æ˜¯è¢«<code>TodoAppContainer</code>ä»£æ›¿.åœ¨Reduxé‡Œ,æœ‰ä¸¤ç§ç±»å‹çš„ç»„ä»¶:å±•ç¤ºç»„ä»¶å’Œå®¹å™¨.æˆ‘æ¨èä½ é˜…è¯»ä¸€ä¸‹ç”±Dan Abramov(Reduxçš„ä½œè€…)å†™ä½œçš„<a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.e5z2vws8e" target="_blank" rel="external">é«˜ä¿¡æ¯é‡çš„æ–‡ç« </a>,å¼ºè°ƒäº†å±•ç¤ºç»„ä»¶å’Œå®¹å™¨çš„å·®å¼‚æ€§.</p>
<p>å¦‚æœæˆ‘æƒ³æ€»ç»“å¾—å¿«ä¸€ç‚¹,æˆ‘å°†å¼•ç”¨<a href="http://redux.js.org/docs/basics/UsageWithReact.html" target="_blank" rel="external">Redux æ–‡æ¡£</a>çš„å†…å®¹ï¼š</p>
<p>â€œå±•ç¤ºç»„ä»¶æ˜¯å…³äºäº‹ä»¶çš„æ ·å­(æ¨¡æ¿å’Œæ ·å¼),å®¹å™¨ç»„ä»¶æ˜¯å…³äºäº‹æƒ…æ˜¯æ€ä¹ˆå·¥ä½œçš„(æ•°æ®è·å–,stateæ›´æ–°)â€.</p>
<p>æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºstore,ä¼ é€’ç»™<code>TodoAppContainer</code>.ç„¶è€Œä¸ºäº†å­ç»„ä»¶å¯ä»¥ä½¿ç”¨store,æˆ‘ä»¬æŠŠstateæ˜ å°„æˆä¸ºReactç»„ä»¶<code>TodoApp</code>çš„<code>props</code>.<br><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line"><span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">todos</span>: state.get(<span class="string">'todos'</span>),</div><div class="line">    <span class="attr">filter</span>: state.get(<span class="string">'filter'</span>)</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> TodoAppContainer = connect(mapStateToProps)(TodoApp);</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­é‡æ–°åŠ è½½app,ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°å®ƒåˆå§‹åŒ–å’Œä¹‹å‰ä¸€æ ·,ä¸è¿‡ç°åœ¨ä½¿ç”¨Redux tools.</p>
<h2 id="Redux-dev-å·¥å…·"><a href="#Redux-dev-å·¥å…·" class="headerlink" title="Redux dev å·¥å…·"></a>Redux dev å·¥å…·</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/9e82a2bf7ffaea5d0fda6af361a126517aecc115" target="_blank" rel="external">è¿™ä¸€éƒ¨åˆ†çš„æäº¤ä»£ç </a></p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»é…ç½®äº†redux storeå’Œreducer.æˆ‘ä»¬å¯ä»¥é…ç½®Redux dev toolsæ¥å±•ç°æ•°æ®æµå¼€å‘.</p>
<p>é¦–å…ˆ,è·å–<a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd" target="_blank" rel="external">Redux dev tools Chrome extension</a></p>
<p>dev toolså¯ä»¥åœ¨Storeåˆ›å»ºçš„æ—¶å€™å¯ä»¥åŠ è½½.</p>
<p><code>src/index.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">import</span> &#123;compose, createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> createStoreDevTools = compose(</div><div class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span> f</div><div class="line">)(createStore);</div><div class="line"><span class="keyword">const</span> store = createStoreDevTools(reducer);</div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure></p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1fdubya02s9j31cy0v6dgk.jpg" alt="Redux dev tools"></p>
<p>é‡æ–°åŠ è½½app,ç‚¹å‡»Reduxå›¾æ ‡,æœ‰äº†.</p>
<p>æœ‰ä¸‰ä¸ªä¸åŒçš„ç›‘è§†å™¨å¯ä»¥ä½¿ç”¨:Diffç›‘è§†å™¨,æ—¥å¿—ç›‘è§†å™¨,Sliderç›‘è§†å™¨.</p>
<h2 id="ä½¿ç”¨Action-Creatorsé…ç½®æˆ‘ä»¬çš„actions"><a href="#ä½¿ç”¨Action-Creatorsé…ç½®æˆ‘ä»¬çš„actions" class="headerlink" title="ä½¿ç”¨Action Creatorsé…ç½®æˆ‘ä»¬çš„actions"></a>ä½¿ç”¨Action Creatorsé…ç½®æˆ‘ä»¬çš„actions</h2><p>åˆ‡æ¢itemçš„ä¸åŒçŠ¶æ€.</p>
<p><a href="https://github.com/phacks/redux-todomvc/commit/7a2dc0963684b569c11f92e41a324324dfb21bdc" target="_blank" rel="external">è¿™éƒ¨åˆ†çš„æäº¤ä»£ç åœ¨è¿™é‡Œ</a></p>
<p>ä¸‹ä¸€æ­¥æ˜¯å…è®¸ç”¨æˆ·åœ¨<code>active</code>å’Œ<code>completed</code>ä¹‹å‰åˆ‡æ¢çŠ¶æ€ï¼š<br><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> &#123;List, <span class="built_in">Map</span>, fromJS&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'../src/reducer'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line"><span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles TOGGLE_COMPLETE by changing the status from active to completed'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'TOGGLE_COMPLETE'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles TOGGLE_COMPLETE by changing the status from completed to active'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'TOGGLE_COMPLETE'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">3</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†é€šè¿‡è¿™äº›æµ‹è¯•,æˆ‘ä»¬æ›´æ–°reducer:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleComplete</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="comment">// We find the index associated with the itemId</span></div><div class="line">  <span class="keyword">const</span> itemIndex = state.get(<span class="string">'todos'</span>).findIndex(</div><div class="line">    <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'id'</span>) === itemId</div><div class="line">  );</div><div class="line">  <span class="comment">// We update the todo at this index</span></div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .update(<span class="string">'status'</span>, status =&gt; status === <span class="string">'active'</span> ? <span class="string">'completed'</span> : <span class="string">'active'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// We update the state to account for the modified todo</span></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SET_STATE'</span>:</div><div class="line">      <span class="keyword">return</span> setState(state, action.state);</div><div class="line">    <span class="keyword">case</span> <span class="string">'TOGGLE_COMPLETE'</span>:</div><div class="line">      <span class="keyword">return</span> toggleComplete(state, action.itemId);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å’Œ<code>SET_STATE</code>çš„actionåŒä¸€ä¸ªåœ°æ–¹,æˆ‘ä»¬éœ€è¦è®©<code>TodoAppContainer</code>ç»„ä»¶æ„ŸçŸ¥åˆ°action,æ‰€ä»¥<code>toggleComplete</code>å›è°ƒå‡½æ•°ä¼šè¢«ä¼ é€’åˆ°<code>TodoItem</code>ç»„ä»¶(å®é™…è°ƒç”¨å‡½æ•°çš„åœ°æ–¹).</p>
<p>åœ¨Reduxä¸­,æœ‰æ ‡å‡†çš„æ–¹æ³•æ¥åšè¿™ä»¶äº‹ï¼šAction Creators.</p>
<p>action creatorsæ˜¯ç®€å•çš„å‡½æ•°,è¿”å›åˆé€‚çš„actionï¼Œè¿™äº›éŸ©å¼æ˜¯Reactçš„<code>props</code>çš„ä¸€äº›æ˜ å°„ä¹‹ä¸€.<br>è®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªaction creator:<br><code>src/action_creators.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toggleComplete</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'TOGGLE_COMPLETE'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨,å°½ç®¡<code>TodoAppcontainer</code>ç»„ä»¶ä¸­çš„<code>connect</code>å‡½æ•°çš„è°ƒç”¨å¯ä»¥ç”¨æ¥è·å–store,æˆ‘ä»¬å‘Šè¯‰ç»„ä»¶ä½¿ç”¨æ˜ å°„<code>props</code>çš„å›è°ƒå‡½æ•°:<br><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'../action_creators'</span>;</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      // ...</div><div class="line">        // We use the spread operator for better lisibility</div><div class="line">        <span class="tag">&lt;<span class="name">TodoList</span>  &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></div><div class="line">      // ...</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">export const TodoAppContainer = connect(mapStateToProps, actionCreators)(TodoApp);</div></pre></td></tr></table></figure></p>
<p>é‡å¯ä½ çš„webserver,åˆ·æ–°ä¸€ä¸‹ä½ çš„æµè§ˆå™¨:å½“å½“.åœ¨æ¡ç›®ä¸Šç‚¹å‡»ç°åœ¨å¯ä»¥åˆ‡æ¢å®ƒçš„çŠ¶æ€.å¦‚æœä½ æŸ¥çœ‹Redux dev tools,ä½ å¯ä»¥çœ‹åˆ°è§¦å‘çš„actionå’Œåç»§çš„æ›´æ–°.</p>
<h2 id="æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨"><a href="#æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨" class="headerlink" title="æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨"></a>æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/3949d4f38912e4b6b8e60fc4c553614d4076028c" target="_blank" rel="external">ç›¸å…³ä»£ç åœ¨åœ¨è¿™é‡Œ</a></p>
<p>ç°åœ¨æ¯ä»¶äº‹æƒ…éƒ½å·²ç»é…ç½®å®Œæ¯•,å†™å…¶ä»–çš„actionæ˜¯ä»¶å°äº‹.æˆ‘ä»¬ç»§ç»­åˆ›å»ºä½ å¸Œæœ›çš„<code>CHANGE_FILTER</code>action,æ”¹å˜å½“å‰stateçš„filter,ç”±æ­¤ä»…ä»…æ˜¾ç¤ºè¿‡æ»¤è¿‡çš„æ¡ç›®.<br>å¼€å§‹åˆ›å»ºaction creatorï¼š<br><code>src/action_creators.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">changeFilter</span>(<span class="params">filter</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'CHANGE_FILTER'</span>,</div><div class="line">    filter</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨å†™reducerçš„å•å…ƒæµ‹è¯•:<br><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles CHANGE_FILTER by changing the filter'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ],</div><div class="line">      <span class="attr">filter</span>: <span class="string">'all'</span></div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'CHANGE_FILTER'</span>,</div><div class="line">      <span class="attr">filter</span>: <span class="string">'active'</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ],</div><div class="line">      <span class="attr">filter</span>: <span class="string">'active'</span></div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>å…³è”çš„reducerå‡½æ•°:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeFilter</span>(<span class="params">state, filter</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.set(<span class="string">'filter'</span>, filter);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SET_STATE'</span>:</div><div class="line">      <span class="keyword">return</span> setState(state, action.state);</div><div class="line">    <span class="keyword">case</span> <span class="string">'TOGGLE_COMPLETE'</span>:</div><div class="line">      <span class="keyword">return</span> toggleComplete(state, action.itemId);</div><div class="line">    <span class="keyword">case</span> <span class="string">'CHANGE_FILTER'</span>:</div><div class="line">      <span class="keyword">return</span> changeFilter(state, action.filter);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æœ€åæˆ‘ä»¬æŠŠ<code>changeFilter</code>å›è°ƒå‡½æ•°ä¼ é€’ç»™<code>TodoTools</code>ç»„ä»¶:<br><code>TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"todoapp"</span>&gt;</span></div><div class="line">        // ...</div><div class="line">        <span class="tag">&lt;<span class="name">TodoTools</span> <span class="attr">changeFilter</span>=<span class="string">&#123;this.props.changeFilter&#125;</span></span></div><div class="line">                   <span class="attr">filter</span>=<span class="string">&#123;this.props.filter&#125;</span></div><div class="line">                   <span class="attr">nbActiveItems</span>=<span class="string">&#123;this.getNbActiveItems()&#125;</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Footer</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å®Œæˆäº†,ç¬¬ä¸€ä¸ªfilter selectorå·¥ä½œå®Œç¾</p>
<h2 id="Itemç¼–è¾‘"><a href="#Itemç¼–è¾‘" class="headerlink" title="Itemç¼–è¾‘"></a>Itemç¼–è¾‘</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/2a7b1138f778524d4aa7eac193c995258d28c5a3" target="_blank" rel="external">ä»£ç åœ¨è¿™é‡Œ</a><br> å½“ç”¨æˆ·ç¼–è¾‘ä¸€ä¸ªæ¡ç›®,å®é™…ä¸Šæ˜¯ä¸¤ä¸ªactionsè§¦å‘çš„ä¸‰ä¸ªå¯èƒ½æ€§:</p>
<ul>
<li>ç”¨æˆ·è¾“å…¥ç¼–è¾‘æ¨¡å¼:<code>EDIT_ITEM</code></li>
<li>ç”¨æˆ·é€€å‡ºç¼–è¾‘æ¨¡å¼(ä¸ä¿å­˜å˜åŒ–):<code>CANCEL_EDITING</code></li>
<li>ç”¨æˆ·éªŒè¯ä»–çš„ç¼–è¾‘(ä¿å­˜å˜åŒ–):<code>DONE_EDITING</code></li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä¸ºä¸‰ä¸ªactionsç¼–å†™action creatorsï¼š<br><code>src/action_creators.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">editItem</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'EDIT_ITEM'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">cancelEditing</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'CANCEL_EDITING'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">doneEditing</span>(<span class="params">itemId, newText</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'DONE_EDITING'</span>,</div><div class="line">    itemId,</div><div class="line">    newText</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨ä¸ºè¿™äº›actionsç¼–å†™å•å…ƒæµ‹è¯•:<br><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles EDIT_ITEM by setting editing to true'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'EDIT_ITEM'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">true</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles CANCEL_EDITING by setting editing to false'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">true</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'CANCEL_EDITING'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles DONE_EDITING by setting by updating the text'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">true</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'DONE_EDITING'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span>,</div><div class="line">      <span class="attr">newText</span>: <span class="string">'Redux'</span>,</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å‘reducerå‡½æ•°,å®é™…æ“ä½œä¸‰ä¸ªactions:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">findItemIndex</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.get(<span class="string">'todos'</span>).findIndex(</div><div class="line">    <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'id'</span>) === itemId</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// We can refactor the toggleComplete function to use findItemIndex</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleComplete</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .update(<span class="string">'status'</span>, status =&gt; status === <span class="string">'active'</span> ? <span class="string">'completed'</span> : <span class="string">'active'</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">editItem</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .set(<span class="string">'editing'</span>, <span class="literal">true</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cancelEditing</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .set(<span class="string">'editing'</span>, <span class="literal">false</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doneEditing</span>(<span class="params">state, itemId, newText</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .set(<span class="string">'editing'</span>, <span class="literal">false</span>)</div><div class="line">    .set(<span class="string">'text'</span>, newText);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'EDIT_ITEM'</span>:</div><div class="line">      <span class="keyword">return</span> editItem(state, action.itemId);</div><div class="line">    <span class="keyword">case</span> <span class="string">'CANCEL_EDITING'</span>:</div><div class="line">      <span class="keyword">return</span> cancelEditing(state, action.itemId);</div><div class="line">    <span class="keyword">case</span> <span class="string">'DONE_EDITING'</span>:</div><div class="line">      <span class="keyword">return</span> doneEditing(state, action.itemId, action.newText);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="æ¸…é™¤å®Œæˆ-æ·»åŠ å’Œåˆ é™¤æ¡ç›®"><a href="#æ¸…é™¤å®Œæˆ-æ·»åŠ å’Œåˆ é™¤æ¡ç›®" class="headerlink" title="æ¸…é™¤å®Œæˆ,æ·»åŠ å’Œåˆ é™¤æ¡ç›®"></a>æ¸…é™¤å®Œæˆ,æ·»åŠ å’Œåˆ é™¤æ¡ç›®</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/c89059a6767903fdf8b9827209f92e1f7385bdb7" target="_blank" rel="external">ä»£ç åœ¨è¿™é‡Œ</a></p>
<p>ä¸‰ä¸ªå‰©ä¸‹çš„actionæ˜¯:</p>
<ol>
<li><code>CLEAR_COMPLETED</code>,åœ¨<code>TodoTools</code>ç»„ä»¶ä¸­è§¦å‘,ä»åˆ—è¡¨ä¸­æ¸…é™¤å®Œæˆçš„æ¡ç›®</li>
<li><code>ADD_ITEM</code>,åœ¨<code>TodoHeader</code>ä¸­è§¦å‘,æ ¹æ®ç”¨æˆ·çš„çš„è¾“å…¥æ–‡æœ¬æ¥æ·»åŠ æ¡ç›®</li>
<li><code>DELETE_ITEM</code>,ç›¸ä¼¼<code>TodoItem</code>ä¸­è°ƒç”¨,åˆ é™¤ä¸€ä¸ªæ¡ç›®</li>
</ol>
<p>æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„å·¥ä½œæµæ˜¯:æ·»åŠ action creators,å•å…ƒæµ‹è¯•reducerå’Œä»£ç é€»è¾‘,æœ€ç»ˆé€šè¿‡propsä¼ é€’å›è°ƒå‡½æ•°:<br><code>src/action_creators.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">clearCompleted</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'CLEAR_COMPLETED'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'ADD_ITEM'</span>,</div><div class="line">    text</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteItem</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'DELETE_ITEM'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles CLEAR_COMPLETED by removing all the completed items'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'CLEAR_COMPLETED'</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles ADD_ITEM by adding the item'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'ADD_ITEM'</span>,</div><div class="line">      <span class="attr">text</span>: <span class="string">'Redux'</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles DELETE_ITEM by removing the item'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'DELETE_ITEM'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">2</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearCompleted</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>,</div><div class="line">    (todos) =&gt; todos.filterNot(</div><div class="line">      <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'status'</span>) === <span class="string">'completed'</span></div><div class="line">    )</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">state, text</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemId = state.get(<span class="string">'todos'</span>).reduce(<span class="function">(<span class="params">maxId, item</span>) =&gt;</span> <span class="built_in">Math</span>.max(maxId,item.get(<span class="string">'id'</span>)), <span class="number">0</span>) + <span class="number">1</span>;</div><div class="line">  <span class="keyword">const</span> newItem = <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: itemId, <span class="attr">text</span>: text, <span class="attr">status</span>: <span class="string">'active'</span>&#125;);</div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, (todos) =&gt; todos.push(newItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteItem</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>,</div><div class="line">    (todos) =&gt; todos.filterNot(</div><div class="line">      <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'id'</span>) === itemId</div><div class="line">    )</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'CLEAR_COMPLETED'</span>:</div><div class="line">      <span class="keyword">return</span> clearCompleted(state);</div><div class="line">    <span class="keyword">case</span> <span class="string">'ADD_ITEM'</span>:</div><div class="line">      <span class="keyword">return</span> addItem(state, action.text);</div><div class="line">    <span class="keyword">case</span> <span class="string">'DELETE_ITEM'</span>:</div><div class="line">      <span class="keyword">return</span> deleteItem(state, action.itemId);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;div&gt;</div><div class="line">      &lt;section className="todoapp"&gt;</div><div class="line">        // We pass down the addItem callback</div><div class="line">        &lt;TodoHeader addItem=&#123;this.props.addItem&#125;/&gt;</div><div class="line">        &lt;TodoList &#123;...this.props&#125; /&gt;</div><div class="line">        // We pass down the clearCompleted callback</div><div class="line">        &lt;TodoTools changeFilter=&#123;this.props.changeFilter&#125;</div><div class="line">                    filter=&#123;this.props.filter&#125;</div><div class="line">                    nbActiveItems=&#123;this.getNbActiveItems()&#125;</div><div class="line">                    clearCompleted=&#123;this.props.clearCompleted&#125;/&gt;</div><div class="line">      &lt;/section&gt;</div><div class="line">      &lt;Footer /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬çš„TodoMVC appç°åœ¨å®Œæˆäº†.</p>
<h2 id="åŒ…è£…èµ·æ¥"><a href="#åŒ…è£…èµ·æ¥" class="headerlink" title="åŒ…è£…èµ·æ¥"></a>åŒ…è£…èµ·æ¥</h2><p>è¿™æˆ‘ä»¬çš„æµ‹è¯•é©±åŠ¨çš„React,Redux&amp;Immutable æŠ€æœ¯æ ˆ</p>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå†…å®¹,æœ‰æ›´å¤šçš„äº‹æƒ…ç­‰ç€ä½ å»æŒ–æ˜<br>ä¾‹å¦‚:</p>
<ul>
<li><a href="https://github.com/reactjs/react-router-redux" target="_blank" rel="external">React Redux router</a>åˆ›å»ºå®Œå…¨çš„å•é¡µé¢åº”ç”¨</li>
<li>æ˜¯ç”±Reduxåœ¨åå°åŒæ„Redux,çœ‹è¿™<a href="http://teropa.info/blog/2015/09/10/full-stack-redux-tutorial.html" target="_blank" rel="external">1æ•™ç¨‹</a>,<a href="https://blog.diacode.com/trello-clone-with-phoenix-and-react-pt-1" target="_blank" rel="external">2æ•™ç¨‹</a></li>
<li><a href="https://github.com/Ghirro/gambit" target="_blank" rel="external">Gambie</a>,ç®€å•çš„åŒ…è£…å™¨ç®€åŒ–åˆ°APIçš„è¿æ¥</li>
<li><a href="https://egghead.io/series/getting-started-with-redux" target="_blank" rel="external">ç³»åˆ—è§†é¢‘</a>,ä½œè€…æ˜¯Dan Abramov(Reduxçš„åˆ›å»ºè€…)</li>
<li>Redux <a href="http://redux.js.org/docs/introduction/Ecosystem.html" target="_blank" rel="external">ç½‘ç«™ä¸Šæ›´å¤šçš„å†…å®¹</a>!</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¿»è¯‘ç‰ˆæœ¬,&lt;a href=&quot;http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-2/&quot; target=&quot;_b
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="Redux" scheme="http://yoursite.com/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-Immutable-js,æŒä¹…åŒ–æ•°æ®ç»“æ„å’Œç»“æ„å…±äº«</title>
    <link href="http://yoursite.com/2017/03/08/%E7%BF%BB%E8%AF%91-Immutable-js,%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%BB%93%E6%9E%84%E5%85%B1%E4%BA%AB/"/>
    <id>http://yoursite.com/2017/03/08/ç¿»è¯‘-Immutable-js,æŒä¹…åŒ–æ•°æ®ç»“æ„å’Œç»“æ„å…±äº«/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>ä¸ºä»€ä¹ˆè¦ç”¨Immutable.jsæ¥ä»£æ›¿Javascriptçš„å¯¹è±¡</em></p>
<blockquote>
<p>ç¿»è¯‘ç‰ˆæœ¬,<a href="https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2#.inlzpjxr8" target="_blank" rel="external">åŸæ–‡è¯·è§</a></p>
<hr>
<p>æŠŠä½ çš„æ•°æ®çœ‹æˆæ˜¯ä¸å¯å˜çš„ä¼šå¸¦æ¥å¾ˆå¤šçš„å¥½å¤„.å®é™…ä¸Šåœ¨ReactèƒŒåæœ‰ä¸ªåŸåˆ™:Reactçš„å…ƒç´ æ˜¯ä¸å¯å˜çš„.ä½ å¯èƒ½ä¹Ÿä¼šå¯¹å­¦ä¹ ä¸å¯å˜Appæ„æ¶æœ‰å¾ˆå¤§å…´è¶£.</p>
</blockquote>
<p>ä½†æ˜¯ä½¿ç”¨Immutable.jsçš„å¥½å¤„æ˜¯:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> todos.update(id,</div><div class="line">    (todo) =&gt; todo.update(<span class="string">'completed'</span>,<span class="comment">//updateæ˜¯immutableçš„æ–¹æ³•</span></div><div class="line">      (completed) =&gt; !completed</div><div class="line">    )</div><div class="line">  )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>è·³è¿‡ä½¿ç”¨æ™®é€šçš„Javascriptå¯¹è±¡(æŠŠä»–ä»¬çœ‹ä½œä¸ºimmutable,å¯ä»¥é€‰åˆ™ä½¿ç”¨ä¾‹å¦‚seamless-immutableä¹‹ç±»çš„åŠ©æ‰‹å‡½æ•°),åƒè¿™æ ·ï¼Ÿ:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123; &#125;, todos, &#123;</div><div class="line">    [id]: <span class="built_in">Object</span>.assign(&#123; &#125;, todos[id], &#123;</div><div class="line">      <span class="attr">completed</span>: !todos[id].completed</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"><span class="comment">// Using updeep</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> u(&#123;</div><div class="line">    [id]: &#123;</div><div class="line">      <span class="attr">completed</span>: <span class="function">(<span class="params">completed</span>) =&gt;</span> !completed</div><div class="line">    &#125;</div><div class="line">  &#125;, todos)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="ä¸€ä¸ªéå¸¸å¤§çš„å¯¹è±¡â€¦"><a href="#ä¸€ä¸ªéå¸¸å¤§çš„å¯¹è±¡â€¦" class="headerlink" title="ä¸€ä¸ªéå¸¸å¤§çš„å¯¹è±¡â€¦"></a>ä¸€ä¸ªéå¸¸å¤§çš„å¯¹è±¡â€¦</h3><p>è®©æˆ‘ä»¬å‡è®¾todo list é‡Œé¢æœ‰100,00ä¸ªä»»åŠ¡:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> todos = &#123;</div><div class="line">  â‹®</div><div class="line">  t79444dae: &#123; <span class="attr">title</span>: <span class="string">'Task 50001'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t7eaf70c3</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50002'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2fd2ffa0</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50003'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t6321775c</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50004'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2148bf88</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50005'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t9e37b9b6</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50006'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tb5b1b6ae</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50007'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tfe88b26d</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50008'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  â‹®</div><div class="line">  (<span class="number">100</span>,<span class="number">000</span> items)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>æˆ‘åˆšåˆšå®Œæˆç¬¬50005ä»¶ä»»åŠ¡.<br>ç°åœ¨æˆ‘æƒ³æŠŠå®ƒæ ‡è®°ä½å®Œæˆ.</p>
<h3 id="ä½¿ç”¨æ™®é€šJavascript-å¯¹è±¡"><a href="#ä½¿ç”¨æ™®é€šJavascript-å¯¹è±¡" class="headerlink" title="ä½¿ç”¨æ™®é€šJavascript å¯¹è±¡"></a>ä½¿ç”¨æ™®é€šJavascript å¯¹è±¡</h3><p><code>var nextState=toggleTodo(todos,&#39;t2148bf88&#39;)</code></p>
<p>è¿™ä¸ªå•ä¸€çš„æ“ä½œå“ŸèŠ±è´¹134msæ¥è¿è¡Œ.</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå½“ä½ ä½¿ç”¨<code>Object.assign</code>,Javascriptçš„æµ…å¤åˆ¶æ‹·è´æ¯ä¸€ä¸ªæºçš„æ¯ä¸ªå±æ€§åˆ°ç›®çš„åœ°.ä¸€æ¬¡ä¸€ä¸ª.</p>
<p>æˆ‘ä»¬æœ‰100,000ä¸ªtodos,æ‰€ä»¥æ„å‘³ç€æœ‰100,000ä¸ªå±æ€§è¦æ‹·è´.<br>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦èŠ±è¿™ä¹ˆé•¿çš„æ—¶é—´.</p>
<hr>
<h3 id="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ</h3><p>åœ¨Javascriptä¸­,å¯¹è±¡é»˜è®¤æ˜¯å¯ä»¥çªå˜(mutable)çš„.<br>å½“ä½ å…‹éš†ä¸€ä¸ªå¯¹è±¡,Javascriptæœ‰æ¯ä¸€ä¸ªå±æ€§çš„æ‹·è´,æ‰€ä»¥ä¸¤ä¸ªå¯¹è±¡å˜å¾—å®Œå…¨åˆ†ç¦»çš„.çœ‹ä¸‹å›¾<br><img src="https://ww3.sinaimg.cn/large/006tKfTcly1fdobo2he6bj312w0i2dgz.jpg" alt="100,000ä¸ªå±æ€§è¢«(æµ…)å¤åˆ¶åˆ°ç›®çš„åœ°"></p>
<p>è¿™å°±å…è®¸ä½ åœ¨æ‹·è´ä»¥åæ”¹å˜ä»»ä½•å¯¹è±¡çš„å±æ€§,å¯¹è±¡ä¹‹é—´ä¹Ÿä¸ä¼šç›¸äº’å½±å“.ç”šè‡³åœ¨æŠŠè¿™äº›å¯¹è±¡å¤„ç†ä¸ºä¸å¯å˜(immutable),Javascriptä¹Ÿè¿˜æ˜¯æŒ‰ç…§mutableæ¥å¤„ç†.</p>
<hr>
<h3 id="ä½¿ç”¨Immutable-js"><a href="#ä½¿ç”¨Immutable-js" class="headerlink" title="ä½¿ç”¨Immutable.js"></a>ä½¿ç”¨Immutable.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> todos = Immutable.fromJS(&#123;</div><div class="line">  â‹®</div><div class="line">  t79444dae: &#123; <span class="attr">title</span>: <span class="string">'Task 50001'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t7eaf70c3</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50002'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2fd2ffa0</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50003'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t6321775c</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50004'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2148bf88</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50005'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t9e37b9b6</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50006'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tb5b1b6ae</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50007'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tfe88b26d</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50008'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  â‹®</div><div class="line">  (<span class="number">100</span>,<span class="number">000</span> items)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<hr>
<p>ä½¿ç”¨<code>Immutable.Map</code>æ¥ä»£è¡¨æˆ‘ä»¬çš„æ•°æ®,æ›´æ–°ç¬¬50005æ¡ä»»åŠ¡<br><code>var nextState=toggleTodo(todos,&#39;t2148bf88&#39;)</code></p>
<p>è¿™ä¸ªæ“ä½œä»…èŠ±è´¹1.2msæ—¶é—´å»è¿è¡Œ.é€Ÿåº¦æå‡äº†100å€ä»¥ä¸Šï¼</p>
<p>ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå¿«ï¼Ÿ</p>
<h3 id="æŒä¹…æ•°æ®ç»“æ„"><a href="#æŒä¹…æ•°æ®ç»“æ„" class="headerlink" title="æŒä¹…æ•°æ®ç»“æ„"></a>æŒä¹…æ•°æ®ç»“æ„</h3><p>æŒä¹…æ•°æ®ç»“æ„(Persistent data structures)å¼ºåŠ›é™åˆ¶æ‰€æœ‰çš„æ“ä½œéƒ½è¦è¿”å›æ•°æ®ç»“æ„çš„æ–°ç‰ˆæœ¬,ä¿æŒåŸæ•°æ®ç»“æ„çš„å®Œæ•´æ€§,ä¸èƒ½æ›´æ”¹åŸæ•°æ®ç»“æ„.</p>
<p>è¿™ä¸€ç‚¹æš—ç¤ºæ‰€æœ‰çš„æŒä¹…åŒ–æ•°æ®éƒ½æ˜¯ä¸å¯å˜çš„.</p>
<p>åœ¨è¿™ä¸ªç»™å®šçš„é™åˆ¶ä¸‹,å®ç°æŒä¹…åŒ–æ•°æ®ç»“æ„çš„åº“å¯ä»¥è¿›è¡Œå¾ˆå¥½çš„ä¼˜åŒ–,å› ä¸ºè¿™äº›åº“çŸ¥é“æˆ‘ä»¬ä¸ä¼šæ”¹å˜æˆ‘ä»¬çš„æ•°æ®.</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¼˜åŒ–</p>
<h3 id="ä½¿ç”¨triesæ¥ä¼˜åŒ–"><a href="#ä½¿ç”¨triesæ¥ä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨triesæ¥ä¼˜åŒ–"></a>ä½¿ç”¨triesæ¥ä¼˜åŒ–</h3><p>ä¸ºäº†ç›´è§‚ä¸€ç‚¹,è¯•ä¸€ä¸ªå°ä¾‹å­</p>
<p>æƒ³è±¡å­˜å‚¨ä¸€ä¸ªé”®-å€¼æ˜ å°„:</p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcly1fdocl8z802j304d08fglh.jpg" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®ç»“æ„å­˜å‚¨åˆ°å•ä¸€çš„Javascirptå¯¹è±¡ä¸­:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">const</span> data = &#123;</div><div class="line">  <span class="attr">to</span>: <span class="number">7</span>,</div><div class="line">  <span class="attr">tea</span>: <span class="number">3</span>,</div><div class="line">  <span class="attr">ted</span>: <span class="number">4</span>,</div><div class="line">  <span class="attr">ten</span>: <span class="number">12</span>,</div><div class="line">  <span class="attr">A</span>: <span class="number">15</span>,</div><div class="line">  <span class="attr">i</span>: <span class="number">11</span>,</div><div class="line">  <span class="attr">in</span>: <span class="number">5</span>,</div><div class="line">  <span class="attr">inn</span>: <span class="number">9</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½åˆ›å»ºä¸€ä¸ªtrieæ¥ä»£æ›¿jsçš„å¯¹è±¡å‘¢ï¼Ÿä»–çš„ç»“æ„çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š<br><img src="https://ww1.sinaimg.cn/large/006tKfTcly1fdocnlha2cj30eo0bhdg5.jpg" alt=""></p>
<p>åŸºæœ¬ä¸Šä½ å¯æ ¹æ®å›¾ä¸Šçš„è·¯å¾„ä»rootå¼€å§‹è·å–åˆ°ä½ éœ€è¦çš„å€¼.</p>
<p>å¦‚æœä½ ä»rootå¼€å§‹æ‰¾<code>data.in</code>,æ ¹æ®æ ‡è®°<code>i</code>å’Œ<code>n</code>çš„è·¯å¾„.å¯ä»¥æ‰¾åˆ°åŒ…å«<code>5</code>çš„èŠ‚ç‚¹.</p>
<p>é‚£ä¹ˆ,æ€ä¹ˆä¿®æ”¹å‘¢ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬æ€è€ƒä¸€ä¸‹æŠŠé”®<code>tea</code>çš„å€¼ä»<code>3</code>æ”¹ä¸º<code>14</code>.</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„trieï¼Œå°½å¯èƒ½çš„ä½¿ç”¨å­˜åœ¨çš„èŠ‚ç‚¹.</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fdocttxa1tj30cq0a7mxf.jpg" alt=""></p>
<p>è€çš„æ ‘å½¢ç»“æ„ä»ç„¶å­˜åœ¨,è€Œä¸”æ²¡æœ‰å˜åŒ–.åœ¨å®ä¾‹ä¸­ä½ å¯ä»¥ä¿ç•™ä¸€ä¸ªå¼•ç”¨</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fdocuasnscj30f00clwf2.jpg" alt=""></p>
<p>åœ¨ä¸Šå›¾ä¸­å¦‚ç»¿è‰²éƒ¨åˆ†æ‰€ç¤º,æˆ‘ä»¬ä»…ä»…åªéœ€è¦æ›´æ–°4ä¸ªèŠ‚ç‚¹æ¥æ›´æ–°è¿™ä¸ªæ•°.å…¶ä»–çš„èŠ‚ç‚¹æ˜¯å¯ä»¥é‡æ–°åˆ©ç”¨çš„ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªå›¾å±•ç¤ºImmutable.jsæ€ä¹ˆå®æ–½<code>Immutable.Map</code>.åˆ›å»ºä¸€ä¸ªæ¯ä¸ªèŠ‚ç‚¹æœ‰32ä¸ªåˆ†æ”¯çš„æ ‘.</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fdodbub78oj30h20cpab6.jpg" alt="Immutable.Mapçš„å®æ–½"></p>
<p> å½“æˆ‘ä»¬æ›´æ–°ä¸€ä¸ªå•ä¸ªé¡¹ç›®,ä»…ä»…åªè¦ä¸€äº›èŠ‚ç‚¹éœ€è¦è¢«é‡æ–°åˆ›å»º.</p>
<p> Immutable.jså€ŸåŠ©crazy advanced techniquesä¿æŒæ ‘å½¢ç»“æ„çš„ç´§å‡‘,æ ¹æ®å„ç§å­æ ‘çš„å„ç§å±æ€§æ¥åˆ›å»ºå¤šç§ç±»å‹çš„èŠ‚ç‚¹.</p>
<p> <img src="https://ww1.sinaimg.cn/large/006tNc79ly1fdoe03ud5ej30h907wt9c.jpg" alt=""></p>
<h3 id="å¹¶ä¸æ€»æ˜¯å¦‚æ­¤â€¦"><a href="#å¹¶ä¸æ€»æ˜¯å¦‚æ­¤â€¦" class="headerlink" title="å¹¶ä¸æ€»æ˜¯å¦‚æ­¤â€¦"></a>å¹¶ä¸æ€»æ˜¯å¦‚æ­¤â€¦</h3><p> ä¸è¦æŠŠæœ¬é—®çš„æœ¬æ„ç†è§£ä¸ºâ€œä½ æ€»æ˜¯éœ€è¦Immutable.jsâ€œ.ä¸æ˜¯è¿™ä¸ªæ„æ€,æˆ‘åªæ˜¯æƒ³å¼ºè°ƒä¸€ä¸‹ä»–çš„å¥½å¤„.è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ¨èè¦ä½¿ç”¨ä»–.</p>
<p>  æ•°æ®ç»“æ„æ˜¯å¾ˆé‡è¦çš„,ä½†æ˜¯å½“æˆ‘ç¼–å†™è½¯ä»¶çš„æ—¶å€™,æˆ‘é¦–å…ˆè¦å°è¯•æœ€ç®€å•çš„æ–¹å¼.æˆ‘è¿‡å»ä½¿ç”¨æ•°ç»„å’Œå¯¹è±¡,ä¹‹åå½“æˆ‘éœ€è¦é€Ÿåº¦æå‡çš„æ—¶å€™,æˆ‘ä½¿ç”¨Immutable.js,æˆ–è€…æ˜¯åœ¨æˆ‘é‡åˆ°åˆ°æˆ‘éœ€è¦ä»–çš„æ—¶å€™.åœ¨åªè¦å°‘æ•°çš„æ¡ç›®,è¿˜æœ‰å°çš„å¯¹è±¡å’Œé›†åˆçš„æ—¶å€™,æˆ‘å°±ä¸ä¼šä½¿ç”¨Immutable.js.</p>
<h2 id="æ˜¯ä¸æ˜¯æ„æ€æ˜¯æˆ‘å¯èƒ½ä¼šè¿”å›å»å¹¶ä¸”åœ¨åé¢åœ¨æ”¹å˜"><a href="#æ˜¯ä¸æ˜¯æ„æ€æ˜¯æˆ‘å¯èƒ½ä¼šè¿”å›å»å¹¶ä¸”åœ¨åé¢åœ¨æ”¹å˜" class="headerlink" title="æ˜¯ä¸æ˜¯æ„æ€æ˜¯æˆ‘å¯èƒ½ä¼šè¿”å›å»å¹¶ä¸”åœ¨åé¢åœ¨æ”¹å˜?"></a>æ˜¯ä¸æ˜¯æ„æ€æ˜¯æˆ‘å¯èƒ½ä¼šè¿”å›å»å¹¶ä¸”åœ¨åé¢åœ¨æ”¹å˜?</h2><p>  å¯¹ï¼éå¸¸å¥½ï¼å¦‚æœä½ çš„æ•°æ®æ¥å…¥æ˜¯é€šè¿‡å•ä¸€,ç»„ç»‡è‰¯å¥½çš„æ¨¡å—.ä¾‹å¦‚:</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// -- Todos.js --</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> empty = &#123; &#125;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">todos, id, todo</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123; &#125;, todos, &#123; [id]: todo &#125;)</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getById</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> todos[id]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ä¼°è®¡æ‰€æœ‰çš„åº”ç”¨ä»£ç æ€»æ˜¯è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å—æ¥è·å–æ•°æ®.å½“ä½ æƒ³æ”¹å˜å†…å«çš„æ•°æ®ç»“æ„æ—¶,ä½ ä»…ä»…éœ€è¦æ›´æ–°è¿™ä¸ªæ–‡ä»¶.</p>
<p>è¿™ä¸ªæˆ‘ä»¬å«åšâ€å®ä½“æ¨¡å—â€œ,å°è£…äº†ä»£è¡¨æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿçš„æ‰€æœ‰å†…å®¹.è¿™ä¸ªæ¦‚å¿µæ¥è‡ªâ€Clean Architectureâ€œ.æˆ‘è®¡åˆ’ä»¥åæ¥å†™å†™è¿™ä¸ªé—®é¢˜.</p>
<h2 id="ä¸è¦æŠŠåº”ç”¨çš„é€»è¾‘å’Œæ•°æ®ç»“æ„è€¦åˆåœ¨ä¸€èµ·"><a href="#ä¸è¦æŠŠåº”ç”¨çš„é€»è¾‘å’Œæ•°æ®ç»“æ„è€¦åˆåœ¨ä¸€èµ·" class="headerlink" title="ä¸è¦æŠŠåº”ç”¨çš„é€»è¾‘å’Œæ•°æ®ç»“æ„è€¦åˆåœ¨ä¸€èµ·"></a><code>ä¸è¦æŠŠåº”ç”¨çš„é€»è¾‘å’Œæ•°æ®ç»“æ„è€¦åˆåœ¨ä¸€èµ·</code></h2><p>æˆ‘å¾ˆäº†è§£åº”ç”¨é€»è¾‘å’Œæ•°æ®ç»“æ„ä¸è€¦åˆåœ¨ä¸€èµ·çš„è‰°éš¾ä¹‹å¤„.è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“åœ¨æœªæ¥æ•°æ®æ€ä¹ˆæ¥è·å–.</p>
<p>ä¾‹å¦‚:æˆ‘ä»¬çš„todo appç°åœ¨ç®¡ç†ç€100,000ä»»åŠ¡.æˆ‘ä»¬æ”¹ä¸ºä½¿ç”¨Immytable.js.ç°åœ¨æ¯ä¸ªéƒ¨åˆ†éƒ½è¶³å¤Ÿå¥½å’Œè¶³å¤Ÿå¿«.</p>
<p>çªç„¶éœ€æ±‚æ¥äº†:â€ä»»åŠ¡è¦æœ‰ä¸€ä¸ªå®‰æ’è€…â€.(ç±»ä¼¼è€å¸ˆå¸ƒç½®ä½œä¸šç»™å­¦ç”Ÿ),â€ç”¨æˆ·åº”è¯¥å¯ä»¥çœ‹åˆ°ä»»åŠ¡æ˜¯è°ç»™å®‰æ’çš„â€.</p>
<pre><code class="js"> <span class="function"><span class="keyword">function</span> <span class="title">findByAssigneeAsArray</span> (<span class="params">todos, assigneeId</span>) </span>{
  <span class="keyword">return</span> todos.filter(
    <span class="function">(<span class="params">task</span>) =&gt;</span> Task.containsAssignee(task, assigneeId)
  ).toArray()
}
</code></pre>
<hr>
<p>ç”¨æˆ·å¼€å§‹æŠ±æ€¨appå˜æ…¢äº†,åˆ†ææ­ç¤ºä¸Šé¢è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªå¤§é—®é¢˜.</p>
<p>ä½¿ç”¨ä¸Šé¢è¿™æ®µä»£ç éœ€è¦åºåˆ—æœç´¢100ï¼Œ000ä»»åŠ¡.è¿™æ ·åšæ€ä¹ˆèƒ½å¿«çš„èµ·æ¥ï¼Ÿ</p>
<h3 id="è¦ä¼˜åŒ–è¿™ä¸ªæ¡ˆä¾‹-æˆ‘ä»¬éœ€è¦æ”¹å˜å†…åœ¨çš„æ•°æ®ç»“æ„"><a href="#è¦ä¼˜åŒ–è¿™ä¸ªæ¡ˆä¾‹-æˆ‘ä»¬éœ€è¦æ”¹å˜å†…åœ¨çš„æ•°æ®ç»“æ„" class="headerlink" title="è¦ä¼˜åŒ–è¿™ä¸ªæ¡ˆä¾‹,æˆ‘ä»¬éœ€è¦æ”¹å˜å†…åœ¨çš„æ•°æ®ç»“æ„"></a>è¦ä¼˜åŒ–è¿™ä¸ªæ¡ˆä¾‹,æˆ‘ä»¬éœ€è¦æ”¹å˜å†…åœ¨çš„æ•°æ®ç»“æ„</h3><p>è¿™éœ€è¦ä¿æŒä¸€ä¸ªåå‘çš„æŸ¥è¯¢è¡¨,è¿æ¥ä»»åŠ¡å®‰æ’äººå’Œä»»åŠ¡åˆ—è¡¨çš„TaksID.è¿™ä¸ªä¼˜åŒ–çš„ä¿®æ”¹å®ä¾‹æ¥è‡ªäº<code>[Taskworld](https://taskworld.com/)</code>.</p>
<p>å¦‚æœæˆ‘ä»¬çš„reducer/selector/viewä»£ç å’Œæ•°æ®ç»“æ„ç›´æ¥è¿ç³»åœ¨ä¸€èµ·,è¦åšå‡ºè¿™æ ·çš„æ”¹å˜éå¸¸éš¾.</p>
<p>æ‰€ä»¥,å¦‚æœæˆ‘ä»¬æƒ³å¿«é€Ÿè¿­ä»£,æˆ‘ä»¬éœ€è¦ç¡®ä¿å¾ˆå®¹æ˜“åšå‡ºä¿®æ”¹.ä»å¼€å§‹å°±ä¿æŒä»£ç æ•´æ´,ä¹¦å†™æµ‹è¯•,å»ºç«‹æŒç»­é›†æˆ.</p>
<h3 id="æ„Ÿè°¢é˜…è¯»ï¼"><a href="#æ„Ÿè°¢é˜…è¯»ï¼" class="headerlink" title="æ„Ÿè°¢é˜…è¯»ï¼"></a>æ„Ÿè°¢é˜…è¯»ï¼</h3><p> æ›´å¤šçš„è®¨è®ºåœ¨<a href="https://www.reddit.com/r/reactjs/comments/5h7pqz/persistent_data_structures_and_structural_sharing/" target="_blank" rel="external">Reddit</a>.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;ä¸ºä»€ä¹ˆè¦ç”¨Immutable.jsæ¥ä»£æ›¿Javascriptçš„å¯¹è±¡&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¿»è¯‘ç‰ˆæœ¬,&lt;a href=&quot;https://medium.com/@dtinth/immutable-js-persistent-data-stru
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>-ç¿»è¯‘-Redux-Saga-å®Œæˆæ—¶é’Ÿæ¼”ç¤ºApp</title>
    <link href="http://yoursite.com/2017/03/08/-%E7%BF%BB%E8%AF%91-Redux-Saga-%E5%AE%8C%E6%88%90%E6%97%B6%E9%92%9F%E6%BC%94%E7%A4%BAApp/"/>
    <id>http://yoursite.com/2017/03/08/-ç¿»è¯‘-Redux-Saga-å®Œæˆæ—¶é’Ÿæ¼”ç¤ºApp/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:44:53.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ç¿»è¯‘ç‰ˆæœ¬ï¼Œ<a href="http://ohyayanotherblog.ghost.io/redux-saga-finishing-the-clock-demo-app/" target="_blank" rel="external">åŸæ–‡è¯·è§</a><br><em>14 NOVEMBER 2016</em></p>
</blockquote>
<p>##å®ç°Sagaä»£ç <br>è¿™ç¯‡æ–‡ç« æ˜¯ä¸‰ç¯‡å…³äºRedux Sagaç³»åˆ—æ–‡ç« çš„ç¬¬ä¸‰ç¯‡,ä¹Ÿæ˜¯æœ€åä¸€ç¯‡.åœ¨ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬å…ˆå¯¹æœ‰å…³çš„æ¦‚å¿µè¿›è¡Œäº†çƒ­èº«.åœ¨ç¬¬äºŒéƒ¨åˆ†,æˆ‘ä»¬å’ŒReduxå…³ç³»æ¨è¿›åˆ°äº†å¦ä¸€ä¸ªé«˜åº¦.æˆ‘ä»¬æŠŠSagaä»˜è¯¸å®æ–½.åœ¨æœ€åä¸€ç¯‡æ–‡ç« ,æˆ‘ä»¬æŠŠæœ€åä¸€éƒ¨åˆ†å†…å®¹å†™å®Œ.å¦‚æœä½ æ²¡æœ‰å…‹éš†app repoï¼Œå¯ä»¥åœ¨è¿™ä¸ª<a href="https://github.com/granmoe/redux-saga-clock-tutorial" target="_blank" rel="external">åœ°å€å…‹éš†</a>,å¦‚æœä¸æƒ³çœ‹è¿™ä¸ªrepo,æƒ³ç›´æ¥è·³åˆ°æœ€ç»ˆçš„appä»£ç ,å¯ä»¥<a href="https://github.com/granmoe/redux-saga-clock.git" target="_blank" rel="external">çœ‹è¿™ä¸ªrepo</a>.   <a href="https://granmoe.github.io/redux-saga-clock/" target="_blank" rel="external">live demoçœ‹è¿™é‡Œ</a>.</p>
<hr>
<p><a href="http://www.jianshu.com/p/6f8678a6ad78" target="_blank" rel="external">ç¬¬ä¸€éƒ¨åˆ†è¯‘æ–‡è¯·è§</a>ï¼Œ<br><a href="http://www.jianshu.com/p/fad0136e77c0" target="_blank" rel="external">ç¬¬äºŒéƒ¨åˆ†è¯‘æ–‡è¯·è§</a>ï¼Œ<br><a href="http://www.jianshu.com/p/88fc4236b505" target="_blank" rel="external">ç¬¬ä¸‰éƒ¨åˆ†è¯‘æ–‡è¯·è§</a>.</p>
<hr>
<h2 id="Whatâ€™s-my-name-agian"><a href="#Whatâ€™s-my-name-agian" class="headerlink" title="Whatâ€™s my name agian?"></a>Whatâ€™s my name agian?</h2><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­,æˆ‘ä»¬è®¾è®¡äº†åŸºç¡€ä½†æ˜¯æœ‰ç‚¹å¹¼ç¨šçš„éœ€æ±‚,åˆ›å»ºäº†å¾ˆåˆçº§æ—¶é’Ÿ,å¯ä»¥å¯¹ç”¨æˆ·çš„äº¤äº’æ“ä½œåšå‡ºä¸€äº›å“åº”.(è¯‘è€…ï¼šåé¢æœ‰å‡ å¥ä¼¼ä¹å’ŒæŠ€æœ¯æ²¡æœ‰å¤ªå¤§å…³ç³»,æˆ‘å°±æ²¡æœ‰ç¿»è¯‘äº†.è¯·å‚è§åŸæ–‡).</p>
<p>æˆ‘ä»¬å†³å®šåªä½¿ç”¨æœ€å°åŒ–çš„redux stateå€¼æœ‰ä¸€ä¸ªå­—æ®µâ€œmillisecondsâ€æ¥ä»£è¡¨æ—¶é’Ÿçš„æ—¶é—´.å› ä¸ºæˆ‘ä»¬çš„æ—¶é’Ÿéœ€è¦å‘å‰,å‘å,é‡ç½®,æ‰€ä»¥åˆ›å»ºäº†ç›¸åº”çš„redux actionå»æ‰§è¡Œå¢,å‡,é‡ç½®actions,è¿™äº›actionså¯ä»¥æ”¹å˜state.<br>å½“æˆ‘ä»¬è¿›å…¥æŸäº›saga codeä»£ç ,åˆ›å»ºä¸€ä¸ªsagaç›‘å¬ä¸‰ä¸ªactions(å¼€å§‹,æš‚åœ,å›æ‹¨),åªæœ‰æ”¶åˆ°ç›¸åº”actionçš„æ—¶å€™,è¾“å‡ºæ—¥å¿—å†…å®¹.æœ€å,æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æŠŠæ—¥å¿—è¾“å‡ºæ›¿æ¢æˆæ—¶é’Ÿå®é™…è¿è¡Œçš„æµç¨‹,ä¾‹å¦‚æ¯ä¸€ç§’ç§å‘é€ä¸€ä¸ªé€’å‡çš„action,å› æ­¤app stateçš„å¼‚æ­¥æ“ä½œéœ€è¦å¥½å¥½çš„è®¾è®¡.æœ€åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„Reactç»„ä»¶,å¯ä»¥è®©æˆ‘ä»¬æ ¹æ®æœŸæœ›çš„sagaä»£ç çš„å·¥ä½œæµç¨‹æµ‹è¯•reduxå’Œsaga action,è§‚å¯Ÿstateçš„æ›´æ–°.</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥å®Œæˆè¿™ä»¶äº‹,æˆ‘ä»¬æƒ³ç»™æœ‹å‹ç•™ä¸‹æ·±åˆ»çš„å°è±¡,çœ‹ä¸Šå»æœ‰æ„æ€ä¸€ç‚¹,æ‰€ä»¥ä¼šä½¿ç”¨ä¸€äº›éå¸¸é…·çš„SVGæŠ€æœ¯,å½“æ—¶é—´å¢åŠ çš„æ—¶å€™,æ—¶é’Ÿå¯ä»¥ç”»å‡ºä¸€äº›å›¾å½¢.ä½†æ˜¯æœ€é‡è¦çš„æ˜¯ä½¿ç”¨Sagaå¯ä»¥æ˜¯appå”±æ­Œ,è·³èˆ.å¼€å§‹ç¼–ç .</p>
<p>##å®ç°Saga<br>æˆ‘ä»¬çš„duck.jsæ˜¯éå¸¸å°çš„,å®é™…ä¸Šä»…ä»…éœ€è¦å¾ˆå°‘å‡ è¡Œä»£ç å»å®Œæˆsaga/redux.ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„duckä»£ç æ˜¯è¿™æ ·çš„:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">rootSaga</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">yield</span> takeLatest([<span class="string">'start-clock'</span>, <span class="string">'pause-clock'</span>, <span class="string">'rewind-clock'</span>], handleClockAction)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Pushed this action to handleClockAction: '</span>, type)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>æ­£å¦‚æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« æ‰€è®¨è®ºçš„,<code>takeLatest</code>å°†ä¼šç›‘å¬action typeæ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªaction type,å½“æ¯æ¬¡å‘é€çš„actionå’Œaction typeä¹‹ä¸€åŒ¹é…çš„æ—¶å€™,ä¼šè¿è¡Œå¦ä¸€ä¸ªæµç¨‹(åœ¨æˆ‘ä»¬çš„appä¸­,æ˜¯<code>handleClockAction</code>).<code>takeLatest</code>ä¹Ÿä¼šå–æ¶ˆä¹‹å‰çš„è¿è¡Œæµç¨‹,ä»–ä¹Ÿä¼šä¼ é€’æ•´ä¸ªactionå¯¹è±¡,æˆ‘ä»¬å¯ä»¥åœ¨<code>handleClockAction</code>ä½¿ç”¨è¿™ä¸ªå¯¹è±¡.</p>
<p>ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹æ•´ä¸ªappåº”è¯¥æ€ä¹ˆå·¥ä½œ.æ‰€æœ‰çš„å®é™…æµç¨‹éƒ½æ˜¯åœ¨<code>handelClockAction</code>ä¸­,åœ¨ä¸‰ä¸ªsaga actionsä¸­,æ¯ä¸€ä¸ªactionæˆ‘ä»¬éƒ½åšä¸€äº›ä¸åŒçš„å·¥ä½œ.æ·±å…¥åˆ°ä»£ç çš„åŸºç¡€æ„æ¶ä¸­.ä½¿ç”¨<code>if/else if</code>ä»£ç å—æ›¿æ¢<code>handleClockAction</code>çš„å•è¡Œä»£ç .è¿™ä¸ªä»£ç å—ä¸ºæ¯ä¸ªaction typeæä¾›åˆ†æ”¯åˆ¤æ–­é€»è¾‘,å¹¶ä¸”è¾“å‡ºä¸€äº›æ–‡æœ¬æ—¥å¿—,éªŒè¯ä»£ç çš„æ­£ç¡®æ€§.</p>
<p>ç»™ä½ å‡ ç§’é’Ÿ,è€å¿ƒç­‰å¾…ä¸€ä¸‹.</p>
<p>å¥½äº†,ä¸‹é¢çš„æ˜¯æˆ‘çš„<code>handelClockAction</code>çš„å®é™…æ ·å­:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//if else ifä»£ç å—è¿›è¡Œåˆ†æ”¯åˆ¤æ–­æ‰§è¡Œæµç¨‹</span></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="keyword">if</span> (type === <span class="string">'start-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock forward here.`</span>)</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'rewind-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock backwards here.`</span>)</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'pause-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. Guess what needs to be done here?`</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ç°åœ¨è¿è¡Œapp(npm start),è½¬åˆ°localhost:8080,æ‰“å¼€javascriptç»ˆç«¯,æµ‹è¯•ä¸€äº›saga actions(ä»–ä»¬å’ŒSVGå›¾ä¸‹é¢çš„æŒ‰é’®æ˜¯è¿æ¥åœ¨ä¸€èµ·çš„).æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯æ¬¡actionæ‰§è¡Œæ—¶,æœ‰ç›¸åº”çš„æ—¥å¿—è¾“å‡º.</p>
<p>å½“æˆ‘ä»¬å¼€å§‹clock action,æˆ‘ä»¬æƒ³è®©æ—¶é’Ÿæ¯100æ¯«ç§’é€’å¢ä¸€æ¬¡.ä¸ºäº†è¿™æ ·åš,ä»sagaå¯¼å…¥åŠ©æ‰‹å‡½æ•°â€delayâ€.ç¼–è¾‘redux-sagaæ–‡ä»¶.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; delay, takeLatest &#125; <span class="keyword">from</span> <span class="string">'redux-saga'</span></div></pre></td></tr></table></figure>
<hr>
<p>delayéå¸¸ç®€å•ï¼ŒåŠŸèƒ½ä¸è¨€è‡ªæ˜.å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°,æ¯«ç§’æ•°,ç„¶åæš‚åœæ‰§è¡Œå¯¹åº”çš„æ—¶é—´.ä¾‹å¦‚<code>yield delay(50)</code>.åœ¨<code>if/else if</code>ä»£ç å—ä¸­æ·»åŠ ä¸€äº›é€»è¾‘ä»£ç ,æ¯1000ms,è¾“å‡ºæ—¥å¿—.è¯·è®°ä½,ä½ éœ€è¦è¿™ä¸ªè¿‡ç¨‹æ— é™åˆ¶çš„é‡å¤.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨éå¸¸ç®€å•çš„åŸç”Ÿjavascriptä»£ç æ§åˆ¶æµæ¥å®ç°.æˆ‘æƒ³è®©ä½ å…ˆçŒœçŒœæ€ä¹ˆå®ç°.</p>
<p>ä¸è¦å·çœ‹.</p>
<p>èŠ±ç‚¹æ—¶é—´è€ƒè™‘ä¸€ä¸‹.</p>
<p>å¥½äº†,ä¸‹é¢æ˜¯æˆ‘çš„ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="keyword">if</span> (type === <span class="string">'start-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;<span class="comment">//å°±æ˜¯è¿™ä¸ªwhile(true)è¯­å¥ä¿æŒå§‹ç»ˆè¿è¡Œ</span></div><div class="line">      <span class="keyword">yield</span> delay(<span class="number">1000</span>)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock forward here.`</span>)</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'rewind-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock backwards here.`</span>)</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'pause-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. Guess what needs to be done here?`</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Š,æ‰“å¼€jsç»ˆç«¯,æŸ¥çœ‹æ—¥å¿—è¾“å‡º,å¯ä»¥å¾—åˆ°ç›´è§‚çš„ä¿¡æ¯.ä½ å°†çœ‹åˆ°,start clock actionæš‚åœ100æ¯«ç§’,ç„¶åè¾“å‡ºä¸€äº›æ—¥å¿—ä¿¡æ¯,ä¹‹åæ— é™åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹.æ³¨æ„ä¸€ä¸ªå…³é”®äº‹å®,æ— è®ºä»€ä¹ˆæ—¶é—´æˆ‘ä»¬çš„<code>takeLatest</code>å‡½æ•°æ¥æ”¶åˆ°åŒ¹é…çš„actionçš„æ—¶å€™,å®ƒä¼šé€€å‡ºå½“å‰è¿è¡Œçš„<code>handleClockAction</code>.å¦‚æœæ˜¯æš‚åœçš„action,ä»€ä¹ˆäº‹æƒ…ä¹Ÿä¸åš,ä½†æ˜¯è¿˜æ˜¯è¦é€€å‡ºå½“å‰ä»»ä½•çš„action,çŒœçŒœæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿåˆ é™¤ä¸€ç‚¹ä»£ç ï¼æš‚åœçš„æ—¶é’Ÿå°†ä¼šè‡ªåŠ¨å¼€å§‹å·¥ä½œ,å› ä¸º<code>takeLatest</code>ä¼šé€€å‡ºå½“å‰çš„<code>handleClockAction</code>,ä¸ç®¡æ—¶é’Ÿæ˜¯å‘å‰è¿˜æ˜¯å‘åè¿è¡Œ,æ—¶é’Ÿéƒ½ä¼šåœæ­¢.<br>ç¡®ä¿¡ä½ ç†è§£<code>takeLatest</code>çš„å…³é”®ç‰¹æ€§.åœ¨<code>handleClockAction</code>ä¸­åšå‡ºåˆé€‚çš„æ”¹å˜.åº”è¯¥æƒ³ä¸‹é¢è¿™æ ·åš:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="keyword">if</span> (type === <span class="string">'start-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">yield</span> delay(<span class="number">1000</span>)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock forward here.`</span>)</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'rewind-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock backwards here.`</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>ç°åœ¨è®©æˆ‘ä»¬åœ¨å¾ªç¯å†…çœŸæ­£çš„dispatchä¸€ä¸ªaction.<br>ï¼ˆæ—ç™½ï¼šæˆ‘ä»¬æ²¡æœ‰å®é™…dispatchä¸€ä¸ªactionï¼Œä»…ä»…è¯·æ±‚ä¸­é—´ä»¶æ¥åšè¿™ä»¶äº‹,æš‚æ—¶ä¸è¦æ‹…å¿ƒ,æˆ‘åé¢ä¼šè§£é‡Šæ¸…æ¥šçš„.)</p>
<p>åœ¨Sagaé‡Œé¢dispatchä¸€ä¸ªaction,æˆ‘ä»¬è¦ä½¿ç”¨<code>put</code> side effects,æ·»åŠ ä¸€è¡Œä»£ç åˆ°duckæ–‡ä»¶é‡Œ.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; put &#125; <span class="keyword">from</span> <span class="string">'redux-saga/effects'</span></div></pre></td></tr></table></figure>
<hr>
<p>é€šè¿‡<code>put</code>è¯·æ±‚ä¸€ä¸ªdispatchçš„action,ç®€å•çš„ä½¿ç”¨<code>yield put({ type: &#39;hi&#39;, data: &#39;I am an action&#39; })</code>å°±å¯ä»¥äº†.æ„æ€æ˜¯åœ¨<code>put</code>é‡Œ,å¯ä»¥è°ƒç”¨ä¸€ä¸ªaction creator è¿”å›ä¸€ä¸ªå•çº¯å¯¹è±¡,åƒè¿™æ ·<code>yield put(someAction())</code>.(åœ¨javascriptä¸­å‡½æ•°çš„å‚æ•°ä¼šç«‹å³æ±‚å€¼).è¿˜è®°å¾—æˆ‘ä»¬åœ¨å¼€å§‹åˆ›å»ºçš„é‚£äº›redux actionå—ï¼Ÿæˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ª,è½¬åˆ°whileå¾ªç¯,è¯•è¯•<code>put</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="keyword">if</span> (type === <span class="string">'start-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">yield</span> delay(<span class="number">1000</span>)</div><div class="line">      <span class="keyword">yield</span> put(incrementMilliseconds())<span class="comment">//æ³¨æ„è¿™ä¸€å¥</span></div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'rewind-clock'</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`Received <span class="subst">$&#123;type&#125;</span>. We need to run the clock backwards here.`</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>åœ¨ä½ çš„æµè§ˆå™¨é‡Œè¯•è¯•.æ³¨æ„åœ¨SVGä¸‹é¢çš„æ—¶é’Ÿæ—¶é—´æ˜¯é€’å¢çš„.</p>
<p>ä¸ºäº†è®©æ—¶é’Ÿåé€€,å¯ä»¥é‡ç”¨start æ—¶é’Ÿçš„å¤§éƒ¨åˆ†ä»£ç .</p>
<p>ä¸‹é¢æ˜¯å›é€€çš„ä»£ç :<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="keyword">if</span> (type === <span class="string">'start-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">yield</span> delay(<span class="number">1000</span>)</div><div class="line">      <span class="keyword">yield</span> put(incrementMilliseconds())</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'rewind-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">yield</span> delay(<span class="number">1000</span>)</div><div class="line">      <span class="keyword">yield</span> put(decrementMilliseconds())<span class="comment">//é€’å‡</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>ç°åœ¨æµ‹è¯•ä¸€ä¸‹æ‰€æœ‰çš„saga actions,ç¡®ä¿æ¯ä»¶äº‹æƒ…éƒ½å·¥ä½œæ­£å¸¸.å¦‚æœå·¥ä½œä¸æ­£å¸¸,é‚£ç»å¯¹æ˜¯ä½ çš„é”™,ä¸æ˜¯æˆ‘çš„é”™.å¼€ä¸ªç©ç¬‘.(è¯‘è€…:åé¢å‡ å¥æ²¡æœ‰ç¿»è¯‘)</p>
<p>æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»æ˜¯è¿è¡Œsagaä»£ç å¹¶ä¸”é€šè¿‡å®éªŒå­¦åˆ°çš„äº†ä¸€äº›ä¸œè¥¿.ä¸€ä¸ªæç¤ºï¼š<code>delay</code>æ˜¯é˜»å¡çš„,å…¶ä»–çš„effectè¯­å¥éƒ½æ˜¯éé˜»å¡çš„.è¯•ç€ä½¿ç”¨<code>for</code>å¾ªç¯.è¦ä¹ˆæŠŠ<code>while</code>æ¡ä»¶æ”¹ä¸ºfalse.æˆ‘ä»¬å·²ç»æ”¾å¼ƒäº†promiseçš„ä¸–ç•Œ,ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›ç®€å•çš„,å¯é¢„æµ‹çš„,åŸç”Ÿçš„javascriptæ¥è¡¨ç°å‡ºæ‰€æœ‰çš„æ§åˆ¶æµè¯­å¥.</p>
<p>å¥½äº†,æŠŠsagaä»£ç æ¢å¤åˆ°ä¸Šé¢çš„æ ·å­.</p>
<p>åšå¥½äº†ä¸Šé¢çš„æ¢å¤,æˆ‘çš„sagaä»£ç å·²ç»å®Œæˆ,å¯ä»¥æ“ä½œäº†(æ³¨æ„äº‹é¡¹ï¼šåœ¨æœ€ç»ˆç‰ˆæœ¬ä¸Š,æˆ‘å·²ç»æŠŠä»£ç é‡æ–°ç»„ç»‡äº†ä¸€ä¸‹,ä»¥ä¾¿äºé˜…è¯»).</p>
<h2 id="Sagaâ€™sçš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œ"><a href="#Sagaâ€™sçš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œ" class="headerlink" title="Sagaâ€™sçš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œ"></a>Sagaâ€™sçš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œ</h2><p>å¥½äº†.ç°åœ¨è®©æˆ‘ä»¬å†åšä¸€äº›äº‹æƒ…,è®©æˆ‘ä»¬è°ˆè°ˆä»£ç æ˜¯æ€ä¹ˆå·¥ä½œçš„.Redux Sagaä¸­æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯:æˆ‘ä»¬å®é™…æ²¡æœ‰åƒdispatchä¸€ä¸ªactionåˆ°storeä¸€æ ·æ‰§è¡Œå¼‚æ­¥æ“ä½œ.æ›¿ä»£æ–¹æ³•æ˜¯:æˆ‘ä»¬yieldå¼‚æ­¥æ“ä½œåˆ°saga middleware,ç„¶åmiddlewareæ‰§è¡Œä»–ä»¬.ç®€å•çš„è¯´,æˆ‘ä»¬ç»™Sagaä¸€ä¸ªæŒ‡ç¤º,å‘Šè¯‰ä»–æˆ‘ä»¬å¸Œæœ›å‘ç”Ÿä»€ä¹ˆ.è¿™äº›å¼‚æ­¥æ“ä½œæè¿°æ˜¯éµå¾ªæ ‡å‡†generatorè¾“å‡ºçš„å•çº¯å¯¹è±¡:<code>{value:any,done:boolean}</code>,è¿™å’Œæˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†çœ‹åˆ°çš„å®Œå…¨ä¸€æ ·.<br>ä¾‹å¦‚,<code>yield put</code>å‘é€ä¸€ä¸ªå¯¹è±¡åˆ°ä¸­é—´ä»¶,è¿™ä¸ªä¸­é—´ä»¶åŒ…å«ä¸€ä¸ªactionå¯¹è±¡,å¯ä»¥dispatchä¸€äº›å†…å®¹ç»™æˆ‘ä»¬(è¯‘è€…:è¿™ä¸ªåœ°æ–¹æœ‰ç‚¹ç»•,å…¶å®æ˜¯åœ¨å¼‚æ­¥æ“ä½œå®Œæˆä»¥å,éœ€è¦å†æ¬¡dispatchè¿”å›çš„ç»“æœ,ä»è€Œæ”¹å˜stateï¼Œè¿™æ ·æˆ‘ä»¬çš„ç»„ä»¶æ‰å¯ä»¥æ ¹æ®stateçš„æ”¹å˜æ¥æ¸²æŸ“æ•ˆæœ,ä¾‹å¦‚ä»è¿œç¨‹èµ„æºè¯·æ±‚æ•°æ®,é€šå¸¸éƒ½éœ€è¦æŠŠæ•´ä¸ªæ“ä½œåˆ†æˆå‡ æ­¥æ¥å®Œæˆ,æ¯ä¸€æ­¥è¦æ”¹å˜ä¸åŒçš„state,åœ¨dispatchä¸­å†dispatch)è¿™æ ·å®šä¹‰å¼‚æ­¥æ•°æ®æµæœ‰å¾ˆå¤šå¥½å¤„,å…¶ä¸­ä¹‹ä¸€æ˜¯å¯æµ‹è¯•æ€§.æˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„åœ¨æ¯ä¸€ä¸ªside effectè¿”å›ä¸­é—´ä»¶çš„æ—¶å€™åˆ›å»ºæ–­è¨€(ç»§ç»­å…³æ³¨åç»­çš„å†…å®¹,æœ‰æµ‹è¯•çš„æ·±å…¥ä»‹ç»)</p>
<p> æˆ‘ä»¬åº”è¯¥éµå¾ªredux-sagaçš„æœ€ä½³å®è·µ,åšäº›å°å°çš„æ›´æ–°,ä»redux-saga/effectsä¸­å¯¼å…¥<code>call</code>,æŠŠ<code>yield delay(100)</code>æ”¹ä¸º<code>yield call(delay,100)</code>.å› ä¸ºæˆ‘ä»¬åªæƒ³è¿”å›side-effectsåˆ°sagaä¸­é—´ä»¶,sagaæä¾›äº†<code>call</code>effectæŠŠnon-effectsè½¬å˜ä¸ºeffects.ä¸ä»…ä»…yield<code>delay</code>è‡ªå·±(promiseå¯¹è±¡)ä¸åŒ,æˆ‘ä»¬é€šè¿‡<code>call</code>æŠŠ<code>delay</code>è½¬å˜ä¸ºeffect,ç„¶åyieldå®ƒ.æ‰€æœ‰çš„non-effectéƒ½åº”è¯¥åšç›¸åŒçš„å¤„ç†.<code>call</code>çš„è¯­æ³•è°ƒç”¨ä¸€ä¸ªå‡½æ•°,å¹¶ä¸”ä¼ é€’å‚æ•°åˆ—è¡¨.ä¾‹å¦‚:<code>yield call(fetch,url,options)</code>.æœ€å,æ³¨æ„,<code>call</code>å¯ä»¥è¢«promiseå¯¹è±¡,generators,æˆ–è€…å‡½æ•°ä½¿ç”¨.</p>
<h2 id="ä»£ç ä¸è¦å¤ªä¸‘é™‹"><a href="#ä»£ç ä¸è¦å¤ªä¸‘é™‹" class="headerlink" title="ä»£ç ä¸è¦å¤ªä¸‘é™‹"></a>ä»£ç ä¸è¦å¤ªä¸‘é™‹</h2><p> æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä½œä¸ºappçš„é…ç½®,åŒ…å«ä¸€äº›å¸¸é‡.ä¸ºä»€ä¹ˆä¸å«åšâ€œconfig.jsâ€åœ¨/srcç›®å½•ä¸‹åˆ›å»º,ç²˜è´´ä¸‹é¢çš„å†…å®¹.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">const</span> MAX_RADIUS = <span class="number">40</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> hands = [  </div><div class="line">  &#123; <span class="attr">ms</span>: <span class="number">144000</span>, <span class="attr">maxTicks</span>: <span class="number">1</span> &#125;,</div><div class="line">  &#123; <span class="attr">ms</span>: <span class="number">36000</span>, <span class="attr">maxTicks</span>: <span class="number">4</span> &#125;,</div><div class="line">  &#123; <span class="attr">ms</span>: <span class="number">12000</span>, <span class="attr">maxTicks</span>: <span class="number">3</span> &#125;,</div><div class="line">  &#123; <span class="attr">ms</span>: <span class="number">2000</span>, <span class="attr">maxTicks</span>: <span class="number">6</span> &#125;,</div><div class="line">  &#123; <span class="attr">ms</span>: <span class="number">400</span>, <span class="attr">maxTicks</span>: <span class="number">5</span> &#125;,</div><div class="line">  &#123; <span class="attr">ms</span>: <span class="number">100</span>, <span class="attr">maxTicks</span>: <span class="number">4</span> &#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> STROKE_WIDTH = MAX_RADIUS / hands.length</div><div class="line"></div><div class="line">hands = hands.map(<span class="function">(<span class="params">hand, idx</span>) =&gt;</span> &#123;  </div><div class="line">  <span class="keyword">const</span> radius = STROKE_WIDTH * (hands.length - idx)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    ...hand,</div><div class="line">    radius,</div><div class="line">    <span class="attr">circumference</span>: <span class="number">2</span> * <span class="built_in">Math</span>.PI * radius,</div><div class="line">    <span class="attr">alpha</span>: <span class="number">1</span> - idx / hands.length</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> CLOCK_HANDS = hands</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> MINIMUM_MS = <span class="number">100</span></div></pre></td></tr></table></figure>
<hr>
<p> è¿™é‡Œé¢éƒ½æœ‰ä»€ä¹ˆå†…å®¹ï¼Ÿè®©æˆ‘è§£é‡Šä¸€ä¸‹,å®ƒæ˜¯ä¸€ç»„å¸¸é‡å’Œè®¡ç®—é‡,æè¿°SVGçš„å¤–è§‚.<br> æˆ‘ä¸ä¼šè¯¦ç»†è®²è¿™ä¸ªå†…å®¹,ä¸æ˜¯è¿™é‡Œçš„é‡ç‚¹.</p>
<p> å¥½äº†,ç°åœ¨æˆ‘ä»¬çš„sagaä»£ç å·²ç»å°±ç»ª,æˆ‘ä»¬ä¹Ÿå®šä¹‰äº†æ‰€æœ‰SVGéœ€è¦çš„é…ç½®æ–‡ä»¶.å†æ›´æ–°ä¸€ä¸‹SVGå†…å®¹,å¥½å®Œæˆapp.jsxçš„ä»£ç .</p>
<p> ##å®Œæˆ HIM<br> ä¸‹é¢æ˜¯ç›®å‰çš„app.jsxä»£ç <br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>  </div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; incrementMilliseconds, decrementMilliseconds, resetClock, startClock, pauseClock, rewindClock &#125; <span class="keyword">from</span> <span class="string">'duck'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;  </div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">const</span> &#123;</div><div class="line">      milliseconds,</div><div class="line">      incrementMilliseconds,</div><div class="line">      decrementMilliseconds,</div><div class="line">      resetClock,</div><div class="line">      startClock,</div><div class="line">      pauseClock,</div><div class="line">      rewindClock</div><div class="line">    &#125; = <span class="keyword">this</span>.props</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">incrementMilliseconds</span> &#125; <span class="attr">onDoubleClick</span>=<span class="string">&#123;</span> <span class="attr">resetClock</span> &#125; <span class="attr">onMouseLeave</span>=<span class="string">&#123;</span> <span class="attr">decrementMilliseconds</span> &#125;</span></div><div class="line">          <span class="attr">className</span>=<span class="string">"clock"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 100 100"</span> <span class="attr">width</span>=<span class="string">"500"</span>&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">&#123;</span> <span class="attr">30</span> &#125; <span class="attr">stroke</span>=<span class="string">&#123;</span> '<span class="attr">rgba</span>(<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>)' &#125; <span class="attr">fill</span>=<span class="string">"orange"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123; milliseconds &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">startClock</span> &#125;&gt;</span>Start Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">pauseClock</span> &#125;&gt;</span>Pause Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">rewindClock</span> &#125;&gt;</span>Rewind Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default connect(state =&gt; (&#123;  </div><div class="line">  milliseconds: state.milliseconds</div><div class="line">&#125;), (&#123;</div><div class="line">  incrementMilliseconds,</div><div class="line">  decrementMilliseconds,</div><div class="line">  resetClock,</div><div class="line">  startClock,</div><div class="line">  pauseClock,</div><div class="line">  rewindClock</div><div class="line">&#125;))(Clock)</div></pre></td></tr></table></figure></p>
<hr>
<p> æˆ‘ä»¬éœ€è¦å¯¼å…¥conifgå†…å®¹,é€šè¿‡propsä¼ é€’åˆ°ç»„ä»¶.åˆ é™¤ä¸€äº›ä¸å¿…è¦çš„å¯¼å…¥æ–‡ä»¶.ä¸å†ç›´æ¥è°ƒç”¨ç‰¹å®šçš„actions,å› ä¸ºæˆ‘ä»¬ä»…ä»…åœ¨sagaä¸­å‘å‡ºaction.æ›´æ–°ä¸€ä¸‹ä»£ç .<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>  </div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; startClock, rewindClock, pauseClock, resetClock &#125; <span class="keyword">from</span> <span class="string">'duck'</span>  </div><div class="line"><span class="keyword">import</span> &#123; CLOCK_HANDS, STROKE_WIDTH &#125; <span class="keyword">from</span> <span class="string">'config'</span></div></pre></td></tr></table></figure></p>
<hr>
<p> ç°åœ¨æˆ‘ä»¬æœ‰äº†æ•°æ®,å¯ä»¥åœ¨SVGå†…ç”»å‡ºæ¼‚äº®çš„åœ†ç¯.ç®€å•ç‚¹çš„è¯´æˆ‘ä»¬ä½¿ç”¨åŒå¿ƒåœ†ä»£è¡¨å°æ—¶/åˆ†é’Ÿ/ç§’.æ—¶é—´æµé€çš„æ—¶å€™,æ”¹å˜æ¯ä¸€ä¸ªåœ†ç¯çš„é•¿åº¦.ä¸ºäº†åšSVGå›¾ç‰‡,ä½¿ç”¨äº†ä¸€äº›å°æŠ€å·§<a href="https://css-tricks.com/svg-line-animation-works/" target="_blank" rel="external">CSS Trick blog post</a></p>
<p> æˆ‘ä»¬ä¸å†é€šè¿‡propsæ‰‹æ®µä¼ é€’millsecondså­—æ®µ.æ¯æ¬¡æ›´æ–°millisecondsæ—¶,æˆ‘ä»¬è®¡ç®—æ¯ä¸€ä¸ªæ—¶é’ŸæŒ‡é’ˆçš„ä½ç½®.è¿™åƒæ˜¯çƒ¦äººçš„æ•°å­¦è®¡ç®—.åŸºæœ¬ä¸Šæˆ‘ä»¬éå†æ¯ä¸€ä¸ªæŒ‡é’ˆ,ç„¶ååœ¨ä¸‹ä¸€ä¸ªæŒ‡é’ˆé‡å¤åŒæ ·çš„è¿‡ç¨‹,(æ—¶é’ˆå°±å‡æ‰å°æ—¶çš„æ•´å€å¥½ç§’æ•°,åˆ†é’Ÿå’Œç§’ä¸€æ ·å¤„ç†),æŠŠå‰©ä½™çš„æ—¶é—´ä¼ é€’ç»™ä¸‹å».æœ€å°çš„æŒ‡é’ˆå¯¹åº”çš„æœ€å°çš„ç²¾åº¦å•ä½,100ms(config.jsä¸­çš„MAXIMUM_MS),æ›´æ–°ä½ çš„<code>connect</code></p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> &#123;  </div><div class="line">  <span class="keyword">const</span> currentTime = state.milliseconds</div><div class="line">  <span class="keyword">let</span> remainingTime = currentTime</div><div class="line"></div><div class="line">  <span class="keyword">const</span> getTicks = <span class="function">(<span class="params">hands, timeRemaining</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> [hand, ...tailHands] = hands</div><div class="line">    hand.ticks = <span class="built_in">Math</span>.floor(timeRemaining / hand.ms)</div><div class="line">    <span class="keyword">return</span> tailHands.length ? [hand, ...getTicks(tailHands, timeRemaining % hand.ms)] : [hand]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> hands = getTicks(CLOCK_HANDS, remainingTime)</div><div class="line">    .map(<span class="function">(<span class="params">hand, idx</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> offset = state.milliseconds &gt;= hand.ms ? <span class="number">1</span> : <span class="number">0</span></div><div class="line">      <span class="keyword">const</span> position = hand.circumference - ((hand.ticks + offset) / hand.maxTicks * hand.circumference)</div><div class="line"></div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...hand,</div><div class="line">        position</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    hands</div><div class="line">  &#125;</div><div class="line">&#125;, (&#123;</div><div class="line">  startClock,</div><div class="line">  rewindClock,</div><div class="line">  resetClock,</div><div class="line">  pauseClock</div><div class="line">&#125;))(Clock)</div></pre></td></tr></table></figure>
<hr>
<p> ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶ä¸­å¯¼å…¥æ–°çš„<code>æŒ‡é’ˆ</code>å±æ€§.åœ¨æ¸²æŸ“æ–¹æ³•ä¸­ç»™propsè§£æ„èµ‹å€¼:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">render () &#123;  </div><div class="line"><span class="keyword">const</span> &#123;</div><div class="line">  hands,</div><div class="line">  startClock,</div><div class="line">  rewindClock,</div><div class="line">  resetClock,</div><div class="line">  pauseClock</div><div class="line">&#125; = <span class="keyword">this</span>.props</div></pre></td></tr></table></figure>
<hr>
<p> ä¸ºäº†æœ€ç»ˆç‰ˆæœ¬,æˆ‘ä»¬åšä¸€ä¸‹æœ€ç»ˆçš„æ”¹å˜.æˆ‘ä»¬æ›´æ–°SVG,å¯åŠ¨<code>onMouseEnter</code>,å›é€€<code>onMouseLeave</code>,æš‚åœ<code>onClick</code>.æ·»åŠ ä¸€ä¸‹è¿™äº›å˜åŒ–.</p>
<p> ï¼ˆè¯‘è€…ï¼šè¿™ä¸€æ®µä¹Ÿä¸ç¿»äº†,åŸä½œè€…è¦å–ä¼ç‰¹åŠ ).</p>
<p>  åšå¥½äº†å§,ç°åœ¨æˆ‘ä»¬åœ¨SVGå†…åˆ›å»ºåŒå¿ƒåœ†,éå†<code>hands</code>å¹¶ä¸”åˆ›å»º<code>&lt;circle&gt;</code>SVGå…ƒç´ ,ä½¿ç”¨æˆ‘ä»¬çš„è®¡ç®—å€¼è®¾ç½®æ¯ä¸ªæŒ‡é’ˆçš„åŠå¾„,ä½ç½®å’Œé€æ˜åº¦.</p>
<p>  è¿™æ˜¯æœ€ç»ˆçš„æ›´æ–°,ä¸‹é¢æ˜¯<code>render()</code>å‡½æ•°è¿”å›çš„å†…å®¹ï¼š<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">return</span> (  </div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onMouseEnter</span>=<span class="string">&#123;</span> <span class="attr">startClock</span> &#125; <span class="attr">onMouseLeave</span>=<span class="string">&#123;</span> <span class="attr">rewindClock</span> &#125; <span class="attr">onDoubleClick</span>=<span class="string">&#123;</span> <span class="attr">resetClock</span> &#125;</span></span></div><div class="line">    <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">pauseClock</span> &#125; <span class="attr">className</span>=<span class="string">"clock"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 100 100"</span> <span class="attr">width</span>=<span class="string">"500"</span>&gt;</div><div class="line">    &#123; hands.map((hand, index) =&gt; &#123;</div><div class="line">      const &#123; radius, circumference, position, alpha &#125; = hand</div><div class="line">      return (</div><div class="line">        <span class="tag">&lt;<span class="name">circle</span> <span class="attr">key</span>=<span class="string">&#123;</span> <span class="attr">index</span> &#125; <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">&#123;</span> <span class="attr">radius</span> &#125; <span class="attr">stroke</span>=<span class="string">&#123;</span> `<span class="attr">rgba</span>(<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>,$&#123;<span class="attr">alpha</span>&#125;)` &#125; <span class="attr">fill</span>=<span class="string">"none"</span></span></div><div class="line">          <span class="attr">strokeWidth</span>=<span class="string">&#123;</span> <span class="attr">STROKE_WIDTH</span> &#125; <span class="attr">strokeDasharray</span>=<span class="string">&#123;</span> <span class="attr">circumference</span> &#125; <span class="attr">strokeDashoffset</span>=<span class="string">&#123;</span> <span class="attr">position</span> &#125; /&gt;</div><div class="line">      )</div><div class="line">    &#125;) &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<hr>
<p> å¿˜äº†ä»¶äº‹æƒ…,è¿”å›duck.jsæ–‡ä»¶,ä»configå¯¼å…¥MINIMUM_MS:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; MINIMUM_MS &#125; <span class="keyword">from</span> <span class="string">'config'</span></div></pre></td></tr></table></figure>
<hr>
<p> ç°åœ¨åœ¨delayå‡½æ•°è°ƒç”¨æ—¶ä½¿ç”¨<code>MINIMUM_MS</code>æ›¿æ¢<code>1000</code>.<br> æ—¶é’Ÿæ¯100mså°±ä¼šæ»´ç­”ä¸€ä¸‹:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="keyword">if</span> (type === <span class="string">'start-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">yield</span> delay(MINIMUM_MS)</div><div class="line">      <span class="keyword">yield</span> put(incrementMilliseconds())</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'rewind-clock'</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">yield</span> delay(MINIMUM_MS)</div><div class="line">      <span class="keyword">yield</span> put(decrementMilliseconds())</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p> çœ‹çœ‹åœ¨sagaä¸­æ§åˆ¶æµç¨‹çš„é€»è¾‘æœ‰å¤šå®¹æ˜“ï¼Ÿ</p>
<h2 id="ç»™ä½ çš„æ—¶é’Ÿä¸Šå‘æ¡"><a href="#ç»™ä½ çš„æ—¶é’Ÿä¸Šå‘æ¡" class="headerlink" title="ç»™ä½ çš„æ—¶é’Ÿä¸Šå‘æ¡"></a>ç»™ä½ çš„æ—¶é’Ÿä¸Šå‘æ¡</h2><p> ç°åœ¨ç»™è¿™æ®µä»£ç æ‹§å‘æ¡,<code>npm start</code>,æµè§ˆå™¨ä¸­æ‰“å¼€localhost:8080.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-a754703b38f36735.gif?imageMogr2/auto-orient/strip" alt="redux-saga-clock.gif"></p>
<p> è¿™æ˜¯ä¸€ä¸ªèƒ½æš‚åœ,æ¢å¤,å‘å‰,å‘åå’Œé‡ç½®.çœ‹ä¸Šå»ä¹Ÿå¾ˆé…·.</p>
<h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p> æ„Ÿè°¢é˜…è¯»è¿™ä¸ªæ•™ç¨‹,æˆ‘ä»¬æ¶‰åŠåˆ°äº†js generatorå’ŒRedux sagaçš„æœ‰å…³å†…å®¹.æˆ‘å¸Œæœ›èƒ½å¸®åŠ©ä½ ç†è§£æ€ä¹ˆä½¿ç”¨Redux Saga,åŒæ—¶è¿˜æœ‰ä½¿ç”¨çš„å¥½å¤„å’ŒèƒŒåçš„åˆç†æ€§.</p>
<p> å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„Redux Sagaçš„å†…å®¹,è¿™é‡Œè¿˜æœ‰ä¸€äº›å¾ˆå¥½çš„æ•™ç¨‹.ä¸‹é¢æ˜¯æˆ‘å¼€å§‹å­¦ä¹ redux sagaçš„æ—¶å€™å¸®åŠ©æˆ‘å…¥é—¨çš„å†…å®¹.</p>
<ul>
<li><a href="http://yelouafi.github.io/redux-saga/docs/introduction/BeginnerTutorial.html" target="_blank" rel="external">Reduxçš„å®˜æ–¹æ–‡æ¡£</a>æ˜¯æ— ä»·ä¹‹å®</li>
<li><a href="http://wecodetheweb.com/2016/01/23/handling-async-in-redux-with-sagas/" target="_blank" rel="external">Niels Gerritsenâ€™sçš„Redux Sagaå…¥é—¨æ•™ç¨‹</a>.è¿™æ˜¯æˆ‘æœ€å¼€å§‹å­¦ä¹ Redux sagaçš„æ•™ç¨‹ä¹‹ä¸€,ç»“æ„å¾ˆæ¸…æ™°,å¸®åŠ©æˆ‘è·¨å›½ä¸€äº›æ¦‚å¿µéšœç¢.</li>
<li><a href="http://joelhooks.com/blog/2016/03/20/build-an-image-gallery-using-redux-saga" target="_blank" rel="external">Joel Hooksçš„æ•™ç¨‹</a></li>
<li><a href="http://jaysoo.ca/2016/01/03/managing-processes-in-redux-using-sagas/" target="_blank" rel="external">Jack Hsuçš„æ–‡ç« </a>.æˆ‘çš„å®ä¾‹å®é™…æ˜¯è¿™ä¸ªæ•™ç¨‹çš„æ‰©å±•.</li>
</ul>
<p>æˆ‘ä¹Ÿå–œæ¬¢ä¸‹é¢çš„æ–‡ç« ,è§£å¯†generators,æ¿€åŠ±æˆ‘å†™è¿™ç¯‡æ–‡ç« ,æ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ç« ,æˆ‘éƒ½ä¸çŸ¥é“generatorsè®²çš„æ˜¯ä»€ä¹ˆç©æ„.</p>
<ul>
<li><a href="https://davidwalsh.name/es6-generators" target="_blank" rel="external">David Walshçš„åšå®¢,å…³äºES6 generatorçš„å†…å®¹,ä½œè€…æ˜¯kyle Simpson</a></li>
<li><a href="http://www.2ality.com/2015/03/es6-generators.html2ality" target="_blank" rel="external">Axel Rauschmeyerçš„ES6 generatorsçš„æ–‡ç« </a></li>
</ul>
<p>æ„Ÿè°¢é˜…è¯»!</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç¿»è¯‘ç‰ˆæœ¬ï¼Œ&lt;a href=&quot;http://ohyayanotherblog.ghost.io/redux-saga-finishing-the-clock-demo-app/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åŸæ–‡è¯·è§
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-Redux-Saga-helloï¼Œworld!</title>
    <link href="http://yoursite.com/2017/03/08/%E7%BF%BB%E8%AF%91-Redux-Saga-hello%EF%BC%8Cworld!/"/>
    <id>http://yoursite.com/2017/03/08/ç¿»è¯‘-Redux-Saga-helloï¼Œworld!/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:54:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>12 OCTOBER 2016</p>
<blockquote>
<p>è¿™æ˜¯ç¿»è¯‘ç‰ˆæœ¬,<a href="https://ohyayanotherblog.ghost.io/redux-saga-hello-world/" target="_blank" rel="external">åŸæ–‡è¯·è§</a></p>
</blockquote>
<hr>
<p><a href="http://www.jianshu.com/p/6f8678a6ad78" target="_blank" rel="external">ç¬¬ä¸€éƒ¨åˆ†è¯‘æ–‡è¯·è§</a>ï¼Œ<br><a href="http://www.jianshu.com/p/fad0136e77c0" target="_blank" rel="external">ç¬¬äºŒéƒ¨åˆ†è¯‘æ–‡è¯·è§</a>ï¼Œ<br><a href="http://www.jianshu.com/p/88fc4236b505" target="_blank" rel="external">ç¬¬ä¸‰éƒ¨åˆ†è¯‘æ–‡è¯·è§</a>.</p>
<hr>
<p>##ç®€å•çš„Redux Saga æ¨¡æ¿</p>
<p>åœ¨è¿™ä¸ªæ–‡ç« ä¸­,æˆ‘ä»¬å°†å®Œæˆå®Œæ•´çš„React/Redux/Redux Saga app,å¹¶ä¸”æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¦è¿™æ ·åš.</p>
<p>æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªappçš„æ¨¡æ¿ä½œä¸ºæœ¬æ–‡çš„èµ·ç‚¹,æˆ‘ä»¬æ²¡æœ‰å¿…è¦å…³æ³¨ä¸€äº›å¼€å‘çš„ç»†èŠ‚,å› ä¸ºè¿™äº›ç»†èŠ‚ä¸æ˜¯æœ¬ç³»åˆ—æ–‡ç« çš„é‡ç‚¹(æˆ‘å‡è®¾ä½ å·²ç»äº†è§£React,Reduxä»¥åŠä¸æ­¤ç›¸å…³çš„å¼€å‘å·¥å…·.)ä½†æ˜¯æˆ‘ä»ç„¶ä¼šç®€å•å¼ºè°ƒä¸€äº›å†…å®¹,ä»¥ä¾¿äºä½ å¯¹é¡¹ç›®ä¾èµ–åŒ…å’Œé…ç½®æœ‰ä¸€äº›åŸºç¡€çš„äº†è§£.ä½ å¯èƒ½æ˜¯ä¸ªé«˜æ‰‹,æˆ–è€…æ˜¯ä¸ªä¸æŠ˜ä¸æ‰£çš„èœé¸Ÿ(æ˜¯èœé¸Ÿä¹Ÿæ²¡æœ‰å…³ç³»)å¦‚æœä½ ä¸å…³å¿ƒè¿™äº›åŸºç¡€å†…å®¹,ç›´æ¥è·³åˆ°é‚£å‰¯å›¾ç‰‡,çœ‹çœ‹åé¢çš„å†…å®¹.</p>
<p>ç¬¬ä¸€æ­¥,å…‹éš†repo,å¹¶ä¸”å®‰è£…ä¾èµ–åŒ…:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//åŸæ–‡çš„repoä¸èƒ½è¿è¡Œäº†,ä¸‹é¢çš„repoæ˜¯éªŒè¯è¿‡çš„</span></div><div class="line">  git clone https:<span class="comment">//github.com/granmoe/redux-saga-clock-tutorial.git  </span></div><div class="line">cd redux-saga-clock-tutorial  </div><div class="line">npm i</div></pre></td></tr></table></figure></p>
<hr>
<p>å¥½äº†åšå®Œä¸Šé¢çš„å·¥ä½œ,ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€é¡¹ç›®,è®©æˆ‘ä»¬å…ˆçœ‹çœ‹é‡Œé¢æœ‰äº›ä»€ä¹ˆå†…å®¹.<br>åœ¨æˆ‘ä»¬çš„package.jsonæ–‡ä»¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯éå¸¸æ ‡å‡†çš„,ä½†æ˜¯è¦æ³¨æ„,å¦‚æœè¦å¯¹ä»˜ä¸æ”¯æŒES2015æ ‡ç –çš„æµè§ˆå™¨,éœ€è¦å¼•å…¥babel-polyfillåŒ….è¿™ä¸ªåŒ…å¿…é¡»åœ¨redux-sagaä¹‹å‰å¼•å…¥(è¯‘è€…:redux-sagaä½¿ç”¨äº†ES2015çš„æŠ€æœ¯ï¼Œæ‰€ä»¥è¦å…ˆè·å¾—æ”¯æŒæ‰å¯ä»¥).</p>
<p>ä½ ä¹Ÿå¯ä»¥æ³¨æ„åˆ°,åœ¨package.jsonä¸­æœ‰ESLintä¾èµ–åŒ…,å› ä¸ºæˆ‘å‘ç°è¿™ä¸ªä¾èµ–åŒ…æ˜¯å¼€å‘ä¸­çš„æ— ä»·ä¹‹å®.</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬çš„babelé…ç½®,åœ¨.babelrcæ–‡ä»¶ä¸­:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"><span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"react"</span>, <span class="string">"stage-2"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>æˆ‘å·²ç»å†³å®šä½¿ç”¨es2015,reactå’Œstage-2.</p>
<p>æˆ‘è¿˜æƒ³è®²è®².eslintrcæ–‡ä»¶,ä½†æ˜¯æˆ‘å®åœ¨æ˜¯ä¸æƒ³è®©ä½ çœ‹åˆ°æƒ³ç¡è§‰.</p>
<p>webpackå’Œindex.htmlæ–‡ä»¶æ²¡è®²,ä½†æ˜¯è¿™é‡Œä¼°è®¡æ²¡æœ‰äººä¼šå¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶æ„Ÿå…´è¶£.</p>
<p>#å¼€å§‹è¿›å…¥æ­£é¢˜å§<br><img src="http://upload-images.jianshu.io/upload_images/2044710-6a256c33dfea1ba8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/320" alt="patrick Stewart McKellan Elmo.jpg"><br> appçš„å…¥å£æ–‡ä»¶æ˜¯main.jsx:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">import</span> <span class="string">'babel-polyfill'</span> <span class="comment">// generator support  </span></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>  </div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>  </div><div class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'app.jsx'</span>  </div><div class="line"><span class="keyword">import</span> initStore <span class="keyword">from</span> <span class="string">'store'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> store = initStore()</div><div class="line"></div><div class="line">ReactDOM.render(  </div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;</span> <span class="attr">store</span> &#125;&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div></pre></td></tr></table></figure>
<hr>
<p> è¿™é‡Œæˆ‘ä»¬å¯¼å…¥ä¸€äº›ä¾èµ–é¡¹(åŒ…æ‹¬babel-polyfill),å¯¼å…¥æ ¹ç»„ä»¶,redux storeçš„é…ç½®,å®ä¾‹åŒ–store,ç„¶ååœ¨ç»è¿‡Provider classåŒ…è£…çš„â€appâ€divçš„ä¸­ä½¿ç”¨ReactDOMæ¸²æŸ“å‡ºæ ¹ç»„ä»¶,è¿™æ ·ä»¥æ¥,åœ¨appä¸­æ‰€æœ‰ç»„ä»¶æ ‘ç§çš„reactç»„ä»¶éƒ½å¯ä»¥å¾ˆå®¹æ˜“çš„æ¥å…¥åˆ°æˆ‘ä»¬çš„storeå®ä¾‹.</p>
<p> æŸ¥çœ‹store.js,ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨saga middlewareæ¥é…ç½®æˆ‘ä»¬çš„store:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</div><div class="line"></div><div class="line">  <span class="keyword">const</span> store = createStore(</div><div class="line">    rootReducer,</div><div class="line">    applyMiddleware(sagaMiddleware)</div><div class="line">  )</div><div class="line"></div><div class="line">  sagaMiddleware.run(rootSaga)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> store</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p> é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨<code>createSagaMiddleware</code>æ–¹æ³•æ¥åˆ›å»ºmiddlewareå®ä¾‹.æ¥ä¸‹æ¥,æŠŠæ ¹reducerå’Œmiddlewareä¼ é€’åˆ°<code>createStore</code>,è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªredux store.ç„¶åæŠŠæˆ‘ä»¬appçš„root sagaä¼ é€’è¿›saga middleware.è¿™ä¸€æ­¥ä¸€å®šè¦åœ¨redux storeå®ä¾‹åŒ–ä»¥åå†æ‰§è¡Œ.<code>rootSaga</code>æ˜¯é¡¶çº§generator,è¿™ä¸ªgeneratorè´Ÿè´£ä»£ç†å…¶ä»–æ‰€æœ‰çš„generatorsçš„å·¥ä½œ(é©¬ä¸Šä¼šçœ‹åˆ°.)</p>
<p> ##ä¸Šé¢éƒ½æ˜¯äº›ä»€ä¹ˆè§é¬¼çš„ä»£ç ,ä½ ä¸ªç‹å…«è›‹(è¯‘è€…:åŸæ„ç›´æ¥ç¿»è¯‘å•Š)<br> å…¶å®æˆ‘ä»¬å·²ç»æœ‰äº†æœ‰è¶£çš„ä¸œè¥¿,æˆ‘ä»¬çš„ä»£ç åŸºæœ¬ä¸Šä¾èµ–ä¸¤ä¸ªæ–‡ä»¶.â€app.jsxâ€æ˜¯ä¸€ä¸ªreactç»„ä»¶,å¯ä»¥æ ¹æ®appçš„stateå’ŒåŸºäºDOMäº‹ä»¶ç³»ç»Ÿçš„actionsæ¥è¿”å›æ¸²æŸ“çš„htmlæ ‡è®°.â€duck.jsâ€åŒ…å«å•çº¯å¯¹è±¡actionså’Œreducer,è¿™ä¸¤ä¸ªå‡½æ•°ä¸€èµ·å·¥ä½œæè¿°å‡ºæ€ä¹ˆä¿®æ”¹state.å…¶ä¸­ä¹ŸåŒ…å«äº†æ‰€æœ‰çš„æ§åˆ¶æµä»£ç ,æ§åˆ¶æµä»£ç æè¿°äº†æ•´ä¸ªappçš„å¤„ç†è¿‡ç¨‹.å¦‚æœä½ å¾ˆç†Ÿæ‚‰æ ‡å‡†çš„é¸­å­æ¨¡å‹,æˆ‘ä»…ä»…ä¿®æ”¹äº†é¸­å­æ¨¡å‹,è®©ä»–å¾ˆå®¹æ˜“åŒ…å«sagaä»£ç .è®©æˆ‘ä»¬ä½¿ç”¨é¸­å­æ¨¡å—æ¥å·¥ä½œå§.</p>
<p>  æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªå¯ä»¥æ§åˆ¶çš„æ—¶é’Ÿ.å¼€å§‹æ¥æƒ³æƒ³appéœ€è¦çš„æœ€ç²¾ç®€çš„sateç»“æ„.åœ¨ä»»ä½•æ—¶é—´æˆ‘ä»¬è¦è¯¢é—®appçš„çŠ¶æ€æ˜¯â€ç°åœ¨å‡ ç‚¹äº†ï¼Ÿâ€æ‰€æœ‰æˆ‘ä»¬éœ€è¦å­˜å‚¨çš„å°±æ˜¯å•ä¸ªçš„æ•°å­—.ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆæ”¹å˜è¿™ä¸ªçŠ¶æ€.å¥½çš„,æˆ‘ä»¬æˆ‘ä»¬å°†åˆ¶ä½œä¸€ä¸ªæ—¶é’Ÿ,ç”¨æˆ·å¯ä»¥å‘å‰,å‘å,æš‚åœå’Œé‡ç½®.è¿™é‡Œçš„æ„æƒ³æ„å‘³ç€æˆ‘ä»¬è¡¨å¾æ—¶é—´çš„ä»£ç é€»è¾‘éœ€è¦å¢,å‡,ä»€ä¹ˆä¹Ÿä¸åš,é‡ç½®åˆ°0.ä»€ä¹ˆäº‹ä¹Ÿä¸åšæ„å‘³ç€ä¸éœ€è¦sateå‘ç”Ÿæ”¹å˜,æ‰€ä»¥æˆ‘ä»¬ç•™ä¸‹å¢åŠ ,å‡å°‘,é‡ç½®.æˆ‘ä»¬è¦æ˜¾ç¤ºæ—¶é—´çš„æ¯«ç§’æ•°,å› æ­¤appçš„stateå°±å®šä¸ºâ€æ¯«ç§’æ•°â€.</p>
<p>  æ­£å¦‚ä¸Šé¢æ‰€è®²çš„,æˆ‘ä»¬åœ¨reduxä»£ç ä¸­ä½¿ç”¨é¸­å­æ¨¡å‹,å¦‚æœä½ ä¸å–œæ¬¢è¿™æ ·åš,å¯ä»¥åˆ†å‰²æˆä¸‰ä¸ªæ–‡ä»¶.<br>  è®©æˆ‘ä»¬çœ‹çœ‹duck.jsä¸­çš„ç¬¬ä¸€éƒ¨åˆ†,<code>saga actions</code>.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">import</span> &#123; takeLatest &#125; <span class="keyword">from</span> <span class="string">'redux-saga'</span></div><div class="line"><span class="keyword">const</span> initialState = &#123;  </div><div class="line">  <span class="attr">milliseconds</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">currentState = initialState, action</span>) </span>&#123;  </div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'reset-clock'</span>:</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...currentState,</div><div class="line">        <span class="attr">milliseconds</span>: <span class="number">0</span></div><div class="line">      &#125;</div><div class="line">    <span class="keyword">case</span> <span class="string">'increment-milliseconds'</span>:</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...currentState,</div><div class="line">        <span class="attr">milliseconds</span>: currentState.milliseconds + <span class="number">100</span></div><div class="line">      &#125;</div><div class="line">    <span class="keyword">case</span> <span class="string">'decrement-milliseconds'</span>:</div><div class="line">      <span class="keyword">if</span> (!currentState.milliseconds) &#123; <span class="keyword">return</span> currentState &#125;</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...currentState,</div><div class="line">        <span class="attr">milliseconds</span>: currentState.milliseconds - <span class="number">100</span></div><div class="line">      &#125;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> currentState</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> resetClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'reset-clock'</span> &#125;) </div><div class="line"> </div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementMilliseconds = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'increment-milliseconds'</span> &#125;)  </div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> decrementMilliseconds = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'decrement-milliseconds'</span> &#125;)</div></pre></td></tr></table></figure>
<hr>
<p> ä¸Šé¢è¿™æ®µä»£ç å¾ˆç®€å•.é¦–å…ˆç”±æˆ‘ä»¬éœ€æ±‚å­—æ®µçš„èµ·å§‹state,æ¥ç€æœ‰ä¸€ä¸ªreducer,reducerå®é™…ä¸Šæ“ä½œactions,å®ƒåŸºäºaction typeå¯¹stateåšå‡ºåˆé€‚çš„ä¿®é¥°,ä¹‹ååˆ›å»ºæ–°çš„stateã€‚æœ€åæˆ‘ä»¬export(æ¨¡å—æ¨¡å¼)ä¸€äº›å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨çš„<code>å•çº¯actionå¯¹è±¡</code>.(é©¬ä¸Šæˆ‘ä»¬ä¼šåœ¨sagaä¸­å¯¼å…¥actionå¯¹è±¡ä¹‹ä¸€).ç¤ºä¾‹ä»£ç æ€»æ˜¯è¿™ä¹ˆè¿™ä¹ˆçš„æ•´æ´.</p>
<p> ç°åœ¨æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸‹appçš„æµç¨‹.åœ¨å¤„ç†è¿‡ç¨‹ä¸­,ä»€ä¹ˆçŠ¶æ€éœ€è¦è¾“å…¥ï¼Ÿè¿™ä¸ªé—®é¢˜çš„å¦ä¸€ä¸ªé—®æ³•æ˜¯:appåœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´åº”è¯¥åšä»€ä¹ˆå·¥ä½œï¼Ÿæˆ‘ä»¬çš„æ—¶é’Ÿå¯ä»¥å‘å‰,å‘å,æš‚åœ.ä¸ºäº†åœ¨è¿™å‡ ä¸ªè¿‡ç¨‹ä¸­ç›¸äº’è½¬å˜,æˆ‘ä»¬éœ€è¦ä¸‰ä¸ªaction,å¼€å§‹æ—¶é’Ÿ,æ‹¨å›æ—¶é—´,æš‚åœæ—¶é’Ÿ.</p>
<p> ä»ä»£ç <code>//saga actions</code>å¼€å§‹,çœ‹çœ‹duckæ¨¡å—çš„å‰©ä½™éƒ¨åˆ†.æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸‰ä¸ªactions,æˆ‘ä»¬çš„root sagaåœ¨æ”¶åˆ°æŸä¸ªactionçš„æ—¶å€™,ä¼šå¯åŠ¨ä¸€ä¸ªå‚»ç“œå¤„ç†æµç¨‹.ç°åœ¨åœ¨ä»£ç é‡Œå‚»ç“œå¤„ç†æµç¨‹åªæ˜¯æ‰“å°ä¸€ä¸‹actionçš„åå­—.åç»­æˆ‘ä»¬ä¼šå¼€å§‹æ ¹æ®action typeå¤„ç†å…·ä½“çš„å¢,å‡,ä¼‘çœ æµç¨‹.è¿™é‡Œæ˜¯duck.jsçš„sagaä»£ç .</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// saga actions</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> startClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'start-clock'</span> &#125;)  </div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> pauseClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'pause-clock'</span> &#125;)  </div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> rewindClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'rewind-clock'</span> &#125;)</div><div class="line"></div><div class="line"><span class="comment">// saga</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">rootSaga</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">yield</span> takeLatest([<span class="string">'start-clock'</span>, <span class="string">'pause-clock'</span>, <span class="string">'rewind-clock'</span>], handleClockAction)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Pushed this action to handleClockAction: '</span>, type)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p> actions(ä¸¥æ ¼ä¸Šè®²,æ ¹æ®æœ¯è¯­æ¥è¯´åº”è¯¥æ˜¯å«â€œaction creatorsâ€,ä½†æ˜¯æ— æ‰€è°“,åªè¦ä½ ç†è§£å…·ä½“çš„æ„ä¹‰å°±å¯ä»¥)åº”è¯¥çœ‹èµ·æ¥å’Œå…¶ä»–çš„redux actionsç±»ä¼¼.ä½†æ˜¯è¿™äº›actionåœ¨æˆ‘ä»¬çš„reducerä¸­ä¸èƒ½å¾—åˆ°å¤„ç†.å¦‚æœä¿æŒä»…ä»…åœ¨sagaä»£ç é™„è¿‘ä¿ç•™è¿™äº›actions,è¿™é‡Œçš„acionsä»…ä»…è§¦å‘saga.åšåˆ°è¿™ä¸€ç‚¹,ä¼šé¿å…actionå’Œæ ¹æ®è¿™äº›actionåšå‡ºçš„stateä¿®æ”¹çš„ä»£ç æ··æ‚åœ¨ä¸€èµ·.æ˜¾è€Œæ˜“è§,saga actionä»ç„¶é€šè„±<code>connect</code>å‡½æ•°ç»‘å®šåˆ°storeå®ä¾‹,å¹¶ä¸”è¾“å…¥åˆ°ç»„ä»¶é‡Œ.</p>
<p> ç°åœ¨è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶é‡Œå¥‡æ€ªçš„saga.ä½ è¿˜è®°å¾—<code>rootSaga</code>è¢«ä¼ é€’åˆ°sagaä¸­é—´ä»¶,å¯¹å—ï¼Ÿå¦ç‡è®²,ä½ å¯èƒ½ä¹Ÿä¸çŸ¥é“,ä½†æ˜¯è¿™ä¹Ÿæ²¡å…³ç³».æ¯æ¬¡æˆ‘ä»¬å‘å‡ºä¸€ä¸ªaction,actionä¼šè¢«æ¨é€åˆ°ç»è¿‡<code>sagaMiddleware.run(generator)</code>åŒ…è£…çš„generator.è¿™å°±æ„å‘³ç€,æ¯ä¸ªgeneratoréƒ½æœ‰æœºä¼šå“åº”action,åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­,<code>rootSaga</code>é‡åˆ°åŒ¹é…çš„action typeçš„æ—¶å€™æ‰ä¼šåšå‡ºå“åº”.æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä»Redux Sagaè·å–çš„<code>takeLatest</code>åŠ©æ‰‹å‡½æ•°å®Œæˆè¿™ä¸ªå·¥ä½œ.<code>takeLatest</code>æ¥æ”¶ä»»ä½•ä¸action typeæ•°ç»„åŒ¹é…çš„action,ç„¶åæ¥ç€ä¼ é€’ä»–,å¯åŠ¨ä¸€ä¸ª<code>handleClockAcion</code>æµç¨‹,ä¼ é€’è¿›action.<code>takeLatest</code>æ„æ€æ˜¯ç›´æ¥æ”¶æœ€æ–°çš„actionï¼Œå¦‚æœç°åœ¨è¿˜æœ‰æ­£åœ¨è¿è¡Œçš„<code>handleClockAction</code>çš„è¯,åœ¨æ–°çš„actionå¼€å§‹ä¹‹å‰,å½“å‰çš„è¿™ä¸ªå¤„ç†æµç¨‹éœ€è¦å…ˆé€€å‡º.<code>handleClockAction</code>,æœ¬è´¨ä¸Šæ˜¯åœ¨åå°å¯åŠ¨,å…è®¸<code>rootSaga</code>ä¿æŒè¿è¡ŒçŠ¶æ€,å³ä½¿<code>handleClockAction</code>ä»åœ¨è¿è¡Œ,ä¹Ÿå¯ä»¥æ¥å—ä¸‹ä¸€ä¸ªåŒ¹é…çš„action.</p>
<p> æ³¨æ„æˆ‘ä»¬ä½¿ç”¨çš„<code>yield</code>å…³é”®è¯,å›æƒ³ä¸€ä¸‹,<code>yield</code>åœ¨generatorä¸­å‘å‡ºå’Œæ¥æ”¶å€¼.åœ¨ä»»ä½•æ—¶é—´,æˆ‘ä»¬<code>yield</code>ä¸€ä¸ªRedux SagaåŠ©æ‰‹æˆ–è€…effectçš„æ—¶å€™,æˆ‘ä»¬å°±æ­£åœ¨å’ŒSaga middlewareè¿›è¡Œé€šè®¯.åœ¨æˆ‘ä»¬çš„ä¸Šé¢çš„å®ä¾‹ä¸­,Redux Sagaç­‰å¾…åŒ¹é…å‘é€åˆ°sagaçš„action.åé¢æˆ‘ä»¬è¿˜ä¼šæ›´è¿›ä¸€æ­¥æ·±å…¥è®¨è®º.<br> æˆ‘å¸Œæœ›ä½ è‡³å°‘å¯¹è¿™ä¸ªæµç¨‹æœ‰ä¸€ç‚¹æ„Ÿè§‰.æˆ‘è®¤ä¸ºå¯èƒ½åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­(è¯‘è€…ï¼šè¿™é‡Œçš„æ„æ€æ˜¯å®é™…è¿è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œå¹¶ä¸æ˜¯ä»£ç çš„æµ‹è¯•è¿‡ç¨‹)ä½ å¯¹è¿™ä¸ªæµç¨‹æ›´æ¸…æ¥šä¸€ç‚¹.æ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹Reactç»„ä»¶ä¸­æ€ä¹ˆå’Œç”¨æˆ·è¿›è¡Œäº¤äº’çš„è¿‡ç¨‹.<br> åœ¨ç»„ä»¶è¿™ä¸€ç‚¹çœ‹,â€œapp.jsxâ€æ˜¯éå¸¸ç®€å•çš„reactç»„ä»¶.è®©æˆ‘ä»¬çœ‹ä¸ªä»”ç»†.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>  </div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; incrementMilliseconds, decrementMilliseconds, resetClock, startClock, pauseClock, rewindClock &#125; <span class="keyword">from</span> <span class="string">'duck'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;  </div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">const</span> &#123;</div><div class="line">      milliseconds,</div><div class="line">      incrementMilliseconds,</div><div class="line">      decrementMilliseconds,</div><div class="line">      resetClock,</div><div class="line">      startClock,</div><div class="line">      pauseClock,</div><div class="line">      rewindClock</div><div class="line">    &#125; = <span class="keyword">this</span>.props</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">incrementMilliseconds</span> &#125; <span class="attr">onDoubleClick</span>=<span class="string">&#123;</span> <span class="attr">resetClock</span> &#125; <span class="attr">onMouseLeave</span>=<span class="string">&#123;</span> <span class="attr">decrementMilliseconds</span> &#125;</span></div><div class="line">          <span class="attr">className</span>=<span class="string">"clock"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 100 100"</span> <span class="attr">width</span>=<span class="string">"500"</span>&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">&#123;</span> <span class="attr">30</span> &#125; <span class="attr">stroke</span>=<span class="string">&#123;</span> '<span class="attr">rgba</span>(<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>)' &#125; <span class="attr">fill</span>=<span class="string">"orange"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123; milliseconds &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">startClock</span> &#125;&gt;</span>Start Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">pauseClock</span> &#125;&gt;</span>Pause Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">rewindClock</span> &#125;&gt;</span>Rewind Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default connect(state =&gt; (&#123;  </div><div class="line">  milliseconds: state.milliseconds</div><div class="line">&#125;), (&#123;</div><div class="line">  incrementMilliseconds,</div><div class="line">  decrementMilliseconds,</div><div class="line">  resetClock,</div><div class="line">  startClock,</div><div class="line">  pauseClock,</div><div class="line">  rewindClock</div><div class="line">&#125;))(Clock)</div></pre></td></tr></table></figure>
<hr>
<p> é€šè¿‡ä½¿ç”¨connecté«˜å†…èšç»„ä»¶,æˆ‘ä»¬å¯ä»¥ä»storeçš„stateè·å–ä¸€ä¸ªå­—æ®µ,å¹¶ä½œä¸ºpropsä¼ é€’è¿›å…¥ç»„ä»¶.æˆ‘ä»¬ä¹Ÿé€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¼ é€’å››ä¸ªaction creators.ReduxæŠŠè¿™ä¸ªå¯¹è±¡ç»‘å®šåˆ°storeå®ä¾‹ä¸­,ç¡®ä¿æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­è°ƒç”¨è¿™å‡ ä¸ªactionçš„æ—¶å€™,ä»–ä»¬å¯ä»¥æ­£ç¡®çš„è¢«dispatch.<br>  åœ¨æˆ‘ä»¬çš„æ¸²æŸ“ä¸­,æˆ‘ä»¬è¿”å›ä¸€ä¸ª<code>&lt;div&gt;</code>,è¿™ä¸ªå…ƒç´ ä¸­æœ‰ä¸€ä¸ªSVG(åç»­ä¸­å°†ä¼šæ¯”è¾ƒå…³é”®).SVGæœ‰ä¸€äº›äº‹ä»¶æ“ä½œå¥æŸ„,è¿™äº›æ“ä½œå¥æŸ„å°†ä¼šdispatch stateä¿®é¥°actions.æ¥ä¸‹æ¥,ä¼šæœ‰ä¸€ä¸ª<code>&lt;p&gt;</code>å…ƒç´ ä¾æ®appçš„stateæ¥æ˜¾ç¤ºå½“å‰æ—¶é—´.æœ€åæˆ‘ä»¬æœ‰å‡ ä¸ª<code>&lt;button&gt;</code>s è¿æ¥åˆ°sagaçš„actions.<br>  ä¸Šé¢çš„ä»£ç éƒ½å°±ä½ä»¥å,æˆ‘ä»¬å°±è¯•ç€è¿è¡Œä¸€ä¸‹app,éªŒè¯ä¸€ä¸‹åŸºç¡€æ„æ¶å’Œactionsçš„å·¥ä½œæƒ…å†µ.</p>
<p>  ##åˆ°åº•èƒ½å·¥ä½œå—ï¼Ÿ<br>  å›åˆ°ä½ çš„ç»ˆç«¯,è¿è¡Œ<code>npm start</code>.ç°åœ¨è¾“å…¥localhost:8080,åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€devtools,æ£€æŸ¥ä¸€ä¸‹js ç»ˆç«¯.å½“ä½ ç‚¹å‡»buttonsçš„æ—¶å€™,ä¼šçœ‹åˆ°saga actionsçš„æ—¥å¿—è¾“å‡º.ç°åœ¨è¯•ç€åœ¨SVGä¸Šç‚¹å‡»,é¼ æ ‡ä¸€å®š,åŒå‡»action.ä½ å¯ä»¥çœ‹åˆ°æ¯«ç§’æ–‡æœ¬çš„æ›´æ–°.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-740c183a8fff53ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/480" alt="appçš„ç•Œé¢"></p>
<p>  çœŸå¥½å•Š,æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªRedux Saga appçš„æ¨¡æ¿ç»“æ„,äº†è§£äº†æ€ä¹ˆä½¿ç”¨<code>takeLatest</code>.è¿˜å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å‡ºä¸€äº›æ—¥å¿—ä¿¡æ¯.æ£’ï¼<br>  åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­,æˆ‘ä»¬ä¼šå®Œæˆæ•´ä¸ªæ—¶é’Ÿçš„å®æ–½,å¾—åˆ°ä¸€äº›éå¸¸é…·çš„å†…å®¹.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;12 OCTOBER 2016&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯ç¿»è¯‘ç‰ˆæœ¬,&lt;a href=&quot;https://ohyayanotherblog.ghost.io/redux-saga-hello-world/&quot; target=&quot;_blank&quot; rel=&quot;exter
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-ä½¿ç”¨Reselectæ”¹è¿›Reactå’ŒReduxç¨‹åºæ€§èƒ½</title>
    <link href="http://yoursite.com/2017/03/08/%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8Reselect%E6%94%B9%E8%BF%9BReact%E5%92%8CRedux%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/"/>
    <id>http://yoursite.com/2017/03/08/ç¿»è¯‘-ä½¿ç”¨Reselectæ”¹è¿›Reactå’ŒReduxç¨‹åºæ€§èƒ½/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:50:55.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><em>Written by Neil Fenton16 June 2016</em><br>  <a href="http://blog.rangle.io/react-and-redux-performance-with-reselect/" target="_blank" rel="external">åŸæ–‡è¯·è§</a></p>
</blockquote>
<p> <img src="https://ww2.sinaimg.cn/large/006tKfTcly1fdnldaaddyg31040g4747.gif" alt="å›¾1"></p>
<p>Reactå’ŒReduxç»„åˆæ˜¯éå¸¸æ£’çš„,å½“ä»–ä»¬ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨æ—¶,å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¨‹åºç»“æ„ä¸­åˆ†ç¦»å…³æ³¨ç‚¹.å³ä½¿Reactæ˜“ç”¨æ€§éå¸¸å¼º,ä½†æ˜¯æ€»ä¼šé‡åˆ°é«˜æ€§èƒ½éœ€æ±‚çš„æ—¶é—´.</p>
<p>åœ¨Reactä¸­æœ€æ˜‚è´µçš„æ“ä½œå°±æ˜¯æ¸²æŸ“å›è·¯.å½“ç»„ä»¶æ£€æµ‹åˆ°è¾“å…¥çš„å˜åŒ–,æ¸²æŸ“å›è·¯å°±ä¼šè¢«è§¦å‘(è¯‘æ³¨ï¼šè¿™é‡Œçš„æ„æ€çš„ç»„ä»¶çš„actionä¼šæ”¹å˜reduxçš„state,å˜å›æœ€ç»ˆåˆå›åˆ°ç»„ä»¶äº†).</p>
<p>å½“æˆ‘ä»¬åˆæ¬¡å¼€å§‹Reactç¨‹åºçš„æ—¶å€™,æˆ‘ä»¬ä¸ä¼šæ‹…å¿ƒæ¸²æŸ“å›è·¯çš„èŠ±é”€é—®é¢˜.ä½†æ˜¯å½“æˆ‘ä»¬çš„UIå˜å¾—å¤æ‚çš„æ—¶å€™,æˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™ä¸€ç‚¹.Reactæä¾›äº†ä¸€äº›å·¥å…·è®©æˆ‘ä»¬èƒ½åŠ«æŒæ¸²æŸ“å›è·¯,å¦‚æœæ¸²æŸ“çœ‹ä¸Šå»ä¸å¿…è¦,æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å·¥å…·æ¥é˜»æ­¢é‡æ¸²æŸ“çš„å‘ç”Ÿ.ä¸ºäº†è¿™ä¹ˆåš,æˆ‘ä»¬è¦æ•²å…¥<code>componentShouldUpdate</code>ç”Ÿå‘½å‘¨æœŸäº‹ä»¶,è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼,é€šçŸ¥ç»„ä»¶æ˜¯å¦åº”è¯¥è¿›è¡Œæ›´æ–°.è¿™æ˜¯ä»¥<code>PureRenderMixin</code>ä½œä¸ºåŸºç¡€,å®ƒæ¯”è¾ƒè¾“å…¥çš„propså’Œstateå’Œå…ˆå‰çš„propså’Œstate,å¦‚æœä¸¤è€…ç›¸ç­‰å°±è¿”å›false.</p>
<p> è¿™ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶å’ŒImmutableé›†åˆä¸€èµ·å¯ä»¥å®å®åœ¨åœ¨çš„æ”¹è¿›æ€§èƒ½,å› ä¸ºæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å†³å®šæ˜¯æ¸²æŸ“è¿˜æ˜¯ä¸æ¸²æŸ“ç»„ä»¶.<br> ä¸å¹¸çš„æ˜¯,ä»…æ­¤è€Œå·².</p>
<p> è€ƒè™‘åˆ°ç´§æ¥ç€çš„é—®é¢˜:æˆ‘ä»¬æ„å»ºä¸€ä¸ªè´­ç‰©è½¦,æœ‰ä¸‰ä¸ªè¾“å…¥ç±»å‹ï¼š</p>
<ul>
<li>è´­ç‰©è½¦é‡Œçš„è´§ç‰©</li>
<li>è´§ç‰©çš„æ•°é‡</li>
<li>ç›¸åº”çš„ç¨ç‡(åŸºäºå·æˆ–è€…çœ)</li>
</ul>
<p>é—®é¢˜æ˜¯æ— è®ºåªè¦è¾“å…¥çš„çŠ¶æ€ä¸€æ”¹å˜(æ–°è´§ç‰©åŠ å…¥,æ•°é‡çš„å˜åŒ–,é€‰æ‹©å·çš„å˜å“ˆ),æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½è¦è¢«é‡æ–°è®¡ç®—å’Œæ¸²æŸ“.å¦‚æœæˆ‘ä»¬çš„è´­ç‰©è½¦é‡Œæœ‰å‡ ç™¾ä¸ªä¸œè¥¿,ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹è¿™å°†ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ€§èƒ½é—®é¢˜.æ”¹å˜ç¨ç‡è‚¯èƒ½ä¼šè§¦å‘è´­ç‰©è½¦çš„é‡æ–°è®¡ç®—,ä½†æ˜¯æ˜¯ä¸åº”è¯¥å‘ç”Ÿçš„.ç¨ç‡çš„å˜åŒ–ä»…ä»…ä¼šå½±å“è¡ç”Ÿçš„æ•°æ®.ä»…ä»…æ€»æ•°,ç¨çš„æ€»æ•°åº”è¯¥å‘ç”Ÿå˜åŒ–,å¹¶ä¸”å‘ç”Ÿåç»§çš„æ›´æ–°.æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆä¿®å¤è¿™ä¸ªé—®é¢˜.(è¯‘æ³¨ï¼šè¿™æ®µçš„æ„æ€æ˜¯å¦‚æœç¨ç‡å˜åŒ–,åœ¨UIç»„ä»¶ä¸­æ˜¯ä¸åº”è¯¥å‘ç”Ÿæ¸²æŸ“çš„,åªæœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦å‘ç”Ÿå˜åŒ–)</p>
<h2 id="Reselectå‰æ¥æ•‘æ´"><a href="#Reselectå‰æ¥æ•‘æ´" class="headerlink" title="Reselectå‰æ¥æ•‘æ´"></a>Reselectå‰æ¥æ•‘æ´</h2><p>Reselectç”¨æ¥è®°å¿†selectorsçš„åº“.æˆ‘ä»¬å®šä¹‰çš„selectorsæ˜¯ä½œä¸ºå‡½æ•°è·å–Redux stateçš„æŸä¸€éƒ¨åˆ†.ä½¿ç”¨è®°å¿†èƒ½åŠ›,æˆ‘ä»¬å¯ä»¥ç»„ç»‡ä¸å¿…è¦çš„è¡ç”Ÿæ•°æ®çš„é‡æ¸²æŸ“å’Œè®¡ç®—è¿‡ç¨‹,ç”±æ­¤åŠ é€Ÿäº†æˆ‘ä»¬çš„app.</p>
<p>è€ƒè™‘ä¸‹é¢è¿™ä¸ªç¤ºä¾‹:<br><img src="https://ww4.sinaimg.cn/large/006tKfTcly1fdnmmp9vlrj30nr0we75c.jpg" alt=""></p>
<p>å¦‚æœæˆ‘ä»¬æœ‰å‡ ç™¾ç”šè‡³ä¸Šåƒä¸ªæ¡ç›®,æ¸²æŸ“è´­ç‰©è½¦ä¸­çš„æ‰€æœ‰é¡¹ç›®èŠ±è´¹ä¼šéå¸¸çš„å¤§,å³ä½¿æ˜¯ç¨ç‡çš„å˜åŒ–.ç”¨æˆ·æ¯ä¸€æ¬¡æœç´¢çš„ä»–çš„è´­ç‰©è½¦çš„æ—¶å€™,æˆ‘ä»¬æ˜¯å¦åº”è¯¥ä¸€éä¸€éçš„é‡è®¡ç®—ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®°å¿†æ€§çš„selectorsæ¥é˜»æ­¢æ˜‚è´µçš„è®¡ç®—è¿‡ç¨‹.ä½¿ç”¨è®°å¿†selectors,å¦‚æœReduxä¸­çš„stateçš„æ ‘å¾ˆå¤§,æˆ‘ä»¬ä¹Ÿä¸ç”¨æ‹…å¿ƒæ²¡åƒstateå˜åŒ–çš„è®¡ç®—é—®é¢˜.æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‰ç«¯å¢åŠ é¢å¤–çš„çµæ´»æ€§,æŠŠè¿™äº›selectorsåˆ†æ•£åˆ°å•ä¸ªçš„ç»„ä»¶ä¸­.</p>
<p>ç°åœ¨çœ‹çœ‹ä¸€ä¸ªä½¿ç”¨Reselectçš„ç®€å•selector:<br><img src="https://ww4.sinaimg.cn/large/006tKfTcly1fdnrzja9zgj30nk080q31.jpg" alt="selector using Reselect"></p>
<p> åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­,æˆ‘ä»¬æŠŠitemçš„è·å–å‡½æ•°åˆ†æˆä¸¤ä¸ªå‡½æ•°,ç¬¬ä¸€ä¸ªå‡½æ•°(ç¬¬3è¡Œ)ç®€å•çš„é¢è·å–è´­ç‰©è½¦ä¸­æ‰€æœ‰çš„items,ç¬¬äºŒä¸ªå‡½æ•°ä»£è¡¨ä¸€ä¸ªè®°å¿†æ€§selector.Reselectæš´éœ²äº†<code>createSelector</code>API,æˆ‘ä»¬å¯ä»¥å€Ÿæ­¤åˆ›å»ºä¸€ä¸ªè®°å¿†æ€§çš„selector.è¿™ä¸ªæ„æ€æ˜¯<code>getItemWithTotals</code>åœ¨ç¬¬ä¸€æ¬¡å‡½æ•°è¿è¡Œçš„æ—¶å€™å°†ä¼šè¿›è¡Œè¿ç®—.å¦‚æœåŒä¸€ä¸ªå‡½æ•°å†æ¬¡è¢«è°ƒç”¨,ä½†æ˜¯è¾“å…¥å€¼(<code>getItems</code>çš„å€¼)æ²¡æœ‰å˜åŒ–,å‡½æ•°å°†ä¼šè¿”å›ä¸€ä¸ªç¼“å­˜(cached)çš„è®¡ç®—ç»“æœ.å¦‚æœitemsè¢«ä¿®æ”¹äº†(ä¾‹å¦‚ï¼šitemæ·»åŠ ,æ•°é‡çš„å˜åŒ–,ä»»ä½•äº‹æƒ…æ“ä½œäº†<code>getItems</code>çš„ç»“æœ),å‡½æ•°å°†ä¼šå†æ¬¡æ‰§è¡Œ.</p>
<p> è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰åŠ›çš„æ¦‚å¿µ,å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªç»„ä»¶çš„stateéœ€è¦é‡è®¡ç®—çš„æ—¶å€™,å®Œå…¨çš„ä¼˜åŒ–åº”è¯¥è¢«æ¸²æŸ“çš„ç»„ä»¶.è¿™æ„å‘³ç€æˆ‘ä»¬ä¸åœ¨æ‹…å¿ƒ<code>getItems</code>å’Œåç»§çš„æ¯ä¸€æ¬¡ä¸­ä»·æ ¼çš„è®¡ç®—,ä½†æ“ä½œçš„æ—¶å€™,ä¸ä¼šå½±å“stateçš„æ‰§è¡Œ.</p>
<p> æˆ‘ä»¬ç»§ç»­è¿™ä¸ªæ–¹å¼æ¥åˆ›å»ºå››ä¸ªè¡ç”Ÿæ•°æ®çš„selectors.åŒ…æ‹¬å°è®¡,ç¨é¢æ€»è®¡å’Œæ€»ä»·æ ¼.<br> <img src="https://ww3.sinaimg.cn/large/006tKfTcly1fdnshe7qxtj30ng0es0t4.jpg" alt="å››ä¸ªselectors"></p>
<h2 id="ä½¿ç”¨selector"><a href="#ä½¿ç”¨selector" class="headerlink" title="ä½¿ç”¨selector"></a>ä½¿ç”¨selector</h2><p>  selectorsä»£ç å®Œæˆä»¥å,è®©æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆåœ¨ç»„ä»¶ä¸­ä½¿ç”¨<code>getItemWithTitals</code>selector:</p>
<p>  <img src="https://ww3.sinaimg.cn/large/006tKfTcly1fdnskl1pn9j30s8106gms.jpg" alt=""></p>
<p>   ç°åœ¨æˆ‘ä»¬æœ‰äº†æœ‰äº†ä¸€ä¸ªç»„ä»¶,ä»…ä»…æ„ŸçŸ¥è´­ç‰©è½¦ä¸­çš„items.è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å¼å› ä¸ºå®ƒå’Œæ€»è®¡å’Œå°è®¡æ²¡æœ‰ä»»ä½•å…³è”.ä»–ä¸æ˜¯å¯ä»¥é‡ç”¨çš„ç»„ä»¶,ä½†æ˜¯æ˜¯æ€§èƒ½éå¸¸å¥½çš„ç»„ä»¶.å’Œè¿™ä¸ªç»„ä»¶æ— å…³çš„å˜åŒ–ä¸ä¼šå¼•èµ·é¢å¤–çš„é‡æ¸²æŸ“.</p>
<p>   è¿™ä¸ªæ–¹å¼åº”ç”¨åˆ°å…¶ä»–çš„è´­ç‰©è½¦ä¸Šæ„å‘³ç€æˆ‘ä»¬å°†ä¼šæœ‰ä¸€ä¸ªç»„ä»¶è´Ÿè´£æ˜¾ç¤ºå°è®¡,æ€»è®¡å’Œç¨é¢è®¡ç®—.</p>
<p>   æ—©ä¸€ç‚¹åœ¨åº”ç”¨ä¸­ä½¿ç”¨è¿™äº›ä¼˜åŒ–æªæ–½æ„å‘³ç€æœªæ¥éœ€è¦ä¿®æ­£æ€§èƒ½é—®é¢˜çš„æ—¶å€™åšçš„å·¥ä½œå°±æ¯”è¾ƒå°‘.æˆ‘å»ºè®®å°½å¯èƒ½æ—©çš„ä½¿ç”¨reselect.åœ¨ç»„ä»¶ä¹‹å¤–ä½¿ç”¨Selectorsæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å®¹æ˜“çš„æµ‹è¯•è¿™äº›æ•°æ®è¡ç”Ÿè®¡ç®—.åœ¨Reduxä¸­ä½¿ç”¨ç®€å•çš„æ¨¡æ‹Ÿæ•°æ®,åŸºäºæä¾›çš„æ•°æ®æµ‹è¯•æœŸå¾…çš„è¾“å‡ºç»“æœ.</p>
<p> è¿›ä¸€æ­¥äº†è§£è¿™äº›æ¦‚å¿µ,å‚è€ƒ<a href="https://github.com/neilff/react-redux-performance" target="_blank" rel="external">demo</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Written by Neil Fenton16 June 2016&lt;/em&gt;&lt;br&gt;  &lt;a href=&quot;http://blog.rangle.io/react-and-redux-performance-with-reselect/&quot; 
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-å¼€å¯React,Reduxå’ŒImmutableä¹‹æ—…-æµ‹è¯•é©±åŠ¨æ•™ç¨‹(part2)</title>
    <link href="http://yoursite.com/2017/03/08/%E7%BF%BB%E8%AF%91-%E5%BC%80%E5%90%AFReact,Redux%E5%92%8CImmutable%E4%B9%8B%E6%97%85-%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E6%95%99%E7%A8%8B(part2)/"/>
    <id>http://yoursite.com/2017/03/08/ç¿»è¯‘-å¼€å¯React,Reduxå’ŒImmutableä¹‹æ—…-æµ‹è¯•é©±åŠ¨æ•™ç¨‹(part2)/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:47:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¿»è¯‘ç‰ˆæœ¬,<a href="http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-2/" target="_blank" rel="external">åŸæ–‡è¯·è§</a></p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fds4960hm8j30xc0b4weu.jpg" alt="Imageç”±[egghead.ioæä¾›](http://egghead.io/)"></p>
<p>è¿™æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„å†…å®¹.</p>
<p>åœ¨ç¬¬ä¸€éƒ¨åˆ†,æˆ‘ä»¬ç½—åˆ—äº†appçš„UI,å¼€å‘å’Œå•å…ƒæµ‹è¯•çš„åŸºç¡€.</p>
<p>æˆ‘ä»¬çœ‹åˆ°äº†appçš„stateé€šè¿‡Reactçš„<code>props</code>å‘ä¸‹ä¼ é€’åˆ°å•ä¸ªçš„ç»„ä»¶,ç”¨æˆ·çš„actionså£°æ˜ä¸ºå›è°ƒå‡½æ•°,å› æ­¤appçš„é€»è¾‘å’ŒUIåˆ†ç¦»å¼€æ¥äº†.</p>
<h2 id="Reduxçš„å·¥ä½œæµä»‹ç»"><a href="#Reduxçš„å·¥ä½œæµä»‹ç»" class="headerlink" title="Reduxçš„å·¥ä½œæµä»‹ç»"></a>Reduxçš„å·¥ä½œæµä»‹ç»</h2><p>åœ¨è¿™ä¸€ç‚¹ä¸Š,æˆ‘ä»¬çš„UIæ˜¯æ²¡æœ‰äº¤äº’æ“ä½œçš„:å°½ç®¡æˆ‘ä»¬å·²ç»æµ‹è¯•äº†å¦‚æœä¸€ä¸ªitemå¦‚æœè¢«è®¾å®šä¸º<code>completed</code>,å®ƒå°†ç»™æ–‡æœ¬åˆ’çº¿,ä½†æ˜¯è¿™é‡Œè¿˜æ²¡æœ‰æ–¹æ³•é‚€è¯·ç”¨æˆ·æ¥å®Œæˆå®ƒ:</p>
<ol>
<li>state treeé€šè¿‡<code>props</code>å®šä¹‰äº†UIå’Œactionå›è°ƒå‡½æ•°.</li>
<li>ç”¨æˆ·çš„actions,ä¾‹å¦‚ç‚¹å‡»,è¢«å‘é€åˆ°action creator,actionè¢«å®ƒèŒƒå¼åŒ–.</li>
<li>redux actionè¢«ä¼ é€’åˆ°reducerå®ç°å®é™…çš„appé€»è¾‘</li>
<li>reduceræ›´æ–°state tree,dispatch stateåˆ°store.</li>
<li>UIæ ¹æ®storeé‡Œçš„æ–°state treeæ¥æ›´æ–°UI</li>
</ol>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fdua9bq152j30f10870sn.jpg" alt="Redux working flos"></p>
<h2 id="è®¾å®šåˆå§‹åŒ–state"><a href="#è®¾å®šåˆå§‹åŒ–state" class="headerlink" title="è®¾å®šåˆå§‹åŒ–state"></a>è®¾å®šåˆå§‹åŒ–state</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/be48d4d610b3438aeb1dfcd07d317b3c72fbdb3e" target="_blank" rel="external">è¿™éƒ¨åˆ†çš„ä»£ç æäº¤åœ¨è¿™é‡Œ</a></p>
<p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªactionå°†ä¼šå…è®¸æˆ‘ä»¬åœ¨Redux storeé‡Œæ­£ç¡®çš„è®¾ç½®åˆå§‹åŒ–state<br>,æˆ‘ä»¬å°†ä¼šåˆ›å»ºstore.</p>
<p>Reduxä¸­çš„actionæ˜¯ä¸€ä¸ªä¿¡æ¯çš„è½½ä½“(payload).actionç”±ä¸€ä¸ªJSONå¯¹è±¡æœ‰ä¸€ä¸ª<code>type</code>å±æ€§,æè¿°actionåˆ°åº•æ˜¯åšä»€ä¹ˆçš„,è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯appéœ€è¦çš„ä¿¡æ¯.åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­,typeè¢«è®¾å®šä¸º<code>SET_STATE</code>,æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªstateå¯¹è±¡åŒ…å«éœ€è¦çš„state:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attribute">type</span>: <span class="string">'SET_STATE'</span>,</div><div class="line">  <span class="attribute">state</span>: &#123;</div><div class="line">    <span class="attribute">todos</span>: [</div><div class="line">      &#123;<span class="attribute">id</span>: <span class="number">1</span>, <span class="attribute">text</span>: <span class="string">'React'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>, <span class="attribute">editing</span>: false&#125;,</div><div class="line">      &#123;<span class="attribute">id</span>: <span class="number">2</span>, <span class="attribute">text</span>: <span class="string">'Redux'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>, <span class="attribute">editing</span>: false&#125;,</div><div class="line">      &#123;<span class="attribute">id</span>: <span class="number">3</span>, <span class="attribute">text</span>: <span class="string">'Immutable'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>, <span class="attribute">editing</span>: false&#125;,</div><div class="line">    ],</div><div class="line">    <span class="attribute">filter</span>: <span class="string">'all'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªactionä¼šè¢«dispatchåˆ°ä¸€ä¸ªreducer,reducerè§’è‰²çš„æ˜¯è¯†åˆ«å’Œå®æ–½å’Œactionå¯¹åº”çš„é€»è¾‘ä»£ç .</p>
<p>è®©æˆ‘ä»¬ä¸ºreduceræ¥å†™å•å…ƒæµ‹è¯•ä»£ç <br><code>test/reducer_spec.js</code><br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> <span class="title">import</span> &#123;List, <span class="built_in">Map</span>, fromJS&#125; from <span class="string">'immutable'</span>;</div><div class="line"><span class="title">import</span> &#123;expect&#125; from <span class="string">'chai'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> reducer from <span class="string">'../src/reducer'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line"></div><div class="line">  it(<span class="string">'handles SET_STATE'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = <span class="built_in">Map</span>();</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attribute">type</span>: <span class="string">'SET_STATE'</span>,</div><div class="line">      <span class="attribute">state</span>: <span class="built_in">Map</span>(&#123;</div><div class="line">        <span class="attribute">todos</span>: List.of(</div><div class="line">          <span class="built_in">Map</span>(&#123;<span class="attribute">id:</span><span class="string"> 1, text</span>: <span class="string">'React'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">          <span class="built_in">Map</span>(&#123;<span class="attribute">id:</span><span class="string"> 2, text</span>: <span class="string">'Redux'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">          <span class="built_in">Map</span>(&#123;<span class="attribute">id:</span><span class="string"> 3, text</span>: <span class="string">'Immutable'</span>, <span class="attribute">status</span>: <span class="string">'completed'</span>&#125;)</div><div class="line">        )</div><div class="line">      &#125;)</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line"></div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attribute">todos</span>: [</div><div class="line">        &#123;<span class="attribute">id:</span><span class="string"> 1, text</span>: <span class="string">'React'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attribute">id:</span><span class="string"> 2, text</span>: <span class="string">'Redux'</span>, <span class="attribute">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attribute">id:</span><span class="string"> 3, text</span>: <span class="string">'Immutable'</span>, <span class="attribute">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†æ–¹ä¾¿ä¸€ç‚¹,<code>state</code>ä½¿ç”¨å•çº¯JSå¯¹è±¡,è€Œä¸æ˜¯ä½¿ç”¨Immutableæ•°æ®ç»“æ„.è®©æˆ‘ä»¬çš„reduceræ¥å¤„ç†è½¬å˜.æœ€å,reducerå°†ä¼šä¼˜é›…çš„å¤„ç†<code>undefined</code>åˆå§‹åŒ–state:<br><code>test/reducer_spec.js</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles SET_STATE with plain JS payload'</span>, () =&gt; &#123;</div><div class="line">    const initialState = Map();</div><div class="line">    const action = &#123;</div><div class="line"><span class="symbol">      type:</span> <span class="string">'SET_STATE'</span>,</div><div class="line"><span class="symbol">      state:</span> &#123;</div><div class="line"><span class="symbol">        todos:</span> [</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">    const nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line"><span class="symbol">      todos:</span> [</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles SET_STATE without initial state'</span>, () =&gt; &#123;</div><div class="line">    const action = &#123;</div><div class="line"><span class="symbol">      type:</span> <span class="string">'SET_STATE'</span>,</div><div class="line"><span class="symbol">      state:</span> &#123;</div><div class="line"><span class="symbol">        todos:</span> [</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">          &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">    const nextState = reducer(undefined, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line"><span class="symbol">      todos:</span> [</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">1</span>, <span class="string">text:</span> <span class="string">'React'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">2</span>, <span class="string">text:</span> <span class="string">'Redux'</span>, <span class="string">status:</span> <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="string">id:</span> <span class="number">3</span>, <span class="string">text:</span> <span class="string">'Immutable'</span>, <span class="string">status:</span> <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬çš„reducerå°†ä¼šåŒ¹é…æ¥æ”¶çš„actionsçš„<code>type</code>,å¦‚æœtypeæ˜¯<code>SET_STATE</code>,å½“å‰çš„stateå’Œactionè¿è½½çš„stateèåˆåœ¨ä¸€èµ·:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;<span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">state, newState</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.merge(newState);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SET_STATE'</span>:</div><div class="line">      <span class="keyword">return</span> setState(state, action.state);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬ä¸å¾—ä¸æŠŠreducerè¿æ¥åˆ°æˆ‘ä»¬çš„app,æ‰€ä»¥å½“appå¯åŠ¨åˆå§‹åŒ–state.è¿™é‡Œå®é™…æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨Reduxåº“,å®‰è£…ä¸€ä¸‹<br><code>npm install â€”save redux@3.3.1 react-redux@4.4.1</code></p>
<p><code>src/index.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123;List, <span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> &#123;Provider&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</div><div class="line"><span class="keyword">import</span> &#123;TodoAppContainer&#125; <span class="keyword">from</span> <span class="string">'./components/TodoApp'</span>;</div><div class="line"></div><div class="line"><span class="comment">// We instantiate a new Redux store</span></div><div class="line"><span class="keyword">const</span> store = createStore(reducer);</div><div class="line"><span class="comment">// We dispatch the SET_STATE action holding the desired state</span></div><div class="line">store.dispatch(&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'SET_STATE'</span>,</div><div class="line">  <span class="attr">state</span>: &#123;</div><div class="line">    <span class="attr">todos</span>: [</div><div class="line">      &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">    ],</div><div class="line">    <span class="attr">filter</span>: <span class="string">'all'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">require</span>(<span class="string">'../node_modules/todomvc-app-css/index.css'</span>);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="comment">// We wrap our app in a Provider component to pass the store down to the components</span></div><div class="line">  &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">TodoAppContainer</span> /&gt;</span></span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ çœ‹çœ‹ä¸Šé¢çš„ä»£ç æ®µ,ä½ å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬çš„<code>TodoApp</code>ç»„ä»¶å®é™…æ˜¯è¢«<code>TodoAppContainer</code>ä»£æ›¿.åœ¨Reduxé‡Œ,æœ‰ä¸¤ç§ç±»å‹çš„ç»„ä»¶:å±•ç¤ºç»„ä»¶å’Œå®¹å™¨.æˆ‘æ¨èä½ é˜…è¯»ä¸€ä¸‹ç”±Dan Abramov(Reduxçš„ä½œè€…)å†™ä½œçš„<a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.e5z2vws8e" target="_blank" rel="external">é«˜ä¿¡æ¯é‡çš„æ–‡ç« </a>,å¼ºè°ƒäº†å±•ç¤ºç»„ä»¶å’Œå®¹å™¨çš„å·®å¼‚æ€§.</p>
<p>å¦‚æœæˆ‘æƒ³æ€»ç»“å¾—å¿«ä¸€ç‚¹,æˆ‘å°†å¼•ç”¨<a href="http://redux.js.org/docs/basics/UsageWithReact.html" target="_blank" rel="external">Redux æ–‡æ¡£</a>çš„å†…å®¹ï¼š</p>
<p>â€œå±•ç¤ºç»„ä»¶æ˜¯å…³äºäº‹ä»¶çš„æ ·å­(æ¨¡æ¿å’Œæ ·å¼),å®¹å™¨ç»„ä»¶æ˜¯å…³äºäº‹æƒ…æ˜¯æ€ä¹ˆå·¥ä½œçš„(æ•°æ®è·å–,stateæ›´æ–°)â€.</p>
<p>æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºstore,ä¼ é€’ç»™<code>TodoAppContainer</code>.ç„¶è€Œä¸ºäº†å­ç»„ä»¶å¯ä»¥ä½¿ç”¨store,æˆ‘ä»¬æŠŠstateæ˜ å°„æˆä¸ºReactç»„ä»¶<code>TodoApp</code>çš„<code>props</code>.<br><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line"><span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">todos</span>: state.get(<span class="string">'todos'</span>),</div><div class="line">    <span class="attr">filter</span>: state.get(<span class="string">'filter'</span>)</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> TodoAppContainer = connect(mapStateToProps)(TodoApp);</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­é‡æ–°åŠ è½½app,ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°å®ƒåˆå§‹åŒ–å’Œä¹‹å‰ä¸€æ ·,ä¸è¿‡ç°åœ¨ä½¿ç”¨Redux tools.</p>
<h2 id="Redux-dev-å·¥å…·"><a href="#Redux-dev-å·¥å…·" class="headerlink" title="Redux dev å·¥å…·"></a>Redux dev å·¥å…·</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/9e82a2bf7ffaea5d0fda6af361a126517aecc115" target="_blank" rel="external">è¿™ä¸€éƒ¨åˆ†çš„æäº¤ä»£ç </a></p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»é…ç½®äº†redux storeå’Œreducer.æˆ‘ä»¬å¯ä»¥é…ç½®Redux dev toolsæ¥å±•ç°æ•°æ®æµå¼€å‘.</p>
<p>é¦–å…ˆ,è·å–<a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd" target="_blank" rel="external">Redux dev tools Chrome extension</a></p>
<p>dev toolså¯ä»¥åœ¨Storeåˆ›å»ºçš„æ—¶å€™å¯ä»¥åŠ è½½.</p>
<p><code>src/index.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">import</span> &#123;compose, createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> createStoreDevTools = compose(</div><div class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span> f</div><div class="line">)(createStore);</div><div class="line"><span class="keyword">const</span> store = createStoreDevTools(reducer);</div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure></p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1fdubya02s9j31cy0v6dgk.jpg" alt="Redux dev tools"></p>
<p>é‡æ–°åŠ è½½app,ç‚¹å‡»Reduxå›¾æ ‡,æœ‰äº†.</p>
<p>æœ‰ä¸‰ä¸ªä¸åŒçš„ç›‘è§†å™¨å¯ä»¥ä½¿ç”¨:Diffç›‘è§†å™¨,æ—¥å¿—ç›‘è§†å™¨,Sliderç›‘è§†å™¨.</p>
<h2 id="ä½¿ç”¨Action-Creatorsé…ç½®æˆ‘ä»¬çš„actions"><a href="#ä½¿ç”¨Action-Creatorsé…ç½®æˆ‘ä»¬çš„actions" class="headerlink" title="ä½¿ç”¨Action Creatorsé…ç½®æˆ‘ä»¬çš„actions"></a>ä½¿ç”¨Action Creatorsé…ç½®æˆ‘ä»¬çš„actions</h2><p>åˆ‡æ¢itemçš„ä¸åŒçŠ¶æ€.</p>
<p><a href="https://github.com/phacks/redux-todomvc/commit/7a2dc0963684b569c11f92e41a324324dfb21bdc" target="_blank" rel="external">è¿™éƒ¨åˆ†çš„æäº¤ä»£ç åœ¨è¿™é‡Œ</a></p>
<p>ä¸‹ä¸€æ­¥æ˜¯å…è®¸ç”¨æˆ·åœ¨<code>active</code>å’Œ<code>completed</code>ä¹‹å‰åˆ‡æ¢çŠ¶æ€ï¼š<br><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> &#123;List, <span class="built_in">Map</span>, fromJS&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'../src/reducer'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line"><span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles TOGGLE_COMPLETE by changing the status from active to completed'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'TOGGLE_COMPLETE'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles TOGGLE_COMPLETE by changing the status from completed to active'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'TOGGLE_COMPLETE'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">3</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†é€šè¿‡è¿™äº›æµ‹è¯•,æˆ‘ä»¬æ›´æ–°reducer:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleComplete</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="comment">// We find the index associated with the itemId</span></div><div class="line">  <span class="keyword">const</span> itemIndex = state.get(<span class="string">'todos'</span>).findIndex(</div><div class="line">    <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'id'</span>) === itemId</div><div class="line">  );</div><div class="line">  <span class="comment">// We update the todo at this index</span></div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .update(<span class="string">'status'</span>, status =&gt; status === <span class="string">'active'</span> ? <span class="string">'completed'</span> : <span class="string">'active'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// We update the state to account for the modified todo</span></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SET_STATE'</span>:</div><div class="line">      <span class="keyword">return</span> setState(state, action.state);</div><div class="line">    <span class="keyword">case</span> <span class="string">'TOGGLE_COMPLETE'</span>:</div><div class="line">      <span class="keyword">return</span> toggleComplete(state, action.itemId);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å’Œ<code>SET_STATE</code>çš„actionåŒä¸€ä¸ªåœ°æ–¹,æˆ‘ä»¬éœ€è¦è®©<code>TodoAppContainer</code>ç»„ä»¶æ„ŸçŸ¥åˆ°action,æ‰€ä»¥<code>toggleComplete</code>å›è°ƒå‡½æ•°ä¼šè¢«ä¼ é€’åˆ°<code>TodoItem</code>ç»„ä»¶(å®é™…è°ƒç”¨å‡½æ•°çš„åœ°æ–¹).</p>
<p>åœ¨Reduxä¸­,æœ‰æ ‡å‡†çš„æ–¹æ³•æ¥åšè¿™ä»¶äº‹ï¼šAction Creators.</p>
<p>action creatorsæ˜¯ç®€å•çš„å‡½æ•°,è¿”å›åˆé€‚çš„actionï¼Œè¿™äº›éŸ©å¼æ˜¯Reactçš„<code>props</code>çš„ä¸€äº›æ˜ å°„ä¹‹ä¸€.<br>è®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªaction creator:<br><code>src/action_creators.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toggleComplete</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'TOGGLE_COMPLETE'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨,å°½ç®¡<code>TodoAppcontainer</code>ç»„ä»¶ä¸­çš„<code>connect</code>å‡½æ•°çš„è°ƒç”¨å¯ä»¥ç”¨æ¥è·å–store,æˆ‘ä»¬å‘Šè¯‰ç»„ä»¶ä½¿ç”¨æ˜ å°„<code>props</code>çš„å›è°ƒå‡½æ•°:<br><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'../action_creators'</span>;</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      // ...</div><div class="line">        // We use the spread operator for better lisibility</div><div class="line">        <span class="tag">&lt;<span class="name">TodoList</span>  &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></div><div class="line">      // ...</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">export const TodoAppContainer = connect(mapStateToProps, actionCreators)(TodoApp);</div></pre></td></tr></table></figure></p>
<p>é‡å¯ä½ çš„webserver,åˆ·æ–°ä¸€ä¸‹ä½ çš„æµè§ˆå™¨:å½“å½“.åœ¨æ¡ç›®ä¸Šç‚¹å‡»ç°åœ¨å¯ä»¥åˆ‡æ¢å®ƒçš„çŠ¶æ€.å¦‚æœä½ æŸ¥çœ‹Redux dev tools,ä½ å¯ä»¥çœ‹åˆ°è§¦å‘çš„actionå’Œåç»§çš„æ›´æ–°.</p>
<h2 id="æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨"><a href="#æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨" class="headerlink" title="æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨"></a>æ”¹å˜ç›®å‰çš„è¿‡æ»¤å™¨</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/3949d4f38912e4b6b8e60fc4c553614d4076028c" target="_blank" rel="external">ç›¸å…³ä»£ç åœ¨åœ¨è¿™é‡Œ</a></p>
<p>ç°åœ¨æ¯ä»¶äº‹æƒ…éƒ½å·²ç»é…ç½®å®Œæ¯•,å†™å…¶ä»–çš„actionæ˜¯ä»¶å°äº‹.æˆ‘ä»¬ç»§ç»­åˆ›å»ºä½ å¸Œæœ›çš„<code>CHANGE_FILTER</code>action,æ”¹å˜å½“å‰stateçš„filter,ç”±æ­¤ä»…ä»…æ˜¾ç¤ºè¿‡æ»¤è¿‡çš„æ¡ç›®.<br>å¼€å§‹åˆ›å»ºaction creatorï¼š<br><code>src/action_creators.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">changeFilter</span>(<span class="params">filter</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'CHANGE_FILTER'</span>,</div><div class="line">    filter</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨å†™reducerçš„å•å…ƒæµ‹è¯•:<br><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles CHANGE_FILTER by changing the filter'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ],</div><div class="line">      <span class="attr">filter</span>: <span class="string">'all'</span></div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'CHANGE_FILTER'</span>,</div><div class="line">      <span class="attr">filter</span>: <span class="string">'active'</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ],</div><div class="line">      <span class="attr">filter</span>: <span class="string">'active'</span></div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>å…³è”çš„reducerå‡½æ•°:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeFilter</span>(<span class="params">state, filter</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.set(<span class="string">'filter'</span>, filter);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SET_STATE'</span>:</div><div class="line">      <span class="keyword">return</span> setState(state, action.state);</div><div class="line">    <span class="keyword">case</span> <span class="string">'TOGGLE_COMPLETE'</span>:</div><div class="line">      <span class="keyword">return</span> toggleComplete(state, action.itemId);</div><div class="line">    <span class="keyword">case</span> <span class="string">'CHANGE_FILTER'</span>:</div><div class="line">      <span class="keyword">return</span> changeFilter(state, action.filter);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æœ€åæˆ‘ä»¬æŠŠ<code>changeFilter</code>å›è°ƒå‡½æ•°ä¼ é€’ç»™<code>TodoTools</code>ç»„ä»¶:<br><code>TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"todoapp"</span>&gt;</span></div><div class="line">        // ...</div><div class="line">        <span class="tag">&lt;<span class="name">TodoTools</span> <span class="attr">changeFilter</span>=<span class="string">&#123;this.props.changeFilter&#125;</span></span></div><div class="line">                   <span class="attr">filter</span>=<span class="string">&#123;this.props.filter&#125;</span></div><div class="line">                   <span class="attr">nbActiveItems</span>=<span class="string">&#123;this.getNbActiveItems()&#125;</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Footer</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å®Œæˆäº†,ç¬¬ä¸€ä¸ªfilter selectorå·¥ä½œå®Œç¾</p>
<h2 id="Itemç¼–è¾‘"><a href="#Itemç¼–è¾‘" class="headerlink" title="Itemç¼–è¾‘"></a>Itemç¼–è¾‘</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/2a7b1138f778524d4aa7eac193c995258d28c5a3" target="_blank" rel="external">ä»£ç åœ¨è¿™é‡Œ</a><br> å½“ç”¨æˆ·ç¼–è¾‘ä¸€ä¸ªæ¡ç›®,å®é™…ä¸Šæ˜¯ä¸¤ä¸ªactionsè§¦å‘çš„ä¸‰ä¸ªå¯èƒ½æ€§:</p>
<ul>
<li>ç”¨æˆ·è¾“å…¥ç¼–è¾‘æ¨¡å¼:<code>EDIT_ITEM</code></li>
<li>ç”¨æˆ·é€€å‡ºç¼–è¾‘æ¨¡å¼(ä¸ä¿å­˜å˜åŒ–):<code>CANCEL_EDITING</code></li>
<li>ç”¨æˆ·éªŒè¯ä»–çš„ç¼–è¾‘(ä¿å­˜å˜åŒ–):<code>DONE_EDITING</code></li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä¸ºä¸‰ä¸ªactionsç¼–å†™action creatorsï¼š<br><code>src/action_creators.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">editItem</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'EDIT_ITEM'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">cancelEditing</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'CANCEL_EDITING'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">doneEditing</span>(<span class="params">itemId, newText</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'DONE_EDITING'</span>,</div><div class="line">    itemId,</div><div class="line">    newText</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨ä¸ºè¿™äº›actionsç¼–å†™å•å…ƒæµ‹è¯•:<br><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles EDIT_ITEM by setting editing to true'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'EDIT_ITEM'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">true</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles CANCEL_EDITING by setting editing to false'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">true</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'CANCEL_EDITING'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles DONE_EDITING by setting by updating the text'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">true</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'DONE_EDITING'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">1</span>,</div><div class="line">      <span class="attr">newText</span>: <span class="string">'Redux'</span>,</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å‘reducerå‡½æ•°,å®é™…æ“ä½œä¸‰ä¸ªactions:<br><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">findItemIndex</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.get(<span class="string">'todos'</span>).findIndex(</div><div class="line">    <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'id'</span>) === itemId</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// We can refactor the toggleComplete function to use findItemIndex</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleComplete</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .update(<span class="string">'status'</span>, status =&gt; status === <span class="string">'active'</span> ? <span class="string">'completed'</span> : <span class="string">'active'</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">editItem</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .set(<span class="string">'editing'</span>, <span class="literal">true</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cancelEditing</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .set(<span class="string">'editing'</span>, <span class="literal">false</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doneEditing</span>(<span class="params">state, itemId, newText</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemIndex = findItemIndex(state, itemId);</div><div class="line">  <span class="keyword">const</span> updatedItem = state.get(<span class="string">'todos'</span>)</div><div class="line">    .get(itemIndex)</div><div class="line">    .set(<span class="string">'editing'</span>, <span class="literal">false</span>)</div><div class="line">    .set(<span class="string">'text'</span>, newText);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, todos =&gt; todos.set(itemIndex, updatedItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'EDIT_ITEM'</span>:</div><div class="line">      <span class="keyword">return</span> editItem(state, action.itemId);</div><div class="line">    <span class="keyword">case</span> <span class="string">'CANCEL_EDITING'</span>:</div><div class="line">      <span class="keyword">return</span> cancelEditing(state, action.itemId);</div><div class="line">    <span class="keyword">case</span> <span class="string">'DONE_EDITING'</span>:</div><div class="line">      <span class="keyword">return</span> doneEditing(state, action.itemId, action.newText);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="æ¸…é™¤å®Œæˆ-æ·»åŠ å’Œåˆ é™¤æ¡ç›®"><a href="#æ¸…é™¤å®Œæˆ-æ·»åŠ å’Œåˆ é™¤æ¡ç›®" class="headerlink" title="æ¸…é™¤å®Œæˆ,æ·»åŠ å’Œåˆ é™¤æ¡ç›®"></a>æ¸…é™¤å®Œæˆ,æ·»åŠ å’Œåˆ é™¤æ¡ç›®</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/c89059a6767903fdf8b9827209f92e1f7385bdb7" target="_blank" rel="external">ä»£ç åœ¨è¿™é‡Œ</a></p>
<p>ä¸‰ä¸ªå‰©ä¸‹çš„actionæ˜¯:</p>
<ol>
<li><code>CLEAR_COMPLETED</code>,åœ¨<code>TodoTools</code>ç»„ä»¶ä¸­è§¦å‘,ä»åˆ—è¡¨ä¸­æ¸…é™¤å®Œæˆçš„æ¡ç›®</li>
<li><code>ADD_ITEM</code>,åœ¨<code>TodoHeader</code>ä¸­è§¦å‘,æ ¹æ®ç”¨æˆ·çš„çš„è¾“å…¥æ–‡æœ¬æ¥æ·»åŠ æ¡ç›®</li>
<li><code>DELETE_ITEM</code>,ç›¸ä¼¼<code>TodoItem</code>ä¸­è°ƒç”¨,åˆ é™¤ä¸€ä¸ªæ¡ç›®</li>
</ol>
<p>æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„å·¥ä½œæµæ˜¯:æ·»åŠ action creators,å•å…ƒæµ‹è¯•reducerå’Œä»£ç é€»è¾‘,æœ€ç»ˆé€šè¿‡propsä¼ é€’å›è°ƒå‡½æ•°:<br><code>src/action_creators.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">clearCompleted</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'CLEAR_COMPLETED'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'ADD_ITEM'</span>,</div><div class="line">    text</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteItem</span>(<span class="params">itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'DELETE_ITEM'</span>,</div><div class="line">    itemId</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>test/reducer_spec.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'reducer'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'handles CLEAR_COMPLETED by removing all the completed items'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'CLEAR_COMPLETED'</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles ADD_ITEM by adding the item'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'ADD_ITEM'</span>,</div><div class="line">      <span class="attr">text</span>: <span class="string">'Redux'</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'handles DELETE_ITEM by removing the item'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> initialState = fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">const</span> action = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'DELETE_ITEM'</span>,</div><div class="line">      <span class="attr">itemId</span>: <span class="number">2</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> nextState = reducer(initialState, action);</div><div class="line">    expect(nextState).to.equal(fromJS(&#123;</div><div class="line">      <span class="attr">todos</span>: [</div><div class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;,</div><div class="line">      ]</div><div class="line">    &#125;));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><code>src/reducer.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearCompleted</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>,</div><div class="line">    (todos) =&gt; todos.filterNot(</div><div class="line">      <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'status'</span>) === <span class="string">'completed'</span></div><div class="line">    )</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">state, text</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> itemId = state.get(<span class="string">'todos'</span>).reduce(<span class="function">(<span class="params">maxId, item</span>) =&gt;</span> <span class="built_in">Math</span>.max(maxId,item.get(<span class="string">'id'</span>)), <span class="number">0</span>) + <span class="number">1</span>;</div><div class="line">  <span class="keyword">const</span> newItem = <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: itemId, <span class="attr">text</span>: text, <span class="attr">status</span>: <span class="string">'active'</span>&#125;);</div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>, (todos) =&gt; todos.push(newItem));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteItem</span>(<span class="params">state, itemId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> state.update(<span class="string">'todos'</span>,</div><div class="line">    (todos) =&gt; todos.filterNot(</div><div class="line">      <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'id'</span>) === itemId</div><div class="line">    )</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">state = Map(</span>), <span class="title">action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'CLEAR_COMPLETED'</span>:</div><div class="line">      <span class="keyword">return</span> clearCompleted(state);</div><div class="line">    <span class="keyword">case</span> <span class="string">'ADD_ITEM'</span>:</div><div class="line">      <span class="keyword">return</span> addItem(state, action.text);</div><div class="line">    <span class="keyword">case</span> <span class="string">'DELETE_ITEM'</span>:</div><div class="line">      <span class="keyword">return</span> deleteItem(state, action.itemId);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> state;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;div&gt;</div><div class="line">      &lt;section className="todoapp"&gt;</div><div class="line">        // We pass down the addItem callback</div><div class="line">        &lt;TodoHeader addItem=&#123;this.props.addItem&#125;/&gt;</div><div class="line">        &lt;TodoList &#123;...this.props&#125; /&gt;</div><div class="line">        // We pass down the clearCompleted callback</div><div class="line">        &lt;TodoTools changeFilter=&#123;this.props.changeFilter&#125;</div><div class="line">                    filter=&#123;this.props.filter&#125;</div><div class="line">                    nbActiveItems=&#123;this.getNbActiveItems()&#125;</div><div class="line">                    clearCompleted=&#123;this.props.clearCompleted&#125;/&gt;</div><div class="line">      &lt;/section&gt;</div><div class="line">      &lt;Footer /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬çš„TodoMVC appç°åœ¨å®Œæˆäº†.</p>
<h2 id="åŒ…è£…èµ·æ¥"><a href="#åŒ…è£…èµ·æ¥" class="headerlink" title="åŒ…è£…èµ·æ¥"></a>åŒ…è£…èµ·æ¥</h2><p>è¿™æˆ‘ä»¬çš„æµ‹è¯•é©±åŠ¨çš„React,Redux&amp;Immutable æŠ€æœ¯æ ˆ</p>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå†…å®¹,æœ‰æ›´å¤šçš„äº‹æƒ…ç­‰ç€ä½ å»æŒ–æ˜<br>ä¾‹å¦‚:</p>
<ul>
<li><a href="https://github.com/reactjs/react-router-redux" target="_blank" rel="external">React Redux router</a>åˆ›å»ºå®Œå…¨çš„å•é¡µé¢åº”ç”¨</li>
<li>æ˜¯ç”±Reduxåœ¨åå°åŒæ„Redux,çœ‹è¿™<a href="http://teropa.info/blog/2015/09/10/full-stack-redux-tutorial.html" target="_blank" rel="external">1æ•™ç¨‹</a>,<a href="https://blog.diacode.com/trello-clone-with-phoenix-and-react-pt-1" target="_blank" rel="external">2æ•™ç¨‹</a></li>
<li><a href="https://github.com/Ghirro/gambit" target="_blank" rel="external">Gambie</a>,ç®€å•çš„åŒ…è£…å™¨ç®€åŒ–åˆ°APIçš„è¿æ¥</li>
<li><a href="https://egghead.io/series/getting-started-with-redux" target="_blank" rel="external">ç³»åˆ—è§†é¢‘</a>,ä½œè€…æ˜¯Dan Abramov(Reduxçš„åˆ›å»ºè€…)</li>
<li>Redux <a href="http://redux.js.org/docs/introduction/Ecosystem.html" target="_blank" rel="external">ç½‘ç«™ä¸Šæ›´å¤šçš„å†…å®¹</a>!</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¿»è¯‘ç‰ˆæœ¬,&lt;a href=&quot;http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-2/&quot; target=&quot;_b
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-å¼€å¯React,Reduxå’ŒImmutableä¹‹æ—…-æµ‹è¯•é©±åŠ¨æ•™ç¨‹(part1)</title>
    <link href="http://yoursite.com/2017/03/08/%E7%BF%BB%E8%AF%91-%E5%BC%80%E5%90%AFReact,Redux%E5%92%8CImmutable%E4%B9%8B%E6%97%85-%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E6%95%99%E7%A8%8B(part1)/"/>
    <id>http://yoursite.com/2017/03/08/ç¿»è¯‘-å¼€å¯React,Reduxå’ŒImmutableä¹‹æ—…-æµ‹è¯•é©±åŠ¨æ•™ç¨‹(part1)/</id>
    <published>2017-03-08T00:04:10.000Z</published>
    <updated>2017-03-23T08:46:26.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ç¿»è¯‘ç‰ˆæœ¬,<a href="http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-1/" target="_blank" rel="external">åŸæ–‡è¯·è§,ç¬¬ä¸€éƒ¨åˆ†</a>,<a href="http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-2/" target="_blank" rel="external">ç¬¬äºŒéƒ¨åˆ†</a></p>
</blockquote>
<p><img src="http://www.theodo.fr/uploads/blog//2016/03/course_banner.png" alt="Image æä¾›ï¼š[egghead.io](http://egghead.io/)"></p>
<p>å‡ å‘¨ä»¥å‰,æˆ‘æ­£åœ¨æ¼«æ— ç›®çš„çš„æµè§ˆ<a href="http://news.ycombinator.com/" target="_blank" rel="external">Hacker News</a>,è¯»åˆ°ä¸€ç¯‡å…³äºReduxçš„å¤´æ¡æ–°é—»,Reduxçš„å†…å®¹æˆ‘æ˜¯äº†è§£,ä½†æ˜¯å¦ä¸€ä¸ªè°ˆåˆ°çš„é—®é¢˜<code>javascript fatigue</code>(JavaScript ç–²åŠ³)å·²ç»å›°æ‰°æˆ‘äº†,æ‰€ä»¥æˆ‘æ²¡æœ‰å¤ªå…³å¿ƒ,çŸ¥é“è¯»åˆ°Reduxçš„å‡ ä¸ªç‰¹å¾.</p>
<ul>
<li>å¼ºåŒ–äº†å‡½æ•°å¼ç¼–ç¨‹,ç¡®ä¿appè¡Œä¸ºçš„å¯é¢„æµ‹æ€§</li>
<li>å…è®¸appçš„åŒæ„,å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å¤§å¤šæ•°é€»è¾‘éƒ½å¯ä»¥å…±äº«</li>
<li>æ—¶é—´æ—…è¡Œçš„debugger?æœ‰å¯èƒ½å—ï¼Ÿ</li>
</ul>
<p>Reduxä¼¼ä¹æ˜¯Reactç¨‹åºstateç®¡ç†çš„ä¼˜é›…æ–¹æ³•,å†è€…è°è¯´çš„æ—¶é—´æ—…è¡Œä¸å¯èƒ½ï¼Ÿæ‰€ä»¥æˆ‘è¯»äº†<a href="http://news.ycombinator.com/" target="_blank" rel="external">æ–‡æ¡£</a>å’Œä¸€ç¯‡éå¸¸ç²¾å½©çš„æ•™ç¨‹<a href="http://teropa.info/blog/2015/09/10/full-stack-redux-tutorial.html" target="_blank" rel="external">@teropa:A Comprehensive Guide to Test-First Development with Redux,React,and Immutable</a>(è¿™ä¸€ç¯‡ä¹Ÿæ˜¯æˆ‘å†™ä½œçš„ä¸»è¦çµæ„Ÿæ¥æº).</p>
<p>æˆ‘å–œæ¬¢Redux,ä»£ç éå¸¸ä¼˜é›…,debuggerä»¤äººç–¯ç‹‚çš„ä¼Ÿå¤§.æˆ‘çš„æ„æ€æ˜¯-çœ‹çœ‹è¿™ä¸ª<img src="http://upload-images.jianshu.io/upload_images/2044710-b8baec21ab99e70b.gif?imageMogr2/auto-orient/strip" alt="todo-action"></p>
<p>æ¥ä¸‹æ¥çš„æ•™ç¨‹ç¬¬ä¸€éƒ¨åˆ†å¸Œæœ›å¼•å¯¼ä½ ç†è§£Reduxè¿è¡Œçš„åŸåˆ™.æ•™ç¨‹çš„ç›®çš„ä»…é™äº(å®¢æˆ·ç«¯,æ²¡æœ‰åŒæ„,æ˜¯æ¯”è¾ƒç®€å•çš„app)ä¿æŒæ•™ç¨‹çš„ç®€æ˜æ‰¼è¦.å¦‚æœä½ æƒ³å‘æ˜çš„æ›´æ·±ä¸€ç‚¹,æˆ‘ä»…å»ºè®®ä½ é˜…è¯»ä¸Šé¢æé«˜çš„é‚£ä¸ªæ•™ç¨‹.å¯¹æ¯”ç‰ˆçš„Github repoåœ¨<a href="https://github.com/phacks/redux-todomvc" target="_blank" rel="external">è¿™é‡Œ</a>,å…±äº«ä»£ç è´´åˆæ•™ç¨‹çš„æ­¥éª¤.å¦‚æœä½ å¯¹ä»£ç æˆ–è€…æ•™ç¨‹æœ‰ä»»ä½•é—®é¢˜å’Œå»ºè®®,æœ€å¥½èƒ½ç•™ä¸‹ç•™è¨€.</p>
<p>ç¼–è¾‘æŒ‰:æ–‡ç« å·²ç»æ›´æ–°ä¸ºES2015ç‰ˆçš„å¥æ³•.</p>
<h2 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h2><p>ä¸ºäº†ç¬¦åˆæ•™ç¨‹çš„ç›®çš„,æˆ‘ä»¬å°†å»ºä¸€ä¸ªç»å…¸çš„<a href="http://todomvc.com/" target="_blank" rel="external">TodoMVC</a>,ä¸ºäº†è®°å½•éœ€è¦,éœ€æ±‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¯ä¸€ä¸ªtodoå¯ä»¥æ¿€æ´»æˆ–è€…å®Œæˆ</li>
<li>å¯ä»¥æ·»åŠ ,ç¼–è¾‘,åˆ é™¤ä¸€ä¸ªtodo</li>
<li>å¯ä»¥æ ¹æ®å®ƒçš„statusæ¥è¿‡æ»¤ç­›é€‰todos</li>
<li>æ¿€æ´»çš„todosçš„æ•°ç›®æ˜¾ç¤ºåœ¨åº•éƒ¨</li>
<li>å®Œæˆçš„Todoç†è§£å¯ä»¥åˆ é™¤</li>
</ul>
<h2 id="Reuduxå’ŒImmutableï¼šä½¿ç”¨å‡½æ•°ç¼–ç¨‹å»è¥æ•‘"><a href="#Reuduxå’ŒImmutableï¼šä½¿ç”¨å‡½æ•°ç¼–ç¨‹å»è¥æ•‘" class="headerlink" title="Reuduxå’ŒImmutableï¼šä½¿ç”¨å‡½æ•°ç¼–ç¨‹å»è¥æ•‘"></a>Reuduxå’ŒImmutableï¼šä½¿ç”¨å‡½æ•°ç¼–ç¨‹å»è¥æ•‘</h2><p>å›åˆ°å‡ ä¸ªæœˆå‰,æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªwebappåŒ…å«ä»ªè¡¨æ¿. éšç€appçš„æˆé•¿,æˆ‘ä»¬æ³¨æ„åˆ°è¶Šæ¥è¶Šå¤šçš„æœ‰å®³çš„bugs,è—åœ¨ä»£ç è§’è½é‡Œ,å¾ˆéš¾å‘ç°.ç±»ä¼¼:â€œå¦‚æœä½ è¦å¯¼èˆªåˆ°è¿™ä¸€é¡µ,ç‚¹å‡»æŒ‰é’®,ç„¶åå›åˆ°ä¸»é¡µ,å–ä¸€æ¯å’–å•¡,å›åˆ°è¿™ä¸€é¡µç„¶åç‚¹å‡»ä¸¤æ¬¡,å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿäº†.â€è¿™äº›bugçš„æ¥æºè¦ä¹ˆæ˜¯å¼‚æ­¥æ“ä½œ(side effects)æˆ–è€…é€»è¾‘:ä¸€ä¸ªactionå¯èƒ½åœ¨appä¸­æœ‰æ„æƒ³ä¸åˆ°çš„å½±å“,è¿™ä¸ªæœ‰æ—¶å€™æˆ‘ä»¬è¿˜å‘ç°ä¸äº†.</p>
<p>è¿™å°±æ˜¯Reduxä¹‹æ‰€ä»¥å­˜åœ¨çš„å¨åŠ›:æ•´ä¸ªappçš„stateæ˜¯ä¸€ä¸ªå•ä¸€çš„æ•°æ®ç»“æ„,state tree.è¿™ä¸€ç‚¹æ„æ€æ˜¯è¯´ï¼šåœ¨ä»»ä½•æ—¶åˆ»,å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹ä»…ä»…æ˜¯state treeç»“æœ,è¿™å°±æ˜¯å•ä¸€æ¥æºçš„çœŸç›¸(ç”¨æˆ·ç•Œé¢çš„æ˜¾ç¤ºå†…å®¹æ˜¯ç”±state treeæ¥å†³å®šçš„).æ¯ä¸€ä¸ªactionæ¥æ”¶state,åº”ç”¨ç›¸åº”çš„ä¿®æ”¹(ä¾‹å¦‚,æ·»åŠ ä¸€ä¸ªtodo),è¾“å‡ºæ›´æ–°çš„state tree.æ›´æ–°çš„ç»“æœæ¸²æŸ“å±•ç¤ºç»™ç”¨æˆ·.é‡Œé¢æ²¡æœ‰æ¨¡ç³Šçš„å¼‚æ­¥æ“ä½œ,æ²¡æœ‰å˜é‡çš„å¼•ç”¨å¼•èµ·çš„ä¸ç»æ„çš„ä¿®æ”¹.è¿™ä¸ªæ­¥éª¤ä½¿å¾—appæœ‰äº†æ›´å¥½çš„ç»“æ„,åˆ†ç¦»å…³æ³¨ç‚¹,dubuggingä¹Ÿæ›´å¥½ç”¨äº†.</p>
<p><a href="https://facebook.github.io/immutable-js" target="_blank" rel="external"><em>Immutable</em></a>æ˜¯æœ‰Facebookå¼€å‘çš„åŠ©æ‰‹å‡½æ•°åº“,æä¾›ä¸€äº›å·¥å…·å»åˆ›å»ºå’Œæ“ä½œimmutableæ•°æ®ç»“æ„.å°½ç®¡åœ¨Reduxä¹Ÿä¸æ˜¯ä¸€å®šè¦ä½¿ç”¨å®ƒ,ä½†æ˜¯å®ƒé€šè¿‡ç¦æ­¢å¯¹è±¡çš„ä¿®æ”¹,å¼ºåŒ–äº†å‡½æ•°å¼ç¼–ç¨‹æ–¹æ³•.æœ‰äº†immutable,å½“æˆ‘ä»¬æƒ³æ›´æ–°ä¸€ä¸ªå¯¹è±¡,å®é™…ä¸Šæˆ‘ä»¬ä¿®æ”¹çš„æ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„çš„å¯¹è±¡,åŸå…ˆçš„å¯¹è±¡ä¿æŒä¸å˜.</p>
<p>è¿™é‡Œæ˜¯â€œ<a href="https://facebook.github.io/immutable-js" target="_blank" rel="external">Immutableæ–‡æ¡£</a>â€é‡Œé¢çš„ä¾‹å­:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line"><span class="keyword">var</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">2</span>);</div><div class="line">assert(map1 === map2); <span class="comment">// no change</span></div><div class="line"><span class="keyword">var</span> map3 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);</div><div class="line">assert(map1 !== map3); <span class="comment">// change</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ›´æ–°äº†<code>map1</code>çš„ä¸€ä¸ªå€¼,<code>map1</code>å¯¹è±¡ä¿æŒä¸å˜,ä¸€ä¸ªæ–°çš„å¯¹è±¡<code>map3</code>è¢«åˆ›å»ºäº†.</p>
<p>Immutableåœ¨storeä¸­è¢«ç”¨æ¥å‚¨å­˜æˆ‘ä»¬çš„appçš„state tree.å¾ˆå¿«æˆ‘ä»¬ä¼šçœ‹åˆ°Immutableæä¾›äº†ä¸€ä¸‹æ“ä½œå¯¹è±¡çš„ç®€å•å’Œæœ‰æ•ˆçš„æ–¹æ³•.</p>
<h2 id="é…ç½®é¡¹ç›®"><a href="#é…ç½®é¡¹ç›®" class="headerlink" title="é…ç½®é¡¹ç›®"></a>é…ç½®é¡¹ç›®</h2><p>å£°æ˜:ä¸€äº›é…ç½®æœ‰@teropsçš„æ•™ç¨‹å¯å‘.</p>
<p>æ³¨æ„äº‹é¡¹:æ¨èä½¿ç”¨Node.js&gt;=4.0.0.ä½ å¯ä»¥ä½¿ç”¨nvm(node version manager)æ¥åˆ‡æ¢ä¸åŒçš„node.jsçš„ç‰ˆæœ¬.</p>
<p><a href="https://github.com/phacks/redux-todomvc/commit/9e2d23ca16980566d9fcaeebbf198031ec55d42f" target="_blank" rel="external">è¿™é‡Œæ˜¯æ¯”è¾ƒç‰ˆæœ¬çš„æäº¤</a></p>
<p>å¼€å§‹é…ç½®é¡¹ç›®:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">mkdir</span> redux-todomvc</div><div class="line"><span class="keyword">cd</span> redux-todomvc</div><div class="line">npm init -<span class="built_in">y</span></div></pre></td></tr></table></figure>
<p>é¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">â”œâ”€â”€ dist</div><div class="line">â”‚   â”œâ”€â”€ bundle<span class="selector-class">.js</span></div><div class="line">â”‚   â””â”€â”€ index<span class="selector-class">.html</span></div><div class="line">â”œâ”€â”€ node_modules</div><div class="line">â”œâ”€â”€ package<span class="selector-class">.json</span></div><div class="line">â”œâ”€â”€ src</div><div class="line">â”œâ”€â”€ test</div><div class="line">â””â”€â”€ webpack<span class="selector-class">.config</span><span class="selector-class">.js</span></div></pre></td></tr></table></figure>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„HTMLé¡µé¢,ç”¨æ¥è¿è¡Œæˆ‘ä»¬çš„app<br><code>dist/index.html</code><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>React TodoMVC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>æœ‰äº†è¿™ä¸ªæ–‡ä»¶,æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„è„šæœ¬æ–‡ä»¶çœ‹çœ‹åŒ…å®‰è£…çš„æƒ…å†µ<br><code>src/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="string">'Hello world !'</span>);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†ä¼šä½¿ç”¨[Webpack]æ¥æ‰“åŒ…æˆä¸º<code>bundle.js</code>æ–‡ä»¶.Webpackçš„ç‰¹æ€§æ˜¯é€Ÿåº¦,å®¹æ˜“é…ç½®,å¤§éƒ¨åˆ†æ˜¯çƒ­æ›´æ–°çš„.ä»£ç çš„æ›´æ–°ä¸éœ€è¦é‡æ–°åŠ è½½,æ„å‘³ç€appçš„stateä¿æŒçƒ­åŠ è½½.</p>
<p>è®©æˆ‘ä»¬å®‰è£…webpack:</p>
<p><code>npm install â€”save-dev webpack@1.12.14 webpack-dev-server@1.14.1</code></p>
<p>appä½¿ç”¨ES2015çš„è¯­æ³•,å¸¦æ¥ä¸€äº›ä¼˜å¼‚çš„ç‰¹æ€§å’Œä¸€äº›è¯­æ³•ç³–.å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„ES2015å†…å®¹,è¿™ä¸ª<a href="https://github.com/DrkSephy/es6-cheatsheet" target="_blank" rel="external">recap</a>æ˜¯ä¸€ä¸ªä¸é”™çš„èµ„æº.</p>
<p>Babelç”¨æ¥æŠŠES2015çš„è¯­æ³•æ”¹å˜ä¸ºæ™®é€šçš„JSè¯­æ³•:<br><code>npm install â€”save-dev babel-core@6.5.2 babel-loader@6.2.4 babel-preset-es2015@6.5.0</code></p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨JSXè¯­æ³•ç¼–å†™Reactç»„ä»¶,æ‰€ä»¥è®©æˆ‘ä»¬å®‰è£…Babel React packageï¼š<br><code>npm install â€”save-dev babel-preset-react@6.5.0</code></p>
<p>é…ç½®webpackè¾“å‡ºæºæ–‡ä»¶:<br><code>package.json</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="string">"babel"</span>: &#123;</div><div class="line">  <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"react"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"> <span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">entry</span>: [</div><div class="line">    <span class="string">'./src/index.js'</span></div><div class="line">  ],</div><div class="line">  <span class="attr">module</span>: &#123;</div><div class="line">    <span class="attr">loaders</span>: [&#123;</div><div class="line">      <span class="attr">test</span>: <span class="regexp">/\.jsx?$/</span>,</div><div class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">      <span class="attr">loader</span>: <span class="string">'babel'</span></div><div class="line">    &#125;]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">resolve</span>: &#123;</div><div class="line">    <span class="attr">extensions</span>: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.jsx'</span>]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: __dirname + <span class="string">'/dist'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'/'</span>,</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.js'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">devServer</span>: &#123;</div><div class="line">    <span class="attr">contentBase</span>: <span class="string">'./dist'</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ç°åœ¨æ·»åŠ Reactå’ŒReactçƒ­åŠ è½½ç»„ä»¶åˆ°é¡¹ç›®ä¸­:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install --save react@0.14.7 react-dom@0.14.7</div><div class="line">npm install --save-dev react-hot-loader@1.3.0</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†è®©çƒ­åŠ è½½èƒ½è¿è¡Œ,webpack.config.jsæ–‡ä»¶ä¸­è¦åšä¸€äº›ä¿®æ”¹.</p>
<p><code>webpack.config.js</code><br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>); <span class="comment">// Requiring the webpack lib</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  entry: [</div><div class="line">    <span class="string">'webpack-dev-server/client?http://localhost:8080'</span>, <span class="comment">// Setting the URL for the hot reload</span></div><div class="line">    <span class="string">'webpack/hot/only-dev-server'</span>, <span class="comment">// Reload only the dev server</span></div><div class="line">    <span class="string">'./src/index.js'</span></div><div class="line">  ],</div><div class="line">  <span class="keyword">module</span>: &#123;</div><div class="line">    loaders: [&#123;</div><div class="line">      test: <span class="regexp">/\.jsx?$/</span>,</div><div class="line">      exclude: <span class="regexp">/node_modules/</span>,</div><div class="line">      loader: <span class="string">'react-hot!babel'</span> <span class="comment">// Include the react-hot loader</span></div><div class="line">    &#125;]</div><div class="line">  &#125;,</div><div class="line">  resolve: &#123;</div><div class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.jsx'</span>]</div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    path: __dirname + <span class="string">'/dist'</span>,</div><div class="line">    publicPath: <span class="string">'/'</span>,</div><div class="line">    filename: <span class="string">'bundle.js'</span></div><div class="line">  &#125;,</div><div class="line">  devServer: &#123;</div><div class="line">    contentBase: <span class="string">'./dist'</span>,</div><div class="line">    hot: <span class="literal">true</span> <span class="comment">// Activate hot loading</span></div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin() <span class="comment">// Wire in the hot loading plugin</span></div><div class="line">  ]</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="é…ç½®å•å…ƒæµ‹è¯•æ¡†æ¶"><a href="#é…ç½®å•å…ƒæµ‹è¯•æ¡†æ¶" class="headerlink" title="é…ç½®å•å…ƒæµ‹è¯•æ¡†æ¶"></a>é…ç½®å•å…ƒæµ‹è¯•æ¡†æ¶</h3><p>æˆ‘ä»¬å°†ä½¿ç”¨Mochaå’ŒChaiæ¥è¿›è¡Œæµ‹è¯•å·¥ä½œ.è¿™ä¸¤ä¸ªå·¥å…·å¹¿æ³›çš„è¢«ä½¿ç”¨,ä»–ä»¬çš„è¾“å‡ºå†…å®¹å¯¹äºæµ‹è¯•é©±åŠ¨å¼€å‘éå¸¸çš„å¥½.Chai-immutableæ˜¯ä¸€ä¸ªchaiæ’ä»¶,ç”¨æ¥å¤„ç†immutableæ•°æ®ç»“æ„.</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install --save immutable@<span class="number">3.7</span><span class="number">.6</span></div><div class="line">npm install --save-dev mocha@<span class="number">2.4</span><span class="number">.5</span> chai@<span class="number">3.5</span><span class="number">.0</span> chai-immutable@<span class="number">1.5</span><span class="number">.3</span></div></pre></td></tr></table></figure>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­,æˆ‘ä»¬ä¸ä¼šä¾èµ–æµè§ˆå™¨ä¸ºåŸºç¡€çš„æµ‹è¯•è¿è¡Œå™¨ä¾‹å¦‚Karma-æ›¿ä»£æ–¹æ¡ˆæ˜¯æˆ‘ä»¬ä½¿ç”¨jsdomåº“,å®ƒå°†ä¼šä½¿ç”¨çº¯javascirptåˆ›å»ºä¸€ä¸ªå‡DOM,è¿™æ ·åšè®©æˆ‘ä»¬çš„æµ‹è¯•æ›´åŠ å¿«é€Ÿ.</p>
<p><code>npm install â€”save-dev jsdom@8.0.4</code></p>
<p>æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºæµ‹è¯•å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬,è¦è€ƒè™‘åˆ°ä¸‹é¢çš„å†…å®¹.</p>
<ul>
<li>æ¨¡æ‹Ÿ<code>document</code>å’Œ<code>window</code>å¯¹è±¡,é€šå¸¸æ˜¯ç”±æµè§ˆå™¨æä¾›</li>
<li>é€šè¿‡<code>chia-immutable</code>å‘Šè¯‰chaiç»„ä»¶æˆ‘ä»¬è¦ä½¿ç”¨immutableæ•°æ®ç»“æ„</li>
</ul>
<p><code>test/setup.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> jsdom <span class="keyword">from</span> <span class="string">'jsdom'</span>;</div><div class="line"><span class="keyword">import</span> chai <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"><span class="keyword">import</span> chaiImmutable <span class="keyword">from</span> <span class="string">'chai-immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> doc = jsdom.jsdom(<span class="string">'&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span>);</div><div class="line"><span class="keyword">const</span> win = doc.defaultView;</div><div class="line"></div><div class="line">global.document = doc;</div><div class="line">global.window = win;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.keys(<span class="built_in">window</span>).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span> (!(key <span class="keyword">in</span> global)) &#123;</div><div class="line">    global[key] = <span class="built_in">window</span>[key];</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">chai.use(chaiImmutable);</div></pre></td></tr></table></figure>
<p>æ›´æ–°ä¸€ä¸‹<code>npm test</code>è„šæœ¬<br><code>package.json</code><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> "scripts": &#123;</div><div class="line">  "test": "mocha --compilers js:babel-core/register --require ./test/setup.js 'test/**/*.@(js|jsx)'",</div><div class="line">  "test:watch": "npm run test -- --watch --watch-extensions jsx"</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p><code>npm run test:watch</code>å‘½ä»¤åœ¨windowsæ“ä½œç³»ç»Ÿä¸‹ä¼¼ä¹ä¸èƒ½å·¥ä½œ.</p>
<p>ç°åœ¨,å¦‚æœæˆ‘ä»¬è¿è¡Œ<code>npm run test:watch</code>,æ‰€æœ‰testç›®å½•é‡Œçš„<code>.js</code>,<code>.jsx</code>æ–‡ä»¶åœ¨æ›´æ–°è‡ªèº«æˆ–è€…æºæ–‡ä»¶çš„æ—¶å€™,å°†ä¼šè¿è¡Œmochaæµ‹è¯•.</p>
<p>é…ç½®å®Œæˆäº†ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œ<code>webpack-dev-server</code>,æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯,<code>npm run test:watch</code>.åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<a href="localhost:8080" target="_blank" rel="external">localhost:8080</a>.æ£€æŸ¥<code>hello world!</code>æ˜¯å¦å‡ºç°åœ¨ç»ˆç«¯ä¸­.</p>
<h2 id="æ„å»ºstate-tree"><a href="#æ„å»ºstate-tree" class="headerlink" title="æ„å»ºstate tree"></a>æ„å»ºstate tree</h2><p>ä¹‹å‰æåˆ°è¿‡,state treeæ˜¯èƒ½æä¾›appæ‰€æœ‰ä¿¡æ¯çš„æ•°æ®ç»“æ„.è¿™ä¸ªç»“æ„éœ€è¦åœ¨å®é™…å¼€å‘ä¹‹å‰ç»è¿‡æ·±æ€ç†Ÿè™‘,å› ä¸ºå®ƒå°†å½±å“ä¸€äº›ä»£ç çš„ç»“æ„å’Œäº¤äº’ä½œç”¨.</p>
<p>ä½œä¸ºç¤ºä¾‹,æˆ‘ä»¬appæ˜¯ä¸€ä¸ªTODO listç”±å‡ ä¸ªæ¡ç›®ç»„åˆè€Œæˆ</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fdtq17eheyj30c70600sj.jpg" alt="state tree 1"><br>æ¯ä¸€ä¸ªæ¡ç›®æœ‰ä¸€ä¸ªæ–‡æœ¬,ä¸ºäº†ä¾¿äºæ“ä½œ,è®¾ä¸€ä¸ªid,æ­¤å¤–æ¯ä¸ªitemæœ‰ä¸¤ä¸ªçŠ¶æ€ä¹‹ä¸€:æ´»åŠ¨æˆ–è€…å®Œæˆï¼šæœ€åä¸€ä¸ªæ¡ç›®éœ€è¦ä¸€ä¸ªå¯ç¼–è¾‘çš„çŠ¶æ€(å½“ç”¨æˆ·æƒ³ç¼–è¾‘çš„æ–‡æœ¬çš„æ—¶å€™),<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿æŒä¸‹é¢çš„æ•°æ®ç»“æ„:<br><img src="https://ww2.sinaimg.cn/large/006tNc79ly1fdtqcw4ofzj30jy083jra.jpg" alt="state tree 2"></p>
<p>ä¹Ÿæœ‰å¯èƒ½åŸºäºä»–ä»¬çš„çŠ¶æ€è¿›è¡Œç­›é€‰,æ‰€ä»¥æˆ‘ä»¬å¤©å‰‘<code>filter</code>æ¡ç›®æ¥è·å–æœ€ç»ˆçš„state tree:<br><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fdtqcvvz68j30p60ar748.jpg" alt="sate tree 3"></p>
<h2 id="åˆ›å»ºUI"><a href="#åˆ›å»ºUI" class="headerlink" title="åˆ›å»ºUI"></a>åˆ›å»ºUI</h2><p>é¦–å…ˆæˆ‘ä»¬æŠŠappåˆ†è§£ä¸ºä¸‹é¢çš„ç»„ä»¶:</p>
<ul>
<li><code>TodoHeader</code>ç»„ä»¶æ˜¯åˆ›å»ºæ–°todoçš„è¾“å…¥ç»„ä»¶</li>
<li><code>TodoList</code>ç»„ä»¶æ˜¯todoçš„åˆ—è¡¨</li>
<li><code>todoItem</code>æ˜¯ä¸€ä¸ªtodo</li>
<li><code>todoInput</code>æ˜¯ç¼–è¾‘todoçš„è¾“å…¥æ¡†</li>
<li><code>TodoTools</code>æ˜¯æ˜¾ç¤ºæœªå®Œæˆçš„æ¡ç›®æ•°é‡,è¿‡æ»¤å™¨å’Œæ¸…é™¤å®Œæˆçš„æŒ‰é’®</li>
<li><code>footer</code>æ˜¯æ˜¾ç¤ºä¿¡æ¯çš„,æ²¡æœ‰å…·ä½“çš„é€»è¾‘</li>
</ul>
<p>æˆ‘ä»¬ä¹Ÿåˆ›å»º<code>TodoApp</code>ç»„ä»¶ç»„ç»‡æ‰€æœ‰çš„å…¶ä»–ç»„ä»¶.</p>
<p>é¦–æ¬¡è¿è¡Œæˆ‘ä»¬çš„ç»„ä»¶</p>
<p><em>æç¤º:</em><a href="https://github.com/phacks/redux-todomvc/commit/d1d2a56a8d2b4f898ed8fdf20f55e7f7f11ad6ad" target="_blank" rel="external">è¿è¡Œè¿™ä¸ªç‰ˆæœ¬</a></p>
<p>æ­£å¦‚æˆ‘ä»¬æ‰€è§çš„,æˆ‘ä»¬å°†ä¼šæŠŠæ‰€æœ‰ç»„ä»¶æ”¾åˆ°åˆå¹¶æˆä¸€ä¸ª<code>TodoApp</code>ç»„ä»¶.æ‰€ä»¥è®©æˆ‘ä»¬æ·»åŠ ç»„ä»¶åˆ°<code>index.html</code>æ–‡ä»¶çš„<code>#app</code>DIVä¸­:<br><code>src/index.jsx</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123;List, <span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> TodoApp <span class="keyword">from</span> <span class="string">'./components/TodoApp'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> todos = List.of(</div><div class="line">  <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;)</div><div class="line">);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TodoApp</span> <span class="attr">todos</span>=<span class="string">&#123;todos&#125;</span> /&gt;</span>,</span></div><div class="line">  document.getElementById('app')</div><div class="line">);</div></pre></td></tr></table></figure>
<p>å› ä¸ºæˆ‘ä»¬åœ¨<code>index.jsx</code>æ–‡ä»¶ä¸­ä½¿ç”¨JSXè¯­æ³•,éœ€è¦åœ¨wabpackä¸­æ‰©å±•<code>.jsx</code>.ä¿®æ”¹å¦‚ä¸‹:<br><code>webpack.config.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> entry: [</div><div class="line">  <span class="string">'webpack-dev-server/client?http://localhost:8080'</span>,</div><div class="line">  <span class="string">'webpack/hot/only-dev-server'</span>,</div><div class="line">  <span class="string">'./src/index.jsx'</span> <span class="comment">// Change the index file extension</span></div><div class="line">],</div></pre></td></tr></table></figure></p>
<h2 id="ç¼–å†™todo-list-UI"><a href="#ç¼–å†™todo-list-UI" class="headerlink" title="ç¼–å†™todo list UI"></a>ç¼–å†™todo list UI</h2><p>ç°åœ¨æˆ‘ä»¬ç¼–å†™ç¬¬ä¸€ç‰ˆæœ¬çš„<code>TodoApp</code>ç»„ä»¶,ç”¨æ¥æ˜¾ç¤ºtodoé¡¹ç›®åˆ—è¡¨:<br><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  getItems() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.todos || [];</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"todoapp"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"todo-list"</span>&gt;</span></div><div class="line">            &#123;this.getItems().map(item =&gt;</div><div class="line">              <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">"active"</span> <span class="attr">key</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"view"</span>&gt;</span></div><div class="line">                  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span></span></div><div class="line">                         <span class="attr">className</span>=<span class="string">"toggle"</span> /&gt;</div><div class="line">                  <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"todo"</span>&gt;</span></div><div class="line">                    &#123;item.get('text')&#125;</div><div class="line">                  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">                  <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"destroy"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            )&#125;</div><div class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>è¦è®°ä½ä¸¤ä»¶äº‹æƒ…:<br>ç¬¬ä¸€ä¸ª,å¦‚æœä½ çœ‹åˆ°çš„ç»“æœä¸å¤ªå¥½,ä¿®å¤å®ƒ,æˆ‘ä»¬å°†ä¼šä½¿ç”¨<a href="https://github.com/tastejs/todomvc-app-css" target="_blank" rel="external">todomvc-app-css</a>åŒ…æ¥è¡¥å……ä¸€äº›éœ€è¦çš„æ ·å¼<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install --save todomvc-app-css@<span class="number">2.0</span><span class="number">.4</span></div><div class="line">npm install style-loader@<span class="number">0.13</span><span class="number">.0</span> css-loader@<span class="number">0.23</span><span class="number">.1</span> --save-dev</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬éœ€è¦å‘Šè¯‰webpackå»åŠ è½½css æ ·å¼æ–‡ä»¶:<br><code>webpack.config.js</code><br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">module</span>: &#123;</div><div class="line">  loaders: [&#123;</div><div class="line">    test: <span class="regexp">/\.jsx?$/</span>,</div><div class="line">    exclude: <span class="regexp">/node_modules/</span>,</div><div class="line">    loader: <span class="string">'react-hot!babel'</span></div><div class="line">  &#125;, &#123;</div><div class="line">    test: <span class="regexp">/\.css$/</span>,</div><div class="line">    loader: <span class="string">'style!css'</span> <span class="comment">// We add the css loader</span></div><div class="line">  &#125;]</div><div class="line">&#125;,</div><div class="line"><span class="comment">//...</span></div></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨<code>inde.jsx</code>æ–‡ä»¶ä¸­æ·»åŠ æ ·å¼:<br><code>src/index.jsx</code><br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="function"><span class="title">require</span>(<span class="params">'../node_modules/todomvc-app-css/index.css'</span>)</span>;</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  &lt;TodoApp todos=&#123;todos&#125; /&gt;,</div><div class="line">  document.getElementById(<span class="string">'app'</span>)</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒä»¶äº‹æ˜¯:ä»£ç ä¼¼ä¹å¾ˆå¤æ‚,è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸¤ä¸ªæˆ–è€…å¤šä¸ªç»„ä»¶çš„åŸå› :<code>TodoList</code>å’Œ<code>TodoItem</code>å°†ä¼šåˆ†åˆ«å…³æ³¨æ¡ç›®åˆ—è¡¨å’Œå•ä¸ªçš„æ¡ç›®.</p>
<p><a href="https://github.com/phacks/redux-todomvc/commit/90fe2cc5f8e1c20546c702b91230369c896b9b81" target="_blank" rel="external">è¿™ä¸€éƒ¨åˆ†çš„æäº¤ä»£ç </a></p>
<p><code>src/components/TodoApp.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'./TodoList'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"todoapp"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">todos</span>=<span class="string">&#123;this.props.todos&#125;</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>åœ¨<code>TodoList</code>ç»„ä»¶ä¸­æ ¹æ®è·å–çš„propsä¸ºæ¯ä¸€ä¸ªæ¡ç›®æ˜¾ç¤ºä¸€ä¸ª<code>TodoItem</code>ç»„ä»¶.</p>
<p><code>src/components/TodoList.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">'./TodoItem'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"main"</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"todo-list"</span>&gt;</span></div><div class="line">        &#123;this.props.todos.map(item =&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">key</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;</span></div><div class="line">                    <span class="attr">text</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125; /&gt;</div><div class="line">        )&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><code>src/components/TodoItem.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">"todo"</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"view"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span></span></div><div class="line">               <span class="attr">className</span>=<span class="string">"toggle"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"todo"</span>&gt;</span></div><div class="line">          &#123;this.props.text&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"destroy"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>åœ¨æˆ‘ä»¬æ·±å…¥ç”¨æˆ·çš„äº¤äº’æ“ä½œä¹‹å‰,æˆ‘ä»¬å…ˆåœ¨ç»„ä»¶<code>TodoItem</code>ä¸­æ·»åŠ ä¸€ä¸ªinputç”¨äºç¼–è¾‘<br><code>src/componensts/TodoItem.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> TextInput <span class="keyword">from</span> <span class="string">'./TextInput'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">"todo"</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"view"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span></span></div><div class="line">               <span class="attr">className</span>=<span class="string">"toggle"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"todo"</span>&gt;</span></div><div class="line">          &#123;this.props.text&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"destroy"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">TextInput</span> /&gt;</span> // We add the TextInput component</div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><code>TextInput</code>ç»„ä»¶å¦‚ä¸‹<br><code>src/compoents/TextInput.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">className</span>=<span class="string">"edit"</span></span></span></div><div class="line">                  <span class="attr">autoFocus</span>=<span class="string">&#123;true&#125;</span></div><div class="line">                  <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="â€çº¯â€œç»„ä»¶çš„å¥½å¤„ï¼šPureRenderMixin"><a href="#â€çº¯â€œç»„ä»¶çš„å¥½å¤„ï¼šPureRenderMixin" class="headerlink" title="â€çº¯â€œç»„ä»¶çš„å¥½å¤„ï¼šPureRenderMixin"></a>â€çº¯â€œç»„ä»¶çš„å¥½å¤„ï¼šPureRenderMixin</h2><p><a href="https://github.com/phacks/redux-todomvc/commit/d9a60c94ba194f63a21df0d2e5d1e6d6a2cca506" target="_blank" rel="external">è¿™éƒ¨åˆ†çš„æäº¤ä»£ç </a></p>
<p>é™¤äº†å…è®¸å‡½æ•°å¼ç¼–ç¨‹çš„æ ·å¼,æˆ‘ä»¬çš„UIæ˜¯å•çº¯çš„,å¯ä»¥ä½¿ç”¨<code>PureRenderMixin</code>æ¥æå‡é€Ÿåº¦,æ­£å¦‚<a href="https://facebook.github.io/react/docs/pure-render-mixin.html" target="_blank" rel="external">React æ–‡æ¡£</a>:<br>å¦‚æœä½ çš„Reactçš„ç»„ä»¶æ¸²æŸ“å‡½æ•°æ˜¯â€çº¯â€œ(æ¢å¥è¯å°±æ˜¯,å¦‚æœä½¿ç”¨ç›¸åŒçš„porpså’Œstate,æ€»æ˜¯ä¼šæ¸²æŸ“å‡ºåŒæ ·çš„ç»“æœ),ä½ å¯ä»¥ä½¿ç”¨mixinåœ¨åŒä¸€ä¸ªæ¡ˆä¾‹è½¬ç»™ä½ æ¥æå‡æ€§èƒ½.</p>
<p>æ­£å¦‚<a href="https://facebook.github.io/react/docs/pure-render-mixin.html" target="_blank" rel="external">Reactæ–‡æ¡£</a>(æˆ‘ä»¬ä¹Ÿä¼šåœ¨ç¬¬äºŒéƒ¨åˆ†çœ‹åˆ°<code>TodoApp</code>ç»„ä»¶æœ‰é¢å¤–çš„è§’è‰²ä¼šé˜»æ­¢<code>PureRenderMixin</code>çš„ä½¿ç”¨)å±•ç¤ºçš„mixinä¹Ÿéå¸¸å®¹æ˜“çš„æ·»åŠ åˆ°æˆ‘ä»¬çš„å­ç»„ä»¶ä¸­:<br><code>npm install --save react-addons-pure-render-mixin@0.14.7</code><br><code>src/components/TodoList.jsc</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> PureRenderMixin <span class="keyword">from</span> <span class="string">'react-addons-pure-render-mixin'</span></div><div class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">'./TodoItem'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="keyword">this</span>.shouldComponentUpdate = PureRenderMixin.shouldComponentUpdate.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><code>src/components/TodoItem/jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> PureRenderMixin <span class="keyword">from</span> <span class="string">'react-addons-pure-render-mixin'</span></div><div class="line"><span class="keyword">import</span> TextInput <span class="keyword">from</span> <span class="string">'./TextInput'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="keyword">this</span>.shouldComponentUpdate = PureRenderMixin.shouldComponentUpdate.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><code>src/components/TextInput.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> PureRenderMixin <span class="keyword">from</span> <span class="string">'react-addons-pure-render-mixin'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="keyword">this</span>.shouldComponentUpdate = PureRenderMixin.shouldComponentUpdate.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="åœ¨listç»„ä»¶ä¸­å¤„ç†ç”¨æˆ·çš„actions"><a href="#åœ¨listç»„ä»¶ä¸­å¤„ç†ç”¨æˆ·çš„actions" class="headerlink" title="åœ¨listç»„ä»¶ä¸­å¤„ç†ç”¨æˆ·çš„actions"></a>åœ¨listç»„ä»¶ä¸­å¤„ç†ç”¨æˆ·çš„actions</h2><p>å¥½äº†,ç°åœ¨æˆ‘ä»¬é…ç½®å¥½äº†listç»„ä»¶.ç„¶è€Œæˆ‘ä»¬æ²¡æœ‰è€ƒè™‘æ·»åŠ ç”¨æˆ·çš„actionså’Œæ€ä¹ˆæ·»åŠ è¿›å»ç»„ä»¶.</p>
<h3 id="propsçš„åŠ›é‡"><a href="#propsçš„åŠ›é‡" class="headerlink" title="propsçš„åŠ›é‡"></a>propsçš„åŠ›é‡</h3><p>åœ¨Reactä¸­,<code>props</code>å¯¹è±¡æ˜¯å½“æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªå®¹å™¨(container)çš„æ—¶å€™,é€šè¿‡è®¾å®šçš„attributesæ¥è®¾å®š.ä¾‹å¦‚,å¦‚æœæˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ª<code>TodoItem</code>å…ƒç´ :<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;TodoItem <span class="built_in">text</span>=&#123;'Text <span class="keyword">of</span> <span class="keyword">the</span> <span class="built_in">item</span>'&#125; /&gt;</div></pre></td></tr></table></figure></p>
<p>ç„¶åæˆ‘ä»¬åœ¨<code>TodoItem</code>ç»„ä»¶ä¸­è·å–<code>this.props.text</code>å˜é‡:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// in TodoItem.jsx</span></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.props.text);</div><div class="line"><span class="comment">// outputs 'Text of the item'</span></div></pre></td></tr></table></figure></p>
<p>Reduxæ„æ¶ä¸­å¼ºåŒ–ä½¿ç”¨<code>props</code>.åŸºç¡€çš„åŸç†æ˜¯stateå‡ ä¹éƒ½å­˜åœ¨äºä»–çš„propsé‡Œé¢.æ¢ä¸€ç§è¯´æ³•ï¼šå¯¹äºåŒæ ·ä¸€ç»„props,ä¸¤ä¸ªå…ƒç´ çš„å®ä¾‹åº”è¯¥è¾“å‡ºå®Œå…¨ä¸€æ ·çš„ç»“æœ.æ­£å¦‚ä¹‹å‰æˆ‘ä»¬çœ‹åˆ°çš„,æ•´ä¸ªappçš„stateéƒ½åŒ…å«åœ¨ä¸€ä¸ªstate treeä¸­:æ„æ€æ˜¯è¯´,state tree å¦‚æœé€šè¿‡<code>props</code>çš„æ–¹å¼ä¼ é€’åˆ°ç»„ä»¶,å°†ä¼šå®Œæ•´å’Œå¯é¢„æœŸçš„å†³å®šappçš„è§†è§‰è¾“å‡º.</p>
<h3 id="TodoListç»„ä»¶"><a href="#TodoListç»„ä»¶" class="headerlink" title="TodoListç»„ä»¶"></a>TodoListç»„ä»¶</h3><p><a href="https://github.com/phacks/redux-todomvc/commit/69707f07b6e9cbca7558cb85fcabff54615c1737" target="_blank" rel="external">è¿™ä¸€éƒ¨åˆ†çš„ä»£ç ä¿®æ”¹</a></p>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†å’Œæ¥ä¸‹æ¥çš„ä¸€éƒ¨åˆ†,æˆ‘ä»¬å°†ä¼šäº†è§£ä¸€ä¸ªæµ‹è¯•ä¼˜å…ˆçš„æ–¹æ³•.</p>
<p>ä¸ºäº†å¸®åŠ©æˆ‘ä»¬æµ‹è¯•ç»„ä»¶,Reactåº“æä¾›äº†<code>TestUtils</code>å·¥å…·æ’ä»¶,æœ‰ä¸€ä¸‹æ–¹æ³•:</p>
<ul>
<li><code>renderIntoDocument</code>,æ¸²æŸ“ç»„ä»¶åˆ°é™„åŠ çš„DOMèŠ‚ç‚¹</li>
<li><code>scryRenderDOMComponentsWIthTag</code>,ä½¿ç”¨æä¾›çš„æ ‡ç­¾(ä¾‹å¦‚<code>li</code>,<code>input</code>)åœ¨DOMä¸­æ‰¾åˆ°æ‰€æœ‰çš„ç»„ä»¶å®ä¾‹.</li>
<li><code>scryRederDOMComponentsWithClass</code>,åŒä¸Šä½¿ç”¨çš„æ˜¯ç±»</li>
<li><code>Simulate</code>,æ¨¡æ‹Ÿç”¨æˆ·çš„actions(ä¾‹å¦‚ ç‚¹å‡»,æŒ‰é”®,æ–‡æœ¬è¾“å…¥â€¦)</li>
</ul>
<p><code>TestUtils</code>æ’ä»¶æ²¡æœ‰åŒ…å«åœ¨<code>react</code>åŒ…ä¸­,æ‰€ä»¥éœ€è¦å•ç‹¬å®‰è£…<br><code>npm install --save-dev react-addons-test-utils@0.14.7</code></p>
<p> æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•å°†ç¡®ä¿<code>Todolist</code>ç»„ä»¶ä¸­,å¦‚æœ<code>filter</code>propsè¢«è®¾ç½®ä¸º<code>active</code>,å°†ä¼šå±•ç¤ºæ‰€æœ‰çš„æ´»åŠ¨æ¡ç›®:<br> <code>test/components/TodoList_spec.jsx</code></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> TestUtils <span class="keyword">from</span> <span class="string">'react-addons-test-utils'</span>;</div><div class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../../src/components/TodoList'</span>;</div><div class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"><span class="keyword">import</span> &#123;List, <span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> &#123;renderIntoDocument,</div><div class="line">       scryRenderedDOMComponentsWithTag&#125; = TestUtils;</div><div class="line"></div><div class="line">describe(<span class="string">'TodoList'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'renders a list with only the active items if the filter is active'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> todos = List.of(</div><div class="line">      <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">      <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">      <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;)</div><div class="line">    );</div><div class="line">    <span class="keyword">const</span> filter = <span class="string">'active'</span>;</div><div class="line">    <span class="keyword">const</span> component = renderIntoDocument(</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">filter</span>=<span class="string">&#123;filter&#125;</span> <span class="attr">todos</span>=<span class="string">&#123;todos&#125;</span> /&gt;</span></span></div><div class="line">    );</div><div class="line">    const items = scryRenderedDOMComponentsWithTag(component, 'li');</div><div class="line"></div><div class="line">    expect(items.length).to.equal(2);</div><div class="line">    expect(items[0].textContent).to.contain('React');</div><div class="line">    expect(items[1].textContent).to.contain('Redux');</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµ‹è¯•å¤±è´¥äº†,æœŸå¾…çš„æ˜¯ä¸¤ä¸ªæ´»åŠ¨æ¡ç›®,ä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸‰ä¸ª.è¿™æ˜¯å†æ­£å¸¸ä¸è¿‡çš„äº†,å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç¼–å†™å®é™…ç­›é€‰çš„é€»è¾‘:<br><code>src/components/TodoList.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// Filters the items according to their status</span></div><div class="line">  getItems() &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.todos) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.props.todos.filter(</div><div class="line">        <span class="function">(<span class="params">item</span>) =&gt;</span> item.get(<span class="string">'status'</span>) === <span class="keyword">this</span>.props.filter</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [];</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"main"</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"todo-list"</span>&gt;</span></div><div class="line">        // Only the filtered items are displayed</div><div class="line">        &#123;this.getItems().map(item =&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">key</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;</span></div><div class="line">                    <span class="attr">text</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125; /&gt;</div><div class="line">        )&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>  ç¬¬ä¸€ä¸ªæµ‹è¯•é€šè¿‡äº†.åˆ«åœä¸‹æ¥,è®©æˆ‘ä»¬æ·»åŠ ç­›é€‰å™¨:<code>all</code>å’Œ<code>completed:</code><br>  <code>test/components/TodoList_spec.js</code><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'TodoList'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'renders a list with only completed items if the filter is completed'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> todos = List.of(</div><div class="line">      <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">      <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>&#125;),</div><div class="line">      <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>&#125;)</div><div class="line">    );</div><div class="line">    <span class="keyword">const</span> filter = <span class="string">'completed'</span>;</div><div class="line">    <span class="keyword">const</span> component = renderIntoDocument(</div><div class="line">      &lt;TodoList filter=&#123;filter&#125; todos=&#123;todos&#125; /&gt;</div><div class="line">    );</div><div class="line">    const items = scryRenderedDOMComponentsWithTag(component, 'li');</div><div class="line"></div><div class="line">    expect(items.length).to.equal(1);</div><div class="line">    expect(items[0].textContent).to.contain('Immutable');</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it('renders a list with all the items', () =&gt; &#123;</div><div class="line">    const todos = List.of(</div><div class="line">      Map(&#123;id: 1, text: 'React', status: 'active'&#125;),</div><div class="line">      Map(&#123;id: 2, text: 'Redux', status: 'active'&#125;),</div><div class="line">      Map(&#123;id: 3, text: 'Immutable', status: 'completed'&#125;)</div><div class="line">    );</div><div class="line">    const filter = 'all';</div><div class="line">    const component = renderIntoDocument(</div><div class="line">      &lt;TodoList filter=&#123;filter&#125; todos=&#123;todos&#125; /&gt;</div><div class="line">    );</div><div class="line">    const items = scryRenderedDOMComponentsWithTag(component, 'li');</div><div class="line"></div><div class="line">    expect(items.length).to.equal(3);</div><div class="line">    expect(items[0].textContent).to.contain('React');</div><div class="line">    expect(items[1].textContent).to.contain('Redux');</div><div class="line">    expect(items[2].textContent).to.contain('Immutable');</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>  ç¬¬ä¸‰ä¸ªæµ‹è¯•å¤±è´¥äº†,å› ä¸º<code>all</code>ç­›é€‰å™¨æ›´æ–°ç»„ä»¶çš„é€»è¾‘ç¨ç¨æœ‰ç‚¹ä¸åŒ<br>  <code>src/components/TodoList.jsx</code><br>  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// ...</span></div><div class="line">export <span class="keyword">default</span> React.Component &#123;</div><div class="line">  <span class="comment">// Filters the items according to their status</span></div><div class="line">  getItems() &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.todos) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.props.todos.filter(</div><div class="line">        (item) =&gt; <span class="keyword">this</span>.props.filter === <span class="string">'all'</span> || item.<span class="keyword">get</span>(<span class="string">'status'</span>) === <span class="keyword">this</span>.props.filter</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [];</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Š,æˆ‘ä»¬çŸ¥é“æ˜¾ç¤ºåœ¨appä¸­çš„æ¡ç›®éƒ½æ˜¯ç»è¿‡<code>filter</code>å±æ€§è¿‡æ»¤çš„.å¦‚æœåœ¨æµè§ˆå™¨ä¸­çœ‹çœ‹ç»“æœ,æ²¡æœ‰æ˜¾ç¤ºä»»ä½•æ¡ç›®,å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è®¾ç½®ï¼š<br><code>src/index.jsx</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ...</span></div><div class="line"><span class="keyword">const</span> todos = List.of(</div><div class="line">  <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'React'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Redux'</span>, <span class="attr">status</span>: <span class="string">'active'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Immutable'</span>, <span class="attr">status</span>: <span class="string">'completed'</span>, <span class="attr">editing</span>: <span class="literal">false</span>&#125;)</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> filter = <span class="string">'all'</span>;</div><div class="line"></div><div class="line"><span class="built_in">require</span>(<span class="string">'../node_modules/todomvc-app-css/index.css'</span>)</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TodoApp</span> <span class="attr">todos</span>=<span class="string">&#123;todos&#125;</span> <span class="attr">filter</span> = <span class="string">&#123;filter&#125;/</span>&gt;</span>,</span></div><div class="line">  document.getElementById('app')</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p><code>src/components/TodoApp.jsx</code></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> ...</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;div&gt;</div><div class="line">      &lt;section className=<span class="string">"todoapp"</span>&gt;</div><div class="line">        <span class="regexp">//</span> We pass the filter props down to the TodoList component</div><div class="line">        &lt;TodoList todos=&#123;<span class="keyword">this</span>.props.todos&#125; filter=&#123;<span class="keyword">this</span>.props.filter&#125;/&gt;</div><div class="line">      &lt;/section&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">```<span class="javascript"> </span></div><div class="line">ä½¿ç”¨åœ¨<span class="string">`index.jsc`</span>æ–‡ä»¶ä¸­å£°æ˜çš„<span class="string">`filter`</span>å¸¸é‡è¿‡æ»¤ä»¥å,æˆ‘ä»¬çš„æ¡ç›®é‡æ–°å‡ºç°äº†.</div><div class="line"></div><div class="line">### TodoItem component</div><div class="line">[è¿™éƒ¨åˆ†çš„ä»£ç ä¿®æ”¹](https:<span class="comment">//github.com/phacks/redux-todomvc/commit/71d2835620f4ba6f3fc3665327f13ec4fba62eee)</span></div><div class="line"></div><div class="line">ç°åœ¨,è®©æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹<span class="string">`TodoItem`</span>ç»„ä»¶.é¦–å…ˆ,æˆ‘ä»¬æƒ³ç¡®ä¿¡<span class="string">`TodoItem`</span>ç»„ä»¶çœŸæ­£æ¸²æŸ“ä¸€ä¸ªæ¡ç›®.æˆ‘ä»¬ä¹Ÿæƒ³æµ‹è¯•ä¸€ä¸‹è¿˜æ²¡æœ‰æµ‹è¯•çš„ç‰¹æ€§,å°±æ˜¯å½“ä¸€ä¸ªæ¡ç›®å®Œæˆçš„æ—¶å€™,ä»–çš„æ–‡æœ¬ä¸­é—´æœ‰ä¸€æ¡çº¿</div><div class="line"><span class="string">`test/components/TodoItem_spec.js`</span></div><div class="line"> ```js</div><div class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> TestUtils <span class="keyword">from</span> <span class="string">'react-addons-test-utils'</span>;</div><div class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">'../../src/components/TodoItem'</span>;</div><div class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"></div><div class="line">const &#123;renderIntoDocument,</div><div class="line">       scryRenderedDOMComponentsWithTag&#125; = TestUtils;</div><div class="line"></div><div class="line">describe(<span class="string">'TodoItem'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  it(<span class="string">'renders an item'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    const text = <span class="string">'React'</span>;</div><div class="line">    const component = renderIntoDocument(</div><div class="line">      &lt;TodoItem text=&#123;text&#125; /&gt;</div><div class="line">    );</div><div class="line">    const todo = scryRenderedDOMComponentsWithTag(component, <span class="string">'li'</span>);</div><div class="line"></div><div class="line">    expect(todo.length).to.equal(<span class="number">1</span>);</div><div class="line">    expect(todo[<span class="number">0</span>].textContent).to.contain(<span class="string">'React'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'strikes through the item if it is completed'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    const text = <span class="string">'React'</span>;</div><div class="line">    const component = renderIntoDocument(</div><div class="line">      &lt;TodoItem text=&#123;text&#125; isCompleted=&#123;<span class="literal">true</span>&#125;/&gt;</div><div class="line">    );</div><div class="line">    const todo = scryRenderedDOMComponentsWithTag(component, <span class="string">'li'</span>);</div><div class="line"></div><div class="line">    expect(todo[<span class="number">0</span>].classList.contains(<span class="string">'completed'</span>)).to.equal(<span class="literal">true</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p> ä¸ºäº†ä½¿ç¬¬äºŒä¸ªæµ‹è¯•é€šè¿‡,å¦‚æœæ¡ç›®çš„çŠ¶æ€æ˜¯<code>complete</code>æˆ‘ä»¬ä½¿ç”¨äº†ç±»<code>complete</code>,å®ƒå°†ä¼šé€šè¿‡propsä¼ é€’å‘ä¸‹ä¼ é€’.æˆ‘ä»¬å°†ä¼šä½¿ç”¨<code>classnames</code>åŒ…æ¥æ“ä½œæˆ‘ä»¬çš„DOMç±».<br> <code>npm install â€”save classnames</code></p>
<p><code>src/components/TodoItem.jsx</code></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="comment">// We need to import the classNames object</span></div><div class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">'classnames'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> TextInput <span class="keyword">from</span> <span class="string">'./TextInput'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">var</span> itemClass = classNames(&#123;</div><div class="line">      <span class="string">'todo'</span>: <span class="literal">true</span>,</div><div class="line">      <span class="string">'completed'</span>: <span class="keyword">this</span>.props.isCompleted</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;itemClass&#125;</span>&gt;</span></span></div><div class="line">      // ...</div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªitemåœ¨ç¼–è¾‘çš„æ—¶å€™å¤–è§‚åº”è¯¥çœ‹èµ·æ¥ä¸ä¸€æ ·,ç”±<code>isEditing</code>propsæ¥åŒ…è£¹.<br><code>test/components/TodoItem_spec.js</code><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'TodoItem'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line"></div><div class="line">  it(<span class="string">'should look different when editing'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> text = <span class="string">'React'</span>;</div><div class="line">    <span class="keyword">const</span> component = renderIntoDocument(</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">text</span>=<span class="string">&#123;text&#125;</span> <span class="attr">isEditing</span>=<span class="string">&#123;true&#125;/</span>&gt;</span></span></div><div class="line">    );</div><div class="line">    const todo = scryRenderedDOMComponentsWithTag(component, 'li');</div><div class="line"></div><div class="line">    expect(todo[0].classList.contains('editing')).to.equal(true);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p> ä¸ºäº†ä½¿æµ‹è¯•é€šè¿‡,æˆ‘ä»¬ä»…ä»…éœ€è¦æ›´æ–°<code>itemClass</code>å¯¹è±¡:<br> <code>src/components/TodoItem.jsx</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">var</span> itemClass = classNames(&#123;</div><div class="line">      <span class="string">'todo'</span>: <span class="literal">true</span>,</div><div class="line">      <span class="string">'completed'</span>: <span class="keyword">this</span>.props.isCompleted,</div><div class="line">      <span class="string">'editing'</span>: <span class="keyword">this</span>.props.isEditing</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;itemClass&#125;</span>&gt;</span></span></div><div class="line">      // ...</div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p> æ¡ç›®å·¦ä¾§çš„checkboxå¦‚æœæ¡ç›®å®Œæˆ,åº”è¯¥æ ‡è®°ä½checked:<br> <code>test/components/TodoItem_spec.js</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'TodoItem'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line"></div><div class="line">  it(<span class="string">'should be checked if the item is completed'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> text = <span class="string">'React'</span>;</div><div class="line">    <span class="keyword">const</span> text2 = <span class="string">'Redux'</span>;</div><div class="line">    <span class="keyword">const</span> component = renderIntoDocument(</div><div class="line">      &lt;TodoItem text=&#123;text&#125; isCompleted=&#123;true&#125;/&gt;,</div><div class="line">      &lt;TodoItem text=&#123;text2&#125; isCompleted=&#123;false&#125;/&gt;</div><div class="line">    );</div><div class="line">    const input = scryRenderedDOMComponentsWithTag(component, 'input');</div><div class="line">    expect(input[0].checked).to.equal(true);</div><div class="line">    expect(input[1].checked).to.equal(false);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p> Reactæœ‰ä¸ªè®¾å®šcheckboxè¾“å…¥stateçš„æ–¹æ³•:<code>defaultChecked</code>.<br> <code>src/components/TodoItem.jsx</code><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;itemClass&#125;</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"view"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span></span></div><div class="line">               <span class="attr">className</span>=<span class="string">"toggle"</span></div><div class="line">               <span class="attr">defaultChecked</span>=<span class="string">&#123;this.props.isCompleted&#125;/</span>&gt;</div><div class="line">        // ...</div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>  æˆ‘ä»¬ä¹Ÿä»<code>TodoList</code>ç»„ä»¶å‘ä¸‹ä¼ é€’<code>isCompleted</code>å’Œ<code>isEditing</code>props.<br>  <code>src/components/TodoList.jsx</code><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  <span class="comment">// This function checks whether an item is completed</span></div><div class="line">  isCompleted(item) &#123;</div><div class="line">    <span class="keyword">return</span> item.get(<span class="string">'status'</span>) === <span class="string">'completed'</span>;</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"main"</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"todo-list"</span>&gt;</span></div><div class="line">        &#123;this.getItems().map(item =&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">key</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;</span></div><div class="line">                    <span class="attr">text</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;</div><div class="line">                    // <span class="attr">We</span> <span class="attr">pass</span> <span class="attr">down</span> <span class="attr">the</span> <span class="attr">info</span> <span class="attr">on</span> <span class="attr">completion</span> <span class="attr">and</span> <span class="attr">editing</span></div><div class="line">                    <span class="attr">isCompleted</span>=<span class="string">&#123;this.isCompleted(item)&#125;</span></div><div class="line">                    <span class="attr">isEditing</span>=<span class="string">&#123;item.get(</span>'<span class="attr">editing</span>')&#125; /&gt;</div><div class="line">        )&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æˆªæ­¢ç›®å‰,æˆ‘ä»¬å·²ç»èƒ½å¤Ÿåœ¨ç»„ä»¶ä¸­åæ˜ å‡ºstateï¼šä¾‹å¦‚,å®Œæˆçš„æ¡ç›®å°†ä¼šè¢«åˆ’çº¿.ç„¶è€Œä¸€ä¸ªwebappå°†ä¼šå¤„ç†è¯¸å¦‚ç‚¹å‡»æŒ‰é’®çš„æ“ä½œ.åœ¨Reduxçš„æ¨¡å¼ä¸­,è¿™ä¸ªæ“ä½œä¹Ÿé€šè¿‡<code>porps</code>æ¥æ‰§è¡Œ,ç¨ç¨ç‰¹æ®Šçš„æ˜¯é€šè¿‡åœ¨propsä¸­ä¼ é€’å›è°ƒå‡½æ•°æ¥å®Œæˆ.é€šè¿‡è¿™ç§æ–¹å¼,æˆ‘ä»¬å†æ¬¡æŠŠUIå’ŒAppçš„é€»è¾‘å¤„ç†åˆ†ç¦»å¼€:ç»„ä»¶æ ¹æœ¬ä¸éœ€è¦çŸ¥é“æŒ‰é’®ç‚¹å‡»çš„æ“ä½œå…·ä½“æ˜¯ä»€ä¹ˆ,ä»…ä»…æ˜¯ç‚¹å‡»è§¦å‘äº†ä¸€äº›äº‹æƒ….</p>
<p>ä¸ºäº†æè¿°è¿™ä¸ªåŸç†,æˆ‘ä»¬å°†ä¼šæµ‹è¯•å¦‚æœç”¨æˆ·ç‚¹å‡»äº†deleteæŒ‰é’®(çº¢è‰²X),<code>delteItem</code>å‡½æ•°å°†ä¼šè¢«è°ƒç”¨.</p>
<p> <a href="https://github.com/phacks/redux-todomvc/commit/b3a6851e8a9f65f1c44e66046bedd1db18c19a48" target="_blank" rel="external">è¿™éƒ¨åˆ†çš„ä»£ç ä¿®æ”¹</a> </p>
<p> <code>test/components/TodoItem_spec.jsx</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">  / ...</div><div class="line"><span class="comment">// The Simulate helper allows us to simulate a user clicking</span></div><div class="line"><span class="keyword">const</span> &#123;renderIntoDocument,</div><div class="line">       scryRenderedDOMComponentsWithTag,</div><div class="line">       Simulate&#125; = TestUtils;</div><div class="line"></div><div class="line">describe(<span class="string">'TodoItem'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'invokes callback when the delete button is clicked'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> text = <span class="string">'React'</span>;</div><div class="line">    <span class="keyword">var</span> deleted = <span class="literal">false</span>;</div><div class="line">    <span class="comment">// We define a mock deleteItem function</span></div><div class="line">    <span class="keyword">const</span> deleteItem = <span class="function"><span class="params">()</span> =&gt;</span> deleted = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">const</span> component = renderIntoDocument(</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">text</span>=<span class="string">&#123;text&#125;</span> <span class="attr">deleteItem</span>=<span class="string">&#123;deleteItem&#125;/</span>&gt;</span></span></div><div class="line">    );</div><div class="line">    const buttons = scryRenderedDOMComponentsWithTag(component, 'button');</div><div class="line">    Simulate.click(buttons[0]);</div><div class="line"></div><div class="line">    // We verify that the deleteItem function has been called</div><div class="line">    expect(deleted).to.equal(true);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p> ä¸ºäº†æ˜¯è¿™ä¸ªæµ‹è¯•é€šè¿‡,æˆ‘ä»¬å¿…é¡»åœ¨deleteæŒ‰é’®å£°æ˜ä¸€ä¸ª<code>onClick</code>å¥æŸ„,ä»–å°†ä¼šè°ƒç”¨ç»è¿‡propsä¼ é€’çš„<code>deleteItem</code>å‡½æ•°.</p>
<p> <code>src/components/TodoItem.jsx</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;itemClass&#125;</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"view"</span>&gt;</span></div><div class="line">        // ...</div><div class="line">        // The onClick handler will call the deleteItem function given in the props</div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"destroy"</span></span></div><div class="line">                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt; this.props.deleteItem(this.props.id)&#125;&gt;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">TextInput</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p> é‡è¦çš„ä¸€ç‚¹:å®é™…åˆ é™¤çš„é€»è¾‘è¿˜æ²¡æœ‰å®æ–½,è¿™ä¸ªå°†æ˜¯Reduxçš„ä¸»è¦ä½œç”¨.<br> åœ¨åŒä¸€ä¸ªmodel,æˆ‘ä»¬å¯ä»¥æµ‹è¯•å’Œå®æ–½ä¸‹é¢çš„ç‰¹æ€§:</p>
<ul>
<li>ç‚¹å‡»checkboxå°†ä¼šè°ƒç”¨<code>toggleComplete</code>å‡½æ•°</li>
<li>åŒå‡»æ¡ç›®æ ‡ç­¾,å°†ä¼šè°ƒç”¨<code>editItem</code>å‡½æ•°</li>
</ul>
<p><code>test/components/TodoItem_spec.js</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line">describe(<span class="string">'TodoItem'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  it(<span class="string">'invokes callback when checkbox is clicked'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> text = <span class="string">'React'</span>;</div><div class="line">    <span class="keyword">var</span> isChecked = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">const</span> toggleComplete = <span class="function"><span class="params">()</span> =&gt;</span> isChecked = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">const</span> component = renderIntoDocument(</div><div class="line">      &lt;TodoItem text=&#123;text&#125; toggleComplete=&#123;toggleComplete&#125;/&gt;</div><div class="line">    );</div><div class="line">    const checkboxes = scryRenderedDOMComponentsWithTag(component, 'input');</div><div class="line">    Simulate.click(checkboxes[0]);</div><div class="line"></div><div class="line">    expect(isChecked).to.equal(true);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it('calls a callback when text is double clicked', () =&gt; &#123;</div><div class="line">    var text = 'React';</div><div class="line">    const editItem = () =&gt; text = 'Redux';</div><div class="line">    const component = renderIntoDocument(</div><div class="line">      &lt;TodoItem text=&#123;text&#125; editItem=&#123;editItem&#125;/&gt;</div><div class="line">    );</div><div class="line">    const label = component.refs.text</div><div class="line">    Simulate.doubleClick(label);</div><div class="line"></div><div class="line">    expect(text).to.equal('Redux');</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p> <code>src/compoents/TodoItem.jsx</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line">render() &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;itemClass&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"view"</span>&gt;</span></div><div class="line">      // We add an onClick handler on the checkbox</div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span></span></div><div class="line">             <span class="attr">className</span>=<span class="string">"toggle"</span></div><div class="line">             <span class="attr">defaultChecked</span>=<span class="string">&#123;this.props.isCompleted&#125;</span></div><div class="line">             <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt; this.props.toggleComplete(this.props.id)&#125;/&gt;</div><div class="line">      // We add a ref attribute to the label to facilitate the testing</div><div class="line">      // The onDoubleClick handler is unsurprisingly called on double clicks</div><div class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"todo"</span></span></div><div class="line">             <span class="attr">ref</span>=<span class="string">"text"</span></div><div class="line">             <span class="attr">onDoubleClick</span>=<span class="string">&#123;()</span> =&gt; this.props.editItem(this.props.id)&#125;&gt;</div><div class="line">        &#123;this.props.text&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"destroy"</span></span></div><div class="line">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt; this.props.deleteItem(this.props.id)&#125;&gt;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">TextInput</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p> æˆ‘ä»¬ä¹Ÿä»<code>TodoList</code>ç»„ä»¶å€ŸåŠ©propså‘ä¸‹ä¼ é€’<code>editItem</code>,<code>deleteItem</code>å’Œ<code>toggleComplete</code>å‡½æ•°.<br> <code>src/components/TodoList.jsx</code><br> <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  render() &#123;</div><div class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">"main"</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"todo-list"</span>&gt;</span></div><div class="line">          &#123;this.getItems().map(item =&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">key</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;</span></div><div class="line">                      <span class="attr">text</span>=<span class="string">&#123;item.get(</span>'<span class="attr">text</span>')&#125;</div><div class="line">                      <span class="attr">isCompleted</span>=<span class="string">&#123;this.isCompleted(item)&#125;</span></div><div class="line">                      <span class="attr">isEditing</span>=<span class="string">&#123;item.get(</span>'<span class="attr">editing</span>')&#125;</div><div class="line">                      // <span class="attr">We</span> <span class="attr">pass</span> <span class="attr">down</span> <span class="attr">the</span> <span class="attr">callback</span> <span class="attr">functions</span></div><div class="line">                      <span class="attr">toggleComplete</span>=<span class="string">&#123;this.props.toggleComplete&#125;</span></div><div class="line">                      <span class="attr">deleteItem</span>=<span class="string">&#123;this.props.deleteItem&#125;</span></div><div class="line">                      <span class="attr">editItem</span>=<span class="string">&#123;this.props.editItem&#125;/</span>&gt;</div><div class="line">          )&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="é…ç½®å…¶ä»–ç»„ä»¶"><a href="#é…ç½®å…¶ä»–ç»„ä»¶" class="headerlink" title="é…ç½®å…¶ä»–ç»„ä»¶"></a>é…ç½®å…¶ä»–ç»„ä»¶</h2><p>ç°åœ¨,ä½ å¯èƒ½å¯¹æµç¨‹æœ‰äº›ç†Ÿæ‚‰äº†.ä¸ºäº†è®©æœ¬æ–‡ä¸è¦å¤ªé•¿,æˆ‘é‚€è¯·ä½ çœ‹çœ‹ç»„ä»¶çš„ä»£ç ,<br><code>TextInput</code>(<a href="https://github.com/phacks/redux-todomvc/commit/8550a95fc589ecaa184367bb907c8dfeffc29d2f" target="_blank" rel="external">ç›¸å…³æäº¤</a>),<code>TodoHeader</code>(<a href="https://github.com/phacks/redux-todomvc/commit/cc97354bab0a0369f0c39b34ff24b44084a75ebb" target="_blank" rel="external">ç›¸å…³æäº¤</a>),<code>Todotools</code>å’Œ<code>Footer</code>(<a href="https://github.com/phacks/redux-todomvc/commit/237dbc36135427f3b5398f19fcc09ecb1e26d895" target="_blank" rel="external">ç›¸å…³æäº¤</a>)ç»„ä»¶.å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·ç•™ä¸‹è¯„è®º,æˆ–ç€åœ¨repoçš„issueä¸­ç•™ä¸‹è¯„è®º.</p>
<p> ä½ å¯èƒ½ä¸»è¦åˆ°ä¸€äº›å‡½æ•°,ä¾‹å¦‚<code>editItem</code>,<code>toggleComplete</code>è¯¸å¦‚æ­¤ç±»çš„,è¿˜æ²¡æœ‰è¢«å®šä¹‰.è¿™äº›å†…å®¹å°†ä¼šåœ¨æ•™ç¨‹çš„ä¸‹ä¸€éƒ¨åˆ†ä½œä¸ºRedux actionsçš„ç»„æˆæ¥å®šä¹‰,æ‰€ä»¥å¦‚æœé‡åˆ°é”™è¯¯,ä¸è¦æ‹…å¿ƒ.</p>
<h2 id="åŒ…è£…èµ·æ¥"><a href="#åŒ…è£…èµ·æ¥" class="headerlink" title="åŒ…è£…èµ·æ¥"></a>åŒ…è£…èµ·æ¥</h2><p> åœ¨è¿™ç¯‡æ–‡ç« ä¸­,æˆ‘å·²ç»æ¼”ç¤ºäº†æˆ‘çš„ç¬¬ä¸€ä¸ªReact,Reduxå’ŒImmutable webapp.æˆ‘ä»¬çš„UIæ˜¯æ¨¡å—åŒ–çš„.å®Œå…¨é€šè¿‡æµ‹è¯•,å‡†å¤‡å’Œå®é™…çš„appé€»è¾‘è”ç³»èµ·æ¥.æ€ä¹ˆæ¥è¿æ¥ï¼Ÿè¿™äº›å‚»ç“œç»„ä»¶ä»€ä¹ˆéƒ½ä¸çŸ¥é“,æ€ä¹ˆè®©æˆ‘ä»¬å¯ä»¥å†™å‡ºæ—¶é—´æ—…è¡Œçš„app?</p>
<p> <a href="http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-2/" target="_blank" rel="external">æ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†åœ¨è¿™é‡Œ</a>.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç¿»è¯‘ç‰ˆæœ¬,&lt;a href=&quot;http://www.theodo.fr/blog/2016/03/getting-started-with-react-redux-and-immutable-a-test-driven-tutorial-part-1
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-é‡æ–°æ€è€ƒRedux</title>
    <link href="http://yoursite.com/2017/03/03/%E7%BF%BB%E8%AF%91-%E9%87%8D%E6%96%B0%E6%80%9D%E8%80%83Redux/"/>
    <id>http://yoursite.com/2017/03/03/ç¿»è¯‘-é‡æ–°æ€è€ƒRedux/</id>
    <published>2017-03-03T00:04:10.000Z</published>
    <updated>2017-03-23T08:52:34.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><em>Arunoda Susiripala  <a href="https://voice.kadira.io/rethinking-redux-f1e96daba60c#.svx11tv8l" target="_blank" rel="external">å‚çœ‹åŸæ–‡</a>,è¿™ç¯‡æ–‡ç« å‘å¸ƒæœ‰äº›æ—¶é—´äº†,ä½†ä»ç„¶æ˜¯å¾ˆå¥½çš„å­¦ä¹ èµ„æ–™,è€Œä¸”åœ¨éšç€å­¦ä¹ å’Œäº†è§£çš„æ·±å…¥,è®¸å¤šæœ‰æ„æ€çš„æƒ³æ³•å¾—åˆ°è¯å®,é‚£æ„Ÿè§‰çœŸæ˜¯å¾ˆå¥½.æ¯”å¦‚æˆ‘å‰é¢è¯ç”Ÿäº†ä¸€ä¸ªæƒ³æ³•,reduxå°±æ˜¯ä¸€ä¸ªæ•°æ®å±‚å•Š!å¯ä»¥å€ŸåŠ©æ•°æ®åº“çš„æ€æƒ³æ¥å­¦ä¹ ,åŒ…æ‹¬å…¶ä¸­è¯ç”Ÿçš„ä¸€äº›ä¸­é—´æ€æƒ³.åœ¨è¿™ç¯‡æ–‡ç« æœ‰æœ‰äº†æ–°çš„å‘ç°,åœ¨Meteorçš„stateç®¡ç†æ–¹æ³•ç›´æ¥ä½¿ç”¨äº†<code>minimongo cache</code>çš„åå­—,åå­—é‡Œçš„å«ä¹‰ä¸è¨€è‡ªæ˜äº†.å°±æ˜¯è¿™äº›å°ç‚¹æ…¢æ…¢ä½¿æˆ‘çš„å­¦ä¹ è¿‡ç¨‹æ›´åŠ æ·±å…¥.å½“ç„¶ä¹Ÿæœ‰ä¸€äº›æ–°çš„æƒ³æ³•,æœ‰å…´è¶£çš„å¾€ä¸‹çœ‹çœ‹.<br>   Dec 22, 2015</em></p>
<hr>
<p>   #é‡æ–°æ€è€ƒRedux<br>   Reduxæ˜¯éå¸¸å¥½çš„æ¡†æ¶.è¿™ç¯‡æ–‡ç« æ—¢ä¸æ˜¯Reduxçš„æ‰©å……ä¹Ÿä¸æ˜¯è¦åˆ›å»ºä¸€ä¸ªæ–°çš„Fluxåº“,è¿™é‡Œæ˜¯å¯¹Reduxæ¨¡å¼çš„é‡æ–°æ€è€ƒ.</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯Redux"><a href="#ä»€ä¹ˆæ˜¯Redux" class="headerlink" title="ä»€ä¹ˆæ˜¯Redux?"></a>ä»€ä¹ˆæ˜¯Redux?</h3><p>   åœ¨æˆ‘ä»¬è®¨è®ºæ–°å†…å®¹ä¹‹å‰,è®©æˆ‘ä»¬å…ˆçœ‹çœ‹Reduxæ˜¯ä»€ä¹ˆ.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-078a8427c21f15a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="Redux flow pic"></p>
<ul>
<li>æœ¬è´¨ä¸Š,Reduxæ˜¯æˆ‘ä»¬çš„appé‡Œå­˜å‚¨å®¢æˆ·ç«¯stateçš„åœ°æ–¹.</li>
<li>ä¸€äº›actionså¯ä»¥æ”¹å˜state.</li>
<li><p>æˆ‘ä»¬ä½¿ç”¨çº¯å‡½æ•°æ¥ç›‘å¬æ‰€æœ‰çš„actionså¹¶ä¸”ä½¿ç”¨å½“å‰çš„stateä½œä¸ºä¸Šä¸‹æ–‡å»åˆ›å»ºæ–°çš„state.è¿™ä¸ªå‡½æ•°å«reducer.<br>(ä¹‹æ‰€ä»¥å«çº¯å‡½æ•°,æ˜¯å› ä¸ºå®ƒä¸ä¼šçªå˜state,è€Œä¸”å®ƒä¹Ÿæ²¡æœ‰ä»»ä½•å¼‚æ­¥æ“ä½œ.)</p>
</li>
<li><p>æœ‰å¾ˆå¤šè®¢é˜…è€…ç›‘å¬ç€ä»–ä»¬éœ€è¦ä¿®æ”¹çš„state.</p>
</li>
</ul>
<p>å¦‚æœä½ æ˜¯Reduxæ–°æ‰‹,çœ‹çœ‹è¿™äº›ç”±<a href="https://egghead.io/series/getting-started-with-redux" target="_blank" rel="external">Reduxåˆ›å»ºè€…å‘å¸ƒçš„è§†é¢‘</a></p>
<p>æˆ‘ä»¥å‰å’Œä½ ä¸€æ ·,ä½†æ˜¯æˆ‘ç°åœ¨å–œæ¬¢Redux.</p>
<h2 id="ä¸ºä»€ä¹ˆæ˜¯Redux"><a href="#ä¸ºä»€ä¹ˆæ˜¯Redux" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯Redux?"></a>ä¸ºä»€ä¹ˆæ˜¯Redux?</h2><p>ç°åœ¨æœ‰è¶³å¤Ÿçš„ç†ç”±ä½¿ç”¨Reactæ„å»ºapp.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çˆ¶å­æ•°æ®æµ,Meteorçš„Tracker based system,Relayæˆ–è€…Mobservable.</p>
<p>è¿™äº›æ–¹æ³•å¯¹äºç®€å•app(æˆ–è€…ä¸­å‹appåº”ç”¨)æ¥è¯´è¿˜æ˜¯æŒºå¥½çš„.ä½†æ˜¯ä¸€æ—¦appè§„æ¨¡å˜å¤§,ææœ‰å¯èƒ½ä¼šä¸§å¤±appçš„æ§åˆ¶æƒ.</p>
<blockquote>
<p>æˆ‘ä¹‹æ‰€ä»¥è¿™ä¹ˆè¯´æ˜¯ä»æˆ‘ä¸¤æ¬¡é‡æ„kandira UIçš„ç»éªŒæ¥çš„,é‚£ä¸ªè¿‡ç¨‹å¤ªç—›è‹¦äº†.</p>
</blockquote>
<p>èƒ½å’ŒReduxå¾ˆé«˜å·¥ä½œçš„æ„æ¶å°±æ˜¯Redux.</p>
<p>Reduxæ˜¯ä¸€ä¸ªç®€å•æ¦‚å¿µ,å®ƒé‡‡ç”¨äº†ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µ(å®é™…ä¸Šæ¥è‡ªElm)å’ŒFluxçš„æ„æ¶.</p>
<p>æœ‰äº†Redux,</p>
<ul>
<li>æˆ‘ä»¬çš„stateæ˜¯å¯ä»¥é¢„æœŸçš„,åœ¨appä¸­ä¹Ÿæ˜¯è¿™æ ·</li>
<li>appçš„å¤§éƒ¨åˆ†æ˜¯çº¯å‡½æ•°,UIä¹Ÿæ˜¯çº¯å‡½æ•°.æ‰€ä»¥å¾ˆå®¹æ˜“æµ‹è¯•.</li>
<li>Reduxæ˜¯ä¸€ä¸ªç®€å•çš„åº“,æ‰€ä»¥æ²¡æœ‰ä»»ä½•é­”æ³•.</li>
<li>Reduxé‡Œçš„æ¨¡å¼è¢«å¾ˆå¤šå¼€å‘è€…ä½¿ç”¨.æ‰€æœ‰ä½ å¯ä»¥ä¾æ®å¾ˆå¥½çš„ç”Ÿæ€ç³»ç»Ÿ.</li>
</ul>
<p>ä¸Šé¢è¿™äº›è§‚ç‚¹å°±æ˜¯æˆ‘è®¤ä¸ºReduxéå¸¸é‡è¦çš„åŸå› .</p>
<p>##é‡æ–°æ€è€ƒ<br>æˆ‘ä»¬æ­£åœ¨è€ƒè™‘ä½¿ç”¨å®¢æˆ·ç«¯stateå’ŒMeteroåå°äº¤äº’æ¥é‡å†™app.æˆ‘ä»¬è®¤ä¸ºReduxçš„æ¨¡å‹æ›´åˆé€‚.ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰è®¸å¤šé—®é¢˜è¦è€ƒè™‘,åœ¨é‚£äº›åœ°æ–¹ä¹¦å†™é€»è¾‘ä»£ç ,æ€ä¹ˆå‡å°‘æ¨¡æ¿ä»£ç é‡.<br> æˆ‘ä»¬ä¹Ÿä¸æ€ä¹ˆç¡®ä¿¡Reduxçš„stateç®¡ç†æ€ä¹ˆå’Œå…¶ä»–çš„stateç®¡ç†ç³»ç»Ÿæ•´åˆ,æ¯”å¦‚Meteorçš„minimongo cache(è¯‘è€…:å•è¯çš„å«ä¹‰æ„å‘³ç€å¯ä»¥çœ‹åšç®€å•çš„mongo æ•°æ®åº“,çœ‹åˆ°è¿™é‡Œä½ æœ‰ä»€ä¹ˆæƒ³æ³•å‘¢ï¼Ÿ).è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æƒ³è¦å¯»æ±‚ä¸€äº›æ”¹å˜.</p>
<p> ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹æˆ‘ä»¬å»ºè®®çš„ä¸€äº›ä¿®æ”¹.</p>
<h3 id="ä½¿ç”¨Reduxç®¡ç†UIçš„state"><a href="#ä½¿ç”¨Reduxç®¡ç†UIçš„state" class="headerlink" title="ä½¿ç”¨Reduxç®¡ç†UIçš„state"></a>ä½¿ç”¨Reduxç®¡ç†UIçš„state</h3><p> åœ¨æˆ‘ä»¬çš„appä¸­,æˆ‘ä»¬è¦ä¿ç•™ä¸€äº›states,Reduxå°±æ˜¯ç”¨äºUI stateç®¡ç†çš„ç»„ä»¶.åœ¨Reduxä¹‹å¤–å¯èƒ½ä¼šæœ‰å…¶ä»–éƒ¨åˆ†æ¥ç®¡ç†state,ä¾‹å¦‚åƒæ˜¯REST APIçš„ç¼“å­˜æˆ–è€…GraphQL.åœ¨Meteorä¸­,å¯èƒ½æ˜¯Minimongo cache.</p>
<p> ###Reduxä¸­çš„å¯¼èˆª<br> update:<br>  åœ¨è¯„è®ºå’Œå…¶ä»–åœ°æ–¹,æˆ‘å‡†å¤‡è¯•è¯•simple-redux-router.çœ‹èµ·æ¥å¯ä»¥åœ¨Reduxä¸­è¿›è¡Œå¯¼èˆª.ä»–å…è®¸Reactè·¯ç”±å™¨ç®¡ç†å¸ƒå±€å’Œdispatch actionsåˆ°store.<br>  æˆ‘æŠŠsimple-redux-routerå’Œæˆ‘çš„sample appè¿›è¡Œæ•´åˆ,æ•´åˆè¿‡ç¨‹è¿˜å¥½é™¤äº†å³æ—¶åŠ è½½è¿‡ç¨‹.<br>  ç°åœ¨,æˆ‘ä»¬å‡†å¤‡æŠŠReact Routerå’ŒReduxåˆå¹¶.ä½†æ˜¯æˆ‘ä»¬ä»”ç»†è€ƒè™‘ä¸€ä¸‹å°±å¯ä»¥å‘ç°,routing(è·¯ç”±)å…¶å®æ˜¯å¦ä¸€ç§ç”¨æˆ·çš„action,ç±»ä¼¼æŒ‰é’®çš„ç‚¹å‡»action.æ‰€ä»¥routerä¸åº”è¯¥æˆä¸ºappçš„ç®¡ç†æˆ–è€…app stateçš„ç®¡ç†å·¥å…·.<br>  ç†æƒ³Reduxä¸­çš„routeråº”è¯¥åº”routeçš„æ”¹å˜è€Œå‘èµ·actions.è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦åšçš„å·¥ä½œ.ç„¶åæˆ‘ä»¬ä½¿ç”¨reduceræ¥æ”¹å˜éœ€è¦çš„app state.</p>
<h3 id="ä½¿ç”¨æ¨¡å—çš„ç›®å½•ç»“æ„"><a href="#ä½¿ç”¨æ¨¡å—çš„ç›®å½•ç»“æ„" class="headerlink" title="ä½¿ç”¨æ¨¡å—çš„ç›®å½•ç»“æ„"></a>ä½¿ç”¨æ¨¡å—çš„ç›®å½•ç»“æ„</h3><p>  æ¨èçš„æ˜¯é»˜è®¤çš„å¸ƒå±€ç›®å½•ç»“æ„.ä½†æ˜¯æˆ‘ä»¬éœ€è¦æ·»åŠ æ–°çš„ç‰¹æ€§æ—¶,æˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªç›®å½•ä¸­æ·»åŠ ä»£ç .<br>  æœ‰ä¸€ä¸ªæ¨¡å¼å«åš<code>é¸­å­</code>æ¨¡å‹,å»ºè®®æˆ‘ä»¬æŒ‰ç»„æŠŠç›¸å…³çš„actions creatorså’Œreduceræ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­.æˆ‘ä»¬å‡†å¤‡ä½¿ç”¨è¿™ä¸ªæ–¹æ³•.æˆ‘ä»¬ä¹Ÿå‡†å¤‡æŠŠç›¸äº’å…³è”çš„ç»„ä»¶å’Œredux containeræ”¾åˆ°ä¸€ä¸ªå•ä¸€ç›®å½•ä¸­.</p>
<p>  ###ç”¨äºæ•°æ®åŠ è½½çš„ä¸€äº›åŠ©æ‰‹å‡½æ•°.</p>
<p>  æˆ‘ä»¬éœ€è¦æ•°æ®æ¥æ¸²æŸ“ç»„ä»¶,é€šå¸¸æˆ‘ä»¬é€šè¿‡action creatoræ¥åšè¿™ä»¶äº‹.ä½†æ˜¯ä¸ºäº†æŠŠæ•°æ®åŠ è½½å’Œç»„ä»¶æ¸²æŸ“å¾ˆå¥½çš„æ•´åˆåœ¨ä¸€èµ·,æˆ‘ä»¬éœ€è¦å†™ä¸€äº›æ¨¡æ¿å¼çš„ä»£ç .æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›åŠ©æ‰‹æ–¹æ³•æ¥æ¶ˆé™¤è¿™äº›æ¨¡æ¿ä»£ç .</p>
<p>  ###æ•´åˆåœ¨ä¸€èµ·<br>  ä¸ºäº†å……åˆ†ç†è§£è¿™äº›ç†å¿µ,æˆ‘ä»¬å¿…éœ€è¯»ä¸€äº›ä»£ç .è¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ„å»ºå®ä¾‹ä»£ç appçš„åŸå› .<br>  è¿™é‡Œæ˜¯repo:<a href="https://github.com/kadira-samples/rethinking-redux-demo" target="_blank" rel="external">rethinking-redux-demo</a>.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Arunoda Susiripala  &lt;a href=&quot;https://voice.kadira.io/rethinking-redux-f1e96daba60c#.svx11tv8l&quot; target=&quot;_blank&quot; rel=&quot;exte
    
    </summary>
    
      <category term="Â ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘-ä¸­é—´ä»¶å’ŒReact-Redux-ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="http://yoursite.com/2017/03/01/%E7%BF%BB%E8%AF%91-%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%92%8CReact-Redux-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <id>http://yoursite.com/2017/03/01/ç¿»è¯‘-ä¸­é—´ä»¶å’ŒReact-Redux-ç”Ÿå‘½å‘¨æœŸ/</id>
    <published>2017-03-01T00:04:10.000Z</published>
    <updated>2017-03-23T08:51:50.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><em>rajaraodv </em> <a href="https://medium.com/@rajaraodv/using-middlewares-in-react-redux-apps-f7c9652610c6#.fu82u8qjf" target="_blank" rel="external">åŸæ–‡è¯·å‚çœ‹</a>.</p>
<p>å¦‚æœä½ ä½¿ç”¨è¿‡ç±»ä¼¼Express.jsæ¡†æ¶æ„å»ºNode.jsç¨‹åº,ä½ å°±å¯èƒ½åœ¨ä½¿ç”¨ä¸­é—´ä»¶,å¹¶ä¸”çŸ¥é“ä»–ä»¬æ€ä¹ˆå·¥ä½œ.Reduxç»™å‰ç«¯å¼•å…¥åŒæ ·çš„æ¦‚å¿µ.</p>
</blockquote>
<h2 id="ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ï¼Ÿ</h2><p>ä¸­é—´ä»¶æ˜¯å¯ä»¥è¢«æ¡†æ¶è‡ªåŠ¨è°ƒç”¨çš„å‡½æ•°,åœ¨æ¡†æ¶ä¸­æ•°æ®æµç»“æŸä¹‹å‰,åœ¨æ•°æ®æµä¸­åŠ å¼ºæˆ–è€…æ”¹å˜è¾“å‡º.<br>ä¾‹å¦‚:å¦‚æœæ¡†æ¶é‡Œé¢æ²¡æœ‰ä¸­é—´ä»¶æ˜¯è¿™ä¸ªæ ·å­çš„:</p>
<p><code>funcAâ€Šâ€”â€Šcallsâ†’ funcBâ€Šâ€”â€Šcallsâ†’ funcC</code></p>
<p>æ·»åŠ äº†ä¸­é—´ä»¶ä»¥å,æ§åˆ¶æµå°±å˜ä¸º:<br><code>funcAâ€Šâ€”â€Šcallsâ†’ funcBâ€Šâ€”â€Šcallsâ†’ funcMiddleWare1â€Šâ€”â€Šback to â†’funcB. funcB â†’ then callsâ†’ funcMiddleWare2â€Šâ€”â€Šback toâ†’ funcB. funcBâ€Šâ€”â€Šfinally callsâ†’ funcC</code></p>
<p>æ³¨æ„ï¼šfuncBæœ€ç»ˆè°ƒç”¨funcCä½†æ˜¯åœ¨è°ƒç”¨funcCä¹‹å‰è¦è°ƒç”¨ä¸¤ä¸ªä¸­é—´ä»¶.</p>
<h2 id="æ²¡æœ‰ä¸­é—´ä»¶çš„Reduxç”Ÿå‘½å‘¨æœŸ"><a href="#æ²¡æœ‰ä¸­é—´ä»¶çš„Reduxç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ²¡æœ‰ä¸­é—´ä»¶çš„Reduxç”Ÿå‘½å‘¨æœŸ"></a>æ²¡æœ‰ä¸­é—´ä»¶çš„Reduxç”Ÿå‘½å‘¨æœŸ</h2><p>è®©æˆ‘ä»¬æƒ³çœ‹çœ‹Redux appç”Ÿå‘½å‘¨æœŸ,æ¥æ›´å¥½çš„ç†è§£å®ƒ.</p>
<p>åœºæ™¯:ç‚¹å‡»â€Click Meâ€æŒ‰é’®,æ›´æ–°â€Clicked xyz timesâ€ æ–‡æœ¬.</p>
<p>å›¾ç‰‡1</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-da53be67e7cd17d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800" alt="1*9E8kenASCn6TWNM9-dEL4Q.png"></p>
<p>åœºæ™¯ï¼šç°åœ¨,å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™,æˆ‘ä»¬æƒ³æŠŠç‚¹å‡»çš„æ•°ç›®ä¿å­˜åˆ°æœåŠ¡å™¨,å¹¶ä¸”åœ¨debuggä¸­å±•ç¤ºstateçš„å˜åŒ–æ—¥å¿—.è®©æˆ‘ä»¬çœ‹çœ‹ç°åœ¨çš„æ§åˆ¶æµ.</p>
<p>å›¾ç‰‡2</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-196ed4d492237d61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800" alt="1*kzLsHNZpJ9HVA4On9YkgAw.png"></p>
<p>åœ¨Reduxä¸­,ä¸­é—´ä»¶å‡½æ•°ä¸€ä¸ªæ¥ä¸€ä¸ªçš„è¢«è°ƒç”¨,ç›´åˆ°æ‰€æœ‰çš„ä¸­é—´ä»¶è¢«è°ƒç”¨,ç„¶åâ€œActionâ€å¯¹è±¡å‘—å‘é€åˆ°â€œReducerâ€.</p>
<p>æ³¨æ„:è¿™å°±å…è®¸ä¸­é—´ä»¶æœ‰ä¿®æ”¹Actionå¯¹è±¡çš„æ½œåŠ›,åœ¨æœ€ç»ˆè°ƒç”¨Reducersä¹‹å‰,è§£æAJAXè°ƒç”¨,è¿˜å¯ä»¥åšå…¶ä»–äº‹æƒ…æ¯”å¦‚æ—¥å¿—.Reeucerså°†ä¼šæ›´æ–°state,åœ¨appéœ€è¦çš„æ—¶å€™æ¸²æŸ“ç»„ä»¶.</p>
<h2 id="ä½¿ç”¨ä¸­é—´ä»¶"><a href="#ä½¿ç”¨ä¸­é—´ä»¶" class="headerlink" title="ä½¿ç”¨ä¸­é—´ä»¶"></a>ä½¿ç”¨ä¸­é—´ä»¶</h2><p>Reduxæœ‰ä¸ªå·¨å¤§çš„ç¤¾åŒº,å·²ç»æ„å»ºäº†<a href="https://github.com/xgrommx/awesome-redux#react---a-javascript-library-for-building-user-interfaces" target="_blank" rel="external">å¤§é‡å¯ä»¥å®Œæˆå„ç§ä»»åŠ¡çš„ä¸­é—´ä»¶</a>.</p>
<p>æ‰€æœ‰ä½ éœ€è¦åšçš„å°±æ˜¯:</p>
<ol>
<li>é€šè¿‡npm å®‰è£…</li>
<li>é…ç½®æˆ–è€…æ·»åŠ åˆ°Redux</li>
</ol>
<p>ä¾‹å¦‚ï¼šåœ¨æˆ‘å‰é¢çš„blogï¼š<a href="https://medium.com/@rajaraodv/a-guide-for-building-a-react-redux-crud-app-7fe0b8943d0f#.aenutqb0r" target="_blank" rel="external">åˆ›å»ºReact Redux CRUDç¨‹åºæŒ‡å—</a>,appä¸ºCRUDæ“ä½œåšAJAXè¯·æ±‚.<br>åœ¨é‡Œé¢,æˆ‘ä½¿ç”¨AXiosçš„åº“æ¥åšAJAXè°ƒç”¨.ä½†æ˜¯Axiosè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡.ä½†æ˜¯Actionséœ€è¦ä¼ é€’ç»™Reducersçš„æ˜¯ä¸€ä¸ªçº¯ç²¹çš„JSONå¯¹è±¡.æ‰€ä»¥åœ¨åœ¨æ•°æ®åˆ°è¾¾Reducersä¹‹å‰ä½¿ç”¨redux-promiseè§£æActionä¸­çš„Promiseå¯¹è±¡.</p>
<p>ä¸ºäº†ä½¿ç”¨,é¦–å…ˆå®‰è£….</p>
<p><code>npm install â€” save redux-promise</code></p>
<p>å†åšä¸€ç‚¹é…ç½®å·¥ä½œ:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> React <span class="keyword">from</span> â€˜reactâ€™;</div><div class="line">...</div><div class="line">import &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> â€˜reduxâ€™;</div><div class="line"><span class="keyword">import</span> rp <span class="keyword">from</span> â€˜redux-promiseâ€™; <span class="comment">// &lt;------------ MIDDLEWARE</span></div><div class="line">...</div><div class="line"><span class="comment">//add middlewares</span></div><div class="line"><span class="keyword">const</span> createStoreWithMiddleware = applyMiddleware(rp)(createStore);</div><div class="line">ReactDOM.render(</div><div class="line"> <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;createStoreWithMiddleware(reducers)&#125;</span>&gt;</span></span></div><div class="line"> <span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;browserHistory&#125;</span> <span class="attr">routes</span>=<span class="string">&#123;routes&#125;</span> /&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></div><div class="line"> , document.getElementById(â€˜bodyâ€™));</div></pre></td></tr></table></figure>
<hr>
<h2 id="ä¸­é—´ä»¶æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"><a href="#ä¸­é—´ä»¶æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ" class="headerlink" title="ä¸­é—´ä»¶æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"></a>ä¸­é—´ä»¶æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h2><p>å¦‚æœä½ çœ‹äº†<a href="https://github.com/acdlite/redux-promise" target="_blank" rel="external">redux-promise</a>,ä½ å°±å¯ä»¥çœ‹åˆ°ä»–æ˜¯æ€ä¹ˆå·¥ä½œçš„.</p>
<p>è¿™é‡Œæ˜¯ä¼ªä»£ç :</p>
<ol>
<li>Reduxè°ƒç”¨ä¸­é—´ä»¶,â€œdispatch(å‡½æ•°)â€,â€œnext(å‡½æ•°)â€å’Œâ€actionâ€œJSONå¯¹è±¡.</li>
<li>ä¸­é—´ä»¶æ£€æŸ¥â€actionâ€å¯¹è±¡,çœ‹çœ‹æ˜¯å¦æœ‰Promiseå¯¹è±¡</li>
<li>å¦‚æœæ²¡æœ‰Promiseå¯¹è±¡,è°ƒç”¨â€nextâ€œå‡½æ•°è¿”å›åˆ°Redux.</li>
<li>å¦‚æœè¿™æ ·åš,ä»–ä¼šé™„åŠ ä¸ŠæˆåŠŸæˆ–è€…å¤±è´¥çš„å›è°ƒå‡½æ•°,ç­‰å¾…æœåŠ¡å™¨çš„å“åº”.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//redux-promise middleware source code</span></div><div class="line"><span class="keyword">import</span> &#123; isFSA &#125; <span class="keyword">from</span> <span class="string">'flux-standard-action'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPromise</span>(<span class="params">val</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> val &amp;&amp; <span class="keyword">typeof</span> val.then === <span class="string">'function'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseMiddleware</span>(<span class="params">&#123; dispatch &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="params">next</span> =&gt;</span> action =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (!isFSA(action)) &#123;</div><div class="line">      <span class="keyword">return</span> isPromise(action)</div><div class="line">        ? action.then(dispatch)</div><div class="line">        : next(action);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> isPromise(action.payload)</div><div class="line">      ? action.payload.then(</div><div class="line">          <span class="function"><span class="params">result</span> =&gt;</span> dispatch(&#123; ...action, <span class="attr">payload</span>: result &#125;),</div><div class="line">          error =&gt; dispatch(&#123; ...action, <span class="attr">payload</span>: error, <span class="attr">error</span>: <span class="literal">true</span> &#125;)</div><div class="line">        )</div><div class="line">      : next(action);</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>æ›´å¤šå†…å®¹è¯·çœ‹:</p>
<ol>
<li><a href="http://redux.js.org/docs/advanced/Middleware.html" target="_blank" rel="external">å®˜æ–¹Redux ä¸­é—´ä»¶æ–‡æ¡£</a></li>
<li><a href="https://github.com/xgrommx/awesome-redux#react---a-javascript-library-for-building-user-interfaces" target="_blank" rel="external">ä¸­é—´ä»¶åˆ—è¡¨</a></li>
<li>åˆ°<a href="https://medium.com/@rajaraodv/a-guide-for-building-a-react-redux-crud-app-7fe0b8943d0f#.aenutqb0r" target="_blank" rel="external">A Guide For Building A React Redux CRUD APP</a>.</li>
</ol>
<p>å°±è¿™äº›å†…å®¹äº†.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;rajaraodv &lt;/em&gt; &lt;a href=&quot;https://medium.com/@rajaraodv/using-middlewares-in-react-redux-apps-f7c9652610c6#.fu82u8qjf&quot; ta
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>Javascript Thiså…³é”®å­—å…¨è§£æ</title>
    <link href="http://yoursite.com/2017/01/08/This%20keywords/"/>
    <id>http://yoursite.com/2017/01/08/This keywords/</id>
    <published>2017-01-08T00:04:10.000Z</published>
    <updated>2017-03-23T02:44:12.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2044710-9f870a42dbc62877.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/200" alt="cover.jpg"></p>
<p>ã€Šä½ ä¸çŸ¥é“çš„javascriptã€‹è¿™æœ¬ä¹¦è¯»äº†æœ‰å¥½å‡ éäº†ï¼Œä¼¼ä¹æ¯ä¸€æ¬¡è¯»éƒ½æœ‰æ–°å‘ç°ï¼Œæœ‰äº›å†…å®¹å¹¶ä¸æ˜¯ä¸€ä¸‹å­å¯ä»¥å¼„æ‡‚çš„ï¼Œæ¯æ¬¡è¯»ä¼¼ä¹éƒ½èƒ½æ˜ç™½ä¸€äº›æ¦‚å¿µã€‚<br>å†é‡è¯»ä¸€ä¸‹<code>this</code>å…³é”®å­—ã€‚è¿™ä¸ªæ¦‚å¿µéå¸¸çµæ´»ï¼Œä¹Ÿéå¸¸éš¾æŒæ¡ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—ç»å¸¸è¯»è¯»æ²¡æœ‰åå¤„ã€‚æœŸå¾…javascriptä¸€æ¡¶æ±Ÿæ¹–ï¼Œè¿™æ ·å­¦ä¹ çš„æˆæœ¬å°±ä½å•¦ï¼<br>å‚è€ƒæœ¬ä¹¦çš„ç¬¬äºŒéƒ¨åˆ†çš„ç¬¬ä¸€ç« ï¼Œç¬¬äºŒç« ã€‚<a id="more"></a></p>
<blockquote>
<p>thiså…³é”®å­—æ˜¯jsä¸­æœ€æœ€å¤æ‚çš„æœºåˆ¶ä¹‹ä¸€ã€‚ä»–è¢«è‡ªåŠ¨å®šä¹‰åˆ°æ‰€æœ‰å‡½æ•°çš„ä½œç”¨åŸŸä¸­ã€‚</p>
</blockquote>
<p>åœ¨å­¦ä¹ è¿™ä¸ªå…³é”®å­—çš„è¿‡ç¨‹ä¸­ä¼¼ä¹ä¹Ÿèµ°äº†å¾ˆé•¿æ—¶é—´çš„å¼¯è·¯ã€‚ä½ è¦é—®æˆ‘ä¸ºä»€ä¹ˆèµ°äº†å¾ˆé•¿æ—¶é—´çš„å¼¯è·¯ï¼Œå…³é”®çš„åœ°æ–¹è¿˜æ˜¯æ²¡æœ‰å¯¹æ ¸å¿ƒçš„æ¦‚å¿µå½»åº•å­¦ä¹ å’Œé¢†ä¼šï¼Œè¿™ä¸€ç‚¹å’Œå°å­¦ç”Ÿå­¦ä¹ æ–°çŸ¥è¯†æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚è¦æƒ³æŒæ¡thisè¿™ä¸ªå…³é”®å­—ï¼Œéœ€è¦ç´§æ‰£å…³é”®æ¦‚å¿µï¼Œä¸è¦å‡­ç©ºæƒ³è±¡è¿™åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚</p>
<p><strong>å…³é”®æ¦‚å¿µï¼šjsä¸­çš„å‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¸€å®šï¼Œä¸€å®šï¼Œä¸€å®šä¼šç»‘å®šåœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œåœ¨åˆ†æthiså…³é”®å­—çš„æ—¶å€™ï¼Œä¸€å®šè¦çŸ¥é“å‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™è¿™ä¸ªå¯¹è±¡åˆ°åº•æ˜¯è°ï¼Ÿ</strong>ã€‚<br><strong>åˆ‡è®°ï¼šjsä¸­å‡½æ•°çš„è°ƒç”¨å’Œå®šä¹‰æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œå‡½æ•°æ‰€ç»‘å®šçš„å¯¹è±¡ç›´åˆ°ä»–è¢«è°ƒç”¨çš„æ—¶å€™æ‰èƒ½çŸ¥é“ã€‚</strong></p>
<p>thiså…³é”®å­—çš„ä¸ç¡®å®šå®šæ˜¯æŠŠåŒåˆƒå‰‘ï¼Œä¸€æ˜¯å‡½æ•°è°ƒç”¨æ—¶çš„å¯¹è±¡ä¸ç¡®å®šæ€§ï¼Œæ˜¯jsä¸­å‡½æ•°çš„ä½¿ç”¨å…·æœ‰å¾ˆå¤§çµæ´»æ€§ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å€Ÿç”¨å…¶ä»–å‡½æ•°æ¥å®ŒæˆåŠŸèƒ½ã€‚äºŒæ˜¯è¿™ä¹Ÿé€ æˆäº†thiså­¦ä¹ çš„ä¸€äº›å›°æ‰°ã€‚æ‰€ä»¥åœ¨å­¦ä¹ çš„æ—¶å€™å…ˆè¦ç†è§£thiså…³é”®å­—çš„ä¼˜ç‚¹ï¼Œç„¶åå†å»å­¦ä¹ é€ æˆå›°æ‰°çš„åœ°æ–¹</p>
<p>é¦–å…ˆçœ‹çœ‹ç¬¬ä¸€æ®µä»£ç <br>page 75<br>    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line"><span class="comment">//æ³¨æ„åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æœªè°ƒç”¨ï¼Œè¿™æ—¶å€™å‡½æ•°æ˜¯æ²¡æœ‰ç»‘å®šä»»ä½•å¯¹è±¡</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">identify</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.name.toUpperCase();</div><div class="line">&#125;</div><div class="line"><span class="comment">//åŒä¸Šé¢çš„å‡½æ•°,ä½†æ˜¯è¿™ä¸ªå‡½æ•°å†…éƒ¨æœ‰ç‚¹å¤æ‚ï¼Œå¦‚æœä¸‹é¢çš„ä»£ç çœ‹ä¸æ‡‚</span></div><div class="line"><span class="comment">//å¯ä»¥åªçœ‹ä¸Šé¢çš„å‡½æ•°</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">speak</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> greeting = <span class="string">"Hello, I'm "</span> + identify.call( <span class="keyword">this</span> );</div><div class="line">	<span class="built_in">console</span>.log( greeting );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> me = &#123; <span class="comment">//å®šä¹‰äº†ä¸€ä¸ªå­—é¢é‡å¯¹è±¡</span></div><div class="line">	name: <span class="string">"Kyle"</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> you = &#123;<span class="comment">//å®šä¹‰äº†ä¸€ä¸ªå­—é¢é‡å¯¹è±¡</span></div><div class="line">	name: <span class="string">"Reader"</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">//é€šè¿‡callæ–¹å¼æŠŠå‡½æ•°identifyåˆ†åˆ«ç»‘å®šåˆ°ä¸¤ä¸ªå¯¹è±¡ä¸Š</span></div><div class="line"><span class="comment">//è¿™æ—¶çš„thisæ˜¯æŒ‡å‘meå¯¹è±¡ï¼Œå’Œyouå¯¹è±¡</span></div><div class="line">identify.call( me ); <span class="comment">// KYLE  </span></div><div class="line">identify.call( you ); <span class="comment">// READER</span></div><div class="line"></div><div class="line"><span class="comment">//é€šè¿‡callæ–¹å¼æŠŠå‡½æ•°callåˆ†åˆ«ç»‘å®šåˆ°ä¸¤ä¸ªå¯¹è±¡ä¸Š</span></div><div class="line"><span class="comment">//è¿™æ—¶çš„thisæ˜¯æŒ‡å‘meå¯¹è±¡ï¼Œå’Œyouå¯¹è±¡</span></div><div class="line">speak.call( me ); <span class="comment">// Hello, I'm KYLE</span></div><div class="line">speak.call( you ); <span class="comment">// Hello, I'm READER</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>åœ¨javascriptä¸­å®šä¹‰å‡½æ•°çš„æ—¶å€™ï¼Œå‡½æ•°æ˜¯ä¸å±äºä»»ä½•å¯¹è±¡çš„ã€‚è¿™ä¸€ç‚¹éå¸¸çš„å…³é”®ï¼Œéå¸¸çš„å…³é”®ï¼Œéå¸¸çš„å…³é”®ã€‚è¿™æ˜¯ç†è§£thiså…³é”®å­—çš„ç¬¬ä¸€ä¸ªéšœç¢ã€‚</p>
</blockquote>
<p>thiså…³é”®å­—åœ¨jså‡½æ•°å®šä¹‰çš„æ—¶å€™çš„ä¸ç¡®å®šæ€§ä½¿å¾—jså‡½æ•°ä½¿ç”¨æœ‰æå¤§çš„çµæ´»æ€§ï¼Œä»»ä½•å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨ä»–ã€‚</p>
<p>###thisåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>thisçš„ç»‘å®šå’Œå‡½æ•°å®šä¹‰çš„ä½ç½®æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåª<code>å–å†³äºå‡½æ•°è°ƒç”¨çš„æ–¹å¼</code>.<br>javascriptä¸­å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ´»åŠ¨è®°å½•(æœ‰æ—¶ä¹Ÿç§°ä¸Šä¸‹æ–‡)ã€‚è¿™ä¸ªè®°å½•åŒ…æ‹¬å‡½æ•°åœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼Œå‡½æ•°çš„è°ƒç”¨æ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ã€‚thiså°±æ˜¯è®°å½•ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚</p>
<p>è¿™æ ·åœ¨å­¦ä¹ javascriptå…³é”®å­—çš„<code>é¦–è¦é—®é¢˜æ˜¯è¦è§£å†³æ€ä¹ˆçŸ¥é“åˆ°å‡½æ•°çš„è°ƒç”¨ä½ç½®</code>.</p>
<p>###jså¯¹è±¡ç»‘å®šè§„åˆ™</p>
<p>æ¯ä¸ªjså‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ä¸€å®šè¦æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œ<code>ç»‘å®š</code>ä»¥åæ‰èƒ½ä½¿ç”¨ã€‚ è¿™é‡Œæ˜¯ç†è§£äº†jså‡½æ•°çš„å®šä¹‰å’Œè°ƒç”¨çš„åŒºåˆ«ä»¥åéœ€è¦æŒæ¡çš„ä¸€ä¸ªè§„æ¨¡æœ€åºå¤§çš„æ¦‚å¿µï¼Œåœ¨jsä¸­ä¸€å…±æœ‰å››ç§ç»‘å®šæ–¹å¼.å°±æˆ‘ä¸ªäººæ¥çœ‹ï¼Œç»‘å®šè§„åˆ™å¹¶ä¸éš¾ï¼Œ<code>éš¾ç‚¹è¿˜æ˜¯åœ¨jsçš„å‡½æ•°ä½œç”¨åŸŸçš„ç†è§£</code>. å°¤å…¶æ˜¯<code>é»˜è®¤ç»‘å®š</code>.è¿™ä¸ªç»‘å®šæ–¹å¼æœ‰æå¤§çš„è¿·æƒ‘æ€§ã€‚</p>
<p>####é»˜è®¤ç»‘å®š<br>è¿™ä¸ªæ˜¯å‡½æ•°çš„ç‹¬ç«‹è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°ç›´æ¥è°ƒç”¨çš„æ—¶å€™ï¼Œä¼¼ä¹æ˜¯æ²¡æœ‰ç»‘å®šåˆ°å¯¹è±¡ä¸Šçš„ï¼Œä½†æ˜¯æ ¹æ®å‰é¢çš„ä»‹ç»ï¼Œjsä¸­å‡½æ•°è°ƒç”¨æ—¶å¿…é¡»è¦ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šã€‚<br>çœ‹ä¸‹é¢ä»£ç  page 83</p>
<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">//è¿™æ˜¯å‡½æ•°çš„å®šä¹‰ä½ç½®</span></div><div class="line">	<span class="built_in">console</span>.log( <span class="keyword">this</span>.a );</div><div class="line">&#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> a = <span class="number">2</span>;<span class="comment">//è¿™ä¸ªå˜é‡å®šä¹‰çš„å«ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»…ä»…æ˜¯èµ‹å€¼ç»™aå—ï¼Ÿ</span></div><div class="line"></div><div class="line">  foo(); <span class="comment">// 2  //è¿™æ˜¯å‡½æ•°çš„è°ƒç”¨ä½ç½®ã€‚ä¸ºä»€ä¹ˆä¼šæ‰“å°å‡º2å‘¢ï¼Ÿ</span></div></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>å¾ˆå¤šå‡½æ•°éƒ½æ˜¯è¿™ä¹ˆè°ƒç”¨çš„ï¼Œç…§çŒ«ç”»è™ä¹Ÿå¯ä»¥å†™å‡ºæ¥ï¼Œä½†æ˜¯ç†è§£äº†å…·ä½“çš„å«ä¹‰å°±ä¸ä¸€æ ·äº†ã€‚<br>fooè¿™ä¸ªå‡½æ•°å®šä¹‰åœ¨å…¨å±€ä½œç”¨åŸŸä¸­(windowä½œç”¨åŸŸä¸­)ï¼Œå·§åˆçš„æ˜¯ä»–çš„è°ƒç”¨ä¹Ÿæ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œæ³¨æ„è¿™ä»…ä»…æ˜¯å·§åˆï¼Œå·§åˆã€‚ é‚£ä¹ˆfoo()è°ƒç”¨çš„æ—¶å€™ä¸ºä»€ä¹ˆä¼šæ‰“å°å‡ºå˜é‡ açš„å€¼å‘¢ï¼Ÿå°½ç®¡ä½¿ç”¨äº†varè¿™ä¸ªå…³é”®å­—ï¼Œä½†æ˜¯åˆ†æä½œç”¨åŸŸå¯ä»¥çŸ¥é“ï¼Œaè¿™ä¸ªå˜é‡å®é™…æ˜¯å…¨å±€å˜é‡ï¼Œè¯´çš„å†æ˜ç™½ä¸€ç‚¹ï¼Œaå®é™…æ˜¯windowè¿™ä¸ªå…¨å±€å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œ2æ˜¯è¿™ä¸ªå±æ€§çš„å±æ€§å€¼ã€‚<br>foo()è°ƒç”¨çš„æ—¶å€™æ˜¯ä¸€ä¸ä¸æŒ‚çš„å…¨è£¸çŠ¶æ€ï¼Œä»…ä»…æ˜¯å‡½æ•°æœ¬èº«ï¼Œæ²¡æœ‰ä»»ä½•ä¿®é¥°ç¬¦ï¼Œè¿™ä¸ªæ—¶å€™ä»–ä¹Ÿæ²¡æœ‰ä»»ä½•å‡½æ•°åŒ…è£¹ï¼Œå¤„åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹é¢ï¼Œæ‰€ä»¥foo()é‡Œé¢çš„thisæ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡çš„ï¼Œå½“è¦æ‰“å°this.açš„æ—¶å€™ï¼Œå¯»æ‰¾foo()è°ƒç”¨ä½ç½®ä¼šæ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œæ‰¾å…¨å±€ä½œç”¨åŸŸçš„å±æ€§this.açš„æ—¶å€™ä¼šæ‰“å°å‡º2è¿™ä¸ªå±æ€§å€¼ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨setTimeout,setIntervalå‡½æ•°çš„æ—¶å€™ï¼Œå®é™…è¿™ä¸¤ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ä¸æŒ‚çš„ï¼ŒåŒæ ·ç»‘å®šåœ¨windowå¯¹è±¡ä¸Šã€‚</p>
<p>####éšå¼ç»‘å®š</p>
<p>å‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™è¢«æ·»åŠ äº†ä¿®é¥°ç¬¦ã€‚çœ‹ä¸‹é¢è¿™ä¸ªä»£ç <br>page 85</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">  <span class="function">function <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="comment">//å®šä¹‰åœ¨å…¨å±€ä½œç”¨ä¸‹çš„å‡½æ•°ï¼Œä»…ä»…æ˜¯å®šä¹‰ï¼Œä¸æ˜¯è°ƒç”¨ä½ç½®</span></div><div class="line">	console.<span class="built_in">log</span>( <span class="keyword">this</span>.a );</div><div class="line">&#125;</div><div class="line"></div><div class="line">var obj = &#123; <span class="comment">//å®šä¹‰ä¸€ä¸ªå¯¹è±¡</span></div><div class="line">	a: <span class="number">2</span>,</div><div class="line">	foo: foo</div><div class="line">&#125;;</div><div class="line"></div><div class="line">obj.foo(); <span class="comment">// 2  ç»™foo()å‡½æ•°æ‰¾äº†ä¸€ä¸ªå¯¹è±¡ï¼Œthiså°±æŒ‡å‘è¿™ä¸ªå¯¹è±¡äº†</span></div></pre></td></tr></table></figure>
<p>è¿™æ˜¯æœ€å¸¸è§çš„æ–¹å¼äº†ï¼Œå¦‚æœä¸å†™å‰é¢çš„objæ˜¯ä¸æ˜¯å°±æ˜¯ä¸Šé¢çš„é»˜è®¤ç»‘å®šäº†ï¼Ÿ</p>
<p><code>éšå¼ä¸¢å¤±</code><br>ç»å¸¸åœ¨jsä»£ç çš„åµŒå¥—å›è°ƒå‡½æ•°ä¸­çœ‹åˆ°åœ¨å¤–å±‚å‡½æ•°å¼€å§‹çš„ä¸€å¥ </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  that=<span class="keyword">this</span>; <span class="comment">//è¿™æ˜¯ä»€ä¹ˆå«ä¹‰</span></div></pre></td></tr></table></figure>
<p>æˆ–è®¸ä½ å·²ç»ä¼šç”¨äº†ï¼Œä½†æ˜¯ç†è§£äº†å…¶ä¸­æ„ä¹‰ç”¨èµ·æ¥ä¼šæ›´åŠ å¾—å¿ƒåº”æ‰‹å•Š</p>
<p>çœ‹ä¸‹é¢æ®µä»£ç .è¿™æ®µä»£ç å…¶å®ä»¥å‰æˆ‘ä¹Ÿä¸å¤ªç†è§£ï¼Œé—®é¢˜è¿˜æ˜¯æ²¡æœ‰å½»åº•é¢†æ‚Ÿjså‡½æ•°å®šä¹‰å’Œè°ƒç”¨ä¹‹é—´æ˜¯æ²¡æœ‰å…³ç³»çš„è¿™ä¸€ç‚¹ã€‚<br>page 86</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function">function <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="comment">//å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°</span></div><div class="line">	console.<span class="built_in">log</span>( <span class="keyword">this</span>.a );</div><div class="line">&#125;</div><div class="line"></div><div class="line">var obj = &#123; <span class="comment">//å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å­—é¢é‡</span></div><div class="line">	a: <span class="number">2</span>,</div><div class="line">	foo: foo  <span class="comment">//å‡½æ•°ä½œä¸ºå¯¹å¯¹è±¡çš„å±æ€§</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">var bar = obj.foo; <span class="comment">//æŠŠobjå¯¹è±¡çš„å‡½æ•°fooå±æ€§èµ‹å€¼ç»™barå˜é‡</span></div><div class="line"><span class="comment">//è¿™é‡Œå°±æ˜¯ç†è§£è¿™ä¸ªé—®é¢˜çš„å…³é”®ï¼Œå¦‚æœä½ ç°åœ¨è®¤ä¸ºè°ƒç”¨bar()çš„æ—¶å€™ç»‘å®šçš„å¯¹è±¡</span></div><div class="line"><span class="comment">//æ˜¯objé‚£å°±å®Œå…¨æé”™äº†ã€‚è¿™ä¸ªæ—¶å€™ä»…ä»…æ˜¯æŠŠå‡½æ•°fooèµ‹å€¼ç»™äº†varå˜é‡ï¼Œ</span></div><div class="line"><span class="comment">//å¹¶æ²¡æœ‰æŠŠå¯¹è±¡ä¹Ÿç»™barå˜é‡ï¼Œå› ä¸ºè¿™é‡Œè¿˜ä¸æ˜¯foo()å‡½æ•°çš„è°ƒç”¨ä½ç½®ï¼Œç°åœ¨</span></div><div class="line"><span class="comment">//fooå‡½æ•°è¿˜æ²¡æœ‰ç»‘å®šå¯¹è±¡ï¼Œé‚£ä¹ˆè°ƒç”¨bar()çš„æ—¶å€™å¯¹è±¡åˆ°åº•æ˜¯è°ï¼Ÿä¸çŸ¥é“ã€‚</span></div><div class="line"><span class="comment">//è°ƒç”¨çš„æ—¶å€™æ‰çŸ¥é“ã€‚</span></div><div class="line"></div><div class="line">var a = <span class="string">"oops, global"</span>; <span class="comment">// ä»»ç„¶æ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§</span></div><div class="line">bar(); <span class="comment">// "oops, global" è¿™é‡Œæ‰§è¡Œçš„æ˜¯é»˜è®¤ç»‘å®šï¼Œthiså°±æ˜¯å»å…¨å±€å¯¹è±¡å•¦</span></div></pre></td></tr></table></figure>
<p>ä¸‹é¢è¿™æ®µä»£ç å°±æ˜¯ä½¿ç”¨var that=thisçš„åœºæ™¯<br>åœ¨ä½¿ç”¨å›è°ƒå‡½æ•°çš„æ—¶å€™è¦ç•™å¿ƒã€‚jsä¸­å‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡ï¼Œå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ä¼ å…¥å‡½æ•°ã€‚ é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œäº†ï¼Œå‡½æ•°ä¸€æ—¦ä½œä¸ºå®å‚ä»£æ›¿å½¢å‚çš„æ—¶å€™ï¼Œå®é™…ä¹Ÿæ‰§è¡Œäº†å’Œä¸Šé¢ä»£ç ä¸€æ ·çš„èµ‹å€¼è¿‡ç¨‹ï¼Œå®é™…åªæ˜¯ä¼ é€’äº†å‡½æ•°æœ¬èº«ï¼ŒåŸå…ˆçš„å¯¹è±¡å°±æ²¡æœ‰äº†ã€‚</p>
<p>page 86</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function">function <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="comment">//å®šä¹‰ä¸€ä¸ªå‡½æ•°</span></div><div class="line">	console.<span class="built_in">log</span>( <span class="keyword">this</span>.a );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">function <span class="title">doFoo</span><span class="params">(fn)</span> </span>&#123; <span class="comment">//fnæ˜¯å½¢å‚</span></div><div class="line">	<span class="comment">// å¦‚æœå‡½æ•°ä½œä¸ºå®å‚ä¼ å…¥ç›¸å½“äºä»£ç  var fn=obj.foo</span></div><div class="line">	<span class="comment">//å’Œä¸Šé¢ä¸€æ®µä»£ç æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯å‡½æ•°æœ¬èº«ï¼Œå¹¶æ²¡æœ‰ç»‘å®šä»»ä½•å¯¹è±¡</span></div><div class="line"></div><div class="line">	fn(); <span class="comment">// åœ¨è¿™é‡Œè°ƒç”¨çš„æ—¶å€™ï¼Œç”±äºfnåªä»£è¡¨foo()å‡½æ•°ï¼Œè¢«ç»‘å®šåˆ°å…¨å±€å¯¹è±¡ä¸Šäº†</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">var obj = &#123;</div><div class="line">	a: <span class="number">2</span>,</div><div class="line">	foo: foo</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var a = <span class="string">"oops, global"</span>; <span class="comment">// `a` also property on global object</span></div><div class="line"></div><div class="line">doFoo( obj.foo ); <span class="comment">// "oops, global"ä¸è¦è¢«obj.fooè¿·æƒ‘äº†</span></div><div class="line"><span class="comment">//æ²¡æœ‰å®é™…æ‰§è¡Œå‡½æ•°çš„è°ƒç”¨ï¼Œæ­¤æ—¶obj.fooä»…ä»…ä»£è¡¨æ²¡æœ‰ç»‘å®šä»»ä½•å¯¹è±¡çš„å‡½æ•°</span></div><div class="line"></div><div class="line"><span class="comment">//è¿™ä¸ªä»£ç å—çœ‹ç€çœ¼ç†Ÿä¹ˆï¼Ÿè¿™å°±æ˜¯javascriptä¸­å›è°ƒå‡½æ•°çš„æ ·å­ï¼Œå½“</span></div><div class="line"><span class="comment">//ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è¿›å¦ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™,è¿™ä¸ªå‚æ•°å‡½æ•°å°±æ‰¾ä¸åˆ°è‡ªå·±ç»‘å®šçš„å¯¹è±¡æ˜¯è°äº†ï¼Œ</span></div><div class="line"><span class="comment">//æ‰€ä»¥å°±é»˜è®¤ç»‘å®šåˆ°å…¨å±€å¯¹è±¡ä¸Šäº†ã€‚ä½†æ˜¯æˆ‘ä»¬æ—¢ç„¶åœ¨ä¸€ä¸ªå‡½æ•°é‡Œè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œè‚¯å®šæ˜¯è¦ç”¨è¿™ä¸ªå‡½æ•°æ“ä½œå½“å‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ—¢ç„¶æ‰¾ä¸åˆ°äº†ï¼Œæˆ‘ä»¬å°±æ‰‹åŠ¨ç»™ä»–æŒ‡å®šä¸€ä¸ªå¯¹è±¡å§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨</span></div><div class="line"><span class="comment">//var  that=thisçš„åŸå› ã€‚æˆ‘è§‰å¾—ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œjsçš„åŠŸåŠ›è‡³å°‘ä¼šå¢åŠ 5%ğŸ˜ã€‚è‡³äºå…·ä½“ä½¿ç”¨ï¼Œæˆ‘æƒ³å†™å‡ºæ¥å…¶å®æ²¡æœ‰ä»€ä¹ˆå¿…è¦äº†ã€‚è¿™æ ·çš„ä»£</span></div><div class="line"><span class="comment">//ç éšå¤„å¯è§.</span></div></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬ä¼šè¿”å›æ¥çœ‹çœ‹æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>####æ˜¾ç¤ºç»‘å®š</p>
<p>ç›´æ¥ä½¿ç”¨apply()å’Œcall()æ–¹æ³•æ¥ç»™å‡½æ•°æŒ‡å®šä¸€ä¸ªå¯¹è±¡<br>page 88</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">   <span class="function">function <span class="title">foo</span><span class="params">()</span> </span>&#123;  <span class="comment">//å®šä¹‰å‡½æ•°</span></div><div class="line">	console.<span class="built_in">log</span>( <span class="keyword">this</span>.a );</div><div class="line">&#125;</div><div class="line"></div><div class="line">var obj = &#123;  <span class="comment">//å¯¹è±¡å­—é¢é‡å®šä¹‰</span></div><div class="line">	a: <span class="number">2</span> </div><div class="line">&#125;;</div><div class="line"></div><div class="line">foo.call( obj ); <span class="comment">// 2  å¼ºåˆ¶ç»‘å®šåˆ°objå¯¹è±¡ä¸Š</span></div></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ˜¾ç¤ºç»‘å®šè¿˜ä¸èƒ½è§£å†³thisçš„ä¸¢å¤±é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…è£¹å‡½æ•°</p>
<p>page 89</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">  <span class="function">function <span class="title">foo</span><span class="params">(something)</span> </span>&#123; <span class="comment">//å®šä¹‰å‡½æ•°</span></div><div class="line">	console.<span class="built_in">log</span>( <span class="keyword">this</span>.a, something );</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.a + something;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var obj = &#123; <span class="comment">//å¯¹è±¡å­—é¢é‡</span></div><div class="line">	a: <span class="number">2</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">var bar = function() &#123; åŒ…è£¹å‡½æ•°ï¼Œæ˜¾ç¤ºç»‘å®š</div><div class="line">	<span class="keyword">return</span> foo.apply( obj, arguments );</div><div class="line"> <span class="comment">//è¿”å›ç»‘å®šäº†å¯¹è±¡å’Œä¼ å…¥å‚æ•°çš„å‡½æ•°è°ƒç”¨</span></div><div class="line"> <span class="comment">//è¿™ä¸ªè¯­å¥åœ¨jsçš„ä»£ç ä¸­éå¸¸çš„å¸¸è§</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">var b = bar( <span class="number">3</span> ); <span class="comment">// 2, 3  </span></div><div class="line">console.<span class="built_in">log</span>( b ); <span class="comment">// 5</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//å¯ä»¥æŠŠç»‘å®šå‡½æ•°ç‹¬ç«‹å‡ºæ¥</span></div><div class="line"></div><div class="line"><span class="function">function <span class="title">bind</span><span class="params">(fn, obj)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> function() &#123;</div><div class="line">		<span class="keyword">return</span> fn.apply( obj, arguments );</div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####new ç»‘å®š</p>
<blockquote>
<p>jsä¸­çš„newå…³é”®å­—å’Œjavaä¸­å®Œå…¨ä¸åŒï¼Œjsä¸­æ²¡æœ‰ç±»ï¼Œåªæœ‰å¯¹è±¡ï¼Œåœ¨jsä¸­ä½¿ç”¨new å…³é”®å­—çš„æ—¶å€™åªæ˜¯è¢«è°ƒç”¨çš„æ™®é€šå‡½æ•°</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="function">function <span class="title">foo</span><span class="params">(a)</span> </span>&#123;  <span class="comment">//å®šä¹‰å‡½æ•°</span></div><div class="line">	<span class="keyword">this</span>.a = a;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var bar = <span class="keyword">new</span> foo( <span class="number">2</span> ); <span class="comment">//ä»…ä»…æ˜¯è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°</span></div><div class="line">console.<span class="built_in">log</span>( bar.a ); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>å¥½äº†ä»¥ä¸Šå°±æ˜¯js thisç»‘å®šçš„å››ç§æ–¹å¼ã€‚  è§£å†³çš„å…³é”®é—®é¢˜æ˜¯jsä¸­åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™åˆ°åº•æ˜¯å±äºå“ªä¸ªå¯¹è±¡çš„é—®é¢˜ã€‚ </p>
<p>åé¢è¿˜æœ‰ä¸€ç‚¹å†…å®¹ï¼Œä½†æ˜¯ä¸Šé¢çš„å†…å®¹æ˜¯æœ€é‡è¦çš„ã€‚  2017å¹´1æœˆ17æ—¥<br><code>çš„ç¡®åŒ…è£¹å‡½æ•°é‚£é‡Œå¥½åƒæ˜¯æ²¡æœ‰è®²æ¸…æ¥šï¼Œæˆ‘ä¹Ÿå¿˜äº†å½“åˆæ˜¯æ€ä¹ˆç†è§£çš„ï¼Œç­‰æˆ‘å†çœ‹çœ‹ï¼Œç„¶åæ›´æ–°ã€‚æœ‰äº›åœ°æ–¹å·²ç»åšäº†æ›´æ–°!</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2044710-9f870a42dbc62877.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/200&quot; alt=&quot;cover.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;ã€Šä½ ä¸çŸ¥é“çš„javascriptã€‹è¿™æœ¬ä¹¦è¯»äº†æœ‰å¥½å‡ éäº†ï¼Œä¼¼ä¹æ¯ä¸€æ¬¡è¯»éƒ½æœ‰æ–°å‘ç°ï¼Œæœ‰äº›å†…å®¹å¹¶ä¸æ˜¯ä¸€ä¸‹å­å¯ä»¥å¼„æ‡‚çš„ï¼Œæ¯æ¬¡è¯»ä¼¼ä¹éƒ½èƒ½æ˜ç™½ä¸€äº›æ¦‚å¿µã€‚&lt;br&gt;å†é‡è¯»ä¸€ä¸‹&lt;code&gt;this&lt;/code&gt;å…³é”®å­—ã€‚è¿™ä¸ªæ¦‚å¿µéå¸¸çµæ´»ï¼Œä¹Ÿéå¸¸éš¾æŒæ¡ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—ç»å¸¸è¯»è¯»æ²¡æœ‰åå¤„ã€‚æœŸå¾…javascriptä¸€æ¡¶æ±Ÿæ¹–ï¼Œè¿™æ ·å­¦ä¹ çš„æˆæœ¬å°±ä½å•¦ï¼&lt;br&gt;å‚è€ƒæœ¬ä¹¦çš„ç¬¬äºŒéƒ¨åˆ†çš„ç¬¬ä¸€ç« ï¼Œç¬¬äºŒç« ã€‚
    
    </summary>
    
      <category term="testing" scheme="http://yoursite.com/categories/testing/"/>
    
    
  </entry>
  
  <entry>
    <title>understanding React(2)</title>
    <link href="http://yoursite.com/2016/05/29/understanding%20React(2)/"/>
    <id>http://yoursite.com/2016/05/29/understanding React(2)/</id>
    <published>2016-05-28T23:53:25.000Z</published>
    <updated>2017-03-23T02:45:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>#####understanding React2</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#####understanding React2&lt;/p&gt;

    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/categories/javascript/"/>
    
    
  </entry>
  
  <entry>
    <title>understanding React(1)</title>
    <link href="http://yoursite.com/2016/05/29/understanding%20React(1)/"/>
    <id>http://yoursite.com/2016/05/29/understanding React(1)/</id>
    <published>2016-05-28T23:53:25.000Z</published>
    <updated>2017-03-23T02:51:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>Rect/Reduxçš„ç³»åˆ—æ–‡ç« <a id="more"></a><br>ç†è§£Reactç¨‹åº(1)-å®‡å®™å¤§çˆ†ç‚¸çš„å¥‡ç‚¹.<br>å½“å¤§çº¦160äº¿å¹´å‰å®‡å®™å¤§çˆ†ç‚¸ä»ä¸€ä¸ªå¥‡ç‚¹å¼€å§‹çš„æ—¶å€™,ç¬¬ä¸€ç¼•å…‰åœ¨å®‡å®™ä¸­æ‰©å±•å¼€æ¥,çˆ†ç‚¸æ—¶äº§ç”Ÿçš„å®‡å®™èƒŒæ™¯è¾å°„è‡³ä»Šåœ¨å®‡å®™çš„æ—¶ç©ºä¸­åˆ°å¤„æ¸¸è¡,ä½œä¸ºä¸€ä¸ªæ™®é€šäººä¹Ÿå¯ä»¥å¾ˆå®¹æ„ŸçŸ¥åˆ°åˆ°ä»–ä»¬çš„å­˜åœ¨,ä¸ä¿¡çš„è¯æ¬å‡ºä½ å®¶é‡ŒçŠ„è§’æ—®æ—¯é‡Œè½æ»¡ç°å°˜çš„åäºŒå¯¸é»‘ç™½ç”µè§†æœº,åªè¦èƒ½ç‚¹äº®ä½ å°±å¯ä»¥æ„ŸçŸ¥åˆ°ä»–ä»¬å­˜åœ¨.é‚£ä¹ˆä»–ä»¬æ˜¯ä»€ï¼Ÿæ²¡æœ‰ç”µè§†èŠ‚ç›®çš„æ—¶å€™,æ»¡å±çš„é›ªèŠ±ç‚¹å°±æ˜¯ç”µè§†å¤©çº¿æ¥å—åˆ°çš„å®‡å®™èƒŒæ™¯è¾å°„.è‡³ä»Šå…³äºå®‡å®™å¤§çˆ†ç‚¸çš„å¥‡ç‚¹åˆ°åº•æ˜¯æ˜¯ä»€ä¹ˆï¼Ÿè°åšçš„ç¨‹åºæ¶æ„,åˆè¡·æ˜¯ä»€ä¹ˆï¼Ÿè¿·ä»ç„¶æ²¡æœ‰è§£å¼€,ç”šè‡³åœ¨å®‡å®™å¤§çˆ†ç‚¸å¼€å§‹ä¹‹å‰,è¿æ—¶é—´éƒ½æ˜¯ä¸å­˜åœ¨çš„.ç§‘å­¦å®¶å¼„ç»Ÿçš„æŠŠæ‰€æœ‰çš„æœªè§£ä¹‹è°œéƒ½ä¸¢ç»™äº†å¥‡ç‚¹,ä¸ºäº†è‡ªåœ†å…¶è¯´,åˆåˆ›å»ºäº†å…¶ä»–çš„ç†è®º.æˆ–è®¸æœ¬æ¥å°±å­˜åœ¨å¤šä¸ªå¥‡ç‚¹,æ‰€ä»¥å­˜åœ¨å¥½å¤šå¹³è¡Œçš„å®‡å®™.å¥½å§ï¼ä¸Šé¢çš„æ˜¯ä¸€ä¸ªè„‘æ´å¤§å¼€çš„è¿‡ç¨‹,ä½ å¯èƒ½ä¼šè¯´ä½ è¯´çš„è¿™äº›ä¸œè¥¿åˆ°åº•å’Œç¨‹åºå¼€å‘æœ‰åŠç‚¹å…³ç³»å—ï¼Ÿæˆ–è®¸æœ‰å§,ä¹Ÿæˆ–è®¸æ›´æœ¬æ²¡æœ‰ä»»ä½•å…³ç³».çœ‹ä½ æ˜¯æ€ä¹ˆç†è§£äº†.</p>
<p>ä¸‹é¢æˆ‘æŠŠè¿™ä¸ªä¸»é¢˜æœ‰å…³çš„å†™ä½œæƒ³æ³•è®²ä¸€ä¸‹.</p>
<ul>
<li>ç¼–ç¨‹åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿå”¯ä¸€çš„ç›®çš„æ˜¯:<code>ä¿¡æ¯</code>.ç¼–ç¨‹å°±æ˜¯ä¼ é€’ä¿¡æ¯.Reactä½œä¸ºJavascriptç¼–ç¨‹è¯­è¨€çš„å­é›†,ä»–æ˜¯åœ¨ä¼ é€’ä¿¡æ¯å—ï¼Ÿå½“ç„¶æ˜¯äº†.å¦‚æœä½ æ˜ç™½äº†æˆ‘è¯´çš„è¿™å¥è¯,åé¢æˆ‘è¦è®²çš„é—®é¢˜å°±å®¹æ˜“å•¦. æ‰€æœ‰çš„æ•°æ®ç»“æ„åŒ…æ‹¬æ›´é«˜çº§çš„æ•°æ®åº“éƒ½æ˜¯å›´ç»•ç€<code>ä¿¡æ¯</code>æ¥è¿è½¬çš„.è¿™ä¸ªä¸»é¢˜æˆ‘åŸæœ¬æƒ³æ”¾åˆ°æœ€åæ¥å†™.å¤´è„‘é‡Œå‡ºç°è¿™ä¸ªæ¦‚å¿µçš„æ—¶å€™,å…¶å®ä¹Ÿæ˜¯ç†è§£äº†ä¸€äº›ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µä»¥åæ‰æœ‰çš„.ä½†æˆ‘æœ¬äººä»¥å‰æ²¡æœ‰æ·±å…¥å­¦ä¹ è¿‡å…¶ä»–ç¼–ç¨‹è¯­è¨€,å¦‚æœä½ æ˜¯æ·±å…¥å­¦ä¹ å’Œäº†è§£è¿‡ä¸€ç§ç¼–ç¨‹è¯­è¨€,é‚£ä¹ˆè¿™é‡Œè®²çš„å†…å®¹å°±å®¹æ˜“ç†è§£äº†.<code>å¦‚æœæˆ‘ä»¬æŠŠä¸ºäº†è§£å†³Reactç¼–ç¨‹ä¸­å‡ºç°çš„stateç®¡ç†é—®é¢˜å¼•å…¥çš„Reduxçœ‹åšæ˜¯ä¸€ç§ç®€å•çš„æ•°æ®åº“ç³»ç»Ÿ</code>,æœ‰äº›é—®é¢˜å°±èƒ½æ‰¾åˆ°å·²çŸ¥æ¦‚å¿µä½œä¸ºç†è§£çš„ä¾æ‰˜äº†.è¿™ä¸ªæ¦‚å¿µ,å¹¶éæˆ‘è‡ªå·±æå‡º,åŸå…ˆæ˜¯æœ‰ç‚¹éšçº¦çš„æƒ³æ³•,åœ¨çœ‹äº†ä¸€æœ¬æœ‰å…³Reactæ¦‚å¿µçš„ä¹¦çš„æ—¶å€™,è§‰å¾—è¿™ä¸ªæƒ³æ³•æ˜¯å¾ˆæ­£ç¡®çš„.æ•°æ®åº“æ“ä½œæ ¸å¿ƒçš„æ¦‚å¿µå°±æ˜¯CRUD,è¿˜æœ‰å—ï¼Ÿæ•°æ®çš„éªŒè¯,æ•°æ®çš„è¿‡æ»¤ç­‰ç­‰.è¿™äº›æ¦‚å¿µå¦‚æœä½ æ¯”ç…§ä»»ä½•ä¸€ç§æ•°æ®åº“çš„æ“ä½œ,éƒ½å¯ä»¥åœ¨Reduxå’ŒReduxä¸­é—´ä»¶ä¸­æ‰¾åˆ°ç±»ä¼¼çš„æ¦‚å¿µ.</li>
<li>æ—¢ç„¶æˆ‘ä»¬è¯´åˆ°äº†å®‡å®™å¤§çˆ†ç‚¸çš„å¥‡ç‚¹ç†è®ºäº†,é‚£ä¹ˆå¦‚æœæŠŠReactç¨‹åºçœ‹æˆæ˜¯ä¸€ä¸ªå¥‡ç‚¹,æ¯”å®‡å®™å¤§çˆ†ç‚¸ç†è®ºå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>å¥‡ç‚¹</code>æ˜¯æ€ä¹ˆå½¢æˆçš„.Reactçš„å¥‡ç‚¹æ˜¯ä¸€ä¸ªhtmlæ–‡ä»¶.å¯¹äºReactçš„çˆ†ç‚¸è¿‡ç¨‹,æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥å®Œå…¨è§£é‡Šæ¸…æ¥šçš„.ç”šè‡³æˆ‘ä»¬è¿˜å¯ä»¥è®©è¿™ä¸ªçˆ†ç‚¸è¿‡ç¨‹æ— é™æ¬¡çš„é‡å¤.æœ‰ç‚¹è™šå¹»äº†å§.æ²¡æœ‰å¼•å…¥é­”å¹»ç°å®ä¸»ä¹‰çš„<code>ä¸€åªæ–—é¸¡</code>[^è¿™åªæ–—é¸¡æ¥è‡ªäºé©¬å°”å…‹æ–¯çš„ã€Šæ²¡æœ‰äººå†™ä¿¡çš„ä¸Šå°‰ã€‹,å®é™…è¿™æœ¬ä¹¦æ²¡æœ‰ä»»ä½•é­”å¹»å†™è¯—ä¸»ä¹‰,é™¤äº†è¿™åªé¸¡çš„ä¸€ä¸ç‚¹æå†™]å’Œçœ‹æ–‡ç« çš„ä½ æ¥å¯¹è¯,æˆ‘å·²ç»å¦¥åäº†.è¿™ä¸ªè¿‡ç¨‹ä¼šå®é™…éœ€è¦ä¸¤æ–¹é¢çš„å†…å®¹å°±å¯ä»¥äº†,ä¸€æ˜¯Node.jsçš„çŸ¥è¯†å’Œä¸€ç‚¹React-reduxç¨‹åºåˆå§‹åŒ–çš„çŸ¥è¯†.</li>
<li>ä¸Šé¢ç¬¬ä¸€ç‚¹æˆ‘ä»¬è°ˆåˆ°äº†å§‘ä¸”å¯ä»¥æŠŠReduxçœ‹åšæ˜¯ä¸€ç§<code>æ•°æ®åº“</code>.é‚£ä¹ˆæ•°æ®åº“æ“ä½œå°±æœ‰æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œæ•°æ®çš„éªŒè¯å’Œè¿‡æ»¤è¿‡ç¨‹,å…·ä½“çš„å®ç°è¯­å¥éƒ½åœ¨react-reduxä¸­å®ç°.å¦‚æœæ˜¯å…¶ä»–è¯­è¨€,æˆ‘ä¸çŸ¥é“æ€ä¹ˆæ¥å®ç°,å¦‚æœæ˜¯Redux,å°±å¥½åŠäº†.Reduxæ¨¡å—é‡Œçš„å†…å®¹å…¶å®æ˜¯éå¸¸å°‘çš„.å°‘åˆ°ä»€ä¹ˆç¨‹åº¦,å¯ä»¥è¿™æ ·è¯´Reduxé‡Œé¢é™¤äº†é—­åŒ…å’Œæ•°ç»„æ“ä½œå°±æ²¡æœ‰æ›´å¤šçš„å†…å®¹äº†.ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿä¸‹é¢è¿™ä¸ªæ¦‚å¿µéå¸¸å…³é”®.<code>åœ¨javascriptä¸­,å…¶ä»–å¯¹è±¡å’Œå‡½æ•°å¯¹è±¡éƒ½æ˜¯ä¼ å¼•ç”¨èµ‹å€¼çš„</code>.æ²¡é”™!javascriptä¹‹æ‰€ä»¥èƒ½å¤Ÿæˆä¸ºä¸€é—¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€.å¯¹è±¡å’Œå‡½æ•°ä¼ å¼•ç”¨èµ‹å€¼æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ¦‚å¿µ,è¿™æ ·åšä»¥å,å‡½æ•°å’Œå¯¹è±¡å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ ‡è®°çš„<code>é”®å</code>.è¿™ä¸ªé”®åå°±å¯ä»¥åœ¨ç¨‹åºé‡Œåˆ°å¤„è¿è¡Œäº†.è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬å€ŸåŠ©äºæ•°æ®åº“çš„æ“ä½œæ¦‚å¿µå’Œjavascriptçš„å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µæ¥ç†è§£Reduxçš„æºç .è¿™ä¸€éƒ¨åˆ†å¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾,å›°éš¾ç‚¹å®é™…æ˜¯æ•°ç»„çš„æ“ä½œæ–¹æ³•çš„çµæ´»åº”ç”¨,å½“ç„¶è¿˜æœ‰<code>é—­åŒ…äº†</code>.è¯´é“è¿™ä¸ªåœ°æ–¹çš„æ—¶å€™æˆ‘ä»¬åœ¨è®¨è®º,æœ¬äººå­¦ä¹ ç¼–ç¨‹æ—¶é—´ä¸é•¿,å¯¹äºè¿™äº›æ–¹æ³•æ½œç§»é»˜åŒ–çš„ä¸œè¥¿å¤ªå°‘,å†™åˆ°ç›¸å…³å†…å®¹ä¸€å®šè¯·é«˜æ‰‹æŒ‡æ•™.</li>
<li>Reduxçš„ä¸­é—´ä»¶,å®é™…åº”ç”¨ä¸­,ç®€å•çš„æµç¨‹å®é™…æ˜¯å¾ˆå°‘çš„.è¿™å¾ˆå¥½ç†è§£å•Š!å°±ç®—æ˜¯ä½ å®¶å°±åœ¨è‡ªæ¥æ°´å‚çš„å¤§é—¨å£,ä½ ä¹Ÿä¸å¯èƒ½æ¯å¤©æ‹¿ç€ä¸€ä¸ªæ¡¶å»æ°´å‚æ‰“æ°´.è‡ªæ¥æ°´å‚çš„æ°´ç»è¿‡å¾ˆå¤šé“çš„å·¥åº,å‡ºå‚çš„æ—¶å€™è¿˜è¦ç»è¿‡å¾ˆå¤šçš„ç®¡é“å’Œæ°´è¡¨æ‰èƒ½åˆ°ä½ å®¶é‡Œ.è‡ªæ¥æ°´å‚æ˜¯ä¸å¯èƒ½åš<code>å¤§è‡ªç„¶çš„æ¬è¿å·¥</code>çš„.[^è¿™ä¸ªæ˜¯çœ‹åˆ°æœ‰ä¸ªå¹½é»˜å›¾ç‰‡ï¼Œé¢˜ç›®æ˜¯æˆ‘ä»¬æ˜¯å¤§è‡ªç„¶çš„æ¬è¿å·¥,ç»“æœæ˜¯æ¡¶è£…æ°´é‡Œæœ‰åªé’è›™åœ¨æ¸¸æ³³,æ„æ€çš„ç¡®æ˜¯å¤§è‡ªç„¶æ¬è¿å·¥,é’è›™éƒ½æ¬è¿äº†].åœ¨æ•°æ®åœ¨Reactå’ŒReduxçš„æµåŠ¨ä¸­,éœ€è¦è§£å†³å¾ˆå¤šçš„ç»†èŠ‚é—®é¢˜,ä¸­é—´ä»¶å°±æ˜¯æ¥å®Œæˆè¿™ä¸ªè¿‡ç¨‹.æœ‰æ—¶å€™äº‹æƒ…è¿˜æ²¡å®Œ.è‡ªæ¥æ°´å‚ä¼šåœ¨è‡ªæ¥æ°´ç”Ÿäº§çš„æ—¶å€™æ·»åŠ æ¼‚ç™½æ¶ˆæ¯’å‰‚.ä¸€æ—¦è¿™æ ·,é—®é¢˜å°±å˜å¾—æ›´å¤æ‚äº†.åˆ°åº•é€‰æ‹©å“ªå®¶çš„æ¬¡æ°¯é…¸é’ ,å‡ æ—¶èƒ½åˆ°è´§,æ¯å®¶çš„ä¸œè¥¿æ·»åŠ çš„æ­¥éª¤æ˜¯ä¸æ˜¯ä¸€æ ·?å¦‚æœçªç„¶ç¼ºè´§äº†,æ€ä¹ˆé€šçŸ¥ç”¨æ°´çš„äºº.è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯Reduxä¸­çš„side effectçš„æ¦‚å¿µ,è™½ç„¶ä¸åœ¨ä¸»æµç¨‹ä¸Š,ä½†æ˜¯å¯¹äºä¸»æµç¨‹è¿˜æ˜¯æœ‰å¾ˆå¤§å½±å“.Reduxåˆ°åº•æ€ä¹ˆå¤„ç†è¿™äº›ç»†èŠ‚ï¼Ÿè¿™éƒ½ä¾èµ–äºä¸­é—´ä»¶æ¥å®ç°.æ‰€ä»¥å¦‚æœè¦ç¼–å†™å¤æ‚çš„åº”ç”¨,è¿™ä¸ªåœ°æ–¹æ˜¯éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´çš„.å¦‚æœæ˜¯ç”Ÿäº§å†œå¤«å±±æ³‰è¿˜å¥½åŠ,å¦‚æœæ˜¯ç”Ÿäº§è„‰åŠ¨,é‚£é—®é¢˜å°±æ›´å¤æ‚å•¦ï¼[^å†œå¤«å±±æ³‰åªæ˜¯æ°´,è„‰åŠ¨é‡Œå°±æ·»åŠ äº†å¾ˆå¤šçš„ç»´ç”Ÿç´ ç­‰ç­‰ä¸œè¥¿].Reduxçš„ä¸­é—´ä»¶ç°åœ¨å¾ˆå¤š,ä½†æ˜¯å®é™…ä¸­ä¸å¯èƒ½æ¯ä¸ªéƒ½ç”¨åˆ°å’Œå­¦ä¹ åˆ°,æ‰€ä»¥åªæ˜¯å…³æ³¨å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ä¸­é—´ä»¶å°±å¯ä»¥äº†.</li>
<li>javascriptçš„æ¨¡å¼è®¾è®¡åœ¨Reactå’ŒReduxä¸­çš„åº”ç”¨,æ¨¡å¼è®¾è®¡åœ¨ç¼–ç¨‹ä¸­æ— å¤„ä¸åœ¨çš„,åœ¨é«˜æ‰‹çš„æºç ä¸­çœ‹è¿™äº›æ¨¡å¼è®¾è®¡æ–¹æ³•,å¯èƒ½æ›´åŠ çš„åŸæ±åŸå‘³å’Œæ ‡å‡†,æ‰€ä»¥æˆ‘ä¹ˆä¹Ÿæ¥ç®€å•çš„è°ˆè°ˆè¿™äº›å†…å®¹,æ¨¡å¼è®¾è®¡å…¶å®å°±æ˜¯Reactå¤§çˆ†ç‚¸çš„èƒŒæ™¯è¾å°„,ä»–å°±å­˜åœ¨äºç¨‹åºçš„ä»»ä½•åœ°æ–¹.</li>
<li>æœ‰å…³æµ‹è¯•-ä½œä¸ºåˆå­¦è€…å¯¹äºç¨‹åºçš„æµ‹è¯•ç†è§£å¤ªå°‘,å€ŸåŠ©ç€è¿™æ¬¡å†™ä½œçš„æœºä¼š,åŠ æ·±è®¤è¯†.</li>
</ul>
<blockquote>
<p>å¥½äº†ï¼Œå¤§æ¦‚è¦å†™çš„ä¸œè¥¿å°±æ˜¯è¿™ä¹ˆå¤šï¼Œåç»­å°±æŒ‰ç…§è¿™ä¸ªæ¡†æ¶æ¥å†™ä½œ.æˆ‘è‡ªå·±èµ·äº†ä¸€ä¸ªåå­—å«<code>æ¡†æ¶å†™ä½œ</code>æˆ–è€…<code>å¤§çº²å†™ä½œ</code>.èµ·å› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿‡å¹´çš„æ—¶å€™åœ¨å®¶é‡Œ,åˆšå¥½è§†é¢‘ç›’å­æœ‰ã€Šå£«å…µçªå‡»ã€‹,æ‰€æœ‰åˆçœ‹äº†ä¸€é,è®°ä¸æ¸…æ˜¯çœ‹çš„ç¬¬å‡ å›äº†.ä½†æ˜¯çœ‹åˆ°æœ‰ä¸€é›†ä¸€å›¢æ”¹ç¼–çš„æ—¶å€™,å¸ˆé•¿å‡ºåœº,æˆ‘è®°å¾—æ•´ä¸ªå£«å…µçªå‡»é‡Œåªå‡ºç°è¿‡ä¸¤ä¸ªå¥³æ€§,å°±æ˜¯è¿™ä¸€é›†.å’Œå…¶ä»–çš„å›½äº§å†›äº‹é¢˜æå¤§ç›¸å¾„åº­,å…¶ä»–çš„å›½äº§å†›äº‹é¢˜æé‡Œéƒ½ä¼šå‡ºç°å‡ ä¸ªé•¿ç›¸ä¿Šç¾,æ‹¿ç€ç”µè„‘çˆ±å¥½è€…ç„Šæ¥ç”µè·¯æ¿,èº«æ‰‹ä¸å‡¡çš„,å’Œç”·ä¸»äººå…¬æç€ä¸çŸ¥é“å‡ ä¸ªè§’çš„æ‹çˆ±å…³ç³».å£«å…µçªå‡»å®Œå…¨å¯ä»¥æŠŠè¿™ä¸¤ä¸ªå¥³æ€§å˜ä¸ºè®¸ä¸‰å¤šå°æ—¶å€™åŒç­çš„ä¸‘å°é¸­,çªç„¶ä¸€ä¸‹çªå˜ä¸ºå£«å…µçªå‡»é‡Œçš„è½åœ¨çª è‡¼é‡Œçš„å¥³ä¸»äººå…¬.åœ¨åŸå…ˆ25é›†çš„ä¸»çº¿é‡Œåœ¨æ·»åŠ è¿™ä¹ˆä¸€ä¸ªä¸­é—´ä»¶,åœ¨æ‹25é›†ä¹Ÿä¸æˆé—®é¢˜å•Š.æ·»åŠ è¿™ä¸ªä¸­é—´ä»¶ä»¥å,é—®é¢˜å°±å¤æ‚äº†,è¿™å¥³ä¸»äººå…¬å¯èƒ½æ˜¯æˆææˆ–è€…ä¼å…­ä¸€çš„å¦¹å¦¹[^æˆæ,ä¼å…­ä¸€å’Œè®¸ä¸‰å¤šæ˜¯åŒä¹¡å—·].å“ˆå“ˆside effectå‡ºç°äº†.åé¢ç¼–å‰§æƒ³æ”¶ç¬”å°±å¾ˆéš¾åˆ¹è½¦äº†. ä½ ä¹Ÿåˆ«ä»¥ä¸ºæˆ‘æ˜¯åœ¨è®²ç¬‘è¯,å¦‚æœä½ åœ¨å›¾ä¹¦é¦†çš„å†™ä½œæ ç›®é‡Œæ‰¾æ‰¾,å¯ä»¥çœ‹åˆ°ç¾å‰§å’Œç”µå½±ç¼–å‰§çš„ä¸€äº›ä¹¦ç±,éƒ½æ˜¯è¿™ä¸ªå¥—è·¯.å‘µå‘µ!ä¸èƒ½å†è®²ä¸‹å»äº†,è¦è¿™ä¹ˆå†™å¾—å¿ƒä¸­æœ‰æ¡†æ¶,è€Œè¦å½¢æˆè¿™ä¸ªæ¡†æ¶éœ€è¦çœ‹å¾ˆå¤šçš„ç±»ä¼¼æ¡†æ¶.è¿™ä¹Ÿæ˜¯å­¦ä¹ ç¼–ç¨‹çš„æ–¹æ³•,å­¦ä¹ æ›´å¤šçš„ä»£ç ,æ‰èƒ½çœ‹åˆ°é‡Œé¢çš„æ¡†æ¶.<br>ã€Šå£«å…µçªå‡»ã€‹æˆ‘çœ‹äº†å¾ˆå¤šé,Reactçš„ç¨‹åºæˆ‘ä¹Ÿçœ‹äº†å¥½å¤š,ä½ çš„é€‰æ‹©æ˜¯ä»€ä¹ˆå‘¢?</p>
</blockquote>
<hr>
<p>æ¥ä¸‹æ¥çš„ä¸€ç¯‡æˆ‘ä»¬è¦çœ‹çœ‹ä¸€ä¸ªReactçš„ç¨‹åºæ˜¯æ€ä¹ˆåŠ è½½åˆ°æµè§ˆå™¨ä¸­çš„.<br>éœ€è¦æœ‰ç‚¹<code>node.js</code>çš„åŸºç¡€çŸ¥è¯†å’Œè‡ªåŠ¨åŒ–æ‰“åŒ…ç¨‹åºçš„åŸºç¡€.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Rect/Reduxçš„ç³»åˆ—æ–‡ç« 
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/categories/javascript/"/>
    
    
  </entry>
  
</feed>
