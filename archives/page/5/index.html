<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
  <meta charset="utf-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <link rel="icon" href="/favicon.ico">
  
  <title>phpsmarter</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox-1.3.4.css">
  <!--在这里倒入jquery 方便处理部分页面的jquery-->
  <script src="https://cdn.staticfile.org/jquery/1.7/jquery.min.js" type="text/javascript" ></script>
</head>
<body class="home">
	<header class="site-header navfixed-false">
  <div class="container">
      <h1><a href="/" title="phpsmarter"><span class="octicon octicon-mark-github"></span> phpsmarter</a></h1>
      <nav class="site-header-nav" role="navigation">
        
              
              <a href="/"  class=" site-header-nav-item hvr-underline-from-center" title="首页">首页</a>
        
              
              <a href="/categories/"  class=" site-header-nav-item hvr-underline-from-center" title="分类">分类</a>
        
              
              <a href="/open-source/"  class=" site-header-nav-item hvr-underline-from-center" title="开源项目">开源项目</a>
        
              
              <a href="/message/"  class=" site-header-nav-item hvr-underline-from-center" title="留言板">留言板</a>
        
              
              <a href="/javascript/"  class=" site-header-nav-item hvr-underline-from-center" title="javascript">javascript</a>
        
      </nav>
  </div>
</header>

	<section class="banner-false">
    <div class="collection-head">
        <div class="container">
            <div class="collection-title">
                <h1 class="collection-header" id="site-description">
                    
                </h1>
                <div class="collection-info">
                    
                    
                    
                        <span class="meta-info">
                            
                                <span class="octicon octicon-location">
                                   
                                        xi&#39;an, China
                                    
                                </span>
                                
                            
                        </span>
                    
                        <span class="meta-info">
                            
                                <span class="octicon octicon-mark-github">
                                   
                                </span>
                                
                                    <a href="http://github.com/phpsmarter" target="_blank">phpsmarter</a>
                                
                            
                        </span>
                    
                </div>
            </div>
        </div>
    </div>
</section>
	   <section class="container">
    <div class="columns">
        <div class="column two-thirds">
            
                  <article id="post-translate|redux-persist" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/translate|redux-persist/">翻译|Redux Persist</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p>Redux Persist<br>持久化和脱水一个redux store<br>Redux Persist是性能好,容易实施,容易扩展</p>
<p><code>npm i - -save redux-persist</code></p>
<p><a href="https://travis-ci.org/rt2zz/redux-persist" target="_blank" rel="external"><img src="https://img.shields.io/travis/rt2zz/redux-persist/master.svg?style=flat-square" alt="build status"></a><br><a href="https://www.npmjs.com/package/redux-persist" target="_blank" rel="external"><img src="https://img.shields.io/npm/v/redux-persist.svg?style=flat-square" alt="npm version"></a><br><a href="https://www.npmjs.com/package/redux-persist" target="_blank" rel="external"><img src="https://img.shields.io/npm/dm/redux-persist.svg?style=flat-square" alt="npm downloads"></a></p>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><p>基本使用方法要在传统的redux中添加代码:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> &#123;compose, applyMiddleware, createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"><span class="keyword">import</span> &#123;persistStore, autoRehydrate&#125; <span class="keyword">from</span> <span class="string">'redux-persist'</span></div><div class="line"></div><div class="line"><span class="comment">// add `autoRehydrate` as an enhancer to your store </span></div><div class="line">(note: <span class="string">`autoRehydrate`</span> is not a middleware)</div><div class="line"><span class="comment">//添加`autoRehydrate到store`,不是中间件</span></div><div class="line"><span class="keyword">const</span> store = createStore(</div><div class="line">  reducer,</div><div class="line">  <span class="literal">undefined</span>,</div><div class="line">  compose(</div><div class="line">    applyMiddleware(...),</div><div class="line">    autoRehydrate()</div><div class="line">  )</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// begin periodically persisting the store</span></div><div class="line"><span class="comment">//周期性的持久化store</span></div><div class="line">persistStore(store)</div></pre></td></tr></table></figure></p>
<hr>
<p>如果为每一个reducer设计 rehydraretion的逻辑,需要在reducer中添加句柄<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;REHYDRATE&#125; <span class="keyword">from</span> <span class="string">'redux-persist/constants'</span></div><div class="line"><span class="comment">//...</span></div><div class="line"><span class="keyword">case</span> REHYDRATE:</div><div class="line">  <span class="keyword">var</span> incoming = action.payload.myReducer</div><div class="line">  <span class="keyword">if</span> (incoming) <span class="keyword">return</span> &#123;...state, ...incoming, <span class="attr">specialKey</span>: processSpecial(incoming.specialKey)&#125;</div><div class="line">  <span class="keyword">return</span> state</div></pre></td></tr></table></figure></p>
<hr>
<p>也可以配置一个持久化层,或者在脱水完成后接受一个action<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">persistStore(store, &#123;<span class="attr">blacklist</span>: [<span class="string">'someTransientReducer'</span>]&#125;, () =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'rehydration complete'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<hr>
<p>如果事情变糟,只需要清洗一下存储:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">persistStore(store, config, callback).purge()</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h4 id="persistStore-store-config-callback"><a href="#persistStore-store-config-callback" class="headerlink" title="persistStore(store,[config,callback])"></a><code>persistStore(store,[config,callback])</code></h4><ul>
<li>参数<ul>
<li></li>
</ul>
</li>
</ul>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/翻译/' title=''>翻译</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redux/">Redux</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript-中的apply和call方法" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/javascript-中的apply和call方法/">javascript的apply和call方法</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>在javascript模式设计的学习中，深感javascript的语法的灵活性，在模式设计的方法中对于高阶函数的使用到了令人发指的地步，几乎每个示例中都离不开函数作为参数的调用方法，apply和call方法是使用最多的。这两个函数调用形式不太一样，但是目的都是一样的。apply和call函数是javascript中的硬绑定方式，可以灵活,动态的改变函数运行时候的作用域对象。并且和argument对象结合起来使用，威力会更大。<br>结合《javascript函数式编程》的一个例子说说。 p2<br>使用apply方法可以创建一个函数，他接收另一个函数，并且返回另一函数，该函数接受一个数组，并用apply来执行函数</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function  splat(<span class="function"><span class="keyword">fun</span>)&#123; //splat函数接受一个函数作为参数</span></div><div class="line">  <span class="keyword">return</span> function(array)&#123; <span class="comment">//返回另一个函数，array作为形参</span></div><div class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">fun</span>.<span class="title">apply</span><span class="params">(<span class="literal">null</span>,array)</span></span>;<span class="comment">//apply方法传入数组参数</span></div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> addArrayElements=splat(function(x,y)&#123;<span class="keyword">return</span> x+y;&#125;); <span class="comment">//传入函数加</span></div><div class="line"><span class="comment">//法函数作为参数</span></div><div class="line"></div><div class="line">addArrayElements([<span class="number">1</span>,<span class="number">2</span>]); <span class="comment">//调用函数，=&gt;3</span></div></pre></td></tr></table></figure>
<blockquote>
<p>另外一个展现js灵活性的地方是，我们可以随时以任意多个任意类型的参数来调用任意一个函数。这里的三个任意体现了js函数使用的灵活性。<br>每个js函数都可以访问一个arguments局部对象，他类似数组，存储了调用函数是的实际参数。</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">   function  unsplat(<span class="function"><span class="keyword">fun</span>)&#123;//接受一个函数作为参数</span></div><div class="line">  <span class="keyword">return</span> function()&#123;<span class="comment">//返回另一个函数</span></div><div class="line">     <span class="comment">//返回的函数为传入的函数绑定arguments对象，这里经过</span></div><div class="line">     <span class="comment">//underscore的toArray方法转为数组对象</span></div><div class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">fun</span>.<span class="title">call</span><span class="params">(<span class="literal">null</span>,_.toArray(arguments)</span></span>);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> joinElements=unsplat(function(array)&#123;<span class="keyword">return</span> array.join(<span class="string">' '</span>);&#125;); <span class="comment">//调用</span></div><div class="line"><span class="comment">//时传入函数实参</span></div><div class="line"></div><div class="line">alert(joinElements(<span class="number">1</span>,<span class="number">2</span>)); <span class="comment">//传入调用的参数，参数长度是不定的</span></div></pre></td></tr></table></figure>
<p>#####这两个方法在模式设计的代码里用的太多了，所以要好好研究研究.</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-学习模式设计的启示-献给和我一样的react-redux的初学者" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/学习模式设计的启示-献给和我一样的react-redux的初学者/">学习模式设计的启示-献给和我一样的react-redux的初学者</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p>这里我不谈到底哪家的书好，那种学习方法好。作为一个软件开发的初学者已经两年了，前一个月感觉到很焦虑，感觉到好多代码都还读不懂，而且年龄也比较大。但是自从接触了几本javascrpt模式设计的书以后，焦虑消失了，尽管任然有很多的代码等着去读，但是心里感觉非常有底，以前如果是赤手在荒原上打猎的话，现在手上就一把猎枪。</p>
<p>现在说说读过模式设计以后的感受。这个读的过程本身又是嵌套函数，读模式设计的过程中也在利用模式的方法来不断的针对一个问题，继续深入的学习，重构。不断的反复。</p>
<p>1拿着榔头的人，看到任何东西都是钉子？</p>
<p>我上周有段时间，感觉看到任何的代码都在考虑他里面有什么模式，甚至影响到了我的其他和编程不相干的领域，比如我以前的专业知识和业余爱好，发现短时间内，通过把模式设计的思想(我说的而是思想，不是思路，是宏观的看法)来重新审视学过或者了解的东西，结果获得了和以前完全不同的东西，似乎好多问题看得很透彻了。 </p>
<p>结果乐此不疲，但是冷静下来想，在这个过程中我是否有点矫枉过正了？我重新反思以后发现，并没有矫枉过正，模式就是解决问题的万能方式，只要你是在主动的根据实际情况解决问题，主动的总结解决问题的过程中各种利弊和规律，就是模式。<br>你再次把这个已经成型的模式应用到类似问题的解决和设计中就是<code>模式设计</code>。<br>这里面最中的是看清楚当前要解决的问题和哪些已知的模式相类似。这是第一步，可以称为<code>模式识别</code>。比如你要开发汽车号牌之别系统，你要先识别出号码，才能做后一步的工作，后一步的逻辑再简单，没有识别出问题就，后面的问题就无从解决。</p>
<p>作为程序员的你是否考虑过：“我的生活，体育爱好，读书，写作，包括找对象，结婚，甚至是约炮过程中是不是总结了一些规律或者使用了别人总结的一些规律，在使用这些规律的过程中那些有效，那些是负分？”  是的！无处不在的经验，到处都是。但是请不要忘了，这些规律是都有自己的使用特殊性的。不考虑环境或者上下文的规律就乱用这些经验就是耍流氓，可能不仅起不到良好效果，反而骂经验总结者傻逼。<br>   我们中国足球就是典型的乱用经验的例子。 我们的足球管理者总是懒政，想短平快的解决问题，期望用别人现成的模式来解决问题。<br>   也可谓是尝试了不少，比如第一人外籍主帅，德国人是那普利。当时举国兴奋，以为找到了解决中国足球难题的良药。结果国人全部都陷入一种妄想症中。  但是忘记了两国足球背景的差别，<br>   两国国民身体健康，身体素质平均情况，足球普及情况，青训普及情况，联赛开展情况，国家经济收入情况。当界队员的天赋情况。这些都要综合考虑。问题岂是区区一个足球教练就能解决的？结果希望越大，失望越大。<br>   领导仍不死心，接着砸钱，足球要从娃娃抓起，派了一对小球员去巴西学习，以为这样问题就能解决了。当时看纪录片介绍，条件那个差呀。但是当时巴西就是那个条件，为什么人家就成功了，屡夺世界冠军呢？。踢球人太多了，球场虽然很差，但是踢球人基数大，天才还是能在这样的条件下诞生。所以这样的计划必定失败。</p>
<p>   如果不考虑这些综合问题，外籍教练和青训系统来一个死一个，成功的都是赌徒。</p>
<p>   实际上我以上的分析也是站在旁观者的角度上看问题，解决问题肯定不会这么简单，如果能看到问题就能解决问题，那就不是问题了。</p>
<p>   2.动手，阅读之后的感受。模式是你自己的体验</p>
<p>   在学习了模式设计的书以后，试着写了一篇有关react/redux中潜藏的一些模式的文章。写这个文章的过程实际是基于我对这个框架之间的关系的学习过程，我是初学者，在redux的学习中确实是卡了很长时间。很多代码具体逻辑看的懂，但是就是感觉不知道在干什么，在学些redux中，刚开始不知道数据怎么流动的。 现在看来这些学习中的摸索过程也还有一定的好处，当我第一次意识到 React UI Component的组件是包含在container这个罐子中的时候，问题似乎一下变得简单了。看到了组件react-redux之间的那种为了功能划分而进行<code>解耦和</code>的过程，当我想到<code>解耦和</code>的过程，似乎其他用到<code>解耦和</code>概念的地方，认识更加清楚了和明晰了，结果是在我继续学习《js模式设计》的时候，难度和广度都降了了好多，原因是这种<code>解耦和</code>思想是编程中把复杂问题分解成简单问题的最有效的方式，通过这种方式可以把复杂的逻辑判断分解开。模式设计中大量使用这种思想，所以很多问题就很容易看懂了。</p>
<p>   但是我回头一想，这个过程也是基于我自己的学习过程来逐渐理解的，如果没有前面的挫折，可能也不会得出 container是个罐子这个形象的例子。如果在刚遇到挫折的时候，别人告诉我，这个容器就是个罐子，你去看看吧。 不可能的事，和盲人摸象一样，给你说面前是一头大象，在你没有完全摸透的情况下，你的感觉是千奇百怪的。</p>
<p>   也许你自己完全理解了以后，这个container可以是一个铝罐，一个篮子，其他什么的东西。不重要<code>最终都会抽象成一个容器</code>。  容器就是大象,要你自己去感受</p>
<p>   3.模式设计和模式识别是一个思考过程。</p>
<p>   我感觉在学习中慢慢感觉到了编程思考的乐趣。在这些书上，一些很复杂的代码，经过重构变为容易维护，容易阅读，容易扩展的过程，真是一张享受过程。从阅读中感受到了思考的强大。<br>   如果前一段时间的学习是基于别人的代码的一种形式的模仿，那么从阅读这些模式设计的书以后，后面就要考虑到对这些作者思想的模仿，人家是怎么做到这一点，我怎么才能达到。大言不惭的说，如果到了这一个境界，我想我的编程方法和能力都能有很大的提高。<br>   4.仅仅是为了编程而编程吗？</p>
<p>   模式设计的书上实际讲了很多的日常生活中的事物运转原理的模拟解决过程。 我想的是编程都是解决实际问题，要想编程思想能有很大的提高，必须要关注这些具体事物运转的逻辑。<br>   5.不断的记录自己的感悟<br>      人的记忆是很脆弱的，程序员要学的东西那么多，你不可能都记住，错误的记录下来也好。</p>
<hr>
<p>   好了，就写这么多，初学者水平，可能过一段时间就觉得这个文章很傻比了。借此文记录这个傻逼的过程。呵呵</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-redux-logic" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/redux-logic/">redux-logic</a>
  

      </h3>
      <div class="repo-list-description">
        
          <h1 id="redux-logic"><a href="#redux-logic" class="headerlink" title="redux-logic"></a>redux-logic</h1><blockquote>
<p>“One place for all your business logic and action side effects”</p>
</blockquote>
<p>Redux middleware that can:</p>
<ul>
<li><strong>intercept</strong> (validate/transform/augment) actions AND</li>
<li><strong>perform async processing</strong> (fetching, I/O, side effects)</li>
</ul>
<p><a href="http://travis-ci.org/jeffbski/redux-logic" target="_blank" rel="external"><img src="https://secure.travis-ci.org/jeffbski/redux-logic.png?branch=master" alt="Build Status"></a> <a href="https://www.codacy.com/app/jeff-barczewski/redux-logic" target="_blank" rel="external"><img src="https://img.shields.io/codacy/grade/3687e7267e6d466b9d226c22b24f0061.svg" alt="Codacy Grade Badge"></a> <a href="https://www.codacy.com/app/jeff-barczewski/redux-logic" target="_blank" rel="external"><img src="https://img.shields.io/codacy/coverage/3687e7267e6d466b9d226c22b24f0061.svg" alt="Codacy Coverage Badge"></a> <a href="https://snyk.io/test/github/jeffbski/redux-logic" target="_blank" rel="external"><img src="https://snyk.io/test/github/jeffbski/redux-logic/badge.svg" alt="Known Vulnerabilities"></a> <a href="https://www.npmjs.com/package/redux-logic" target="_blank" rel="external"><img src="https://img.shields.io/npm/v/redux-logic.svg" alt="NPM Version Badge"></a></p>
<h2 id="tl-dr"><a href="#tl-dr" class="headerlink" title="tl;dr"></a>tl;dr</h2><p>With redux-logic, you have the <strong>freedom</strong> to write your logic in <strong>your favorite JS style</strong>:</p>
<ul>
<li>plain <strong>callback</strong> code - <code>dispatch(resultAction)</code></li>
<li><strong>promises</strong> - <code>return axios.get(url).then(...)</code></li>
<li><strong>async/await</strong> - <code>result = await fetch(url)</code></li>
<li><strong>observables</strong> - <code>ob$.next(action1)</code></li>
</ul>
<blockquote>
<p>Use the type of code you and your team are comfortable and experienced with.</p>
</blockquote>
<p>Leverage powerful <strong>declarative</strong> features by simply setting properties:</p>
<ul>
<li><strong>filtering</strong> for action type(s) or with regular expression(s)</li>
<li><strong>cancellation</strong> on receiving action type(s)</li>
<li>use only response for the <strong>latest</strong> request</li>
<li><strong>debouncing</strong></li>
<li><strong>throttling</strong></li>
<li>dispatch actions - auto <strong>decoration</strong> of payloads</li>
</ul>
<p>Testing your logic is straight forward and simple.</p>
<p>With simple code your logic can:</p>
<ul>
<li><strong>intercept</strong> actions before they hit the reducer<ul>
<li><strong>validate</strong>, verify, auth check actions and allow/reject or modify actions</li>
<li><strong>transform</strong> - augment/enhance/modify actions</li>
</ul>
</li>
<li><strong>process</strong> - <strong>async processing</strong> and dispatching, orchestration, I/O (ajax, REST, subscriptions, GraphQL, web sockets, …)</li>
</ul>
<p>Redux-logic makes it easy to use code that is split into bundles, so you can dynamically load logic right along with your split UI.</p>
<p>Server rendering is simplified with redux-logic since it lets you know when all your async fetching is complete without manual tracking.</p>
<p>Inspired by redux-observable epics, redux-saga, and custom redux middleware, redux-logic combines ideas of each into a simple easy to use API.</p>
<h2 id="Quick-Example"><a href="#Quick-Example" class="headerlink" title="Quick Example"></a>Quick Example</h2><p>This is an example of logic which will listen for actions of type FETCH_POLLS and it will perform ajax request to fetch data for which it dispatches the results (or error) on completion. It supports cancellation by allowing anything to send an action of type CANCEL_FETCH_POLLS. It also uses <code>take latest</code> feature that if additional FETCH_POLLS actions come in before this completes, it will ignore the outdated requests.</p>
<p>The developer can just declare the type filtering, cancellation, and take latest behavior, no code needs to be written for that. That leaves the developer to focus on the real business requirements which are invoked in the process hook.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> fetchPollsLogic = createLogic(&#123;</div><div class="line"></div><div class="line">  <span class="comment">// declarative built-in functionality wraps your code</span></div><div class="line">  type: FETCH_POLLS, <span class="comment">// only apply this logic to this type</span></div><div class="line">  cancelType: CANCEL_FETCH_POLLS, <span class="comment">// cancel on this type</span></div><div class="line">  latest: <span class="literal">true</span>, <span class="comment">// only take latest</span></div><div class="line"></div><div class="line">  <span class="comment">// your code here, hook into one or more of these execution</span></div><div class="line">  <span class="comment">// phases: validate, transform, and/or process</span></div><div class="line">  process(&#123; getState, action &#125;, dispatch, done) &#123;</div><div class="line">    axios.get(<span class="string">'https://survey.codewinds.com/polls'</span>)</div><div class="line">      .then(<span class="function"><span class="params">resp</span> =&gt;</span> resp.data.polls)</div><div class="line">      .then(<span class="function"><span class="params">polls</span> =&gt;</span> dispatch(&#123; <span class="attr">type</span>: FETCH_POLLS_SUCCESS,</div><div class="line">                                <span class="attr">payload</span>: polls &#125;))</div><div class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</div><div class="line">             <span class="built_in">console</span>.error(err); <span class="comment">// log since could be render err</span></div><div class="line">             dispatch(&#123; <span class="attr">type</span>: FETCH_POLLS_FAILED, <span class="attr">payload</span>: err,</div><div class="line">                        <span class="attr">error</span>: <span class="literal">true</span> &#125;)</div><div class="line">      &#125;)</div><div class="line">      .then(<span class="function"><span class="params">()</span> =&gt;</span> done()); <span class="comment">// call done when finished dispatching</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Since redux-logic gives you the freedom to use your favorite style of JS code (callbacks, promises, async/await, observables), it supports many features to make that easier, <a href="/jeffbski/redux-logic/blob/master/docs/api.md#dispatch---multi-dispatching-and-process-variable-signature">explained in more detail</a>.</p>
<h2 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h2><ul>
<li><a href="#goals">Goals</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="./docs/api.md">Full API</a></li>
<li><a href="#examples">Examples</a> - <a href="#jsfiddle-live-examples">JSFiddle</a> and <a href="#full-examples">full examples</a></li>
<li><a href="#comparison-summaries">Comparison summaries</a> to <a href="#compared-to-fat-action-creators">fat action creators</a>, <a href="#compared-to-redux-thunk">thunks</a>, <a href="#compared-to-redux-observable">redux-observable</a>, <a href="#compared-to-redux-saga">redux-saga</a>, <a href="#compared-to-custom-redux-middleware">custom middleware</a></li>
<li><a href="#implementing-sampal-pattern">SAM/PAL pattern</a></li>
<li><a href="#other">Other</a> - todo, inspiration, license</li>
</ul>
<h2 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h2><ul>
<li>organize business logic keeping action creators and reducers clean<ul>
<li>action creators are light and just post action objects</li>
<li>reducers just focus on updating state</li>
<li>intercept and perform validations, verifications, authentication</li>
<li>intercept and transform actions</li>
<li>perform async processing, orchestration, dispatch actions</li>
</ul>
</li>
<li>wrap your core business logic code with declarative behavior<ul>
<li>filtered - apply to one or many action types or even all actions</li>
<li>cancellable - async work can be cancelled</li>
<li>limiting (like taking only the latest, throttling, and debouncing)</li>
</ul>
</li>
<li>features to support business logic and large apps<ul>
<li>have access to full state to make decisions</li>
<li>easily composable to support large applications</li>
<li>inject dependencies into your logic, so you have everything needed in your logic code</li>
<li>dynamic loading of logic for splitting bundles in your app</li>
<li>your core logic code stays focussed and simple, don’t use generators or observables unless you want to.</li>
<li>create subscriptions - streaming updates</li>
<li>easy testing - since your code is just a function it’s easy to isolate and test</li>
</ul>
</li>
</ul>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install rxjs --save</div><div class="line">npm install redux-logic --save</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// in configureStore.js</span></div><div class="line"><span class="keyword">import</span> &#123; createLogic, createLogicMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux-logic'</span>;</div><div class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'./rootReducer'</span>;</div><div class="line"><span class="keyword">import</span> arrLogic <span class="keyword">from</span> <span class="string">'./logic'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> deps = &#123; <span class="comment">// optional injected dependencies for logic</span></div><div class="line">  <span class="comment">// anything you need to have available in your logic</span></div><div class="line">  A_SECRET_KEY: <span class="string">'dsfjsdkfjsdlfjls'</span>,</div><div class="line">  <span class="attr">firebase</span>: firebaseInstance</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> logicMiddleware = createLogicMiddleware(arrLogic, deps);</div><div class="line"></div><div class="line"><span class="keyword">const</span> middleware = applyMiddleware(</div><div class="line">  logicMiddleware</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> enhancer = middleware; <span class="comment">// could compose in dev tools too</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">configureStore</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> store = createStore(rootReducer, enhancer);</div><div class="line">  <span class="keyword">return</span> store;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// in logic.js - combines logic from across many files, just</span></div><div class="line"><span class="comment">// a simple array of logic to be used for this app</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</div><div class="line"> ...todoLogic,</div><div class="line"> ...pollsLogic</div><div class="line">];</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// in polls/logic.js</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> validationLogic = createLogic(&#123;</div><div class="line">  <span class="attr">type</span>: ADD_USER,</div><div class="line">  validate(&#123; getState, action &#125;, allow, reject) &#123;</div><div class="line">    <span class="keyword">const</span> user = action.payload;</div><div class="line">    <span class="keyword">if</span> (!getState().users[user.id]) &#123; <span class="comment">// can also hit server to check</span></div><div class="line">      allow(action);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      reject(&#123; <span class="attr">type</span>: USER_EXISTS_ERROR, <span class="attr">payload</span>: user, <span class="attr">error</span>: <span class="literal">true</span> &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> addUniqueId = createLogic(&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'*'</span>,</div><div class="line">  transform(&#123; getState, action &#125;, next) &#123;</div><div class="line">    <span class="comment">// add unique tid to action.meta of every action</span></div><div class="line">    <span class="keyword">const</span> existingMeta = action.meta || &#123;&#125;;</div><div class="line">    <span class="keyword">const</span> meta = &#123;</div><div class="line">      ...existingMeta,</div><div class="line">      <span class="attr">tid</span>: shortid.generate()</div><div class="line">    &#125;,</div><div class="line">    next(&#123;</div><div class="line">      ...action,</div><div class="line">      meta</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> fetchPollsLogic = createLogic(&#123;</div><div class="line">  <span class="attr">type</span>: FETCH_POLLS, <span class="comment">// only apply this logic to this type</span></div><div class="line">  cancelType: CANCEL_FETCH_POLLS, <span class="comment">// cancel on this type</span></div><div class="line">  latest: <span class="literal">true</span>, <span class="comment">// only take latest</span></div><div class="line">  process(&#123; getState, action &#125;, dispatch, done) &#123;</div><div class="line">    axios.get(<span class="string">'https://survey.codewinds.com/polls'</span>)</div><div class="line">      .then(<span class="function"><span class="params">resp</span> =&gt;</span> resp.data.polls)</div><div class="line">      .then(<span class="function"><span class="params">polls</span> =&gt;</span> dispatch(&#123; <span class="attr">type</span>: FETCH_POLLS_SUCCESS,</div><div class="line">                                <span class="attr">payload</span>: polls &#125;))</div><div class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</div><div class="line">             <span class="built_in">console</span>.error(err); <span class="comment">// log since could be render err</span></div><div class="line">             dispatch(&#123; <span class="attr">type</span>: FETCH_POLLS_FAILED, <span class="attr">payload</span>: err,</div><div class="line">                        <span class="attr">error</span>: <span class="literal">true</span> &#125;)</div><div class="line">      &#125;)</div><div class="line">      .then(<span class="function"><span class="params">()</span> =&gt;</span> done());</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// pollsLogic</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</div><div class="line">  validationLogic,</div><div class="line">  addUniqueId,</div><div class="line">  fetchPollsLogic</div><div class="line">];</div></pre></td></tr></table></figure>
<h3 id="processOptions-introduced-for-redux-logic-0-8-2-allowing-for-even-more-streamlined-code"><a href="#processOptions-introduced-for-redux-logic-0-8-2-allowing-for-even-more-streamlined-code" class="headerlink" title="processOptions introduced for redux-logic@0.8.2 allowing for even more streamlined code"></a>processOptions introduced for redux-logic@0.8.2 allowing for even more streamlined code</h3><p><code>processOptions</code> has these new properties which affect the process hook behavior:</p>
<ul>
<li><p><code>dispatchReturn</code> - the returned value of the process function will be dispatched or if it is a promise or observable then the resolve, reject, or observable values will be dispatched applying any successType or failType logic if defined. Default is determined by arity of process fn, <code>true</code> if dispatch not provided, <code>false</code> otherwise. <a href="https://github.com/jeffbski/redux-logic/blob/master/docs/api.md#dispatch---multi-dispatching-and-process-variable-signature" target="_blank" rel="external">Details</a></p>
</li>
<li><p><code>successType</code> - dispatch this action type using contents of dispatch as the payload (also would work with with promise or observable). You may alternatively provide an action creator function to use instead and it will receive the value as only parameter. Default: <code>undefined</code>.</p>
<ul>
<li><p>if successType is a string action type</p>
<ul>
<li>create action using successType and provide value as payload. ex: with <code>successType:&#39;FOO&#39;</code>, result would be <code>{ type: &#39;FOO&#39;, payload: value }</code></li>
</ul>
</li>
<li><p>if successType is an action creator fn receiving the value as only parameter</p>
<ul>
<li>use the return value from the action creator fn for dispatching ex: <code>successType: x =&gt; ({ type: &#39;FOO&#39;, payload: x })</code></li>
<li>if the action creator fn returns a falsey value like <code>undefined</code> then nothing will be dispatched. This allows your action creator to control whether something is actually dispatched based on the value provided to it.</li>
</ul>
</li>
</ul>
</li>
<li><p><code>failType</code> - dispatch this action type using contents of error as the payload, sets error: true (would also work for rejects of promises or error from observable). You may alternatively provide an action creator function to use instead which will receive the error as the only parameter. Default: <code>undefined</code>.</p>
<ul>
<li><p>if failType is a string action type</p>
<ul>
<li>create action using failType, provide value as the payload, and set error to true. ex: with <code>failType:&#39;BAR&#39;</code>, result would be <code>{ type: &#39;BAR&#39;, payload: errorValue, error: true }</code></li>
</ul>
</li>
<li><p>if failType is an action creator function receiving the error value as its only parameter</p>
<ul>
<li>use the return value from the action creator fn for dispatching. ex: <code>failType: x =&gt; ({ type: &#39;BAR&#39;, payload: x, error: true })</code></li>
<li>if the action creator fn returns a falsey value like <code>undefined</code> then nothing will be dispatched. This allows your action creator to control whether something is actually dispatched based on teh value provided to it.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The successType and failType would enable clean code, where you can simply return a promise or observable that resolves to the payload and rejects on error. The resulting code doesn’t have to deal with dispatch and actions directly.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> fetchPollsLogic = createLogic(&#123;</div><div class="line"></div><div class="line">  <span class="comment">// declarative built-in functionality wraps your code</span></div><div class="line">  type: FETCH_POLLS, <span class="comment">// only apply this logic to this type</span></div><div class="line">  cancelType: CANCEL_FETCH_POLLS, <span class="comment">// cancel on this type</span></div><div class="line">  latest: <span class="literal">true</span>, <span class="comment">// only take latest</span></div><div class="line"></div><div class="line">  processOptions: &#123;</div><div class="line">    <span class="comment">// optional since the default is true when dispatch is omitted from</span></div><div class="line">    <span class="comment">// the process fn signature</span></div><div class="line">    dispatchReturn: <span class="literal">true</span>, <span class="comment">// use returned/resolved value(s) for dispatching</span></div><div class="line">    <span class="comment">// provide action types or action creator functions to be used</span></div><div class="line">    <span class="comment">// with the resolved/rejected values from promise/observable returned</span></div><div class="line">    successType: FETCH_POLLS_SUCCESS, <span class="comment">// dispatch this success act type</span></div><div class="line">    failType: FETCH_POLLS_FAILED, <span class="comment">// dispatch this failed action type</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// Omitting dispatch from the signature below makes the default for</span></div><div class="line">  <span class="comment">// dispatchReturn true allowing you to simply return obj, promise, obs</span></div><div class="line">  <span class="comment">// not needing to use dispatch directly</span></div><div class="line">  process(&#123; getState, action &#125;) &#123;</div><div class="line">    <span class="keyword">return</span> axios.get(<span class="string">'https://survey.codewinds.com/polls'</span>)</div><div class="line">      .then(<span class="function"><span class="params">resp</span> =&gt;</span> resp.data.polls);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>This is pretty nice leaving us with mainly our business logic code that could be easily extracted and called from here.</p>
<h2 id="Full-API"><a href="#Full-API" class="headerlink" title="Full API"></a>Full API</h2><p>See the <a href="./docs/api.md">docs for the full api</a></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="JSFiddle-live-examples"><a href="#JSFiddle-live-examples" class="headerlink" title="JSFiddle live examples"></a>JSFiddle live examples</h3><ul>
<li><a href="https://jsfiddle.net/jeffbski/78vpf92k/" target="_blank" rel="external">search async axios fetch</a> - live search using debounce and take latest functionality with axios fetch</li>
<li><a href="https://jsfiddle.net/jeffbski/uLh2add5/" target="_blank" rel="external">search rxjs ajax fetch</a> - live search using debounce and take latest functionality with rxjs ajax fetch</li>
<li><a href="https://jsfiddle.net/jeffbski/rLz44jk9/" target="_blank" rel="external">search rxjs ajax fetch - using processOptions</a> - live search using debounce and take latest with rxjs ajax fetch using processOptions to streamline the code</li>
<li><a href="https://jsfiddle.net/jeffbski/954g5n7h/" target="_blank" rel="external">async axios fetch - single page</a> - displayed using React</li>
<li><a href="https://jsfiddle.net/jeffbski/0fu407na/" target="_blank" rel="external">async rxjs-ajax fetch</a> - async fetching using RxJS ajax which supports XHR abort for cancels</li>
<li><a href="https://jsfiddle.net/jeffbski/yzy8w4ve/" target="_blank" rel="external">async axios fetch - single page redux only</a> - just the redux and redux-logic code</li>
<li><a href="https://jsfiddle.net/jeffbski/oL6jmp52/" target="_blank" rel="external">async axios fetch - using processOptions</a> - using processOptions to streamline your code further with React</li>
<li><a href="https://jsfiddle.net/jeffbski/d4p6oo0d/" target="_blank" rel="external">async rxjs-ajax fetch - using processOptions</a> - async fetch using RxJS ajax (supporting XHR abort on cancel) and processOptions for clean code.</li>
<li><a href="https://jsfiddle.net/jeffbski/rfc7oz9p/" target="_blank" rel="external">async await - react</a> - using ES7 async functions (async/await) displaying with React</li>
<li><a href="https://jsfiddle.net/jeffbski/h485f6h5/" target="_blank" rel="external">async await - redux only</a> - using ES7 async functions (async/await) - just redux and redux-logic code</li>
<li><a href="https://jsfiddle.net/jeffbski/0rodyekn/" target="_blank" rel="external">async await - react processOptions</a> - using ES7 async functions (async/await) with processOptions, displayed with React</li>
</ul>
<h3 id="Full-examples"><a href="#Full-examples" class="headerlink" title="Full examples"></a>Full examples</h3><ul>
<li><a href="./examples/search-async-fetch">search-async-fetch</a> - search async fetch example using axios uses debouncing and take latest features</li>
<li><a href="./examples/async-fetch-vanilla">async-fetch-vanilla</a> - async fetch example using axios</li>
<li><a href="./examples/async-rxjs-ajax-fetch">async-rxjs-ajax-fetch</a> - async fetch example using RxJS ajax (supporting XHR abort on cancel) and redux-actions</li>
<li><a href="./examples/async-fetch-proc-options">async-fetch-proc-options</a> - async fetch example using axios and the new processOptions feature</li>
<li><a href="./examples/async-rxjs-ajax-proc-options">async-rxjs-ajax-proc-options</a> - async RxJS ajax (with XHR abort on cancel) fetch example using axios and the new processOptions feature</li>
<li><a href="./examples/async-await">async-await - ES7 async functions</a> - async fetch example using axios and ES7 async functions (async/await)</li>
<li><a href="./examples/async-await-proc-options">async-await - ES7 async functions with processOptions</a> - async fetch example using axios and ES7 async functions (async/await) and using the new processOptions feature</li>
<li><a href="./examples/countdown">countdown</a> - a countdown timer implemented with setInterval</li>
<li><a href="./examples/countdown-obs">countdown-obs</a> - a countdown timer implemented with Rx.Observable.interval</li>
<li><a href="./examples/form-validation">form-validation</a> - form validation and async post to server using axios, displays updated user list</li>
<li><a href="./examples/notification">notification</a> - notification message example showing at most N messages for X amount of time, rotating queued messages in as others expire</li>
<li><a href="./examples/single-file">search-single-file</a> - search async fetch example with all code in a single file and displayed with React</li>
<li><a href="./examples/single-file-redux">single-file-redux</a> - async fetch example with all code in a single file and appended to the container div. Only redux and redux-logic code.</li>
</ul>
<h2 id="Comparison-summaries"><a href="#Comparison-summaries" class="headerlink" title="Comparison summaries"></a>Comparison summaries</h2><p>Following are just short summaries to compare redux-logic to other approaches.</p>
<p>For a more detailed comparison with examples, see by article in docs, <a href="./docs/where-business-logic.md">Where do I put my business logic in a React-Redux application?</a>.</p>
<h3 id="Compared-to-fat-action-creators"><a href="#Compared-to-fat-action-creators" class="headerlink" title="Compared to fat action creators"></a>Compared to fat action creators</h3><ul>
<li>no easy way to cancel or do limiting like take latest with fat action creators</li>
<li>action creators would not have access to the full global state so you might have to pass down lots of extra data that isn’t needed for rendering. Every time business logic changes might require new data to be made available</li>
<li>no global interception using just action creators - applying logic or transformations across all or many actions</li>
<li>Testing components and fat action creators may require running the code (possibly mocked API calls).</li>
</ul>
<h3 id="Compared-to-redux-thunk"><a href="#Compared-to-redux-thunk" class="headerlink" title="Compared to redux-thunk"></a>Compared to redux-thunk</h3><ul>
<li>With thunks business logic is spread over action creators</li>
<li>With thunks there is not an easy way to cancel async work nor to perform (take latest) limiting</li>
<li>no global interception with thunks - applying logic or transformations across all or many actions</li>
<li>Testing components and thunked action creators may require running the code (possibly mocked API calls). When you have a thunk (function or promise) you don’t know what it does unless you execute it.</li>
</ul>
<h3 id="Compared-to-redux-observable"><a href="#Compared-to-redux-observable" class="headerlink" title="Compared to redux-observable"></a>Compared to redux-observable</h3><ul>
<li>redux-logic doesn’t require the developer to use rxjs observables. It uses observables under the covers to provide cancellation, throttling, etc. You simply configure these parameters to get this functionality. You can still use rxjs in your code if you want, but not a requirement.</li>
<li>redux-logic hooks in before the reducer stack like middleware allowing validation, verification, auth, tranformations. Allow, reject, tranform actions before they hit your reducers to update your state as well as accessing state after reducers have run. redux-observable hooks in after the reducers have updated state so they have no opportuntity to prevent the updates.</li>
</ul>
<h3 id="Compared-to-redux-saga"><a href="#Compared-to-redux-saga" class="headerlink" title="Compared to redux-saga"></a>Compared to redux-saga</h3><ul>
<li>redux-logic doesn’t require you to code with generators</li>
<li>redux-saga relies on pulling data (usually in a never ending loop) while redux-logic and logic are reactive, responding to data as it is available</li>
<li>redux-saga runs after reducers have been run, redux-logic can intercept and allow/reject/modify before reducers run also as well as after</li>
</ul>
<h3 id="Compared-to-custom-redux-middleware"><a href="#Compared-to-custom-redux-middleware" class="headerlink" title="Compared to custom redux middleware"></a>Compared to custom redux middleware</h3><ul>
<li>Both are fully featured to do any type of business logic (validations, tranformations, processing)</li>
<li>redux-logic already has built-in capabilities for some of the hard stuff like cancellation, limiting, dynamic loading of code. With custom middleware you have to implement all functionality.</li>
<li>No safety net, if things break it could stop all of your future actions</li>
<li>Testing requires some mocking or setup</li>
</ul>
<h3 id="Implementing-SAM-PAL-Pattern"><a href="#Implementing-SAM-PAL-Pattern" class="headerlink" title="Implementing SAM/PAL Pattern"></a>Implementing SAM/PAL Pattern</h3><p>The <a href="http://sam.js.org" target="_blank" rel="external">SAM (State-Action-Model) pattern</a> is a pattern introduced by Jean-Jacques Dubray. Also known as the PAL (proposer, acceptor, learner) pattern based on Paxos terminology.</p>
<p>A few of the challenging parts of implementing this with a React-Redux application are:</p>
<ol>
<li>where to perform the <code>accept</code> (interception) of the proposed action performing validation, verification, authentication against the current model state. Based on the current state, it might be appropriate to modify the action, dispatch a different action, or simply suppress the action.</li>
<li>how to trigger actions based on the state after the model has finished updating, referred to as the <code>NAP</code> (next-action-predicate).</li>
</ol>
<p>Custom Redux middleware can be introduced to perform this logic, but you’ll be implementing most everything on your own.</p>
<p>With <code>redux-logic</code> you can implement the SAM / PAL pattern easily in your React/Redux apps.</p>
<p>Namely you can separate out your business logic from your action creators and reducers keeping them thin. redux-logic provides a nice place to accept, reject, and transform actions before your reducers are run. You have access to the full state to make decisions and you can trigger actions based on the updated state as well.</p>
<p>Solving those SAM challenges previously identified using redux-logic:</p>
<ol>
<li>perform acceptance in redux-logic <code>validate</code> hooks, you have access to the full state (model) of the app to make decisions. You can perform synchronous or asynchronous logic to determine whether to accept the action and you may augment, modify, substitute actions, or suppress as desired.</li>
<li>Perform NAP processing in redux-logic <code>process</code> hooks. The process hook runs after the actions have been sent down to the reducers so you have access to the full model (state) after the updates where you can make decisions and dispatch additional actions based on the updated state.</li>
</ol>
<p><a name="other"></a></p>
<h2 id="Inspiration"><a href="#Inspiration" class="headerlink" title="Inspiration"></a>Inspiration</h2><p>redux-logic was inspired from these projects:</p>
<ul>
<li><a href="https://redux-observable.js.org" target="_blank" rel="external">redux-observable epics</a></li>
<li><a href="http://yelouafi.github.io/redux-saga/" target="_blank" rel="external">redux-saga</a></li>
<li><a href="http://redux.js.org/docs/advanced/Middleware.html" target="_blank" rel="external">redux middleware</a></li>
</ul>
<h2 id="Minimized-gzipped-size-with-all-deps"><a href="#Minimized-gzipped-size-with-all-deps" class="headerlink" title="Minimized/gzipped size with all deps"></a>Minimized/gzipped size with all deps</h2><p>(redux-logic only includes the modules of RxJS 5 that it uses)<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">redux-logic<span class="selector-class">.min</span><span class="selector-class">.js</span><span class="selector-class">.gz</span> <span class="number">11</span>KB</div></pre></td></tr></table></figure></p>
<p>Note: If you are already including RxJS 5 into your project then the resulting delta will be much smaller.</p>
<h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul>
<li>add typescript support</li>
<li>more docs</li>
<li>more examples</li>
<li>evaulate additional features as outlined above</li>
</ul>
<h2 id="Get-involved"><a href="#Get-involved" class="headerlink" title="Get involved"></a>Get involved</h2><p>If you have input or ideas or would like to get involved, you may:</p>
<ul>
<li>contact me via twitter @jeffbski  - <a href="http://twitter.com/jeffbski" target="_blank" rel="external">http://twitter.com/jeffbski</a></li>
<li>open an issue on github to begin a discussion - <a href="https://github.com/jeffbski/redux-logic/issues" target="_blank" rel="external">https://github.com/jeffbski/redux-logic/issues</a></li>
<li>fork the repo and send a pull request (ideally with tests) - <a href="https://github.com/jeffbski/redux-logic" target="_blank" rel="external">https://github.com/jeffbski/redux-logic</a></li>
<li>See the <a href="http://github.com/jeffbski/redux-logic/raw/master/CONTRIBUTING.md" target="_blank" rel="external">contributing guide</a></li>
</ul>
<h2 id="Supporters"><a href="#Supporters" class="headerlink" title="Supporters"></a>Supporters</h2><p>This project is supported by <a href="https://codewinds.com/" target="_blank" rel="external">CodeWinds Training</a></p>
<p><a name="license"></a></p>
<h2 id="License-MIT"><a href="#License-MIT" class="headerlink" title="License - MIT"></a>License - MIT</h2><ul>
<li><a href="http://github.com/jeffbski/redux-logic/raw/master/LICENSE.md" target="_blank" rel="external">MIT license</a></li>
</ul>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Redux/' title=''>Redux</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redux/">Redux</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript-职责链模式" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/javascript-职责链模式/">javascript 职责链模式-紧密耦合判读变多函数分开处理</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>职责链模式是：是多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。如果是在jvascript中很好解决这个问题。 从编程上来说就是把比较复杂的if-else嵌套紧密的判断-执行逻辑使用高阶函数把判断语句中所做的事情放到函数中处理。</p>
</blockquote>
<p>逻辑处理的复杂度并没有改变，但是各个处理部分就分散到函数中去了。每个函数只做两件事情，能处理就处理，不能处理就交给其他函数，或者把自己的逻辑，通过异步再通知下一个函数进行处理。 这样通过单个函数内部的指针简化紧密嵌套的逻辑。<br>我作为初学者感觉到这样处理，代码读起来非常清晰。但是执行的效率是不是和紧密嵌套的逻辑一样我就不知道了。或许是用时间换代码的易读性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//实例来自《js设计模式与开发实践》</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params"> orderType, pay, stock </span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span> ( orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span> )&#123;<span class="comment">//根据orderType,pay进行任务分配</span></div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'500 元定金预购, 得到100 优惠券'</span> ); <span class="comment">//符合order500条件，直接执行逻辑</span></div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">		   <span class="comment">//不符合order500条件交个order200处理，order500任务完成</span></div><div class="line">			order200( orderType, pay, stock ); <span class="comment">// 将请求传递给200 元订单</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;;</div><div class="line">	<span class="comment">// 200 元订单</span></div><div class="line">	<span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params"> orderType, pay, stock </span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span> ( orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span> )&#123;<span class="comment">//符合order200条件</span></div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'200 元定金预购, 得到50 优惠券'</span> ); <span class="comment">//执行逻辑</span></div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">		   <span class="comment">//条件不符合，传给下一个函数处理</span></div><div class="line">			orderNormal( orderType, pay, stock ); <span class="comment">// 将请求传递给普通订单</span></div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="comment">// 普通购买订单</span></div><div class="line">	<span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params"> orderType, pay, stock </span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span> ( stock &gt; <span class="number">0</span> )&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'普通购买, 无优惠券'</span> );</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'手机库存不足'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="comment">// 测试结果：</span></div><div class="line">	order500( <span class="number">1</span> , <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：500 元定金预购, 得到100 优惠券</span></div><div class="line">	order500( <span class="number">1</span>, <span class="literal">false</span>, <span class="number">500</span> ); <span class="comment">// 输出：普通购买, 无优惠券</span></div><div class="line">	order500( <span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span> ); <span class="comment">// 输出：200 元定金预购, 得到500 优惠券</span></div><div class="line">	order500( <span class="number">3</span>, <span class="literal">false</span>, <span class="number">500</span> ); <span class="comment">// 输出：普通购买, 无优惠券</span></div><div class="line">	order500( <span class="number">3</span>, <span class="literal">false</span>, <span class="number">0</span> ); <span class="comment">// 输出：手机库存不足</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-再再访javascript闭包" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/再再访javascript闭包/">再再访javascript闭包</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>还是闭包，闭包在javascript的编程中作用太大。仍然还是要加深理解<br>  这次的例子是来自《javascript设计模式》<br><a href="http://jsdesignpatterns.com" target="_blank" rel="external">pro javascript design patterns  sourcecode</a> 这本书算是比较老的了。上帝要我学好javascript，花了不少力气。本地图书馆的 javascript的设计模式的书籍尽然悉数尽收了。名字直接带js 设计模式的书四本都有，《精通javascript》,《javascript面向对象编程》有内容涉及。几本javascript的动物书都有。</p>
</blockquote>
<p>直接看代码，这个代码的问题，其实在tab编程的时候，已经在用了，但是还不是太清楚。<code>关键点：每次调用闭包的时候，都会创建一个单独的作用域，或者叫作用域气泡，这个作用域中的变量和其他闭包的变量是隔绝的，所以叫气泡</code>。javascript通过闭包可以达到隐藏和封装信息的用途。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//foo()函数是外部函数。bar()是内部函数，var a=10是使用var 关键字</span></div><div class="line"><span class="comment">//定义的变量，而且位于foo()函数内部，在全局作用域下是访问不到的</span></div><div class="line"><span class="comment">//所以是私有变量。bar()函数位于foo()函数内部，拥有访问foo()作用域的权利。</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">var</span> a = <span class="number">10</span>;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;<span class="comment">//bar()函数是内部函数，可以访问到var a 变量，或者叫捕获</span></div><div class="line">     a *= <span class="number">2</span>; </div><div class="line">     <span class="keyword">return</span> a; <span class="comment">//return  局部变量</span></div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="keyword">return</span> bar;     <span class="comment">//返回内部函数，这样在foo()作用域外也可以访问到bar</span></div><div class="line">           <span class="comment">//函数，由于变量a也从bar()函数返回，变量从 foo()作用域中脱逃出来。</span></div><div class="line">  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> baz = foo(); <span class="comment">// baz是函数foo()的引用</span></div><div class="line">baz(); <span class="comment">// returns 20. //奇妙的地方在这里</span></div><div class="line">baz(); <span class="comment">// returns 40.//也是</span></div><div class="line">baz(); <span class="comment">// returns 80.//也是</span></div><div class="line"><span class="comment">//持续调用baz实际上在同一个foo()作用域里面的操作.这里就只有一个</span></div><div class="line"><span class="comment">//作用域存在，变量a也就可以一直保存改变的值了。</span></div><div class="line"></div><div class="line"><span class="comment">//下面就不同了，blat重新引用了foo()函数，重新创建了一个闭包作用</span></div><div class="line"><span class="comment">//域，变量a是从10开始的，可以理解为初始化。</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> blat = foo();   <span class="comment">//这是foo()的另一引用。这里有点绕了。</span></div><div class="line"><span class="comment">//闭包的变量是在定义闭包时候就定义好的，与运行时是无关的。</span></div><div class="line"><span class="comment">//所以在第二次引用闭包是变量的初始值还是10</span></div><div class="line"><span class="comment">//这个地方是不是有些熟悉？是的，和函数绑定的对象刚好是相反的，</span></div><div class="line"><span class="comment">//函数绑定的作用域对象是在运行时绑定的，与定义函数时的作用域无关</span></div><div class="line">blat();    <span class="comment">// returns 20</span></div><div class="line">blat();    <span class="comment">// returns 40</span></div></pre></td></tr></table></figure>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/javascript/' title=''>javascript</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-本地Node-js服务器作为api服务器的解决办法" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/本地Node-js服务器作为api服务器的解决办法/">本地Node-js服务器作为api服务器的解决办法</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>在看react-native教程的时候，遇到要在手机端调试，需要api服务器，但是由于Node.js自己就作为服务器，没有apache怎么解决这个问题，用apache和nginx也可以解决，但是有点复杂，我们就使用node已有的模块解决这个问题.<br>概念:电脑的地址有两个，一个是本地环回地址，就是127.0.0.1或localhost,这个地址本机以外是不能访问的，还有一个地址是路由器或交换机分配的ip地址，这个地址其他电脑可以访问。<br>在node.js中要把ip地址转为本地环回地址才可以访问。原理就是这样。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//服务器端的代码</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line"><span class="comment">// set up handlebars view engine</span></div><div class="line"><span class="keyword">var</span> handlebars = <span class="built_in">require</span>(<span class="string">'express3-handlebars'</span>)</div><div class="line">	.create(&#123; <span class="attr">defaultLayout</span>:<span class="string">'main'</span> &#125;);</div><div class="line">app.engine(<span class="string">'handlebars'</span>, handlebars.engine);</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'handlebars'</span>);</div><div class="line"></div><div class="line">app.set(<span class="string">'port'</span>, process.env.PORT || <span class="number">3000</span>);</div><div class="line"></div><div class="line">app.use(express.static(__dirname + <span class="string">'/public'</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> fortuneCookies = [</div><div class="line">	<span class="string">"Conquer your fears or they will conquer you."</span>,</div><div class="line">	<span class="string">"Rivers need springs."</span>,</div><div class="line">	<span class="string">"Do not fear what you don't know."</span>,</div><div class="line">	<span class="string">"You will have a pleasant surprise."</span>,</div><div class="line">	<span class="string">"Whenever possible, keep it simple."</span>,</div><div class="line">];</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">	res.render(<span class="string">'home'</span>);</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> randomFortune = </div><div class="line">		fortuneCookies[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * fortuneCookies.length)];</div><div class="line">	res.render(<span class="string">'about'</span>, &#123; <span class="attr">fortune</span>: randomFortune &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 404 catch-all handler (middleware)</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</div><div class="line">	res.status(<span class="number">404</span>);</div><div class="line">	res.render(<span class="string">'404'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 500 error handler (middleware)</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.error(err.stack);</div><div class="line">	res.status(<span class="number">500</span>);</div><div class="line">	res.render(<span class="string">'500'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log( <span class="string">'Express started on http://localhost:'</span> + </div><div class="line">    app.get(<span class="string">'port'</span>) + <span class="string">'; press Ctrl-C to terminate.'</span> );</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<hr>
<p>上面这段代码在127.0.0.1:3000端口启动一个本地服务器,但是在手机端是不能访问的.</p>
<p>我们再启动另一个node.js服务器来解决这个问题.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//proxy.js</span></div><div class="line">   <span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>), </div><div class="line">         httpProxy = <span class="built_in">require</span>(<span class="string">'http-proxy'</span>);  <span class="comment">//引入这个模块</span></div><div class="line">  </div><div class="line"><span class="comment">// 新建一个代理 Proxy Server 对象  </span></div><div class="line"><span class="keyword">var</span> proxy = httpProxy.createProxyServer(&#123;&#125;);  </div><div class="line">  </div><div class="line"><span class="comment">// 捕获异常  </span></div><div class="line">proxy.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, req, res</span>) </span>&#123;  </div><div class="line">  res.writeHead(<span class="number">500</span>, &#123;  </div><div class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>  </div><div class="line">  &#125;);  </div><div class="line">  res.end(<span class="string">'Something went wrong. And we are reporting a custom error message.'</span>);  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="comment">// 另外新建一个 HTTP 80 端口的服务器，也就是常规 Node 创建 HTTP 服务器的方法。  </span></div><div class="line"><span class="comment">// 在每次请求中，调用 proxy.web(req, res config) 方法进行请求分发  </span></div><div class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;  </div><div class="line">  <span class="comment">// 在这里可以自定义你的路由分发  </span></div><div class="line">  <span class="keyword">var</span> host = req.headers.host, ip = req.headers[<span class="string">'x-forwarded-for'</span>] || req.connection.remoteAddress;  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"client ip:"</span> + ip + <span class="string">", host:"</span> + host);  </div><div class="line">    </div><div class="line">  <span class="keyword">switch</span>(host)&#123;  <span class="comment">//意思是监听下面的ip地址,如果匹配就转到</span></div><div class="line"><span class="comment">//127.0.0.1:3000地址</span></div><div class="line">    <span class="keyword">case</span> <span class="string">'192.168.0.101:8080'</span>:    <span class="comment">//监听这个地址</span></div><div class="line">   <span class="comment">//这个地址在window上用ipconfig查看,mac/linux用ifconfig查看</span></div><div class="line">   </div><div class="line">    <span class="keyword">case</span> <span class="string">'bbs.aaaa.com'</span>:  </div><div class="line">        proxy.web(req, res, &#123; <span class="attr">target</span>: <span class="string">'http://127.0.0.1:3000'</span> &#125;);  <span class="comment">//转到这个地址</span></div><div class="line">    <span class="keyword">break</span>;  </div><div class="line">    </div><div class="line">    <span class="keyword">default</span>:  </div><div class="line">        res.writeHead(<span class="number">200</span>, &#123;  </div><div class="line">            <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>  </div><div class="line">        &#125;);  </div><div class="line">        res.end(<span class="string">'Welcome to my server!'</span>);  </div><div class="line">  &#125;  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="built_in">console</span>.log(<span class="string">"listening on port 8080"</span>)  </div><div class="line">server.listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure></p>
<p>node proxy.js 以后启动了proxy服务器.可以通过电脑的ip地址访问127.0.0.1的api路由了。</p>
<p>如果是使用nginx也可以达到要求，<br>在mac上使用homebrew包管理相当方便<br> bash下  安装 brew install nginx<br>                启动 brew services start nginx<br>  如果安装了atom编辑器<br>  bash在 直接  atom /usr/local/etc/nginx/nginx.conf 打开配置文件本分以后做出修改</p>
<p>下面是nginx.conf的配置文件</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//nginx.conf</span></div><div class="line"></div><div class="line"> #原来的文件另存后。直接使用下面内容替换nginx.<span class="keyword">conf</span>的内容</div><div class="line"></div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    <span class="keyword">include</span>       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    #log_format  main  '<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="string">"$request"</span> '</div><div class="line">    #                  '<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> <span class="string">"$http_referer"</span> '</div><div class="line">    #                  '<span class="string">"$http_user_agent"</span> <span class="string">"$http_x_forwarded_for"</span>';</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    sendfile        <span class="keyword">on</span>;</div><div class="line">    #tcp_nopush     <span class="keyword">on</span>;</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen 8080;  #监听80880端口</div><div class="line">        server_name www.penguu.com 192.168.1.100;  #这里是真机要访问的地址。</div><div class="line">        # <span class="keyword">Mac</span> 通过终端 ifconfig 查看。比如我查看的就是192.168.1.100</div><div class="line">        #手机访问的接口就是 192.168.1.100:8080</div><div class="line">        #实际在23行监听的端口可以是80端口，由于浏览器默认就是80端口。但是在<span class="keyword">mac</span>中有权限问题。所#以就使用8080端口</div><div class="line">        # address_book中的service中的地址也要修改路径是</div><div class="line">        # <span class="keyword">view</span>/service.js-&gt;host,修改为 192.168.1.100：8080</div><div class="line"></div><div class="line">        #access_log /<span class="keyword">var</span>/<span class="keyword">log</span>/nginx/<span class="keyword">test</span>.<span class="keyword">log</span>;</div><div class="line">        location / &#123;</div><div class="line">            proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line">            proxy_set_header X-Forwarded-<span class="keyword">For</span> <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">            proxy_set_header Host  <span class="variable">$http_host</span>;</div><div class="line">            proxy_set_header X-Nginx-Proxy true;</div><div class="line">            proxy_set_header Connection <span class="string">""</span>;</div><div class="line">            proxy_pass      http:<span class="comment">//127.0.0.1:3000;  # address_book的 server地址，就是本地node.js服务器的ip地址</span></div><div class="line">            #node.js默认就是127.0.0.1 ，port:3000是在<span class="keyword">app</span>.js中设定的。可以修改。</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/技术/' title=''>技术</a>
          </span>
        
      
        <!--
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-用javascript来生产一部iPhone8" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/用javascript来生产一部iPhone8/">用javascript来生产一部iPhone8</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p>其实要谈谈javascript的对象链。</p>
<p>唐纳德.川普 当选美国第四十五任总统。当选以后，川普立即给蒂姆.库克打电话<br>   <em>川普(Trump)</em>：“我说厨子啊，我是美国总统，我现在命令你把在中国的apple工厂搬回美国，iPhone8就在国内生产，好兑现我对广大蓝领选民的承诺啊”.<br>  <em>库克(Cook)</em>:“呵呵，这是一个鹅妹子嘤的建议嗷，but no”.建在中国的工厂是搬不回来了。</p>
<p>   开个玩笑算是开场白。经过几天的理解，发现javascript的对象<br>   链居然和现代企业的生产链居然十分的相似。字面都带链啊。这里就借apple的iPhone8的生产来理解js的对象链。可能不是十分贴切。但是在一定程度上能帮你理解相关概念。</p>
<p>   要学习js功，必先自宫，如不自宫，必不成功。  如果你带着java,C++,php的对象原理来学习js的对象继承，会撞得满头包，尤其是看到和其他语言一样的关键字时，千万不能拿老概念来套。js自成体系，所以学习js的对象链要理解其自身的特点。我先摆出来。1js中是没有类这个抽象概念的，<code>js中都是对象</code>。2 js对象继承实际发生的是一种“<em>委托关系</em>”。这种委托关系是js的对象链的精华所在。</p>
<p>  这个“<em>委托关系</em>”听着耳熟吗？什么?不熟。那么听过<code>OEM</code>么？什么?也没有听过<code>OEM</code>。好吧知道富士康么？什么？没听过？同学火星冬天冷吗？<br>  好吧，OEM就是代工工厂。这流程就是一个公司擅长设计，但是他不生产产品，他<code>委托</code>另一个擅长制造的工厂生产产品。另一个工厂又会把其中一部分生产过程<code>委托</code> 给其他工厂，这个委托关系可以一直持续下去。如果理解js对象继承链的人立刻会知道我说的原理。没有理解也没有关系，下面就借着iPhone8的生产来看看这个<code>委托关系</code>。</p>
<p> 我们把这个过程稍微简化一下，要不全过程写完我也没有那个能力，写全过程要找郭明池来写。 </p>
<p>  我把ip8的生产简化为:<br>    1.硬件设计<br>    2.软件设计<br>    3.初试</p>
<pre><code>4. 整机生产
5. 电池生产
6. 屏幕生产
7.  外设生产
</code></pre><p>下面会用一些伪代码来说明这个问题。js中都是对象，没有类。类都是实体，是在内存中实际存在的。在整个生产中的公司都是对象。现在我们看看这些对象<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">//苹果公司对象   </span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> &#123;</span></div><div class="line">        init()&#123;  <span class="comment">//初始化apple公司</span></div><div class="line">             founder：<span class="string">"Steve Jobs"</span>;</div><div class="line">             current <span class="string">leader:</span><span class="string">"Tim Cook"</span>;</div><div class="line"><span class="symbol">             Designer:</span><span class="string">"Ivy"</span>;</div><div class="line">             <span class="string">Location :</span><span class="string">"South. CA"</span></div><div class="line">         &#125;</div><div class="line">         </div><div class="line">         programSoftware()&#123;  <span class="comment">//软件制作和设计</span></div><div class="line">             <span class="keyword">return</span> (<span class="string">" make ios11"</span>)；</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         designHardware()&#123; <span class="comment">//硬件原型设计</span></div><div class="line">            (<span class="string">" make ios11"</span>)；  </div><div class="line">            (<span class="string">" make  protype of ip8"</span>)；</div><div class="line">            (<span class="string">"design cpu of a11 "</span>)；</div><div class="line">   </div><div class="line">      &#125;</div><div class="line"></div><div class="line">         legalGroup()&#123;  <span class="comment">//法务部 负责和华为打官司</span></div><div class="line">           (<span class="string">"lawsuit with huawei"</span>)</div><div class="line">        &#125;               </div><div class="line">   &#125;</div><div class="line"></div><div class="line"><span class="comment">//这就在javascript里面给apple公司建立了一个对象，整个对象有初始化的属性， 还有三个自己擅长的方法。</span></div></pre></td></tr></table></figure></p>
<p> 话说2007年，乔布斯还在世的时候，他找到富士康公司老板郭台铭说：”我说台铭啊，我想找个工厂生产手机，以前富士康生产的imac不错，这才还是委托你们来生产吧“ 。郭台铭是：好吧。我马上建立<code>富士康苹果手机工厂</code>。为了好理解我加了<code>命名空间</code>，看见了么^_^。2017年，Apple推出iphone 10周年了，又要开始生产了。</p>
  <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//FskApple这个对象就是Apple的继承者，他本身是一个对象，并不是实例化出来的</span></div><div class="line"><span class="comment">//FskApple和Apple尽管用了extends关键字，但是他们没有从属关系，仅仅是委托关系而已</span></div><div class="line">   FskApple <span class="function"><span class="keyword">extends</span> <span class="title">Apple</span> <span class="params">()</span></span>&#123;</div><div class="line">        init()&#123;  <span class="comment">//fsk的初始化属性</span></div><div class="line">           founder:<span class="string">"郭台铭"</span>；</div><div class="line">           location:<span class="string">"郑州"</span>；            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">          makeHardware()&#123; <span class="comment">//硬件生产    </span></div><div class="line">            (<span class="string">" make  module ip8"</span>)；     <span class="comment">//生产模具，这是fsk的特长</span></div><div class="line">           (<span class="string">" Assemble ip8"</span>)；     <span class="comment">//组装iphone8，这也是fsk的特长     </span></div><div class="line">  </div><div class="line">         &#125;</div><div class="line"></div><div class="line"></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>  富士康并不精通屏幕生产，所以富士康有把屏幕的生产委托给了LG公司.LG公司要给苹果生产最新的AMOLED屏幕。<code>这里和实际的委托有出入只是为了好理解</code>. 好么又一个工厂出来了。富士康LG工厂。</p>
   <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">//LG富士康工厂又受fsk的委托生产</span></div><div class="line">     LgFsk <span class="function"><span class="keyword">extends</span> <span class="title">FskApple</span> <span class="params">()</span></span>&#123;</div><div class="line">      init()&#123;  <span class="comment">//LgFsk的初始化属性</span></div><div class="line">         founder:<span class="string">"unknow"</span>；</div><div class="line">         location:<span class="string">"seoul"</span>；            </div><div class="line">      &#125;</div><div class="line">      </div><div class="line">        makeScreen()&#123; <span class="comment">//屏幕   </span></div><div class="line">          (<span class="string">" make circuit"</span>)；     <span class="comment">//生产背板电路</span></div><div class="line">         (<span class="string">" make panel"</span>)；     <span class="comment">//生产面板     </span></div><div class="line"></div><div class="line">       &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实际的生产的委托关系比这个复杂的多，js的对象链也比这个复杂一点。我在这里把它简化为一条线的委托关系只是为了好理解。</p>
<p>三个对象的<code>委托链</code>建成以后，就可以投入生产了。富士康公司要调用ip8的设计方法时，他并不要自己去创建这个方法，因为他不擅长这个方法，他直接利用和苹果公司的委托关系借用苹果公司的设计方法就可以了。 苹果是委托富士康来生产，从整个产业链来说也可以认为是富士康委托苹果公司做了设计工作。苹果不生产，富士康不设计，但是一旦两者产生委托关系以后，两者可以发挥各自的特长，2017年iPhone8就在这个委托链中生产出来了。</p>
<p> 现代企业想改变这么一个发挥各自优势的链时多么的不容易，再也找不到更好的方法了。所以库克说苹果工厂再也回不去了。</p>
<p>为此我画了一张图，比较丑，凑活着看吧。这里就是三个对象之间的继承关系。我觉得叫连接关系比较好一点。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-3d40a51a813a002b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="screenshot_20.png"><br>原理如此，三个对象有继承关系，但是之间并不是从属关系。对象都具有自己擅长的方法，其他对象的方法也不活再费力去做一个独立的副本。lg要设计方法可以找富士康，富士康没有的话又可以找苹果。</p>
<p>我们去掉细节来看，js的对象继承链只是有些关键字借用了传统的面向对象的东西，但是实际上js和java的对象是完全不同的。</p>
<p>###最后再强调一句：javascript中的对象继承链不是对象之间的从属关系，而是一种委托和合作关系。理解这一点后面的学习就好办了。</p>
<p>   初学者水平，不知道这个通俗理解是否得体和准确？</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/javascript/' title=''>javascript</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-翻译-Immutable-js,持久化数据结构和结构共享" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/翻译-Immutable-js,持久化数据结构和结构共享/">翻译-Immutable-js,持久化数据结构和结构共享</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p><em>为什么要用Immutable.js来代替Javascript的对象</em></p>
<blockquote>
<p>翻译版本,<a href="https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2#.inlzpjxr8" target="_blank" rel="external">原文请见</a></p>
<hr>
<p>把你的数据看成是不可变的会带来很多的好处.实际上在React背后有个原则:React的元素是不可变的.你可能也会对学习不可变App构架有很大兴趣.</p>
</blockquote>
<p>但是使用Immutable.js的好处是:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> todos.update(id,</div><div class="line">    (todo) =&gt; todo.update(<span class="string">'completed'</span>,<span class="comment">//update是immutable的方法</span></div><div class="line">      (completed) =&gt; !completed</div><div class="line">    )</div><div class="line">  )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>跳过使用普通的Javascript对象(把他们看作为immutable,可以选则使用例如seamless-immutable之类的助手函数),像这样？:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123; &#125;, todos, &#123;</div><div class="line">    [id]: <span class="built_in">Object</span>.assign(&#123; &#125;, todos[id], &#123;</div><div class="line">      <span class="attr">completed</span>: !todos[id].completed</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"><span class="comment">// Using updeep</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleTodo</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> u(&#123;</div><div class="line">    [id]: &#123;</div><div class="line">      <span class="attr">completed</span>: <span class="function">(<span class="params">completed</span>) =&gt;</span> !completed</div><div class="line">    &#125;</div><div class="line">  &#125;, todos)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="一个非常大的对象…"><a href="#一个非常大的对象…" class="headerlink" title="一个非常大的对象…"></a>一个非常大的对象…</h3><p>让我们假设todo list 里面有100,00个任务:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> todos = &#123;</div><div class="line">  ⋮</div><div class="line">  t79444dae: &#123; <span class="attr">title</span>: <span class="string">'Task 50001'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t7eaf70c3</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50002'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2fd2ffa0</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50003'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t6321775c</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50004'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2148bf88</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50005'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t9e37b9b6</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50006'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tb5b1b6ae</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50007'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tfe88b26d</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50008'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  ⋮</div><div class="line">  (<span class="number">100</span>,<span class="number">000</span> items)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>我刚刚完成第50005件任务.<br>现在我想把它标记位完成.</p>
<h3 id="使用普通Javascript-对象"><a href="#使用普通Javascript-对象" class="headerlink" title="使用普通Javascript 对象"></a>使用普通Javascript 对象</h3><p><code>var nextState=toggleTodo(todos,&#39;t2148bf88&#39;)</code></p>
<p>这个单一的操作哟花费134ms来运行.</p>
<p>为什么？因为当你使用<code>Object.assign</code>,Javascript的浅复制拷贝每一个源的每个属性到目的地.一次一个.</p>
<p>我们有100,000个todos,所以意味着有100,000个属性要拷贝.<br>这就是为什么要花这么长的时间.</p>
<hr>
<h3 id="为什么要这么做？"><a href="#为什么要这么做？" class="headerlink" title="为什么要这么做？"></a>为什么要这么做？</h3><p>在Javascript中,对象默认是可以突变(mutable)的.<br>当你克隆一个对象,Javascript有每一个属性的拷贝,所以两个对象变得完全分离的.看下图<br><img src="https://ww3.sinaimg.cn/large/006tKfTcly1fdobo2he6bj312w0i2dgz.jpg" alt="100,000个属性被(浅)复制到目的地"></p>
<p>这就允许你在拷贝以后改变任何对象的属性,对象之间也不会相互影响.甚至在把这些对象处理为不可变(immutable),Javascript也还是按照mutable来处理.</p>
<hr>
<h3 id="使用Immutable-js"><a href="#使用Immutable-js" class="headerlink" title="使用Immutable.js"></a>使用Immutable.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> todos = Immutable.fromJS(&#123;</div><div class="line">  ⋮</div><div class="line">  t79444dae: &#123; <span class="attr">title</span>: <span class="string">'Task 50001'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t7eaf70c3</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50002'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2fd2ffa0</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50003'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t6321775c</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50004'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t2148bf88</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50005'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">t9e37b9b6</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50006'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tb5b1b6ae</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50007'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  <span class="attr">tfe88b26d</span>: &#123; <span class="attr">title</span>: <span class="string">'Task 50008'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">  ⋮</div><div class="line">  (<span class="number">100</span>,<span class="number">000</span> items)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<hr>
<p>使用<code>Immutable.Map</code>来代表我们的数据,更新第50005条任务<br><code>var nextState=toggleTodo(todos,&#39;t2148bf88&#39;)</code></p>
<p>这个操作仅花费1.2ms时间去运行.速度提升了100倍以上！</p>
<p>为什么会这么快？</p>
<h3 id="持久数据结构"><a href="#持久数据结构" class="headerlink" title="持久数据结构"></a>持久数据结构</h3><p>持久数据结构(Persistent data structures)强力限制所有的操作都要返回数据结构的新版本,保持原数据结构的完整性,不能更改原数据结构.</p>
<p>这一点暗示所有的持久化数据都是不可变的.</p>
<p>在这个给定的限制下,实现持久化数据结构的库可以进行很好的优化,因为这些库知道我们不会改变我们的数据.</p>
<p>让我们看一个优化</p>
<h3 id="使用tries来优化"><a href="#使用tries来优化" class="headerlink" title="使用tries来优化"></a>使用tries来优化</h3><p>为了直观一点,试一个小例子</p>
<p>想象存储一个键-值映射:</p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcly1fdocl8z802j304d08fglh.jpg" alt=""></p>
<p>我们可以把这个数据结构存储到单一的Javascirpt对象中:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">const</span> data = &#123;</div><div class="line">  <span class="attr">to</span>: <span class="number">7</span>,</div><div class="line">  <span class="attr">tea</span>: <span class="number">3</span>,</div><div class="line">  <span class="attr">ted</span>: <span class="number">4</span>,</div><div class="line">  <span class="attr">ten</span>: <span class="number">12</span>,</div><div class="line">  <span class="attr">A</span>: <span class="number">15</span>,</div><div class="line">  <span class="attr">i</span>: <span class="number">11</span>,</div><div class="line">  <span class="attr">in</span>: <span class="number">5</span>,</div><div class="line">  <span class="attr">inn</span>: <span class="number">9</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>但是我们怎么才能创建一个trie来代替js的对象呢？他的结构看起来是这个样子的：<br><img src="https://ww1.sinaimg.cn/large/006tKfTcly1fdocnlha2cj30eo0bhdg5.jpg" alt=""></p>
<p>基本上你可根据图上的路径从root开始获取到你需要的值.</p>
<p>如果你从root开始找<code>data.in</code>,根据标记<code>i</code>和<code>n</code>的路径.可以找到包含<code>5</code>的节点.</p>
<p>那么,怎么修改呢？</p>
<p>让我们思考一下把键<code>tea</code>的值从<code>3</code>改为<code>14</code>.</p>
<p>我们可以创建一个新的trie，尽可能的使用存在的节点.</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fdocttxa1tj30cq0a7mxf.jpg" alt=""></p>
<p>老的树形结构仍然存在,而且没有变化.在实例中你可以保留一个引用</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fdocuasnscj30f00clwf2.jpg" alt=""></p>
<p>在上图中如绿色部分所示,我们仅仅只需要更新4个节点来更新这个数.其他的节点是可以重新利用的。</p>
<p>下面这个图展示Immutable.js怎么实施<code>Immutable.Map</code>.创建一个每个节点有32个分支的树.</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fdodbub78oj30h20cpab6.jpg" alt="Immutable.Map的实施"></p>
<p> 当我们更新一个单个项目,仅仅只要一些节点需要被重新创建.</p>
<p> Immutable.js借助crazy advanced techniques保持树形结构的紧凑,根据各种子树的各种属性来创建多种类型的节点.</p>
<p> <img src="https://ww1.sinaimg.cn/large/006tNc79ly1fdoe03ud5ej30h907wt9c.jpg" alt=""></p>
<h3 id="并不总是如此…"><a href="#并不总是如此…" class="headerlink" title="并不总是如此…"></a>并不总是如此…</h3><p> 不要把本问的本意理解为“你总是需要Immutable.js“.不是这个意思,我只是想强调一下他的好处.解释一下为什么推荐要使用他.</p>
<p>  数据结构是很重要的,但是当我编写软件的时候,我首先要尝试最简单的方式.我过去使用数组和对象,之后当我需要速度提升的时候,我使用Immutable.js,或者是在我遇到到我需要他的时候.在只要少数的条目,还有小的对象和集合的时候,我就不会使用Immutable.js.</p>
<h2 id="是不是意思是我可能会返回去并且在后面在改变"><a href="#是不是意思是我可能会返回去并且在后面在改变" class="headerlink" title="是不是意思是我可能会返回去并且在后面在改变?"></a>是不是意思是我可能会返回去并且在后面在改变?</h2><p>  对！非常好！如果你的数据接入是通过单一,组织良好的模块.例如:</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// -- Todos.js --</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> empty = &#123; &#125;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">todos, id, todo</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123; &#125;, todos, &#123; [id]: todo &#125;)</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getById</span> (<span class="params">todos, id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> todos[id]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>估计所有的应用代码总是要使用这个模块来获取数据.当你想改变内含的数据结构时,你仅仅需要更新这个文件.</p>
<p>这个我们叫做”实体模块“,封装了代表整个软件系统的所有内容.这个概念来自”Clean Architecture“.我计划以后来写写这个问题.</p>
<h2 id="不要把应用的逻辑和数据结构耦合在一起"><a href="#不要把应用的逻辑和数据结构耦合在一起" class="headerlink" title="不要把应用的逻辑和数据结构耦合在一起"></a><code>不要把应用的逻辑和数据结构耦合在一起</code></h2><p>我很了解应用逻辑和数据结构不耦合在一起的艰难之处.这是因为我们不知道在未来数据怎么来获取.</p>
<p>例如:我们的todo app现在管理着100,000任务.我们改为使用Immytable.js.现在每个部分都足够好和足够快.</p>
<p>突然需求来了:”任务要有一个安排者”.(类似老师布置作业给学生),”用户应该可以看到任务是谁给安排的”.</p>
<pre><code class="js"> <span class="function"><span class="keyword">function</span> <span class="title">findByAssigneeAsArray</span> (<span class="params">todos, assigneeId</span>) </span>{
  <span class="keyword">return</span> todos.filter(
    <span class="function">(<span class="params">task</span>) =&gt;</span> Task.containsAssignee(task, assigneeId)
  ).toArray()
}
</code></pre>
<hr>
<p>用户开始抱怨app变慢了,分析揭示上面这个函数是个大问题.</p>
<p>使用上面这段代码需要序列搜索100，000任务.这样做怎么能快的起来？</p>
<h3 id="要优化这个案例-我们需要改变内在的数据结构"><a href="#要优化这个案例-我们需要改变内在的数据结构" class="headerlink" title="要优化这个案例,我们需要改变内在的数据结构"></a>要优化这个案例,我们需要改变内在的数据结构</h3><p>这需要保持一个反向的查询表,连接任务安排人和任务列表的TaksID.这个优化的修改实例来自于<code>[Taskworld](https://taskworld.com/)</code>.</p>
<p>如果我们的reducer/selector/view代码和数据结构直接连系在一起,要做出这样的改变非常难.</p>
<p>所以,如果我们想快速迭代,我们需要确保很容易做出修改.从开始就保持代码整洁,书写测试,建立持续集成.</p>
<h3 id="感谢阅读！"><a href="#感谢阅读！" class="headerlink" title="感谢阅读！"></a>感谢阅读！</h3><p> 更多的讨论在<a href="https://www.reddit.com/r/reactjs/comments/5h7pqz/persistent_data_structures_and_structural_sharing/" target="_blank" rel="external">Reddit</a>.</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/翻译/' title=''>翻译</a>
          </span>
        
      
        <!--
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-翻译-Redux-Saga-hello，world!" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/08/翻译-Redux-Saga-hello，world!/">翻译-Redux-Saga-hello，world!</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p>12 OCTOBER 2016</p>
<blockquote>
<p>这是翻译版本,<a href="https://ohyayanotherblog.ghost.io/redux-saga-hello-world/" target="_blank" rel="external">原文请见</a></p>
</blockquote>
<hr>
<p><a href="http://www.jianshu.com/p/6f8678a6ad78" target="_blank" rel="external">第一部分译文请见</a>，<br><a href="http://www.jianshu.com/p/fad0136e77c0" target="_blank" rel="external">第二部分译文请见</a>，<br><a href="http://www.jianshu.com/p/88fc4236b505" target="_blank" rel="external">第三部分译文请见</a>.</p>
<hr>
<p>##简单的Redux Saga 模板</p>
<p>在这个文章中,我们将完成完整的React/Redux/Redux Saga app,并且来看看为什么要这样做.</p>
<p>我已经创建了一个app的模板作为本文的起点,我们没有必要关注一些开发的细节,因为这些细节不是本系列文章的重点(我假设你已经了解React,Redux以及与此相关的开发工具.)但是我仍然会简单强调一些内容,以便于你对项目依赖包和配置有一些基础的了解.你可能是个高手,或者是个不折不扣的菜鸟(是菜鸟也没有关系)如果你不关心这些基础内容,直接跳到那副图片,看看后面的内容.</p>
<p>第一步,克隆repo,并且安装依赖包:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//原文的repo不能运行了,下面的repo是验证过的</span></div><div class="line">  git clone https:<span class="comment">//github.com/granmoe/redux-saga-clock-tutorial.git  </span></div><div class="line">cd redux-saga-clock-tutorial  </div><div class="line">npm i</div></pre></td></tr></table></figure></p>
<hr>
<p>好了做完上面的工作,使用你喜欢的编辑器打开项目,让我们先看看里面有些什么内容.<br>在我们的package.json文件中每个元素都是非常标准的,但是要注意,如果要对付不支持ES2015标砖的浏览器,需要引入babel-polyfill包.这个包必须在redux-saga之前引入(译者:redux-saga使用了ES2015的技术，所以要先获得支持才可以).</p>
<p>你也可以注意到,在package.json中有ESLint依赖包,因为我发现这个依赖包是开发中的无价之宝.</p>
<p>下面是我们的babel配置,在.babelrc文件中:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"><span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"react"</span>, <span class="string">"stage-2"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>我已经决定使用es2015,react和stage-2.</p>
<p>我还想讲讲.eslintrc文件,但是我实在是不想让你看到想睡觉.</p>
<p>webpack和index.html文件没讲,但是这里估计没有人会对这两个文件感兴趣.</p>
<p>#开始进入正题吧<br><img src="http://upload-images.jianshu.io/upload_images/2044710-6a256c33dfea1ba8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/320" alt="patrick Stewart McKellan Elmo.jpg"><br> app的入口文件是main.jsx:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">import</span> <span class="string">'babel-polyfill'</span> <span class="comment">// generator support  </span></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>  </div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>  </div><div class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'app.jsx'</span>  </div><div class="line"><span class="keyword">import</span> initStore <span class="keyword">from</span> <span class="string">'store'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> store = initStore()</div><div class="line"></div><div class="line">ReactDOM.render(  </div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;</span> <span class="attr">store</span> &#125;&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div></pre></td></tr></table></figure>
<hr>
<p> 这里我们导入一些依赖项(包括babel-polyfill),导入根组件,redux store的配置,实例化store,然后在经过Provider class包装的”app”div的中使用ReactDOM渲染出根组件,这样以来,在app中所有组件树种的react组件都可以很容易的接入到我们的store实例.</p>
<p> 查看store.js,代码中我们使用saga middleware来配置我们的store:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</div><div class="line"></div><div class="line">  <span class="keyword">const</span> store = createStore(</div><div class="line">    rootReducer,</div><div class="line">    applyMiddleware(sagaMiddleware)</div><div class="line">  )</div><div class="line"></div><div class="line">  sagaMiddleware.run(rootSaga)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> store</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p> 首先我们使用<code>createSagaMiddleware</code>方法来创建middleware实例.接下来,把根reducer和middleware传递到<code>createStore</code>,这就创建了一个redux store.然后把我们app的root saga传递进saga middleware.这一步一定要在redux store实例化以后再执行.<code>rootSaga</code>是顶级generator,这个generator负责代理其他所有的generators的工作(马上会看到.)</p>
<p> ##上面都是些什么见鬼的代码,你个王八蛋(译者:原意直接翻译啊)<br> 其实我们已经有了有趣的东西,我们的代码基本上依赖两个文件.”app.jsx”是一个react组件,可以根据app的state和基于DOM事件系统的actions来返回渲染的html标记.”duck.js”包含单纯对象actions和reducer,这两个函数一起工作描述出怎么修改state.其中也包含了所有的控制流代码,控制流代码描述了整个app的处理过程.如果你很熟悉标准的鸭子模型,我仅仅修改了鸭子模型,让他很容易包含saga代码.让我们使用鸭子模块来工作吧.</p>
<p>  我们将会创建一个可以控制的时钟.开始来想想app需要的最精简的sate结构.在任何时间我们要询问app的状态是”现在几点了？”所有我们需要存储的就是单个的数字.现在让我们来看看怎么改变这个状态.好的,我们我们将制作一个时钟,用户可以向前,向后,暂停和重置.这里的构想意味着我们表征时间的代码逻辑需要增,减,什么也不做,重置到0.什么事也不做意味着不需要sate发生改变,所以我们留下增加,减少,重置.我们要显示时间的毫秒数,因此app的state就定为”毫秒数”.</p>
<p>  正如上面所讲的,我们在redux代码中使用鸭子模型,如果你不喜欢这样做,可以分割成三个文件.<br>  让我们看看duck.js中的第一部分,<code>saga actions</code>.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">import</span> &#123; takeLatest &#125; <span class="keyword">from</span> <span class="string">'redux-saga'</span></div><div class="line"><span class="keyword">const</span> initialState = &#123;  </div><div class="line">  <span class="attr">milliseconds</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">currentState = initialState, action</span>) </span>&#123;  </div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'reset-clock'</span>:</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...currentState,</div><div class="line">        <span class="attr">milliseconds</span>: <span class="number">0</span></div><div class="line">      &#125;</div><div class="line">    <span class="keyword">case</span> <span class="string">'increment-milliseconds'</span>:</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...currentState,</div><div class="line">        <span class="attr">milliseconds</span>: currentState.milliseconds + <span class="number">100</span></div><div class="line">      &#125;</div><div class="line">    <span class="keyword">case</span> <span class="string">'decrement-milliseconds'</span>:</div><div class="line">      <span class="keyword">if</span> (!currentState.milliseconds) &#123; <span class="keyword">return</span> currentState &#125;</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        ...currentState,</div><div class="line">        <span class="attr">milliseconds</span>: currentState.milliseconds - <span class="number">100</span></div><div class="line">      &#125;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> currentState</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> resetClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'reset-clock'</span> &#125;) </div><div class="line"> </div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementMilliseconds = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'increment-milliseconds'</span> &#125;)  </div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> decrementMilliseconds = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'decrement-milliseconds'</span> &#125;)</div></pre></td></tr></table></figure>
<hr>
<p> 上面这段代码很简单.首先由我们需求字段的起始state,接着有一个reducer,reducer实际上操作actions,它基于action type对state做出合适的修饰,之后创建新的state。最后我们export(模块模式)一些可以在其他地方调用的<code>单纯action对象</code>.(马上我们会在saga中导入action对象之一).示例代码总是这么这么的整洁.</p>
<p> 现在我们需要实现一下app的流程.在处理过程中,什么状态需要输入？这个问题的另一个问法是:app在某个特定的时间应该做什么工作？我们的时钟可以向前,向后,暂停.为了在这几个过程中相互转变,我们需要三个action,开始时钟,拨回时间,暂停时钟.</p>
<p> 从代码<code>//saga actions</code>开始,看看duck模块的剩余部分.我们已经创建了三个actions,我们的root saga在收到某个action的时候,会启动一个傻瓜处理流程.现在在代码里傻瓜处理流程只是打印一下action的名字.后续我们会开始根据action type处理具体的增,减,休眠流程.这里是duck.js的saga代码.</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// saga actions</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> startClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'start-clock'</span> &#125;)  </div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> pauseClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'pause-clock'</span> &#125;)  </div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> rewindClock = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'rewind-clock'</span> &#125;)</div><div class="line"></div><div class="line"><span class="comment">// saga</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">rootSaga</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">yield</span> takeLatest([<span class="string">'start-clock'</span>, <span class="string">'pause-clock'</span>, <span class="string">'rewind-clock'</span>], handleClockAction)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">handleClockAction</span> (<span class="params">&#123; type &#125;</span>) </span>&#123;  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Pushed this action to handleClockAction: '</span>, type)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p> actions(严格上讲,根据术语来说应该是叫“action creators”,但是无所谓,只要你理解具体的意义就可以)应该看起来和其他的redux actions类似.但是这些action在我们的reducer中不能得到处理.如果保持仅仅在saga代码附近保留这些actions,这里的acions仅仅触发saga.做到这一点,会避免action和根据这些action做出的state修改的代码混杂在一起.显而易见,saga action仍然通脱<code>connect</code>函数绑定到store实例,并且输入到组件里.</p>
<p> 现在解释一下这个文件里奇怪的saga.你还记得<code>rootSaga</code>被传递到saga中间件,对吗？坦率讲,你可能也不知道,但是这也没关系.每次我们发出一个action,action会被推送到经过<code>sagaMiddleware.run(generator)</code>包装的generator.这就意味着,每个generator都有机会响应action,在我们的实例中,<code>rootSaga</code>遇到匹配的action type的时候才会做出响应.我们正在使用从Redux Saga获取的<code>takeLatest</code>助手函数完成这个工作.<code>takeLatest</code>接收任何与action type数组匹配的action,然后接着传递他,启动一个<code>handleClockAcion</code>流程,传递进action.<code>takeLatest</code>意思是直接收最新的action，如果现在还有正在运行的<code>handleClockAction</code>的话,在新的action开始之前,当前的这个处理流程需要先退出.<code>handleClockAction</code>,本质上是在后台启动,允许<code>rootSaga</code>保持运行状态,即使<code>handleClockAction</code>仍在运行,也可以接受下一个匹配的action.</p>
<p> 注意我们使用的<code>yield</code>关键词,回想一下,<code>yield</code>在generator中发出和接收值.在任何时间,我们<code>yield</code>一个Redux Saga助手或者effect的时候,我们就正在和Saga middleware进行通讯.在我们的上面的实例中,Redux Saga等待匹配发送到saga的action.后面我们还会更进一步深入讨论.<br> 我希望你至少对这个流程有一点感觉.我认为可能在测试过程中(译者：这里的意思是实际运行代码的过程，并不是代码的测试过程)你对这个流程更清楚一点.所以让我们看看React组件中怎么和用户进行交互的过程.<br> 在组件这一点看,“app.jsx”是非常简单的react组件.让我们看个仔细.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>  </div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; incrementMilliseconds, decrementMilliseconds, resetClock, startClock, pauseClock, rewindClock &#125; <span class="keyword">from</span> <span class="string">'duck'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;  </div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">const</span> &#123;</div><div class="line">      milliseconds,</div><div class="line">      incrementMilliseconds,</div><div class="line">      decrementMilliseconds,</div><div class="line">      resetClock,</div><div class="line">      startClock,</div><div class="line">      pauseClock,</div><div class="line">      rewindClock</div><div class="line">    &#125; = <span class="keyword">this</span>.props</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">incrementMilliseconds</span> &#125; <span class="attr">onDoubleClick</span>=<span class="string">&#123;</span> <span class="attr">resetClock</span> &#125; <span class="attr">onMouseLeave</span>=<span class="string">&#123;</span> <span class="attr">decrementMilliseconds</span> &#125;</span></div><div class="line">          <span class="attr">className</span>=<span class="string">"clock"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 100 100"</span> <span class="attr">width</span>=<span class="string">"500"</span>&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">&#123;</span> <span class="attr">30</span> &#125; <span class="attr">stroke</span>=<span class="string">&#123;</span> '<span class="attr">rgba</span>(<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>,<span class="attr">1</span>)' &#125; <span class="attr">fill</span>=<span class="string">"orange"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123; milliseconds &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">startClock</span> &#125;&gt;</span>Start Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">pauseClock</span> &#125;&gt;</span>Pause Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">rewindClock</span> &#125;&gt;</span>Rewind Clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default connect(state =&gt; (&#123;  </div><div class="line">  milliseconds: state.milliseconds</div><div class="line">&#125;), (&#123;</div><div class="line">  incrementMilliseconds,</div><div class="line">  decrementMilliseconds,</div><div class="line">  resetClock,</div><div class="line">  startClock,</div><div class="line">  pauseClock,</div><div class="line">  rewindClock</div><div class="line">&#125;))(Clock)</div></pre></td></tr></table></figure>
<hr>
<p> 通过使用connect高内聚组件,我们可以从store的state获取一个字段,并作为props传递进入组件.我们也通过一个对象传递四个action creators.Redux把这个对象绑定到store实例中,确保我们在组件中调用这几个action的时候,他们可以正确的被dispatch.<br>  在我们的渲染中,我们返回一个<code>&lt;div&gt;</code>,这个元素中有一个SVG(后续中将会比较关键).SVG有一些事件操作句柄,这些操作句柄将会dispatch state修饰actions.接下来,会有一个<code>&lt;p&gt;</code>元素依据app的state来显示当前时间.最后我们有几个<code>&lt;button&gt;</code>s 连接到saga的actions.<br>  上面的代码都就位以后,我们就试着运行一下app,验证一下基础构架和actions的工作情况.</p>
<p>  ##到底能工作吗？<br>  回到你的终端,运行<code>npm start</code>.现在输入localhost:8080,在浏览器中打开devtools,检查一下js 终端.当你点击buttons的时候,会看到saga actions的日志输出.现在试着在SVG上点击,鼠标一定,双击action.你可以看到毫秒文本的更新.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-740c183a8fff53ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/480" alt="app的界面"></p>
<p>  真好啊,我们创建了一个Redux Saga app的模板结构,了解了怎么使用<code>takeLatest</code>.还可以在终端中输出一些日志信息.棒！<br>  在下一篇文章中,我们会完成整个时钟的实施,得到一些非常酷的内容.</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-08T00:04:10.000Z" itemprop="datePublished">2017-03-08</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/翻译/' title=''>翻译</a>
          </span>
        
      
        <!--
          
        -->

      </p>
    </div>
  </article>
            
        </div>
        <div class="column one-third">
          <h3>Search</h3>

<div id="site_search">

	<!-- Google -->
	
		<form action="http://www.google.com/search?" data-site="http://yoursite.com">
	    	<input type="text" id="search_box" name="q" placeholder="Search" style="width: 253px;">
	    	<button type="button" class="btn btn-default" id="site_search_do"><span class="octicon octicon-search"></span></button>
	    </form>
	

	<!-- 本地搜索 -->
	

</div>
<h3>Popular Repositories</h3>

    
    <div class="popular-container"></div>
    
    <script type="text/template" id="popular-list-template">
        <a href="{%=clone_url%}" class="card text-center" target="_blank">
            <div class="thumbnail">
                <div class="card-image geopattern" data-pattern-id="{%=name%}">
                    <div class="card-image-cell">
                        <h3 class="card-title">
                            {%=name%}
                        </h3>
                    </div>
                </div>
                <div class="caption">
                    <div class="card-description">
                        <p class="card-text">
                            {%=description%}
                        </p>
                    </div>
                    <div class="card-text">
                        <span class="meta-info tooltipped tooltipped-n" aria-label="{%=stargazers_count%} stars">
                            <span class="octicon octicon-star"></span> {%=stargazers_count%}
                        </span>
                        <span class="meta-info tooltipped tooltipped-n" aria-label="{%=forks_count%} forks">
                            <span class="octicon octicon-git-branch"></span> {%=forks_count%}
                        </span>
                        <span class="meta-info tooltipped tooltipped-n" aria-label="最后更新时间：{%=updated_at%}">
                            <span class="octicon octicon-clock"></span>
                            <time datetime="{%=updated_at%}">{%=updated_at%}</time>
                        </span>
                    </div>
                </div>
            </div>
        </a>
    </script>

    <script src="/js/baiduTemplate.js"></script>
    <script type="text/javascript">
        var popular_repos = function(){

            var baiduTpl = new Object();

            var handleTpl = function(){
                baiduTpl.popular_list = baidu.template("popular-list-template");
            };

            var handleGithub = function(){
                var popularContainer = $(".popular-container");

                var repos = "Redux-counter-with-note,myreading,React-native-dummy-redux-app".split(",");
                for(var i in repos){
                    var name = repos[i];
                    $.get("https://api.github.com/repos/phpsmarter/"+name,handle);
                }

                function handle(result){
                    result.updated_at = result.updated_at.split("T")[0];
                    if(result){
                        var html = baiduTpl.popular_list(result);
                        popularContainer.append(html);
                        $(".geopattern").each(function(){           
                            $(this).geopattern($(this).data('pattern-id'));
                        });
                    }
                }
            };

            return {
                init:function(){
                    handleTpl();
                    handleGithub();
                }
            }
        }; 
        $(popular_repos().init);
    </script>

        </div>
    </div>

    
      <div class="pagination text-align">
          <div class="btn-group">
              <a class="extend prev" rel="prev" href="/archives/page/4/">&laquo;</a><a class="page-number" href="/archives/">1</a><a class="page-number" href="/archives/page/2/">2</a><a class="page-number" href="/archives/page/3/">3</a><a class="page-number" href="/archives/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/archives/page/6/">6</a><a class="extend next" rel="next" href="/archives/page/6/">&raquo;</a>
          </div>
      </div>
    
</section>

<footer class="container">
    <div class="site-footer" role="contentinfo">
        <div class="copyright left mobile-block">
                © 2017
                <span title="phpsmarter">phpsmarter</span>
                <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
        </div>

        <ul class="site-footer-links right mobile-hidden">
            <li>
                <a href="javascript:window.scrollTo(0,0)" >TOP</a>
            </li>
        </ul>

        <a href="https://phpsmarter.github.io" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <ul class="site-footer-links mobile-hidden">
            
                  
                  <li>
                    <a href="/"  title="首页">首页</a>
                  </li>
            
                  
                  <li>
                    <a href="/categories/"  title="分类">分类</a>
                  </li>
            
                  
                  <li>
                    <a href="/open-source/"  title="开源项目">开源项目</a>
                  </li>
            
                  
                  <li>
                    <a href="/message/"  title="留言板">留言板</a>
                  </li>
            
                  
                  <li>
                    <a href="/javascript/"  title="javascript">javascript</a>
                  </li>
            
            <li>
                <a href="/atom.xml">
                    <span class="octicon octicon-rss" style="color:blue;"></span>
                </a>
            </li>
        </ul>
    </div>
</footer>

		<script src="/js/geopattern.js"></script>
		<script src="/js/highlight.pack.js"></script>
		<script src="/lib/fancybox/jquery.fancybox-1.3.4.pack.js"></script>

		

		

		<script src="/js/index.js"></script>

		 <script src="/js/popular_repo.js"></script> 

	</body>
</html>