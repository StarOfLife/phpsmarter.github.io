<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
  <meta charset="utf-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <link rel="icon" href="/favicon.ico">
  
  <title>phpsmarter</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox-1.3.4.css">
  <!--在这里倒入jquery 方便处理部分页面的jquery-->
  <script src="https://cdn.staticfile.org/jquery/1.7/jquery.min.js" type="text/javascript" ></script>
</head>
<body class="home">
	<header class="site-header navfixed-false">
  <div class="container">
      <h1><a href="/" title="phpsmarter"><span class="octicon octicon-mark-github"></span> phpsmarter</a></h1>
      <nav class="site-header-nav" role="navigation">
        
              
              <a href="/"  class=" site-header-nav-item hvr-underline-from-center" title="首页">首页</a>
        
              
              <a href="/category/" target="true" class=" site-header-nav-item hvr-underline-from-center" title="分类">分类</a>
        
              
              <a href="/open-source/"  class=" site-header-nav-item hvr-underline-from-center" title="开源项目">开源项目</a>
        
              
              <a href="/message/"  class=" site-header-nav-item hvr-underline-from-center" title="留言板">留言板</a>
        
      </nav>
  </div>
</header>

	<section class="banner-false">
    <div class="collection-head">
        <div class="container">
            <div class="collection-title">
                <h1 class="collection-header" id="site-description">
                    
                </h1>
                <div class="collection-info">
                    
                    
                        <span class="meta-info">
                            
                                <span class="octicon octicon-location">
                                   
                                        ChengDu, China
                                    
                                </span>
                                
                            
                        </span>
                    
                        <span class="meta-info">
                            
                                <span class="octicon octicon-mark-github">
                                   
                                </span>
                                
                                    <a href="http://github.com/yumemor" target="_blank">yumemor</a>
                                
                            
                        </span>
                    
                </div>
            </div>
        </div>
    </div>
</section>
	   <section class="container">
    <div class="columns">
        <div class="column two-thirds">
            
                  <article id="post-javascript桥接模式(1)-队列数据结构" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/24/javascript桥接模式(1)-队列数据结构/">javascript桥接模式(1)-队列数据结构</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>根据书上例子的实际要求，涉及到js队列的问题。所以先把js中队列的具体实现数据结构贴出来。具体参考《学习javascript数据结构和算法》第四章。<br>队列数据结构遵循先入先出的原则。入队操作添加到数组的末尾，返回新数组。出队操作弹出数组第一个元素，返回新数组。两个操作对于数组都有结构的改变</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//js中队列的实现是依赖数组的数据结构</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Queue</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">let</span> items = [];  <span class="comment">//初始化空数组，let关键字是es6中的</span></div><div class="line">    <span class="comment">//用于形成大括号包围的作用域</span></div><div class="line"></div><div class="line">    <span class="keyword">this</span>.enqueue = <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123; <span class="comment">//入队操作</span></div><div class="line">        items.push(element); <span class="comment">//数组push操作</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.dequeue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//出对</span></div><div class="line">        <span class="keyword">return</span> items.shift(); <span class="comment">//数组shift操作</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.front = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//队列第一个元素</span></div><div class="line">        <span class="keyword">return</span> items[<span class="number">0</span>];     <span class="comment">//数组第一个元素</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.isEmpty = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//判断队列有无成员</span></div><div class="line">        <span class="keyword">return</span> items.length == <span class="number">0</span>; <span class="comment">//布尔值判断</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.clear = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//清空队列</span></div><div class="line">        items = [];   <span class="comment">//变量重新赋值空数组</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.size = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//获得队列的长度</span></div><div class="line">        <span class="keyword">return</span> items.length; </div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.print = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//打印队列</span></div><div class="line">        <span class="built_in">console</span>.log(items.toString());</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>下面是优先队列。数据成员入队的时候要携带数据和优先级。<br>优先级在这里的定义是数字越大在数组中的位置靠后。当插入一个数组元素的时候，先要根据它的优先级来判断，最小是直接插入到第一位，紧邻一个比他大的优先级是，就插入到这个邻居的前面。如果是最大的数字就插到数组的最后。<br>一维数组变成了二位数组。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">PriorityQueue</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">let</span> items = [];</div><div class="line">     </div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">QueueElement</span> (<span class="params">element, priority</span>)</span>&#123; </div><div class="line">            <span class="keyword">this</span>.element = element;<span class="comment">//成员本身</span></div><div class="line">        <span class="keyword">this</span>.priority = priority;  <span class="comment">//优先级</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.enqueue = <span class="function"><span class="keyword">function</span>(<span class="params">element, priority</span>)</span>&#123;</div><div class="line">        <span class="keyword">let</span> queueElement = <span class="keyword">new</span> QueueElement(element, priority);</div><div class="line"></div><div class="line">        <span class="keyword">let</span> added = <span class="literal">false</span>; <span class="comment">//添加标记</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;items.length; i++)&#123;</div><div class="line">            <span class="keyword">if</span> (queueElement.priority &lt;            </div><div class="line"> items[i].priority)&#123;  <span class="comment">//找到优先级数字比他大的那个元素</span></div><div class="line"></div><div class="line">                items.splice(i,<span class="number">0</span>,queueElement);            </div><div class="line">             <span class="comment">// 插到这个元素的前面</span></div><div class="line">                added = <span class="literal">true</span>;</div><div class="line">                <span class="keyword">break</span>; <span class="comment">// 终止</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!added)&#123; <span class="comment">//如果是优先级数字是最大的，直接插入到</span></div><div class="line">        <span class="comment">//数组的末尾</span></div><div class="line">            items.push(queueElement); <span class="comment">//&#123;5&#125;</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="comment">//其他操作和普通队列是一样的</span></div><div class="line"></div><div class="line">    <span class="keyword">this</span>.dequeue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> items.shift();</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.front = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> items[<span class="number">0</span>];</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.isEmpty = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> items.length == <span class="number">0</span>;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.size = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> items.length;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//print使用了es6里的拼接字符串的方法</span></div><div class="line">    <span class="keyword">this</span>.print = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;items.length; i++)&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;items[i].element&#125;</span>  - <span class="subst">$&#123;items[i].priority&#125;</span>`</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> priorityQueue = <span class="keyword">new</span> PriorityQueue();</div><div class="line">priorityQueue.enqueue(<span class="string">"John"</span>, <span class="number">2</span>);</div><div class="line">priorityQueue.enqueue(<span class="string">"Jack"</span>, <span class="number">1</span>);</div><div class="line">priorityQueue.enqueue(<span class="string">"Camila"</span>, <span class="number">1</span>);</div><div class="line">priorityQueue.enqueue(<span class="string">"Maxwell"</span>, <span class="number">2</span>);</div><div class="line">priorityQueue.enqueue(<span class="string">"Ana"</span>, <span class="number">3</span>);</div><div class="line">priorityQueue.print();</div><div class="line"><span class="comment">//=&gt;</span></div><div class="line"><span class="comment">//打印出的结果</span></div><div class="line">Jack  - <span class="number">1</span>  <span class="comment">//数组元素--优先级</span></div><div class="line">Camila  - <span class="number">1</span></div><div class="line">John  - <span class="number">2</span></div><div class="line">Maxwell  - <span class="number">2</span></div><div class="line">Ana  - <span class="number">3</span></div></pre></td></tr></table></figure>
<p>在这个队列的基础上可以实现javascript中桥接模式的例子。本文算是一个独立的javascript队列的介绍，也作为桥接模式例子的背景方法。<br><a href="http://www.apress.com/cn/book/9781590599082" target="_blank" rel="external">javascript设计模式 第八章-桥接模式</a></p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-24T11:04:10.000Z" itemprop="datePublished">2017-03-24</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-react-native视差滚动组件使用" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/24/react-native视差滚动组件使用/">react-native视差滚动组件使用</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p>看到许多app在界面上实现了头部的图片和文字的渐隐效果，在网上找到一个组件，实现了这个功能。如果要体现比较好的效果还需要在细节地方多研究。<br>这里写出来仅供学习的进一步的研究</p>
<p>   看看效果图</p>
<p><a href="https://github.com/phpsmarter/react-native-parallax-scroll-view" target="_blank" rel="external">react-native-parallax-scroll-view ,github地址</a></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-32c303299eff67ca.gif?imageMogr2/auto-orient/strip" alt="ScreenFlow.gif"><br>下面看一下代码<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">import</span> React, &#123; Component &#125; from <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  Dimensions,</div><div class="line">  Image,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">  AppRegistry,</div><div class="line">  StatusBar</div><div class="line">&#125; from <span class="string">'react-native'</span>;</div><div class="line"><span class="comment">//导入组件</span></div><div class="line"><span class="keyword">import</span> ParallaxScrollView from <span class="string">'react-native-parallax-scroll-view'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> window = Dimensions.<span class="built_in">get</span>(<span class="string">'window'</span>);<span class="comment">//获取宽度</span></div><div class="line">console.<span class="built_in">log</span>(window.<span class="built_in">width</span>);</div><div class="line"></div><div class="line">class Nested extends Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View style=&#123;&#123; flex: <span class="number">1</span> &#125;&#125;&gt;</div><div class="line">         <span class="comment">//方向，可以为row</span></div><div class="line">        &lt;View style=&#123;&#123; flex: <span class="number">1</span>, flexDirection: <span class="string">'column'</span> &#125;&#125;&gt;</div><div class="line">          &lt;View style=&#123;&#123; <span class="built_in">width</span>: <span class="number">60</span>, backgroundColor: <span class="string">'red'</span> &#125;&#125;/&gt;</div><div class="line">         <span class="comment">//滚动效果都在下面这个组件</span></div><div class="line">          &lt;ParallaxScrollView</div><div class="line">              style=&#123;&#123; flex: <span class="number">1</span>, backgroundColor: <span class="string">'hotpink'</span>, overflow: <span class="string">'hidden'</span> &#125;&#125;</div><div class="line">             <span class="comment">//下面渲染背景</span></div><div class="line">              renderBackground=&#123;() =&gt;  &lt;Image style=&#123;&#123;<span class="built_in">width</span>:window.<span class="built_in">width</span>,<span class="built_in">height</span>:<span class="number">350</span>&#125;&#125; source=&#123;require(<span class="string">'./images/schedule-background.png'</span>)&#125;/&gt;&#125;</div><div class="line">             <span class="comment">//下面是渲染前景</span></div><div class="line">              renderForeground=&#123;() =&gt; (</div><div class="line">                &lt;View&gt;</div><div class="line">                &lt;View style=&#123;&#123;alignItems: <span class="string">'center'</span>, justifyContent: <span class="string">'center'</span>,marginTop:<span class="number">50</span>&#125;&#125;&gt;</div><div class="line">              </div><div class="line">                &lt;Image style=&#123;&#123;borderRadius:<span class="number">50</span></div><div class="line">              &#125;&#125; source=&#123;&#123;</div><div class="line">                  uri: <span class="string">'https://pbs.twimg.com/profile_images/2694242404/5b0619220a92d391534b0cd89bf5adc1_400x400.jpeg'</span>,</div><div class="line">                  <span class="built_in">width</span>: <span class="number">100</span>,</div><div class="line">                  <span class="built_in">height</span>: <span class="number">100</span></div><div class="line">                &#125;&#125;/&gt;</div><div class="line">                &lt;/View&gt;</div><div class="line">               </div><div class="line">                  &lt;Text style=&#123;&#123;paddingVertical: <span class="number">5</span>,<span class="built_in">textAlign</span>:<span class="string">'center'</span>,<span class="built_in">color</span>:<span class="string">'white'</span>&#125;&#125;&gt;</div><div class="line">                    Talks by Rich Hickey</div><div class="line">                   &lt;/Text&gt;</div><div class="line">                   &lt;Text style=&#123;&#123;paddingVertical: <span class="number">5</span> ,<span class="built_in">textAlign</span>:<span class="string">'center'</span>,<span class="built_in">color</span>:<span class="string">'white'</span>&#125;&#125;&gt;</div><div class="line">                    CTO of Cognitec, Creator of Clojure</div><div class="line">                  &lt;/Text&gt;</div><div class="line">                </div><div class="line">                &lt;/View&gt;</div><div class="line">                </div><div class="line">            )&#125;</div><div class="line">             <span class="comment">//渲染固定头部</span></div><div class="line">              renderFixedHeader=&#123;() =&gt; &lt;Text style=&#123;&#123; <span class="built_in">textAlign</span>: <span class="string">'right'</span>, <span class="built_in">color</span>: <span class="string">'white'</span>, padding: <span class="number">5</span>, fontSize: <span class="number">20</span>,marginTop:<span class="number">20</span> &#125;&#125;&gt;Hello&lt;/Text&gt;&#125;</div><div class="line">              parallaxHeaderHeight=&#123; <span class="number">350</span> &#125;&gt;</div><div class="line">                        &lt;View style=&#123;&#123; alignItems: <span class="string">'center'</span>&#125;&#125;&gt;&lt;Text style=&#123;&#123; fontSize: <span class="number">20</span> ,backgroundColor:<span class="string">"#519caf"</span>,<span class="built_in">width</span>:window.<span class="built_in">width</span>,<span class="built_in">textAlign</span>:<span class="string">'center'</span>&#125;&#125;&gt;This is parallaxbox&lt;/Text&gt;&lt;/View&gt;          </div><div class="line"></div><div class="line">          &lt;/ParallaxScrollView&gt;</div><div class="line">          </div><div class="line">        &lt;/View&gt;</div><div class="line">        &lt;View style=&#123;&#123; <span class="built_in">height</span>: <span class="number">30</span>, backgroundColor: <span class="string">'#6577cc'</span> &#125;&#125;/&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export <span class="keyword">default</span> Nested;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">AppRegistry.registerComponent(<span class="string">'parallaxBox'</span>, () =&gt; Nested);</div></pre></td></tr></table></figure></p>
<p>背景图片用了一张f8app的背景图片，曲线有动态变化效果。<br>这个组件的api还是有一些，用好了效果就出来了。具体的看github介绍</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-23T21:44:17.000Z" itemprop="datePublished">2017-03-23</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/React-native/' title=''>React-native</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-Velocity动画库学习" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/24/Velocity动画库学习/">Velocity动画库学习</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p><img src="http://upload-images.jianshu.io/upload_images/2044710-a6a2735312d5c432.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/240" alt="1661.987.big.jpg.png"></p>
<blockquote>
<p>看velocity.js的内容有段时间了，源于图片这本书。前面看直观的感受是：这个库的操作很简单。要解决一个rn的动画问题，把这本书又拿出来看，刚好看到也有了velocity-react版，考虑是否以后可以用在react-native上，这样的话应用范围就大很多。<br><a href="http://velocityjs.org" target="_blank" rel="external">Velocity.js文档</a><br><a href="https://github.com/twitter-fabric/velocity-react" target="_blank" rel="external">velocity-react github地址</a>；<br><a href="https://fabric.io/blog/introducing-the-velocityreact-library" target="_blank" rel="external">velocity-react的内容</a>；</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-a00dfb63a7e5f09d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/400" alt="1443477710321.png"><br>初始化比较简单，网页中先导入jquery库，然后导入velocity.js库<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  //最好是配合jquery来使用，可以使用jquery的链式操作。</div><div class="line">  //jquery的函数操作在完成以后会有一句 return this,由此链式操作的</div><div class="line"> //的后一个方法的对象和前一个方法的对象是相同的</div><div class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/js/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/js/velocity.min.js"</span>&gt;</span><span class="javascript">/script&gt; </span></div><div class="line">   $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $div=$(<span class="string">"div"</span>);   <span class="comment">//jQuery对象缓存起来</span></div><div class="line">    $div.velocity(&#123;<span class="attr">opacity</span>:<span class="number">0.5</span>&#125;);  <span class="comment">//调用方法</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><em>Velocity接受多个参数</em>，第一个参数是一个对象，用于将css属性映射到对应的目标值，第二个参数是指定动画的选项<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> $element.velocity(&#123;<span class="string">width:</span><span class="string">"500px"</span>,<span class="string">opacity:</span><span class="number">0.5</span>&#125;,&#123;<span class="string">duration:</span><span class="number">400</span>,<span class="string">easing:</span><span class="string">"swing"</span>&#125;)</div><div class="line"></div><div class="line"><span class="comment">//也可以使用简写</span></div><div class="line">$element.velocity(&#123;<span class="string">width:</span><span class="string">"500px"</span>,<span class="string">opacity:</span><span class="number">0.5</span>&#125;,<span class="number">400</span>，<span class="string">"ease-in-out"</span>);</div></pre></td></tr></table></figure></p>
<p><em>对于css属性，velocity不支持简写，只能一个一个的写，而且css属性也和react一样是驼峰命名。</em></p>
<p>链式操作；如果为了效率放弃使用jquery,那么就不能使用链式操作了<br>每个操作单独写就可以了。<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$elemnt</span><span class="selector-class">.velocity</span>(&#123;<span class="attribute">width</span>:<span class="string">"400px"</span>&#125;).velocity(&#123;opacity:<span class="number">0.6</span>&#125;);</div></pre></td></tr></table></figure></p>
<p>使用这个库实现旋转动画 </p>
<p><img src="http://upload-images.jianshu.io/upload_images/2044710-5ddc998c6c858840.gif?imageMogr2/auto-orient/strip" alt="ScreenFlow.gif"><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;image id=<span class="string">"pic"</span> src=<span class="string">"img/pic.jpg"</span>/&gt;</div><div class="line">   <span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></span></div><div class="line">         $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">             $pic=$(<span class="string">"#pic"</span>);</div><div class="line">            $pic.velocity(  <span class="comment">//loop表示无限循环</span></div><div class="line">                    &#123;<span class="attr">rotateZ</span>: <span class="string">"360deg"</span>&#125;,&#123;<span class="attr">duration</span>:<span class="number">5000</span>,<span class="attr">loop</span>: <span class="literal">true</span> &#125;,<span class="string">"linear"</span>)；   </div><div class="line">         &#125;);   </div><div class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><a href="http://twitter-fabric.github.io/velocity-react/" target="_blank" rel="external">这是官方的一个示例</a><br><img src="http://upload-images.jianshu.io/upload_images/2044710-019b0a1d63961dd2.gif?imageMogr2/auto-orient/strip" alt="ScreenFlow3.gif"><br>下面是react组件的用法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ npm install --save velocity-react</div><div class="line"><span class="built_in">require</span>(<span class="string">'velocity-animate'</span>);</div><div class="line"><span class="built_in">require</span>(<span class="string">'velocity-animate/velocity.ui'</span>);</div><div class="line"> <span class="xml"><span class="tag">&lt;<span class="name">VelocityComponent</span> <span class="attr">animation</span>=<span class="string">&#123;&#123;</span> <span class="attr">opacity:</span> <span class="attr">this.state.showSubComponent</span> ? <span class="attr">1</span> <span class="attr">:</span> <span class="attr">0</span> &#125;&#125; <span class="attr">duration</span>=<span class="string">&#123;500&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">MySubComponent</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">VelocityComponent</span>&gt;</span></div></pre></td></tr></table></figure></p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-23T21:37:04.000Z" itemprop="datePublished">2017-03-23</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/React/' title=''>React</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-Javascript reducer函数" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/24/Javascript reducer函数/">Javascript reducer函数实战</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>javascript Reduce函数是比较强大的一个函数,在简书上看到有个作者写了这个函数的文章,也是看到有个问题就向他请教,大神很忙,但是仍然在github上做了答复,我对那个问题搞明白了,所以写了下面这个文章,但是没有写完,现在陪老娘在医院,又把这个问题翻出来看,又不懂了,还是拉锯战啊. javascript的编程中,我开始感到看别人的源码最难的地方实际还是两个,一个是数组方法的灵活应用,另一个是对象的浅拷贝和深拷贝的问题.这两个问题要是有深刻的体会,看源码的难度会降低很多.reduce,slice,splice,concat函数是明星.遇到这几个函数的时候就有些看不懂,所以掌握这几个函数是非常重要的. 深拷贝和浅拷贝的问题其实和javascript的对象和函数都是传引用赋值息息相关,一句话解决对象的共享还是独享的问题.javascript的设计模式很多都是利用对象很函数的传引用赋值的特点来完成的.所以这儿地方也是非常的重要.javascript的数组元素也可以是对象的引用.</p>
</blockquote>
<p>本人是新手,最大的体会是学到的两个简单原则:1 对象是用来组织数据和相关方法的,所以组织方式越简单,越灵活越好,由于js的对象和函数都可以传引用赋值,所以在js中,以对象字面量和数组的组织方式真的是非常的强大,之所以这么讲,就是要把学习数组的方法提到新的高度.2 编程到底是在干什么？ 我逐渐体会到编程也就是解决信息的传递，存储和处理的问题. 所以很多问题其实稍微抽象一下,问题可能会简单一点. 我简单的写了一个东西,在学习React/Redux的时候,总是掌握不了实质,就是Redux中的state的实质是什么.前面学习的时候,总是言必称state,想了各种办法去了解什么是state，为什么要这样设计.其实再抽象一下,这不就是一个小型的数据库吗？可以这样说吗？当然可以了,我看了一本介绍React的书,有点确认了,当我这几天再读F8 app的代码官方文档的时候,facebook直接就是把Redux称为数据层.我还想了一些办法来理解Redux，比如说借用中介者模式,MVC解耦和模式,但是如果抽象为数据层,那么还有什么问题解决不了的吗？ 如果接触过任何一种web框架语言,例如php/mysql,node/mongodb.每种都是解耦和,每种都是中介者模式.所以在理解这些概念的时候最基础的内容可能是最解决问题的条件.你可以梳理一下这些框架中与数据库操作都有哪些? 连接数据库,数据库操作语句,数据库文件,返回值等等.这些东西在react/redux中都能找到一摸一样的内容.web框架里的数据库操作和redux的操作是完全一样的,有什么奇怪的吗？都是数据库.</p>
<p>Redux的文档中有个redo,undo的例子,我最近又重新看redux文档的时候，感觉这一部分讲的真是好,以前怎么没有理解呢？  有三个缺陷一个是对于state的数据结构的理解,一个是堆栈方法使用理解,另一个就是js的浅拷贝的问题。前面看那本数据结构的书,也不得法,但是硬着头皮把几种数据结构拿下以后,突然觉得好多问题都找到了解决办法,计算机中对于数据结构和算法的重视不是白来的.state如果作为一个简单数据库,他里面就是一些<code>键值对</code>. 由于js中对象可以传引用,所以可以很容易的建立一个类数据库的结构.其他语言可以吗？</p>
<p>#####下面我们就贯彻以上的理念,来研究一些基础的内容。<br>第一个就是Reducer函数,参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="external">MDN</a> 文档</p>
<p>直接看代码例子</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//accumulator是累加值,currentValue是当前遍历的值</span></div><div class="line">[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].reduce( (accumulator, currentValue, currentIndex, array) =&gt; &#123;</div><div class="line">  return accumulator + currentValue;</div><div class="line">&#125;, <span class="number">10</span>);</div></pre></td></tr></table></figure>
<hr>
<table>
<thead>
<tr>
<th style="text-align:left">callback</th>
<th style="text-align:left">accumulate</th>
<th style="text-align:left">currentValue</th>
<th style="text-align:left">currentIndex</th>
<th style="text-align:left">array</th>
<th style="text-align:left">return</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">第一次调用</td>
<td style="text-align:left">10</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">[0,1,2,3,4]</td>
<td style="text-align:left">10</td>
</tr>
<tr>
<td style="text-align:left">第二次调用</td>
<td style="text-align:left">10</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">[0,1,2,3,4]</td>
<td style="text-align:left">11</td>
</tr>
<tr>
<td style="text-align:left">第三次调用</td>
<td style="text-align:left">11</td>
<td style="text-align:left">2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">[0,1,2,3,4]</td>
<td style="text-align:left">13</td>
</tr>
<tr>
<td style="text-align:left">第四次调用</td>
<td style="text-align:left">13</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">[0,1,2,3,4]</td>
<td style="text-align:left">16</td>
</tr>
<tr>
<td style="text-align:left">第五次调用</td>
<td style="text-align:left">16</td>
<td style="text-align:left">4</td>
<td style="text-align:left">4</td>
<td style="text-align:left">[0,1,2,3,4]</td>
<td style="text-align:left">20</td>
</tr>
</tbody>
</table>
<p>第一个遍历，accumulate等于10.遍历的数组元素是0，index是0.这是巧合。数组还是[0,1,2,3,4]。返回的值是初始值加当前的数组元素值，也就是返回accumulate+array[currentIndex]。return的就是 10+array[0]=10.</p>
<p>第二个遍历，accumulate就是10，遍历的数组元素是1，index是1.这也是巧合。数组还是[0,1,2,3,4]。返回的值是accumulate加当前的数组值，accumulate+array[currentIndex]。<br>也就是返回 10+array[1]=11.</p>
<p>第二个遍历和第一个遍历的区别就是初始值来源不同。第一个遍历的是reduce带进来的数据。第二个遍历使用的是第一个遍历返回的值。<br>后面的几个遍历就和第二个遍历一样了。</p>
<p><em>数组扁平化</em><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var flattened = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>]].reduce(function(a, b) &#123;</div><div class="line">    return a.concat(b); <span class="comment">//要了解concat的使用,返回的是</span></div><div class="line">    <span class="comment">//数组合并的返回对象</span></div><div class="line">&#125;, []); <span class="comment">//起始是空数组</span></div><div class="line"><span class="comment">// flattened is [0, 1, 2, 3, 4, 5]</span></div></pre></td></tr></table></figure></p>
<hr>
<p>就这么简单,但是灵活变动起来也不是太好理解啊<br>看这个计算器的React-Native的代码,在UI组件中渲染出计算器的几个按键的方法</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> Types = &#123; <span class="comment">//类型</span></div><div class="line">  NUMBER: <span class="string">'NUMBER'</span>,</div><div class="line">  DECIMAL: <span class="string">'DECIMAL'</span>,</div><div class="line">  SIGN: <span class="string">'SIGN'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> inputs = [</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">1</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">2</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">3</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">4</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">5</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">6</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">7</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">8</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">9</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'+/-'</span>, type: Types.SIGN&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">0</span>, type: Types.NUMBER&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'.'</span>, type: Types.DECIMAL&#125;,</div><div class="line">];</div><div class="line"><span class="comment">//操作符的配置</span></div><div class="line"><span class="keyword">var</span> operations = [</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'/'</span>, color: <span class="string">'#c77ccc'</span>, altColor: <span class="string">'#b16eb7'</span>, operation: OPERATION_DIVIDE&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'-'</span>, color: <span class="string">'#f8b055'</span>, altColor: <span class="string">'#dc9c4c'</span>, operation: OPERATION_SUBTRACT&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'+'</span>, color: <span class="string">'#f796d2'</span>, altColor: <span class="string">'#e088be'</span>, operation: OPERATION_ADD&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'x'</span>, color: <span class="string">'#6fcdf4'</span>, altColor: <span class="string">'#65badd'</span>, operation: OPERATION_MULTIPLY&#125;</div><div class="line">];</div><div class="line"></div><div class="line">renderInputRows() &#123;</div><div class="line">    <span class="keyword">var</span> &#123;inputNumber, inputSigned, inputDecimal&#125; = <span class="keyword">this</span>.props;<span class="comment">//注意在redux中那个地方返回了这三个函数的名字</span></div><div class="line">    <span class="keyword">return</span> inputs.reduce((collection, input) =&gt; &#123;<span class="comment">//这里的reduce是怎么用的呢？</span></div><div class="line">      <span class="keyword">if</span> (collection[collection.length - <span class="number">1</span>].length === <span class="number">3</span>) &#123;<span class="comment">//为什么等于3</span></div><div class="line">        collection.push([]);</div><div class="line">      &#125;</div><div class="line">      collection[collection.length<span class="number">-1</span>].push(input);</div><div class="line">      <span class="keyword">return</span> collection;</div><div class="line">    &#125;, [[]]).map((<span class="keyword">group</span>, rowIndex) =&gt; &#123;</div><div class="line">      <span class="keyword">var</span> columns = <span class="keyword">group</span>.map((item, columnIndex) =&gt; &#123;<span class="comment">//看看map的方法</span></div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          &lt;TouchableHighlight</div><div class="line">            key=&#123;<span class="string">'inputRow_'</span> + rowIndex + <span class="string">'_inputCol_'</span> + columnIndex&#125;</div><div class="line">            underlayColor=<span class="string">"#ededed"</span></div><div class="line">            style=&#123;styles.input&#125;</div><div class="line">            onPress=&#123;() =&gt; &#123; <span class="comment">//dispatch方法</span></div><div class="line">              <span class="keyword">if</span> (item.type === Types.NUMBER) &#123;</div><div class="line">                inputNumber(item.<span class="keyword">value</span>);</div><div class="line">              &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">item.type === Types.DECIMAL</span>) </span>&#123;</div><div class="line">                inputDecimal();</div><div class="line">              &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">item.type === Types.SIGN</span>) </span>&#123;</div><div class="line">                inputSigned();</div><div class="line">              &#125;</div><div class="line">            &#125;&#125;&gt;</div><div class="line">            &lt;Text style=&#123;styles.inputText&#125;&gt;&#123;item.<span class="keyword">value</span>&#125;&lt;/Text&gt;</div><div class="line">          &lt;/TouchableHighlight&gt;</div><div class="line">        );</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
<p>看看这个数组的reducer方法的使用.<a href="https://github.com/benoitvallon/react-native-nw-react-calculator" target="_blank" rel="external">源代码在这里</a></p>
<p>这个我稍后再补充,会补充大神给我的解答.</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> var Types = &#123;</div><div class="line">  <span class="keyword">NUMBER</span>: <span class="string">'NUMBER'</span>,</div><div class="line">  <span class="keyword">DECIMAL</span>: <span class="string">'DECIMAL'</span>,</div><div class="line">  <span class="built_in">SIGN</span>: <span class="string">'SIGN'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">var inputs = [</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">1</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">2</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">3</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">4</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">5</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">6</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">7</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">8</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">9</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'+/-'</span>, <span class="keyword">type</span>: Types.<span class="built_in">SIGN</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="number">0</span>, <span class="keyword">type</span>: Types.<span class="keyword">NUMBER</span>&#125;,</div><div class="line">  &#123;<span class="keyword">value</span>: <span class="string">'.'</span>, <span class="keyword">type</span>: Types.<span class="keyword">DECIMAL</span>&#125;,</div><div class="line">];</div><div class="line">//这里其实是有一维数组转为二维数组，打印结构可以看到.</div><div class="line">//注意reduce的起始值就是一个二维数组.</div><div class="line">var result = inputs.reduce((collection, input) =&gt; &#123;</div><div class="line">      <span class="keyword">if</span> (collection[collection.length - <span class="number">1</span>].length === <span class="number">3</span>) &#123;</div><div class="line">        collection.push([]);</div><div class="line">      &#125;</div><div class="line">      collection[collection.length-<span class="number">1</span>].push(input);</div><div class="line">      <span class="keyword">return</span> collection;</div><div class="line">    &#125;, [[]])</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(result)</div><div class="line">console.table(result)</div></pre></td></tr></table></figure>
<p>再看看下面这里两段代码<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">let str = `name,  age,  hair\nMerble,  <span class="number">35</span>,  red\nBob,  <span class="number">64</span>,  blonde`;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">lameCSV</span><span class="params">(str)</span></span> &#123;</div><div class="line">  <span class="keyword">return</span> str.split(<span class="string">'\n'</span>).reduce(<span class="function"><span class="keyword">function</span><span class="params">(table, row)</span></span>&#123;</div><div class="line">    <span class="built_in">table</span>.push(row.split(<span class="string">','</span>).map(<span class="function"><span class="keyword">function</span><span class="params">(c)</span></span> &#123;<span class="keyword">return</span> c.trim();&#125;));</div><div class="line">    <span class="keyword">return</span> <span class="built_in">table</span></div><div class="line">  &#125;, <span class="string">[[]]</span>);</div><div class="line">&#125;;</div><div class="line">lameCSV(str);</div></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var arr=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>];</div><div class="line"> var result = arr.reduce((collection, input) =&gt; &#123;</div><div class="line">      if (collection[collection.length - <span class="number">1</span>].length === <span class="number">3</span>) &#123;</div><div class="line">        collection.push([]);</div><div class="line">      &#125;</div><div class="line">      collection[collection.length<span class="number">-1</span>].push(input);</div><div class="line">      console.log(collection);</div><div class="line">      return collection;</div><div class="line">    &#125;, [[]]);</div></pre></td></tr></table></figure>
<hr>
<p><a href="https://github.com/zaxlct/baike_spider/issues/1" target="_blank" rel="external">感谢大神的帮助,大神的github</a><br>reduce这个方法还能演变出什么花样来呢？数组的操作真的是一个需要好好学习的内容.</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-23T21:03:59.000Z" itemprop="datePublished">2017-03-23</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/javascript/' title=''>javascript</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-Immutable collections for JavaScript" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/22/Immutable collections for JavaScript/">Immutable-collections</a>
  

      </h3>
      <div class="repo-list-description">
        
          <h1 id="Immutable-collections-for-JavaScript"><a href="#Immutable-collections-for-JavaScript" class="headerlink" title="Immutable collections for JavaScript"></a>Immutable collections for JavaScript</h1><p><a href="https://travis-ci.org/facebook/immutable-js" target="_blank" rel="external"><img src="https://travis-ci.org/facebook/immutable-js.svg?branch=master" alt="Build Status"></a></p>
<p><a href="http://en.wikipedia.org/wiki/Immutable_object" target="_blank" rel="external">Immutable</a> data cannot be changed once created, leading to much simpler<br>application development, no defensive copying, and enabling advanced memoization<br>and change detection techniques with simple logic. <a href="http://en.wikipedia.org/wiki/Persistent_data_structure" target="_blank" rel="external">Persistent</a> data presents<br>a mutative API which does not update the data in-place, but instead always<br>yields new updated data.</p>
<p>Immutable.js provides many Persistent Immutable data structures including:<br><code>List</code>, <code>Stack</code>, <code>Map</code>, <code>OrderedMap</code>, <code>Set</code>, <code>OrderedSet</code> and <code>Record</code>.</p>
<p>These data structures are highly efficient on modern JavaScript VMs by using<br>structural sharing via <a href="http://en.wikipedia.org/wiki/Hash_array_mapped_trie" target="_blank" rel="external">hash maps tries</a> and <a href="http://hypirion.com/musings/understanding-persistent-vector-pt-1" target="_blank" rel="external">vector tries</a> as popularized<br>by Clojure and Scala, minimizing the need to copy or cache data.</p>
<p><code>Immutable</code> also provides a lazy <code>Seq</code>, allowing efficient<br>chaining of collection methods like <code>map</code> and <code>filter</code> without creating<br>intermediate representations. Create some <code>Seq</code> with <code>Range</code> and <code>Repeat</code>.</p>
<p>Want to hear more? Watch the presentation about Immutable.js:</p>
<p><a href="https://youtu.be/I7IdS-PbEgI" target="_blank" alt="Immutable Data and React"><img src="https://img.youtube.com/vi/I7IdS-PbEgI/0.jpg"></a></p>
<h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><p>Install <code>immutable</code> using npm.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install immutable</div></pre></td></tr></table></figure>
<p>Then require it into any module.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Immutable = <span class="built_in">require</span>(<span class="string">'immutable'</span>);</div><div class="line"><span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line"><span class="keyword">var</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);</div><div class="line">map1.get(<span class="string">'b'</span>); <span class="comment">// 2</span></div><div class="line">map2.get(<span class="string">'b'</span>); <span class="comment">// 50</span></div></pre></td></tr></table></figure>
<h3 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h3><p>To use <code>immutable</code> from a browser, download <a href="https://github.com/facebook/immutable-js/blob/master/dist/immutable.min.js" target="_blank" rel="external">dist/immutable.min.js</a><br>or use a CDN such as <a href="https://cdnjs.com/libraries/immutable" target="_blank" rel="external">CDNJS</a><br>or <a href="http://www.jsdelivr.com/#!immutable.js" target="_blank" rel="external">jsDelivr</a>.</p>
<p>Then, add it as a script tag to your page:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"immutable.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line">    <span class="keyword">var</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);</div><div class="line">    map1.get(<span class="string">'b'</span>); <span class="comment">// 2</span></div><div class="line">    map2.get(<span class="string">'b'</span>); <span class="comment">// 50</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Or use an AMD loader (such as <a href="http://requirejs.org/" target="_blank" rel="external">RequireJS</a>):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'./immutable.min.js'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">Immutable</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line">    <span class="keyword">var</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);</div><div class="line">    map1.get(<span class="string">'b'</span>); <span class="comment">// 2</span></div><div class="line">    map2.get(<span class="string">'b'</span>); <span class="comment">// 50</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>If you’re using <a href="http://browserify.org/" target="_blank" rel="external">browserify</a>, the <code>immutable</code> npm module<br>also works from the browser.</p>
<h3 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h3><p>Use these Immutable collections and sequences as you would use native<br>collections in your <a href="http://typescriptlang.org" target="_blank" rel="external">TypeScript</a> programs while still taking<br>advantage of type generics, error detection, and auto-complete in your IDE.</p>
<p>Just add a reference with a relative path to the type declarations at the top<br>of your file.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">///&lt;reference path='./node_modules/immutable/dist/immutable.d.ts'/&gt;</span></div><div class="line"><span class="keyword">import</span> Immutable = <span class="built_in">require</span>(<span class="string">'immutable'</span>);</div><div class="line"><span class="keyword">var</span> map1: Immutable.Map&lt;string, number&gt;;</div><div class="line">map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line"><span class="keyword">var</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);</div><div class="line">map1.get(<span class="string">'b'</span>); <span class="comment">// 2</span></div><div class="line">map2.get(<span class="string">'b'</span>); <span class="comment">// 50</span></div></pre></td></tr></table></figure>
<h2 id="The-case-for-Immutability"><a href="#The-case-for-Immutability" class="headerlink" title="The case for Immutability"></a>The case for Immutability</h2><p>Much of what makes application development difficult is tracking mutation and<br>maintaining state. Developing with immutable data encourages you to think<br>differently about how data flows through your application.</p>
<p>Subscribing to data events throughout your application creates a huge overhead of<br>book-keeping which can hurt performance, sometimes dramatically, and creates<br>opportunities for areas of your application to get out of sync with each other<br>due to easy to make programmer error. Since immutable data never changes,<br>subscribing to changes throughout the model is a dead-end and new data can only<br>ever be passed from above.</p>
<p>This model of data flow aligns well with the architecture of <a href="http://facebook.github.io/react/" target="_blank" rel="external">React</a><br>and especially well with an application designed using the ideas of <a href="http://facebook.github.io/flux/docs/overview.html" target="_blank" rel="external">Flux</a>.</p>
<p>When data is passed from above rather than being subscribed to, and you’re only<br>interested in doing work when something has changed, you can use equality.</p>
<p>Immutable collections should be treated as <em>values</em> rather than <em>objects</em>. While<br>objects represent some thing which could change over time, a value represents<br>the state of that thing at a particular instance of time. This principle is most<br>important to understanding the appropriate use of immutable data. In order to<br>treat Immutable.js collections as values, it’s important to use the<br><code>Immutable.is()</code> function or <code>.equals()</code> method to determine value equality<br>instead of the <code>===</code> operator which determines object reference identity.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line"><span class="keyword">var</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">2</span>);</div><div class="line">assert(map1.equals(map2) === <span class="literal">true</span>);</div><div class="line"><span class="keyword">var</span> map3 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);</div><div class="line">assert(map1.equals(map3) === <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>Note: As a performance optimization <code>Immutable</code> attempts to return the existing<br>collection when an operation would result in an identical collection, allowing<br>for using <code>===</code> reference equality to determine if something definitely has not<br>changed. This can be extremely useful when used within a memoization function<br>which would prefer to re-run the function if a deeper equality check could<br>potentially be more costly. The <code>===</code> equality check is also used internally by<br><code>Immutable.is</code> and <code>.equals()</code> as a performance optimization.</p>
<p>If an object is immutable, it can be “copied” simply by making another reference<br>to it instead of copying the entire object. Because a reference is much smaller<br>than the object itself, this results in memory savings and a potential boost in<br>execution speed for programs which rely on copies (such as an undo-stack).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;);</div><div class="line"><span class="keyword">var</span> clone = map1;</div></pre></td></tr></table></figure>
<h2 id="JavaScript-first-API"><a href="#JavaScript-first-API" class="headerlink" title="JavaScript-first API"></a>JavaScript-first API</h2><p>While <code>immutable</code> is inspired by Clojure, Scala, Haskell and other functional<br>programming environments, it’s designed to bring these powerful concepts to<br>JavaScript, and therefore has an Object-Oriented API that closely mirrors that<br>of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/New_in_JavaScript/ECMAScript_6_support_in_Mozilla" target="_blank" rel="external">ES6</a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="external">Array</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="external">Map</a>, and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="external">Set</a>.</p>
<p>The difference for the immutable collections is that methods which would mutate<br>the collection, like <code>push</code>, <code>set</code>, <code>unshift</code> or <code>splice</code> instead return a new<br>immutable collection. Methods which return new arrays like <code>slice</code> or <code>concat</code><br>instead return new immutable collections.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> list1 = Immutable.List.of(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line"><span class="keyword">var</span> list2 = list1.push(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</div><div class="line"><span class="keyword">var</span> list3 = list2.unshift(<span class="number">0</span>);</div><div class="line"><span class="keyword">var</span> list4 = list1.concat(list2, list3);</div><div class="line">assert(list1.size === <span class="number">2</span>);</div><div class="line">assert(list2.size === <span class="number">5</span>);</div><div class="line">assert(list3.size === <span class="number">6</span>);</div><div class="line">assert(list4.size === <span class="number">13</span>);</div><div class="line">assert(list4.get(<span class="number">0</span>) === <span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>Almost all of the methods on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="external">Array</a> will be found in similar form on<br><code>Immutable.List</code>, those of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="external">Map</a> found on <code>Immutable.Map</code>, and those of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="external">Set</a><br>found on <code>Immutable.Set</code>, including collection operations like <code>forEach()</code><br>and <code>map()</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> alpha = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>, <span class="attr">d</span>:<span class="number">4</span>&#125;);</div><div class="line">alpha.map(<span class="function">(<span class="params">v, k</span>) =&gt;</span> k.toUpperCase()).join();</div><div class="line"><span class="comment">// 'A,B,C,D'</span></div></pre></td></tr></table></figure>
<h3 id="Accepts-raw-JavaScript-objects"><a href="#Accepts-raw-JavaScript-objects" class="headerlink" title="Accepts raw JavaScript objects."></a>Accepts raw JavaScript objects.</h3><p>Designed to inter-operate with your existing JavaScript, <code>immutable</code><br>accepts plain JavaScript Arrays and Objects anywhere a method expects an<br><code>Iterable</code> with no performance penalty.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>, <span class="attr">d</span>:<span class="number">4</span>&#125;);</div><div class="line"><span class="keyword">var</span> map2 = Immutable.Map(&#123;<span class="attr">c</span>:<span class="number">10</span>, <span class="attr">a</span>:<span class="number">20</span>, <span class="attr">t</span>:<span class="number">30</span>&#125;);</div><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">d</span>:<span class="number">100</span>, <span class="attr">o</span>:<span class="number">200</span>, <span class="attr">g</span>:<span class="number">300</span>&#125;;</div><div class="line"><span class="keyword">var</span> map3 = map1.merge(map2, obj);</div><div class="line"><span class="comment">// Map &#123; a: 20, b: 2, c: 10, d: 100, t: 30, o: 200, g: 300 &#125;</span></div></pre></td></tr></table></figure>
<p>This is possible because <code>immutable</code> can treat any JavaScript Array or Object<br>as an Iterable. You can take advantage of this in order to get sophisticated<br>collection methods on JavaScript Objects, which otherwise have a very sparse<br>native API. Because Seq evaluates lazily and does not cache intermediate<br>results, these operations can be extremely efficient.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>,<span class="attr">c</span>:<span class="number">3</span>&#125;;</div><div class="line">Immutable.Seq(myObject).map(<span class="function"><span class="params">x</span> =&gt;</span> x * x).toObject();</div><div class="line"><span class="comment">// &#123; a: 1, b: 4, c: 9 &#125;</span></div></pre></td></tr></table></figure>
<p>Keep in mind, when using JS objects to construct Immutable Maps, that<br>JavaScript Object properties are always strings, even if written in a quote-less<br>shorthand, while Immutable Maps accept keys of any type.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123; <span class="number">1</span>: <span class="string">"one"</span> &#125;;</div><div class="line"><span class="built_in">Object</span>.keys(obj); <span class="comment">// [ "1" ]</span></div><div class="line">obj[<span class="string">"1"</span>]; <span class="comment">// "one"</span></div><div class="line">obj[<span class="number">1</span>];   <span class="comment">// "one"</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> map = Immutable.fromJS(obj);</div><div class="line">map.get(<span class="string">"1"</span>); <span class="comment">// "one"</span></div><div class="line">map.get(<span class="number">1</span>);   <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p>Property access for JavaScript Objects first converts the key to a string, but<br>since Immutable Map keys can be of any type the argument to <code>get()</code> is<br>not altered.</p>
<h3 id="Converts-back-to-raw-JavaScript-objects"><a href="#Converts-back-to-raw-JavaScript-objects" class="headerlink" title="Converts back to raw JavaScript objects."></a>Converts back to raw JavaScript objects.</h3><p>All <code>immutable</code> Iterables can be converted to plain JavaScript Arrays and<br>Objects shallowly with <code>toArray()</code> and <code>toObject()</code> or deeply with <code>toJS()</code>.<br>All Immutable Iterables also implement <code>toJSON()</code> allowing them to be passed to<br><code>JSON.stringify</code> directly.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> deep = Immutable.Map(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: Immutable.List.of(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) &#125;);</div><div class="line">deep.toObject() <span class="comment">// &#123; a: 1, b: 2, c: List [ 3, 4, 5 ] &#125;</span></div><div class="line">deep.toArray() <span class="comment">// [ 1, 2, List [ 3, 4, 5 ] ]</span></div><div class="line">deep.toJS() <span class="comment">// &#123; a: 1, b: 2, c: [ 3, 4, 5 ] &#125;</span></div><div class="line"><span class="built_in">JSON</span>.stringify(deep) <span class="comment">// '&#123;"a":1,"b":2,"c":[3,4,5]&#125;'</span></div></pre></td></tr></table></figure>
<h3 id="Embraces-ES6"><a href="#Embraces-ES6" class="headerlink" title="Embraces ES6"></a>Embraces ES6</h3><p><code>Immutable</code> takes advantage of features added to JavaScript in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/New_in_JavaScript/ECMAScript_6_support_in_Mozilla" target="_blank" rel="external">ES6</a>,<br>the latest standard version of ECMAScript (JavaScript), including <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/The_Iterator_protocol" target="_blank" rel="external">Iterators</a>,<br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="external">Arrow Functions</a>, <a href="http://wiki.ecmascript.org/doku.php?id=strawman:maximally_minimal_classes" target="_blank" rel="external">Classes</a>, and <a href="http://www.2ality.com/2014/09/es6-modules-final.html" target="_blank" rel="external">Modules</a>. It’s also inspired by the<br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="external">Map</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="external">Set</a> collections added to ES6. The library is “transpiled” to ES3<br>in order to support all modern browsers.</p>
<p>All examples are presented in ES6. To run in all browsers, they need to be<br>translated to ES3.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ES6</span></div><div class="line">foo.map(<span class="function"><span class="params">x</span> =&gt;</span> x * x);</div><div class="line"><span class="comment">// ES3</span></div><div class="line">foo.map(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x * x; &#125;);</div></pre></td></tr></table></figure>
<h2 id="Nested-Structures"><a href="#Nested-Structures" class="headerlink" title="Nested Structures"></a>Nested Structures</h2><p>The collections in <code>immutable</code> are intended to be nested, allowing for deep<br>trees of data, similar to JSON.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nested = Immutable.fromJS(&#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:&#123;<span class="attr">c</span>:[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;&#125;&#125;);</div><div class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5 ] &#125; &#125; &#125;</span></div></pre></td></tr></table></figure>
<p>A few power-tools allow for reading and operating on nested data. The<br>most useful are <code>mergeDeep</code>, <code>getIn</code>, <code>setIn</code>, and <code>updateIn</code>, found on <code>List</code>,<br><code>Map</code> and <code>OrderedMap</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nested2 = nested.mergeDeep(&#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:&#123;<span class="attr">d</span>:<span class="number">6</span>&#125;&#125;&#125;);</div><div class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5 ], d: 6 &#125; &#125; &#125;</span></div><div class="line"></div><div class="line">nested2.getIn([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>]); <span class="comment">// 6</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> nested3 = nested2.updateIn([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>], value =&gt; value + <span class="number">1</span>);</div><div class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5 ], d: 7 &#125; &#125; &#125;</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> nested4 = nested3.updateIn([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], list =&gt; list.push(<span class="number">6</span>));</div><div class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5, 6 ], d: 7 &#125; &#125; &#125;</span></div></pre></td></tr></table></figure>
<h2 id="Lazy-Seq"><a href="#Lazy-Seq" class="headerlink" title="Lazy Seq"></a>Lazy Seq</h2><p><code>Seq</code> describes a lazy operation, allowing them to efficiently chain<br>use of all the Iterable methods (such as <code>map</code> and <code>filter</code>).</p>
<p><strong>Seq is immutable</strong> — Once a Seq is created, it cannot be<br>changed, appended to, rearranged or otherwise modified. Instead, any mutative<br>method called on a Seq will return a new Seq.</p>
<p><strong>Seq is lazy</strong> — Seq does as little work as necessary to respond to any<br>method call.</p>
<p>For example, the following does not perform any work, because the resulting<br>Seq is never used:</p>
<pre><code>var oddSquares = Immutable.Seq.of(1,2,3,4,5,6,7,8)
  .filter(x =&gt; x % 2).map(x =&gt; x * x);
</code></pre><p>Once the Seq is used, it performs only the work necessary. In this<br>example, no intermediate arrays are ever created, filter is called three times,<br>and map is only called once:</p>
<pre><code>console.log(oddSquares.get(1)); // 9
</code></pre><p>Any collection can be converted to a lazy Seq with <code>.toSeq()</code>.</p>
<pre><code>var seq = Immutable.Map({a:1, b:1, c:1}).toSeq();
</code></pre><p>Seq allows for the efficient chaining of sequence operations, especially when<br>converting to a different concrete type (such as to a JS object):</p>
<pre><code>seq.flip().map(key =&gt; key.toUpperCase()).flip().toObject();
// { A: 1, B: 1, C: 1 }
</code></pre><p>As well as expressing logic that would otherwise seem memory-limited:</p>
<pre><code>Immutable.Range(1, Infinity)
  .skip(1000)
  .map(n =&gt; -n)
  .filter(n =&gt; n % 2 === 0)
  .take(2)
  .reduce((r, n) =&gt; r * n, 1);
// 1006008
</code></pre><p>Note: An iterable is always iterated in the same order, however that order may<br>not always be well defined, as is the case for the <code>Map</code>.</p>
<h2 id="Equality-treats-Collections-as-Data"><a href="#Equality-treats-Collections-as-Data" class="headerlink" title="Equality treats Collections as Data"></a>Equality treats Collections as Data</h2><p><code>Immutable</code> provides equality which treats immutable data structures as pure<br>data, performing a deep equality check if necessary.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">1</span>, <span class="attr">c</span>:<span class="number">1</span>&#125;);</div><div class="line"><span class="keyword">var</span> map2 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">1</span>, <span class="attr">c</span>:<span class="number">1</span>&#125;);</div><div class="line">assert(map1 !== map2); <span class="comment">// two different instances</span></div><div class="line">assert(Immutable.is(map1, map2)); <span class="comment">// have equivalent values</span></div><div class="line">assert(map1.equals(map2)); <span class="comment">// alternatively use the equals method</span></div></pre></td></tr></table></figure>
<p><code>Immutable.is()</code> uses the same measure of equality as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is" target="_blank" rel="external">Object.is</a><br>including if both are immutable and all keys and values are equal<br>using the same measure of equality.</p>
<h2 id="Batching-Mutations"><a href="#Batching-Mutations" class="headerlink" title="Batching Mutations"></a>Batching Mutations</h2><blockquote>
<p>If a tree falls in the woods, does it make a sound?</p>
<p>If a pure function mutates some local data in order to produce an immutable<br>return value, is that ok?</p>
<p>— Rich Hickey, Clojure</p>
</blockquote>
<p>Applying a mutation to create a new immutable object results in some overhead,<br>which can add up to a minor performance penalty. If you need to apply a series<br>of mutations locally before returning, <code>Immutable</code> gives you the ability to<br>create a temporary mutable (transient) copy of a collection and apply a batch of<br>mutations in a performant manner by using <code>withMutations</code>. In fact, this is<br>exactly how  <code>Immutable</code> applies complex mutations itself.</p>
<p>As an example, building <code>list2</code> results in the creation of 1, not 3, new<br>immutable Lists.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> list1 = Immutable.List.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> list2 = list1.withMutations(<span class="function"><span class="keyword">function</span> (<span class="params">list</span>) </span>&#123;</div><div class="line">  list.push(<span class="number">4</span>).push(<span class="number">5</span>).push(<span class="number">6</span>);</div><div class="line">&#125;);</div><div class="line">assert(list1.size === <span class="number">3</span>);</div><div class="line">assert(list2.size === <span class="number">6</span>);</div></pre></td></tr></table></figure>
<p>Note: <code>immutable</code> also provides <code>asMutable</code> and <code>asImmutable</code>, but only<br>encourages their use when <code>withMutations</code> will not suffice. Use caution to not<br>return a mutable copy, which could result in undesired behavior.</p>
<p><em>Important!</em>: Only a select few methods can be used in <code>withMutations</code> including<br><code>set</code>, <code>push</code> and <code>pop</code>. These methods can be applied directly against a<br>persistent data-structure where other methods like <code>map</code>, <code>filter</code>, <code>sort</code>,<br>and <code>splice</code> will always return new immutable data-structures and never mutate<br>a mutable collection.</p>
<h2 id="Documentation"><a href="#Documentation" class="headerlink" title="Documentation"></a>Documentation</h2><p><a href="http://facebook.github.io/immutable-js/docs/" target="_blank" rel="external">Read the docs</a> and eat your vegetables.</p>
<p>Docs are automatically generated from <a href="https://github.com/facebook/immutable-js/blob/master/type-definitions/Immutable.d.ts" target="_blank" rel="external">Immutable.d.ts</a>.<br>Please contribute!</p>
<p>Also, don’t miss the <a href="https://github.com/facebook/immutable-js/wiki" target="_blank" rel="external">Wiki</a> which<br>contains articles on specific topics. Can’t find something? Open an <a href="https://github.com/facebook/immutable-js/issues" target="_blank" rel="external">issue</a>.</p>
<h2 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h2><p>If you are using the <a href="http://chaijs.com/" target="_blank" rel="external">Chai Assertion Library</a>, <a href="https://github.com/astorije/chai-immutable" target="_blank" rel="external">Chai Immutable</a> provides a set of assertions to use against <code>Immutable</code> collections.</p>
<h2 id="Contribution"><a href="#Contribution" class="headerlink" title="Contribution"></a>Contribution</h2><p>Use <a href="https://github.com/facebook/immutable-js/issues" target="_blank" rel="external">Github issues</a> for requests.</p>
<p>We actively welcome pull requests, learn how to <a href="./CONTRIBUTING.md">contribute</a>.</p>
<h2 id="Changelog"><a href="#Changelog" class="headerlink" title="Changelog"></a>Changelog</h2><p>Changes are tracked as <a href="https://github.com/facebook/immutable-js/releases" target="_blank" rel="external">Github releases</a>.</p>
<h2 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h2><p><a href="https://www.youtube.com/watch?v=K2NYwP90bNs" target="_blank" rel="external">Phil Bagwell</a>, for his inspiration<br>and research in persistent data structures.</p>
<p><a href="https://github.com/hughfdjackson/" target="_blank" rel="external">Hugh Jackson</a>, for providing the npm package<br>name. If you’re looking for his unsupported package, see <a href="https://github.com/hughfdjackson/immutable" target="_blank" rel="external">this repository</a>.</p>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p><code>Immutable</code> is <a href="https://github.com/facebook/immutable-js/blob/master/LICENSE" target="_blank" rel="external">BSD-licensed</a>. We also provide an additional <a href="https://github.com/facebook/immutable-js/blob/master/PATENTS" target="_blank" rel="external">patent grant</a>.</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-22T00:04:10.000Z" itemprop="datePublished">2017-03-22</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Redux/' title=''>Redux</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript动态类型，鸭子终于煮熟了" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/20/javascript动态类型，鸭子终于煮熟了/">javascript动态类型，鸭子终于煮熟了</a>
  

      </h3>
      <div class="repo-list-description">
        
          <p>冬至来了，刚去吃了一碗萝卜饺子，浑身发热。突然觉得鸭子已经熟了。</p>
<p>开个玩笑。这里要说的是动态语言的鸭子类型(ducking type)。 <code>这个话题应该是整个javascript面向对象编程的核心思想</code>.不知道下这个结论对不对？可是在前面还不太了解到底是什么意思。看代码的时候总有种感觉，就是javascript太灵活了，怎么什么对象的方法都可以直接通过参数传递的方式来在另一个函数中使用。在模式学习时常看到这种代码。<br>刚才又重新看这部分内容时突然明白了。这个方法就是面向对象编程里的鸭子模型。</p>
<p>什么是鸭子类型呢？我总结一句话，英雄不问出处，只要能干活就行。javascript里面对象都是蓝领，只干活，至于是小学水平还是博士水平，我们不关心，能干活就行。 java语言就不是，java在你干活之前想要把你的祖宗十八代都查一遍，根正苗红的才能来干活。所以javascript就很灵活啦。</p>
<p>这就是鸭子类型。<code>如果它走起路来像鸭子，叫起来嘎嘎的，那么它就是鸭子</code>。</p>
<p>鸭子类型赋予了javascript极大的灵活性，动态调用对象方法的时候非常自由。 </p>
<p>参考《javascript模式设计与开发实践》 第一章</p>
<p>看下面代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> duck = &#123;  <span class="comment">//鸭子对象</span></div><div class="line">		duckSinging: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'嘎嘎嘎'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> chicken = &#123;  <span class="comment">//鸡对象</span></div><div class="line">		duckSinging: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'嘎嘎嘎'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> choir = []; <span class="comment">// 合唱团</span></div><div class="line">	<span class="keyword">var</span> joinChoir = <span class="function"><span class="keyword">function</span>(<span class="params"> animal </span>)</span>&#123; <span class="comment">//实例化动物对象</span></div><div class="line">		<span class="keyword">if</span> ( animal &amp;&amp; <span class="keyword">typeof</span> animal.duckSinging === <span class="string">'function'</span> )&#123; </div><div class="line">       <span class="comment">//稍作检测，只要有唱歌的方法就可以用。</span></div><div class="line">			choir.push( animal );</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'恭喜加入合唱团'</span> );</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'合唱团已有成员数量:'</span> + choir.length );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	joinChoir( duck ); <span class="comment">// 恭喜加入合唱团</span></div><div class="line">	joinChoir( chicken ); <span class="comment">// 恭喜加入合唱团</span></div></pre></td></tr></table></figure>
<p>以上就是一个鸭子类型的代码， 鸡也混入合唱团了，但是没有关系，英雄不问出处，只要你能唱歌就行了。<br>很方便对象方法的调用。 javascript代码中遍布这样的例子，但是现在看来一点也不奇怪了。因为这鸭子类型就是动态语言的优势。而javascript就是动态语言之一，只是实现了这种模式而已。</p>
<p>对于这个问题的认识也破费周折，但是现在看来是值得的。理解了这一点，对javascript的应用能力就更加深了一步。</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-20T00:04:10.000Z" itemprop="datePublished">2017-03-20</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript的模板方法模式" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/19/javascript的模板方法模式/">javascript的模板方法模式</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>模板方法是一种只需要使用继承就可以实现的非常简单的模式<br> 模板方法由两部分组成，一是抽象的父类，二是具体实现的子类。通常在抽象父类中封装了子类的算法框架，包括实现一些公共方法以及封装子类中所有方法的执行顺序。</p>
</blockquote>
<p>参考《javascript模式设计与开发实践》第11章</p>
<p>这个模式方法很有意思,在使用之前需要有一个抽象的额过程，是对类似的生产过程的具体细节的理解，找出流程中的共同点作为抽象的父类。<br>咖啡和茶的冲泡过程</p>
<table>
<thead>
<tr>
<th style="text-align:left">泡<code>咖啡</code></th>
<th style="text-align:left">泡<code>茶</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">把水煮沸</td>
<td style="text-align:left">把水煮沸</td>
</tr>
<tr>
<td style="text-align:left">用沸水<code>泡咖啡</code></td>
<td style="text-align:left">用沸水<code>浸泡茶叶</code></td>
</tr>
<tr>
<td style="text-align:left">把<code>咖啡</code>倒进杯子</td>
<td style="text-align:left">把<code>茶水</code>倒进杯子</td>
</tr>
<tr>
<td style="text-align:left">加<code>糖和牛奶</code></td>
<td style="text-align:left">加<code>柠檬</code></td>
</tr>
</tbody>
</table>
<p>把泡咖啡和泡茶的不同点标示出来，剩下的部分就是共同的部分</p>
<ul>
<li>[ ] 原料不同，一个是咖啡，一个是茶。抽象为饮料</li>
<li>[ ] 泡的方式不同，一个是泡，一个是浸泡。统一抽象为泡</li>
<li>[ ] 加入的调味品不同，一个是糖和牛奶，一个是柠檬。抽象为调料<br>整个冲泡饮料的过程就抽象为下面的流程</li>
</ul>
<ol>
<li>把水煮沸</li>
<li>用沸水冲泡饮料</li>
<li>把饮料倒进被子</li>
<li>加调料</li>
</ol>
<p>抽象的父类的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Beverage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; </div><div class="line">Beverage.prototype.boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log( <span class="string">'把水煮沸'</span> );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Beverage.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 空方法，应该由子类重写</span></div><div class="line">Beverage.prototype.pourInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 空方法，应该由子类重写</span></div><div class="line">Beverage.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 空方法，应该由子类重写</span></div><div class="line">Beverage.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//定义子类的函数执行顺序</span></div><div class="line">	<span class="keyword">this</span>.boilWater();</div><div class="line">	<span class="keyword">this</span>.brew();</div><div class="line">	<span class="keyword">this</span>.pourInCup();</div><div class="line">	<span class="keyword">this</span>.addCondiments();</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>有了父类的模板，在煮茶是就依照父类的模板来使用，通用部分不动，特殊的地方重写父类的方法</p>
<p>茶叶子类继承父类的模板</p>
<pre><code>var Tea = function(){}; //定义煮茶子类
Tea.prototype = new Beverage(); //继承父类
Tea.prototype.brew = function(){ //重写父类方法
    console.log( &apos;用沸水浸泡茶叶&apos; );
};
Tea.prototype.pourInCup = function(){ 重写父类方法
    console.log( &apos;把茶倒进杯子&apos; );
};
Tea.prototype.addCondiments = function(){ 重写父类方法
    console.log( &apos;加柠檬&apos; );
};
var tea = new Tea(); //实例化子类
tea.init(); //依照父类的方法执行顺序来执行

//由于javascript的对象原型继承链的方式和java的继承是完全不同的，这里代码结构和java类似，但是里面的机制是不同的

<figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line"></div><div class="line"><span class="clean">#####钩子方法</span></div><div class="line"></div><div class="line"><span class="number">1.</span> 把水煮沸</div><div class="line"><span class="number">2.</span> 用沸水冲泡饮料</div><div class="line"><span class="number">3.</span> 把饮料倒进被子</div><div class="line"><span class="number">4.</span> 加调料</div><div class="line"></div><div class="line">上面是一般的冲调饮料的流程，但是可能会有特殊情况，比如有的人可能不会加调料。遇到这种情况需要使用`钩子方法`来在隔离有变化的步骤</div></pre></td></tr></table></figure>
</code></pre><p>var Beverage = function(){};<br>    Beverage.prototype.boilWater = function(){<br>        console.log( ‘把水煮沸’ );<br>    };<br>    Beverage.prototype.brew = function(){<br>        throw new Error( ‘子类必须重写brew 方法’ );<br>    };<br>    Beverage.prototype.pourInCup = function(){<br>        throw new Error( ‘子类必须重写pourInCup 方法’ );<br>    };<br>    Beverage.prototype.addCondiments = function(){<br>        throw new Error( ‘子类必须重写addCondiments 方法’ );<br>    };<br>    Beverage.prototype.customerWantsCondiments = function(){<br>        return true; // 默认需要调料<br>    };<br>    Beverage.prototype.init = function(){<br>        this.boilWater();<br>        this.brew();<br>        this.pourInCup();<br>    if ( this.customerWantsCondiments() ){ // 如果挂钩返回true，则需要调料<br>        this.addCondiments(); //第四步就变为可选的方法了<br>    }<br>};<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">实例化冲泡咖啡的实例</div></pre></td></tr></table></figure></p>
<p> var CoffeeWithHook = function(){};<br> CoffeeWithHook.prototype = new Beverage();<br>CoffeeWithHook.prototype.brew = function(){<br>    console.log( ‘用沸水冲泡咖啡’ );<br>};<br>CoffeeWithHook.prototype.pourInCup = function(){<br>    console.log( ‘把咖啡倒进杯子’ );<br>};<br>CoffeeWithHook.prototype.addCondiments = function(){<br>    console.log( ‘加糖和牛奶’ );<br>};<br>CoffeeWithHook.prototype.customerWantsCondiments = function(){<br>    return window.confirm( ‘请问需要调料吗？’ );//对顾客选择的判断条件<br>};<br>var coffeeWithHook = new CoffeeWithHook();</p>
<p>```</p>
<p>模板方法通过封装变化提高系统扩展能力。</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-19T00:04:10.000Z" itemprop="datePublished">2017-03-19</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript组合模式" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/18/javascript组合模式/">javascript组合模式</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>在程序设计中，组合模式就是用小的子对象来构建更大的对象，而这些小的子对象本身也是由更小的对象组成的。这里只是组合，并没有从属关系。参考《javascript设计模式与开发实践》第十章</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//宏命令的代码</span></div><div class="line"><span class="keyword">var</span> closeDoorCommand = &#123;<span class="comment">//作为叶对象</span></div><div class="line">		execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'关门'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">var</span> openPcCommand = &#123; <span class="comment">//作为叶对象</span></div><div class="line">		execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'开电脑'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">var</span> openQQCommand = &#123;<span class="comment">//作为叶对象</span></div><div class="line">		execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'登录QQ'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="comment">//组合模式的根对象</span></div><div class="line">	<span class="keyword">var</span> MacroCommand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> &#123;</div><div class="line">			<span class="attr">commandsList</span>: [],</div><div class="line">			<span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> command </span>)</span>&#123;<span class="comment">//叶对象作为数组的元素传递到</span></div><div class="line">			<span class="comment">//数组中</span></div><div class="line">				<span class="keyword">this</span>.commandsList.push( command );</div><div class="line">			&#125;,</div><div class="line">			<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//执行组合命令</span></div><div class="line">				<span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, command; command = <span class="keyword">this</span>.commandsList[ i++ ]; )&#123;</div><div class="line">					command.execute(); <span class="comment">//叶对象都有execute方法</span></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">var</span> macroCommand = MacroCommand();</div><div class="line">	macroCommand.add( closeDoorCommand );<span class="comment">//添加到根对象数组中</span></div><div class="line">	macroCommand.add( openPcCommand );<span class="comment">//同上</span></div><div class="line">	macroCommand.add( openQQCommand );<span class="comment">//同上</span></div><div class="line">	macroCommand.execute();<span class="comment">//执行根命令</span></div></pre></td></tr></table></figure>
<p><em>两个要点</em>:1.js对象引用可以作为数组元素加入到数组中。2. 叶对象都有一样的execute方法。在根对象执行的时候，可以使用leaf.execute的模式来调用对象的方法。</p>
<blockquote>
<p>在叶对象中还可以继续扩展也对象，组合的深度继续加深。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MacroCommand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//根对象的方法保持不变</span></div><div class="line">		<span class="keyword">return</span> &#123;</div><div class="line">			<span class="attr">commandsList</span>: [],</div><div class="line">			<span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> command </span>)</span>&#123;</div><div class="line">				<span class="keyword">this</span>.commandsList.push( command );</div><div class="line">			&#125;,</div><div class="line">			<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				<span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, command; command = <span class="keyword">this</span>.commandsList[ i++ ]; )&#123;</div><div class="line">					command.execute();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">var</span> openAcCommand = &#123;</div><div class="line">		<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log( <span class="string">'打开空调'</span> );</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"><span class="comment">/**********家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令</span></div><div class="line">*********/</div><div class="line"><span class="keyword">var</span> openTvCommand = &#123;</div><div class="line">	<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( <span class="string">'打开电视'</span> );</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> openSoundCommand = &#123;</div><div class="line">	<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( <span class="string">'打开音响'</span> );</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> macroCommand1 = MacroCommand(); <span class="comment">//第一个叶对象</span></div><div class="line">macroCommand1.add( openTvCommand ); <span class="comment">//添加下一级叶对象</span></div><div class="line">macroCommand1.add( openSoundCommand );<span class="comment">//同上</span></div><div class="line"><span class="comment">/*********关门、打开电脑和打登录QQ 的命令****************/</span></div><div class="line"><span class="keyword">var</span> closeDoorCommand = &#123;</div><div class="line">	<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( <span class="string">'关门'</span> );</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> openPcCommand = &#123;</div><div class="line">	<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( <span class="string">'开电脑'</span> );</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> openQQCommand = &#123;</div><div class="line">	<span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( <span class="string">'登录QQ'</span> );</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> macroCommand2 = MacroCommand();<span class="comment">//第二个叶对象</span></div><div class="line">macroCommand2.add( closeDoorCommand );<span class="comment">//添加下一级叶对象</span></div><div class="line">macroCommand2.add( openPcCommand );<span class="comment">//同上</span></div><div class="line">macroCommand2.add( openQQCommand );</div><div class="line"><span class="comment">/*********现在把所有的命令组合成一个“超级命令”**********/</span></div><div class="line"><span class="keyword">var</span> macroCommand = MacroCommand(); <span class="comment">//顶级根对象</span></div><div class="line">macroCommand.add( openAcCommand ); <span class="comment">//一个叶对象</span></div><div class="line">macroCommand.add( macroCommand1 ); <span class="comment">//另一个</span></div><div class="line">macroCommand.add( macroCommand2 ); <span class="comment">//另一个</span></div><div class="line"><span class="comment">/*********最后给遥控器绑定“超级命令”**********/</span></div><div class="line"><span class="keyword">var</span> setCommand = (<span class="function"><span class="keyword">function</span>(<span class="params"> command </span>)</span>&#123;</div><div class="line">	<span class="built_in">document</span>.getElementById( <span class="string">'button'</span> ).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		command.execute();</div><div class="line">	&#125;</div><div class="line">&#125;)( macroCommand );</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//最终所有的叶对象的引用都添加到commandlist数组中，在根对象上执行</span></div><div class="line"><span class="comment">//execute方法时，会遍历所有的叶对象，并执行leaf.execute()方法。</span></div><div class="line"><span class="comment">//得到结果</span></div></pre></td></tr></table></figure>
<p>#####最终还是使用了javascript的数组操作和对象操作的便利性。在javascript的模式设计中，基本都是在操作数组和对象。所有有必要还好在深刻理解一下数组对象的方法。</p>
<p>这个系列写了好几篇文章了。其实写的时候好多地方还不太懂，写着写着有些地方就明白了，所以还是要坚持写下去。现在觉得写的还不错，过半年可能觉得就很傻了。</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-17T23:04:10.000Z" itemprop="datePublished">2017-03-17</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript桥接模式(2)" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/17/javascript桥接模式(2)/">javascript桥接模式(2)</a>
  

      </h3>
      <div class="repo-list-description">
        
          <ol>
<li>事件监听器</li>
<li>桥接模式的其他例子<br>这实际就是一个闭包的例子，通过闭包函数获取外层函数作用域内定义的私有变量。这个函数又可以叫做特权函数，getter函数。这个函数只get不set.       </li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> <span class="keyword">Public</span> = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">var</span> secret = <span class="number">3</span>;</div><div class="line">  this.privilegedGetter = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> secret;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="keyword">Public</span>;</div><div class="line"><span class="keyword">var</span> data = o.privilegedGetter();</div></pre></td></tr></table></figure>
<p>3 .  用桥接模式联结多个类.通过下面的方法，如果代码从上往下看是聚合了连个类。在桥接类中统一返回。如果是从下往上看代码，实际是把一个完整的代码拆成了两个独立的类，这样两个独立的类可以修改自己的逻辑，不会影响到另一类的工作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">var</span> Class1 = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.a = a;</div><div class="line">  <span class="keyword">this</span>.b = b;</div><div class="line">  <span class="keyword">this</span>.c = c;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Class2 = <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.d = d;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> BridgeClass = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.one = <span class="keyword">new</span> Class1(a, b, c);</div><div class="line">  <span class="keyword">this</span>.two = <span class="keyword">new</span> Class2(d);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>4 . 构建XHR连接队列</p>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-17T13:04:10.000Z" itemprop="datePublished">2017-03-17</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
                  <article id="post-javascript单例模式(1)" class="repo-list">
    <div class="repo-list-item" >
      <h3 class="repo-list-name" itemprop="name">
        
  
      <a class="article-title" href="/2017/03/16/javascript单例模式(1)/">javascript单例模式(1)</a>
  

      </h3>
      <div class="repo-list-description">
        
          <blockquote>
<p>单例(singleton).这种模式提供了一种将代码组织为一个逻辑单元的手段，可以通过单一变量来访问。通过确保单例对象只有一个拷贝，可以确保代买使用童颜的全局资源。单例可以用来划分命名空间，可以借助单例把代码组织的更为一致，从而更容易阅读和维护。</p>
</blockquote>
<pre><code>本文参照这本书第五章，介绍的重点和另一本书好像是不同的。结合着看看    
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/2044710-c97bcd5773f19459.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/320" alt="s3398900.jpg"></p>
<p>####单例的基本结构<br>最基本的就是一个对象字面量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//对象字面量作为单体</span></div><div class="line"><span class="keyword">var</span> Singleton = &#123;</div><div class="line">  <span class="attr">attribute1</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">attribute2</span>: <span class="number">10</span>,</div><div class="line"></div><div class="line">  <span class="attr">method1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">method2</span>: <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Singleton.attribute1 = <span class="literal">false</span>; <span class="comment">//修改</span></div><div class="line"><span class="keyword">var</span> total = Singleton.attribute2 + <span class="number">5</span>; <span class="comment">//使用单例</span></div><div class="line"><span class="keyword">var</span> result = Singleton.method1();</div></pre></td></tr></table></figure>
<p><code>方法位于对象字面量中就有了命名空间，和其他同名的函数就不会冲突了。对象字面量里的方法统一用  nameSpace.method的格式调用</code><br>对象字面量的命名空间还可以继续划分例如parent.children.method。<br>这样不仅变量发生冲突的机会大大减少，而且归属更明确了。</p>
<p>上面的对象字面量的单例是不是很眼熟？ 在node程序中的配置文件config.js里面是不是都是这种代码？ 配置项都是全局唯一的。</p>
<p>#####惰性实例化<br>本来单例是想写这个内容的，但是今天一看，还是没看全。曾探的js模式书里的单例其实都是这个部分。<code>实际的单例代码放在一个函数中，然后使用一个变量来缓存实例化的代码，如果已经实例化就直接返回缓存的代码。</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">  MyNamespace.Singleton = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">var</span> uniqueInstance; <span class="comment">// 私有变量缓存实例化单例</span></div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">constructor</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 具体需要按需加载的代码.</span></div><div class="line">    <span class="keyword">var</span> privateAttribute1 = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">var</span> privateAttribute2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateMethod1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateMethod2</span>(<span class="params">args</span>) </span>&#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123; <span class="comment">// Public members.</span></div><div class="line">      publicAttribute1: <span class="literal">true</span>,</div><div class="line">      <span class="attr">publicAttribute2</span>: <span class="number">10</span>,</div><div class="line">    </div><div class="line">      <span class="attr">publicMethod1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        ...</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">publicMethod2</span>: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</div><div class="line">        ...</div><div class="line">      &#125;</div><div class="line">    &#125;  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">getInstance</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span>(!uniqueInstance) &#123; <span class="comment">// 单例若不存在，调用constructor函数</span></div><div class="line">        uniqueInstance = <span class="keyword">constructor</span>(); //调用<span class="keyword">constructor</span>函数后，缓存返回值</div><div class="line">      &#125;</div><div class="line">      return uniqueInstance;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>

        
      </div>
      <p class="repo-list-meta">
        <span class="meta-info">
          <span class="octicon octicon-calendar"></span>
           <time datetime="2017-03-16T00:04:10.000Z" itemprop="datePublished">2017-03-16</time>
        </span>

        
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href='/categories/Designpattern/' title=''>Designpattern</a>
          </span>
        
      
        <!--
          
            <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
          
        -->

      </p>
    </div>
  </article>
            
        </div>
        <div class="column one-third">
          <!--处理未安装 search 插件 默认 Google 搜索-->
 

<h3>Search</h3>

<div id="site_search">

	<!-- Google -->
	

	<!-- 本地搜索 -->
	
		<form id="search-form" >
			<input type="text" id="search" placeholder="Search" >
			<button type="button" class="btn btn-default" id="site_search_do"><span class="octicon octicon-search"></span></button>
		</form>

		<div id="local-search-result"></div>

		<script src="/js/search.js"></script>	
		<script type="text/javascript">
			$(function(){
				var currentIndex = -1;
				var search_path = "search.xml";
				if (!search_path) search_path = "search.xml";
				var path = "/" + search_path;
				searchFunc(path, 'search', 'local-search-result');

				$(document).delegate("#local-search-result>.search-result-list li","hover",function(){
					var liNode = $("#local-search-result>.search-result-list li");
					liNode.removeClass("hover");
					currentIndex = $("#local-search-result>.search-result-list li").index($(this));
					liNode.eq(currentIndex).addClass("hover");
				})

				$("#search-form").submit(function(){
					return false;
				})

				$("#search").keydown(function(event){
					var keyCode = event.keyCode;
					var liNode = $("#local-search-result>.search-result-list li");
					if(keyCode == 38 || keyCode == 40 || keyCode == 13){
						liNode.removeClass("hover");
						if(keyCode == 38){
							if(currentIndex - 1 >= 0) currentIndex --;
						}
						if(keyCode == 40){
							if(currentIndex + 1 < liNode.length) currentIndex ++;
						}
						if(keyCode == 13){
							location.href = liNode.eq(currentIndex).find("a").attr("href");
						}
						liNode.eq(currentIndex).addClass("hover");
						return false;
					}else{
						currentIndex = -1;
					}
				})
			})
		</script>

	

</div>

<h3>Popular Repositories</h3>
    <div class="popular-container"></div>
    
    <script type="text/template" id="popular-list-template">
        <a href="{%=clone_url%}" class="card text-center" target="_blank">
            <div class="thumbnail">
                <div class="card-image geopattern" data-pattern-id="{%=name%}">
                    <div class="card-image-cell">
                        <h3 class="card-title">
                            {%=name%}
                        </h3>
                    </div>
                </div>
                <div class="caption">
                    <div class="card-description">
                        <p class="card-text">
                            {%=description%}
                        </p>
                    </div>
                    <div class="card-text">
                        <span class="meta-info tooltipped tooltipped-n" aria-label="{%=stargazers_count%} stars">
                            <span class="octicon octicon-star"></span> {%=stargazers_count%}
                        </span>
                        <span class="meta-info tooltipped tooltipped-n" aria-label="{%=forks_count%} forks">
                            <span class="octicon octicon-git-branch"></span> {%=forks_count%}
                        </span>
                        <span class="meta-info tooltipped tooltipped-n" aria-label="最后更新时间：{%=updated_at%}">
                            <span class="octicon octicon-clock"></span>
                            <time datetime="{%=updated_at%}">{%=updated_at%}</time>
                        </span>
                    </div>
                </div>
            </div>
        </a>
    </script>

    <script src="/js/baiduTemplate.js"></script>
    <script type="text/javascript">
        var popular_repos = function(){

            var baiduTpl = new Object();

            var handleTpl = function(){
                baiduTpl.popular_list = baidu.template("popular-list-template");
            };

            var handleGithub = function(){
                var popularContainer = $(".popular-container");

                var repos = "hexo-theme-primer".split(",");
                for(var i in repos){
                    var name = repos[i];
                    $.get("https://api.github.com/repos/yumemor/"+name,handle);
                }

                function handle(result){
                    result.updated_at = result.updated_at.split("T")[0];
                    if(result){
                        var html = baiduTpl.popular_list(result);
                        popularContainer.append(html);
                        $(".geopattern").each(function(){           
                            $(this).geopattern($(this).data('pattern-id'));
                        });
                    }
                }
            };

            return {
                init:function(){
                    handleTpl();
                    handleGithub();
                }
            }
        }; 
        $(popular_repos().init);
    </script>

        </div>
    </div>

    
      <div class="pagination text-align">
          <div class="btn-group">
              <span class="page-number current">1</span><a class="page-number" href="/tags/javascript/page/2/">2</a><a class="page-number" href="/tags/javascript/page/3/">3</a><a class="extend next" rel="next" href="/tags/javascript/page/2/">&raquo;</a>
          </div>
      </div>
    
</section>

<footer class="container">
    <div class="site-footer" role="contentinfo">
        <div class="copyright left mobile-block">
                © 2016
                <span title="yumemor">yumemor</span>
                <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
        </div>

        <ul class="site-footer-links right mobile-hidden">
            <li>
                <a href="javascript:window.scrollTo(0,0)" >TOP</a>
            </li>
        </ul>

        <a href="https://github.com/yumemor/hexo-theme-primer" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <ul class="site-footer-links mobile-hidden">
            
                  
                  <li>
                    <a href="/"  title="首页">首页</a>
                  </li>
            
                  
                  <li>
                    <a href="/category/" target="true" title="分类">分类</a>
                  </li>
            
                  
                  <li>
                    <a href="/open-source/"  title="开源项目">开源项目</a>
                  </li>
            
                  
                  <li>
                    <a href="/message/"  title="留言板">留言板</a>
                  </li>
            
            <li>
                <a href="/atom.xml">
                    <span class="octicon octicon-rss" style="color:orange;"></span>
                </a>
            </li>
        </ul>
    </div>
</footer>

		<script src="/js/geopattern.js"></script>
		<script src="/js/highlight.pack.js"></script>
		<script src="/lib/fancybox/jquery.fancybox-1.3.4.pack.js"></script>

		

		<script src="/js/index.js"></script>

		 <script src="/js/popular_repo.js"></script> 

	</body>
</html>